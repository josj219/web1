/// <reference path="../../Base/Controls/jquery-last-vsdoc.js" />
/// <reference path="Form.aspx" />

var m_evalXML;
var g_szAcceptLang = "ko"; 
var m_sReqMode;
var m_oFormEditor;
var m_cvtXML = $.parseXML("<root></root>");
var m_bApvDirty = false;
var m_bFrmExtDirty = false;
var m_bFrmInfoDirty = false;
var m_sOPubDocNO = "";
var m_sAddList = "";
var m_ibIdx = 0;
var m_bDeputy = false;
var m_oFormReader;
var m_bFileSave = true;
var m_CmtBln = true;
var m_ApvChangeMode = "";		//결재선변경 모
var m_wfid = "";                //현재결재자사번
var m_RejectDocLink = "";       //반송 원문서 필요 정보
var m_bTabForm = false;         //탭형태로 양식 open 여부
var m_FixApvLineData = null;    //지정결재선 필요 정보
var m_FixApvLineCTData = "";    //지정결재선 Controller 필요 정보
var m_FixApvLineDAF = null;     //지정결재선 DAF 필요 정보
var sgINIListFiles = "";        //기존 파일의 쿼리스트링 전송으로 인해 인코딩 문제가 발생
var m_inkClicked = "";
var sLastComment = "";
var m_TempSave = false;
var m_TempSaveInfo = false;     //임시저장시 subject 자동 입력 되었는지 여부
var m_bTempFlag = false;        //임시로 flag 사용(공통)
var m_sTempString = "";         //임시로 string 사용(공통)
var gIsSAP = "";                //SAP연동양식여부(2013-10-14 HIW)
var gFormUrl = "";
var _g_b_smartDocChange = false; // 스마트보고 임시저장 여부
var _g_SmartreportReuse = false; // 스마트보고 재작성여부
var fnUploadCompletedCallBackMethod; //첨부파일 업로드 후 콜백 함수
var g_CheckFileUpload = true;    // 첨부파일 업로드 관련 체크 변수
var a, ua = navigator.userAgent;
var _WebServerDomain = "";

this.agent = {
    safari: ((a = ua.split('AppleWebKit/')[1]) ? (a.split('(')[0]).split('.')[0] : 0) >= 412,
    konqueror: ((a = ua.split('Konqueror/')[1]) ? a.split(';')[0] : 0) >= 3.4,
    mozes: ((a = ua.split('Gecko/')[1]) ? a.split(" ")[0] : 0) >= 20011128,
    opera: (!!window.opera) && (document.body.style.opacity == ""),
    msie: (!!window.ActiveXObject) ? (!!(new ActiveXObject("Microsoft.XMLHTTP"))) : (navigator.appName == 'Microsoft Internet Explorer') ? true : false
} //safari, konqueror, opera url 한글 인코딩 처리를 위해추가

var btoUtf = ((this.agent.safari || this.agent.konqueror || this.agent.opera) ? false : true);

function initOnloadformmenu() {
    //GetBaseConfig 변경 2019.03
    _WebServerDomain = _BaseConfigApv.WebServerDomain;

    //console.log("initOnloadformmenu Start : " + new Date().getHours() + ":" + new Date().getMinutes() + ":" + new Date().getSeconds() + "." + new Date().getMilliseconds());
    // 읽기 모드에서만 '메일로 복사하기' 버튼 보이게 2019.04.29 (by crom)
    if (getInfo("templatemode") == "Read") {
        if (getInfo("loct") == "COMPLETE") { // 완료함에서만 보임         
            // 메일로 복사 버튼제어 기존 로직 주석처리 S. 20191219 beokim
            //if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "COOPERATION_PATTERN") { // 품의서류와 협조전류에서만 보임
            //    $('#btn_CopyToMail').show();
            //}
            // 메일로 복사 버튼제어 기존 로직 주석처리 E. 20191219 beokim

            // 메일로 복사 버튼제어 로직 추가 (양식 옵션으로 분리) S. 20191219 beokim
            if (getInfo("chkscCopyToMailFunction_YN") != undefined && getInfo("chkscCopyToMailFunction_YN") == "Y" && formJson.oFormData.DOC_LEVEL != "01" ) {
                $('#btn_CopyToMail').show();
            }
            else {
                $('#btn_CopyToMail').hide();
            }
            // 메일로 복사 버튼제어 로직 추가 E. 20191219 beokim

            // 메일로 전달 버튼제어 
            if (getInfo("chkscForwardToMail_YN") != undefined && getInfo("chkscForwardToMail_YN") == "Y") {
                $('#btn_ForwardMail').show();
            }
            else {
                $('#btn_ForwardMail').hide();
            }
        }

        // 현대건설은 메일로전달기능을 모든 문서에 대해서 사용함
        if (getInfo("etid") == "H147") {
            // 메일로 전달 버튼제어 
            if (getInfo("chkscForwardToMail_YN") != undefined && getInfo("chkscForwardToMail_YN") == "Y") {
                $('#btn_ForwardMail').show();
            }
        }


    }
    //재사용버튼 클릭으로 들어오는 경우 처리 20111006
    //Forms.js commonDataChanger()로 재사용시 데이터 처리 이동
    //회신옵션 추가 20150129
    if (getInfo("reuse") == "Y" || getInfo("reuse") == "P" || getInfo("reuse") == "YH") {
        if (getInfo("mode") != "DRAFT" && getInfo("mode") != "TEMPSAVE") {
            //반송함에서 재사용할 경우 원문서 경로 포함시키기 getInfo("pidc")
            if (getInfo("mode") == "REJECT" && getInfo("loct") == "REJECT") {
                m_RejectDocLink = getInfo("wiid") + "@@@" + getPIDC() + ";" + getInfo("piid") + ";" + "" + "@@@" + getInfo("SUBJECT") + "@@@" + getInfo("DOC_NO");
            }

            m_sReqMode = "DRAFT";

            //----------------------> 아래부분 다시 복원시킴(양유빈, 2017.06.22)
            setInfo("fiid", getInfo("fiid_reuse")); //setInfo("REPLY", "");
            setInfo("piid", getInfo("piid_spare")); setInfo("pidc", ""); setInfo("mode", "DRAFT"); setInfo("loct", "DRAFT");
            m_sReqMode = "DRAFT";
            document.getElementsByName("APVLIST")[0].value = "";
            setInfo("DOC_NO", "");
            //setInfo("RECEIVE_NO", "");
            setInfo("INITIATOR_ID", getInfo("usid")); setInfo("INITIATOR_NAME", getInfo("usnm")); setInfo("INITIATOR_OU_ID", getInfo("dpid_apv")); setInfo("INITIATOR_OU_NAME", getInfo("dpnm_apv"));
            setInfo("wiid", ""); //201107 재사용으로 임시저장 시 결재선 저장을 위해 처리
            //의견부분 삭제 
            setInfo("commentlist", "<WF_COMMENT></WF_COMMENT>");
            document.getElementsByName("APVLIST")[0].value = getApvListReUse();
            setInfo("apst", document.getElementsByName("APVLIST")[0].value);
            //--------------------->

        }

        if (g_szEditable) {
            //document.getElementById("btDocLinked").style.display = "";
            //document.getElementById("btDocLink").style.display = "";
            document.getElementById("btPreView").style.display = "";
            //if (getInfo("scPM") == "1") { document.getElementById("btPM").style.display = ""; }
        }
    }

    if (getInfo("loct") != "DRAFT" && getInfo("loct") != "TEMPSAVE") {
    }
    else {
        //document.getElementById("btDocLinked").style.display = "";
        //document.getElementById("btDocLink").style.display = "";
    }

    if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") {
        g_szEditable = true;
        //if ((getInfo('scInformationAppV') == '01' || getInfo('scInformationAppV') == '11')) {
        if ((getInfo('scInformationAppV') == '010' || getInfo('scInformationAppV') == '110' || getInfo('scInformationAppV') == '011' || getInfo('scInformationAppV') == '111' || getInfo('scInformationApp_coop_only') == '1') && (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN")) { // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
            try {
                document.getElementById("RecLine").innerHTML = initConsultList();
            }
            catch (e) { }
        } //일경우 결재선에서 협조처가 추가 된 것이다.

    }
    else if (getInfo('editmode') == "Y") {
        g_szEditable = true;
    }

    if (g_szEditable) {
        if (getInfo("Form_AttchDocuments") == "Y") {
            //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
            if (getInfo("farmCode") == _FarmCode) {
                document.getElementById("btDocLinked").style.display = "";
                document.getElementById("btDocLink").style.display = "";
            }
        }
        document.getElementById("btPreView").style.display = "";
    }

    if (document.location.href.toUpperCase().indexOf("/FORMS/FORMTAB.ASPX") > -1) {
        m_bTabForm = true; divMenu.childNodes[1].style.width = "990px";
    }

    //YHM 본문 비교 버튼 추가
    if (getInfo("fmpf") == "WF_FORM_DRAFT" && Number(getInfo("dochistorycnt")) > 0) {
        document.getElementById("btDocBodyHistory").style.display = "none";
    }

    if (getInfo("scCMB") == null || getInfo("scCMB") == "0") {
        m_oFormEditor = window.document;//parent.editor
        m_oFormReader = window.document;//parent.redear

        //TO-DO : 신세계 Customizing 수신부서 결재선도 결재자가 지정하기 때문에 재기안 모드일때도 대결자 셋팅 진행함
        //2016-10-05 BY YJYOO
        //if (admintype != "ADMIN" && getInfo("loct") == "APPROVAL"
        //    && (getInfo("mode") == "APPROVAL" || getInfo("mode") == "PCONSULT" || getInfo("mode") == "RECAPPROVAL")) {
        if (admintype != "ADMIN" && getInfo("loct") == "APPROVAL"
            && (getInfo("mode") == "APPROVAL" || getInfo("mode") == "PCONSULT" || getInfo("mode") == "RECAPPROVAL" || getInfo("mode") == "REDRAFT")) {
            setApvList();
        }
        else {
            document.getElementById("APVLIST").value = getInfo("apst");
        }

        //$("#RecDeptList").val(getInfo("RECEIVE_NAMES"));

        if (getInfo("scSign") == "1") {
            document.getElementById("SIGNIMAGETYPE").value = getInfo("usit");
        }

        if (getInfo("loct") == "ARCHIVE") initBtnArchive();
        else initBtn();

        if ((getInfo("loct") == "MONITOR") || (getInfo("loct") == "PREAPPROVAL") || (getInfo("loct") == "PROCESS") || (getInfo("loct") == "COMPLETE") && (getInfo("mode") != "REJECT")) {
            if ((getInfo("loct") == "PROCESS") && (getInfo("mode") == "PROCESS" || getInfo("mode") == "PCONSULT" || getInfo("mode") == "RECAPPROVAL" || getInfo("mode") == "SUBAPPROVAL" || getInfo("mode") == "AUDIT") && getInfo("INITIATOR_ID") == getInfo("usid") && getInfo("pfsk") == "T006") {
                m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
                var elmRoot = $(m_evalXML).find("steps");
                var elmList = $(elmRoot).find("division > step > ou > person:has(taskinfo[kind!='charge'])");
                var strDate;

                $(elmRoot).find("division > step > ou > person:has(taskinfo[kind!='charge'])").each(function (i, elm) {
                    var elmTaskInfo = $(elm).find("taskinfo");
                    if ($(elmTaskInfo).attr("datecompleted") != null) {
                        strDate = $(elmTaskInfo).attr("datecompleted")
                    }
                });

                //2006.12.14 by wolf //2006.12.13 by wolf 사용자 문서 조회 및 수정
                //관리자 모드가 아닐때
                if (admintype != "ADMIN") {
                    if (strDate == null) {
                        if (getInfo("gloct") != "DEPART") {					// [2015-01-23 modi] 부서진행함 - 조건 없이 실행하던걸 if추가하여 안에 넣음
                            //document.getElementById("btWithdraw").style.display = ""; //회수
                            if (getInfo('scDraftCancel') == 0) { // 회수 사용안함
                                document.getElementById("btWithdraw").style.display = "none";
                            }
                            else {
                                document.getElementById("btWithdraw").style.display = "";
                            }
                        }

                        //수신처 담당자가 pending 상태일 때는 회수 안됨
                        //수신처 수신함에 pending 일 경우 회수 안됨
                        elmList = $(elmRoot).find("division:has(taskinfo[status='pending'])[divisiontype='receive'] > step > ou");

                        if (elmList.length > 0) {
                            if (getInfo('scDraftCancel') == 0) {//상신취소 사용 안함
                                document.getElementById("btWithdraw").style.display = "none"; //상신
                            }
                        }

                    }
                    //else if (strDate != null && getInfo("scDraftCancel") == "1") {
                    //    if ($(elmRoot).find("division[divisiontype='receive'] > step > ou > person[code = '" + getInfo("usid") + "']:has(taskinfo[kind = 'charge'])").length == 0) {
                    //        document.getElementById("btAbort").style.display = "";		 //진행 중 문서도 취소가 됨
                    //    }
                    //}
                }
                //강제합의
                var elmAssist = $(elmRoot).find("division:has(taskinfo[status='pending']) > step[routetype='assist'][@unittype='ou']:has(taskinfo[status='pending'])");
                if (elmAssist.length > 0 && getInfo("scForcedConsent") == "1") {
                    if (addDate("d", getInfo("scForcedConsentV"), getInfo("INITIATED_DATE"), "-") <= getInfo("svdt").substring(0, 10)) {
                        document.getElementById("btForcedConsent").style.display = "";
                    }
                }
                //합의부서 삭제 - 
                elmAssist = $(elmRoot).find("division:has(taskinfo[status='pending']) > step:has(taskinfo[status='pending'])[routetype='assist'][unittype='ou'] > ou:has(taskinfo[status='pending'])");
                if (getInfo("scDCooRemove") == "1" && elmAssist.length > 0) {
                    var bPendigOUs = false;

                    $(elmRoot).find("division:has(taskinfo[status='pending']) > step:has(taskinfo[status='pending'])[routetype='assist'][unittype='ou'] > ou:has(taskinfo[status='pending'])").each(function (i, elmaOU) {
                        var elmaPerson = $(elmaOU).find("person");
                        if (elmaPerson.length == 0) {
                            bPendigOUs = true;
                        }
                    });

                    if (bPendigOUs) document.getElementById("btDCooRemove").style.display = "";
                }
            }
        }
        if (getInfo("pfsk") == "MONITOR") {
            document.getElementById("btRecDept").style.display = "none"; document.getElementById("btPrint").style.display = "none"; document.getElementById("btOrder").style.display = "none"; document.getElementById("btReUse").style.display = "none"; document.getElementById("btCirculate").style.display = "none";
            switch (getInfo("loct")) {
                case "PREAPPROVAL": document.getElementById("btMonitor").style.display = "none"; break;
                case "COMPLETE": document.getElementById("btMonitor").style.display = ""; $('#btDocMove').css("display", ""); document.getElementById("btExit").alt = gLabel__close2; break; //"미확인 닫기"
            }
        }

        if (getInfo("reuse") == "N") document.getElementById("btModify").style.display = "none";

        //2013.07 : 현결재자 변경 후 후결 셋팅
        if (getInfo("scChangeReview") == "1") // 특정 양식만
        {
            if (getInfo("pfsk") == "T006") //기안자
            {
                if (getInfo("loct") == "PROCESS" && getInfo("mode") == "PROCESS") { //진행함에서 현재결재자가 일반결재일 경우
                    var m_evalXMLChangeReview = $.parseXML(document.getElementById("APVLIST").value);
                    var elmRootChangeReview = $(m_evalXMLChangeReview).find("steps");

                    var elmApprover = $(elmRootChangeReview).find("division[divisiontype='send']:has(>taskinfo[status = 'pending' ]) > step > ou > person:has(taskinfo[kind='normal'][status='pending'])");
                    if (elmApprover.length == 1) document.getElementById("btApproverChangeReview").style.display = "";
                }

                if (getInfo("loct") == "PROCESS" && getInfo("mode") == "PCONSULT") { //진행함에서 현재결재자가 협조일 경우
                    var m_evalXMLChangeDeputy = $.parseXML(document.getElementById("APVLIST").value);
                    var elmRootChangeDeputy = $(m_evalXMLChangeDeputy).find("steps");

                    var elmApprover = $(elmRootChangeDeputy).find("division[divisiontype='send']:has(>taskinfo[status = 'pending' ]) > step[routetype='consult']:has(>taskinfo[status = 'pending' ]) > ou > person:has(taskinfo[kind='consult'][status='pending'])");
                    if (elmApprover.length > 0) document.getElementById("btApproverChangeDeputy").style.display = "";
                }
            }
        }
    }

    //도움말 팝업
    try {
        if ((getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") && getInfo("UseDocHelpApproval") == "Y") {
            //document.getElementById("btHelpView").style.display = ""; 	/ / 양식도움말
            $("#trHelpApproval").css("display", "");
            //if (getInfo("UseDocChargeTalk") == "Y") {
            //    $("#btChargeTalk").css("display", "");
            //}
            document.getElementById("HelpApproval").innerHTML = getInfo("RESERVED1");
        }
        if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") {
            //helpOpen("popup");
            setTimeout("helpOpen('popup');", 100);
        }
    } catch (e) {
    }

    // [2015-07-20 han add] 양식팝업창 title 변경
    if (!((getInfo("SecuritySetupAt") == "Y" || getInfo("SECURITY_YN") == "Y") && CehckUseWebDRM(getInfo("DOC_LEVEL")))) {
        //document.getElementsByTagName('title')[0].text = _strAppName + " - " + getInfo("fmnm");
        // [2020-09-25 chang hun 수정] 양식팝업창 title 다국어적용
        document.getElementsByTagName('title')[0].text = _strAppName + " - " + Common.GetDic("FormName_"+getInfo("etid")+"_"+getInfo("fmpf"));
    }


    //if (getInfo("fmpf") == "WF_FORM_DRAFT_IC0_003") {
    if (getInfo('scApvLineTypeauto') == 'R') {
        var TEXT = $('#btDeptLineConsultText').html();
        if (TEXT != null)
            $('#btDeptLineConsultText').html(TEXT.split("^")[1]);
        else
            $('#btDeptLineConsultText').html("");
    }
    //if (getInfo("fmpf") == "WF_FORM_DRAFT_IC0_999") {
    if (getInfo('scApvLineTypeauto') == 'D') {
        var TEXT = $('#btDeptLineConsultText').html();
        if (TEXT == null)
            $('#btDeptLineConsultText').html(TEXT);
        else
            $('#btDeptLineConsultText').html(TEXT.split("^")[0]);
    }
    //보안여부  [파워텍] 관련 보안여부 체크시
    fn_getSecurity();
    //console.log("initOnloadformmenu END : " + new Date().getHours() + ":" + new Date().getMinutes() + ":" + new Date().getSeconds() + "." + new Date().getMilliseconds());

    //현대건설, 현대엔지니어링 보안 예외 사용자 처리
    if (getInfo("templatemode") == "Read") {
        if (!(formJson.oFormData.DOC_LEVEL == undefined))
        { fn_docSecurityUserCheck(formJson.oFormData.DOC_LEVEL); }
    }
}

//보안여부 [파워텍] 관련 보안여부 체크시 SecurityForm(관리자 PAGE에서 체크시) KBW 20180123
function fn_getSecurity() {
    //보안여부 [파워텍] 관련 보안여부 체크시 SecurityForm(관리자 PAGE에서 체크시) KBW 20180123
    if (getInfo("LOCAL_HPT_ApprovalYN") == "Y") {
        $("#secrecy").show();
        //if (getInfo("fmpf") == "GWOK_GENERAL" || getInfo("SecurityForm") == "Y")
        //    $("#secrecy").show();

        if (getInfo("mode") == "DRAFT") {
            if (getInfo("SecurityForm") == "Y") {
                //CS 에서 SecuritySetupAt 추가
                $("input:checkbox[id='chk_secrecy']").prop("checked", true);
                chk_secrecy_onclick();
            }
        }
        else if (getInfo("mode") == "TEMPSAVE") {
            if (formJson.BODY_CONTEXT.DOCSECURITY == "1") {
                //CS 에서 SecuritySetupAt 추가
                $("input:checkbox[id='chk_secrecy']").prop("checked", true);
                chk_secrecy_onclick();
            }
        }
        else {
            if (getInfo("SecuritySetupAt") == "Y") {
                //CS 에서 SecuritySetupAt 추가
                $("input:checkbox[id='chk_secrecy']").prop("checked", true);
                chk_secrecy_onclick();
                fn_setSecurity();
            }
            else {
                fn_setSecurity();
            }
        }
    }
}

function fn_setSecurity() {
    //읽기모드 시 보안 결재 선택 불가
    if (getInfo("templatemode") == "Read" && getInfo("editmode") == "N") {

        $("input:checkbox[id='chk_secrecy']").attr("disabled", true);
    }
    //편집 이면서 발신 부서일 경우 getInfo('scLCHBis') == '1' scCHBis getInfo("currentDocumentStateCode") == "SEND"
    //수신 부서에서 편집 시 보안 결재 선택 불가. 아래 로직 주석 처리.. 필요할 수 있음. KBW 20180413 
    //else if (getInfo("templatemode") == "Write" && getInfo("editmode") == "Y")
    //{
    //    var elmRoot = $.parseXML(document.getElementById("APVLIST").value);

    //    switch (getInfo("pdef"))
    //    {
    //        //신청서류의 경우 수신 부서에서는 편집 기능시에도 보안 결재를 선택 불가.
    //        case "DEPT_INTER_PATTERN":
    //            var strStatus = $(elmRoot).find("division > step > ou > role > person > taskinfo").attr("status");
    //            //롤 결재자의 대기 중일 경우 inactive 가 아닌 경우
    //            //신청서류 수신 부서 품의서 협조전 에서는 보안 결재 체크를 수정할 수 없음. 
    //            if (strStatus == 'pending' || strStatus == "completed") {
    //                $("input:checkbox[id='chk_secrecy']").attr("disabled", true);
    //            }
    //            break;
    //        //품의서류의 발신부서를 제외한 나머지 협조처 검토자 
    //        case "GENERAL_PATTERN":
    //            break;
    //        //협조전 류의 발신부서를 제외한 나머지 협조처 담당자 
    //        case "COOPERATION_PATTERN":
    //            break;
    //    }
    //}
}

//test
//양식에 필요한 정보 팝업(팝업공지, 양식도움말 등을 띄운다)
function helpOpen(type) {
    var sTitle = "";
    if (type == "popup") {
        if (getInfo("UseDocPopupApproval") != "Y") {
            return;
        } else {
            sTitle = Common.GetDic("lbl_NoticePopup");
        }
    } else if (type == "popupbtn") {
        if (getInfo("UseDocPopupBtn") != "Y") {
            return;
        } else {
            sTitle = Common.GetDic("lbl_NoticePopup");
        }
    } else if (type == "help") {
        if (getInfo("UseDocHelpApproval") != "Y") {
            return;
        } else {
            sTitle = Common.GetDic("lbl_apv_formcreate_LCODE28");
        }
    } else {
        return;
    }
    var sUrl2 = "/Approval/Forms/FormHelpPopup.aspx?type=" + type;
    var iHeight = 400; var iWidth = 600;

    if (getInfo("DocPopupHeight") != "" && getInfo("DocPopupWidth") != "") {
        iHeight = getInfo("DocPopupHeight");
        iWidth = getInfo("DocPopupWidth");
    }

    var nLeft = (screen.width - iWidth) / 2;
    var nTop = (screen.height - iHeight) / 2;
    var sWidth = iWidth.toString() + "px";
    var sHeight = iHeight.toString() + "px";
    var sLeft = nLeft.toString() + "px";
    var sTop = nTop.toString() + "px";

    //var nLeft = (screen.width - iWidth) / 2;
    //var nTop = (screen.height - iHeight) / 2;
    //var sWidth = iWidth.toString() + "px";
    //var sHeight = iHeight.toString() + "px";
    //var sActIndx = "";
    //var sTitle = "";

    //CFN_OpenWindow(sUrl2, "", iWidth, iHeight, "resize");
    Common.ShowDialog("btHelpPopup", "", Common.GetDic("lbl_apv_formcreate_LCODE28"), sUrl2, iWidth, iHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
    //Common.ShowDialog(pTargetId, pSelfId, sTitle, strUrl, "700px", "455px", "iframe-ifNoScroll");
}

function setApvDirty() { m_bApvDirty = true; }

function setApvChangeMode(pMode) { m_ApvChangeMode = pMode; }	//결재선변경 모드

//json object로 대체
//getInfo, setInfo 대체 방안
function getInfo(sKey) {
    try {
        return formJson.oFormData[sKey];
    }
    catch (e) {
        alert(gMessage254 + sKey + gMessage255);//"양식정보에 없는 키값["+sKey+"]입니다."
    }
}

function setInfo(sKey, sValue, sException) {
    try {
        formJson.oFormData[sKey] = sValue;
    } catch (e) {
        if (sException == null) {
            alert(Message254 + sKey + gMessage255);//"양식정보에 없는 키값["+sKey+"]입니다."
        }
    }
}

//setPreView 함수 분리
function setPreViewData() {
    try {
        //if (CFN_GetQueryString("openID") == getInfo('fmid')) {//Layer popup 실행일 경우 queryString으로 openID를 넘김
        if (CFN_GetQueryString("editMode") == 'Y' && CFN_GetQueryString("CFN_OpenWindowName") == 'undefined') {//Layer popup 실행일 경우 완료함, 편집함에서 미리보기 할 경우 
            openID = CFN_GetQueryString("openID");
            if ($("#" + openID + "_if", parent.document).length > 0) {
                m_oInfoSrc = $("#" + openID + "_if", parent.document)[0].contentWindow;
                var sFormXml = m_oInfoSrc.getFormXML('preview');

            }
        } else if (openMode == "L") {//Layer popup 실행일 경우 queryString으로 openID를 넘김
            var openID = getInfo('fmid');
            if ($("#" + openID + "_if", parent.document).length > 0) {
                m_oInfoSrc = $("#" + openID + "_if", parent.document)[0].contentWindow;
                var sFormXml = m_oInfoSrc.getFormXML('preview');
            }
        } else {
            if (CFN_GetQueryString("mobileyn") == "Y" && getInfo('readtype') == "pdfdown") {
                var sFormXml = getFormXML('preview');
            }
            else {
                var sFormXml = opener.getFormXML('preview');
            }
        }
        if (sFormXml.indexOf("<BODY_CONTEXT>") == -1) {
            sFormXml = sFormXml.replace("</formdata>", "");
            sFormXml += makeNode("BODY_CONTEXT", getInfo("BODY_CONTEXT"));
            sFormXml += "</formdata>";
        }

        var xmlFormXML = $.parseXML(sFormXml);

        var FormNodes = xmlFormXML.documentElement.childNodes;
        var FormNode;

        for (var i = 0; i < FormNodes.length; i++) {
            FormNode = FormNodes[i];
            if ($(FormNode).context.tagName == "bodyinfo") {
                setInfo($(FormNode).context.tagName, CFN_XmlToString($(FormNode)[0]));
            }
            else if ($(FormNode).context.tagName == "BODY_CONTEXT") {
                if ($(FormNode).text().indexOf("<BODY_CONTEXT>") == 0) {
                    setInfo($(FormNode).context.tagName, $(FormNode).text());
                }
                else {
                    setInfo($(FormNode).context.tagName, "<BODY_CONTEXT>" + $(FormNode).text() + "</BODY_CONTEXT>");
                }
            }
            else if ($(FormNode).context.tagName == "ATTACH_FILE_INFO") { //작성에서 인쇄 보기시 첨부파일 그리기.
                if (CFN_GetQueryString("Readtype") == "preview") {
                    List = GetOpenerApprovalUpLoadFileList();
                    if (List.length > 0) setInfo("ATTACH_FILE_INFO", " ");
                }
                else
                    setInfo($(FormNode).context.tagName, $(FormNode).text());
            }
            else {
                setInfo($(FormNode).context.tagName, $(FormNode).text());
            }

        }

        //BODY_CONTEXT json object 처리
        if (typeof formJson.oFormData.BODY_CONTEXT == 'undefined') {
            var tempObj = {};
            tempObj["BODY_CONTEXT"] = $.xml2json(getInfo('BODY_CONTEXT'));
            if (typeof formJson.BODY_CONTEXT == 'undefined') {
                formJson = mergeJsonObj(formJson, tempObj);
            }
        }
        else {
            formJson.BODY_CONTEXT = $.xml2json(getInfo('BODY_CONTEXT'));
        }

        //bodyinfo json object 처리
        if (typeof formJson.oFormData.bodyinfo == 'undefined') {
            var tempObj = {};
            tempObj["bodyinfo"] = $.xml2json(getInfo('bodyinfo'));
            if (typeof formJson.bodyinfo == 'undefined') {
                formJson = mergeJsonObj(formJson, tempObj);
            }
        }
        else {
            formJson.bodyinfo = $.xml2json(getInfo('bodyinfo'));
        }

    } catch (e) {
        alert(e.message);
    }

}

function setPreViewPostRendering() {
    try {
        setInfo("INITIATED_DATE", getInfo("svdt"));
        g_szEditable = false;
        setInfo("mode", "COMPLETE");
        setInfo("loct", "COMPLETE");


        if (CFN_GetQueryString("openID") == getInfo("fmid") || CFN_GetQueryString("editMode") == 'Y' && CFN_GetQueryString("CFN_OpenWindowName") == 'undefined') {
            document.getElementById("APVLIST").value = m_oInfoSrc.document.getElementById("APVLIST").value;

        } else {
            if (CFN_GetQueryString("mobileyn") == "Y" && getInfo('readtype') == "pdfdown") {
                document.getElementById("APVLIST").value = getInfo("apst");
            }
            else {
                document.getElementById("APVLIST").value = opener.document.getElementById("APVLIST").value;
            }
        }

        initOnloadformedit();

        var aBtn = document.getElementsByName("cbBTN");
        for (var i = 0; i < aBtn.length; i++) {
            aBtn[i].style.display = "none";
        }

        //대외공문 미리보기 창
        //[2015-01-29 LeeSM] readtype = print 조건 추가
        if (getInfo("readtype") != "Pubpreview" && getInfo("readtype") != "Print") {
            document.getElementById("btPrint").style.display = "";
            //if (_ie) {
            //    $("#divbtPrintView").show()//인쇄미리보기
            //}

        } else if (getInfo("readtype") == "Pubpreview" || getInfo("readtype") == "Print") {
            //대외공문미리보기 일경우 양식명, 결재선, 참고정보 display:none;
            document.getElementById("divMenu02").style.display = "none";
            document.getElementById("divTempMemo").style.display = "none";
            document.getElementById("formlogo").style.display = "none";
            document.getElementById("AppLine").style.display = "none";
            document.getElementById("AppLineListType").style.display = "none";
            document.getElementById("AssistLine").style.display = "none";
            document.getElementById("tbLinkInfo").style.display = "none";
            document.getElementById("tbLinkInfo").style.display = "none";
        }
        //댓글, 발신댓글, 수신댓글 제거
        document.getElementById("CommentTable").style.display = "none";
        document.getElementById("div_table").style.display = "none";
        document.getElementById("div_table_REC").style.display = "none";
        document.getElementById("btExitPreView").style.display = "";
    } catch (e) {
        alert(e.message);
    }
}

//미리보기 창에서 하던 함수를 수정함
function setPreView() {
    var sFormXml = opener.getFormXML();
    if (sFormXml.indexOf("<BODY_CONTEXT>") == -1) {
        sFormXml = sFormXml.replace("</formdata>", "");
        sFormXml += makeNode("BODY_CONTEXT", getInfo("BODY_CONTEXT"));
        sFormXml += "</formdata>";
    }
    var xmlFormXML = $.parseXML(sFormXml);

    var FormNodes = xmlFormXML.documentElement.childNodes;
    var FormNode;
    for (var i = 0; i < FormNodes.length; i++) {
        FormNode = FormNodes[i];
        if ($(FormNode).context.tagName == "bodyinfo") {
            setInfo($(FormNode).context.tagName, CFN_XmlToString($(FormNode)[0]));
        } else {
            setInfo($(FormNode).context.tagName, $(FormNode).text());
        }
    }

    setInfo("INITIATED_DATE", getInfo("svdt"));
    g_szEditable = false;
    setInfo("mode", "COMPLETE");
    setInfo("loct", "COMPLETE");
    document.getElementById("APVLIST").value = opener.document.getElementById("APVLIST").value;

    initOnloadformedit();

    var aBtn = document.getElementsByName("cbBTN");

    for (var i = 0; i < aBtn.length; i++) {
        aBtn[i].style.display = "none";
    }

    //대외공문 미리보기 창
    //[2015-01-29 LeeSM] readtype = print 조건 추가
    if (getInfo("readtype") != "Pubpreview" && getInfo("readtype") != "Print") {
        document.getElementById("btPrint").style.display = "";
        //if (_ie) {
        //    $("#divbtPrintView").show()//인쇄미리보기
        //}

    } else if (getInfo("readtype") == "Pubpreview" || getInfo("readtype") == "Print") {
        //대외공문미리보기 일경우 양식명, 결재선, 참고정보 display:none;
        document.getElementById("divMenu02").style.display = "none";
        document.getElementById("divTempMemo").style.display = "none";
        document.getElementById("formlogo").style.display = "none";
        document.getElementById("AppLine").style.display = "none";
        document.getElementById("AppLineListType").style.display = "none";
        document.getElementById("AssistLine").style.display = "none";
        document.getElementById("tbLinkInfo").style.display = "none";
    }

    document.getElementById("btExitPreView").style.display = "";

    clearInterval(timerID);
}

function setOpenWindowData() {
    try {
        //작성창 조회창 구분에 따른 값 가져오기 처리
        if (getInfo("templatemode") == "Write") {
            //2012차기버전작업 var sFormXml = getFormXML();
            var sFormXml = getFormXML();
            if (sFormXml.indexOf("<BODY_CONTEXT>") == -1) {
                sFormXml = sFormXml.replace("</formdata>", "");
                sFormXml += makeNode("BODY_CONTEXT", getInfo("BODY_CONTEXT"));
                sFormXml += "</formdata>";
            }
            var xmlFormXML = $.parseXML(sFormXml);

            var FormNodes = xmlFormXML.documentElement.childNodes;
            var FormNode;
            for (var i = 0; i < FormNodes.length; i++) {
                FormNode = FormNodes[i];
                if ($(FormNode).context.tagName == "bodyinfo") {
                    setInfo($(FormNode).context.tagName, CFN_XmlToString($(FormNode)[0]));
                } else {
                    setInfo($(FormNode).context.tagName, $(FormNode).text());
                }
            }

            //BODY_CONTEXT json object 처리
            if (typeof formJson.oFormData.BODY_CONTEXT != 'undefined') {
                var tempObj = {};
                tempObj["BODY_CONTEXT"] = $.xml2json(getInfo('BODY_CONTEXT'));
                if (typeof formJson.BODY_CONTEXT == 'undefined') {
                    formJson = mergeJsonObj(formJson, tempObj);
                }
            }

            //bodyinfo json object 처리
            if (typeof formJson.oFormData.bodyinfo != 'undefined') {
                var tempObj = {};
                tempObj["bodyinfo"] = $.xml2json(getInfo('bodyinfo'));
                if (typeof formJson.bodyinfo == 'undefined') {
                    formJson = mergeJsonObj(formJson, tempObj);
                }
            }

        }
    } catch (e) {
        alert(e.message);
    }
}

function setOpenWindowPostRendering() {
    try {
        document.getElementById("APVLIST").value = $("textarea[name=APVLIST]", opener.document).val();  //HIW

        initOnloadformedit();

        if (opener.openID != null && opener.openMode == "L") {
            opener.parent.Common.Close(opener.openID);
        } else {
            //작성이외의 LayerPopup에서 새창 떳을때 opener가 사라져, destination 상실 보완 by ssuby 2011-12-29
            if (opener.location.href.toUpperCase().indexOf("/APPROVAL/FORMS/FORMWRITE.ASPX") > -1) {
                opener.document.location.href = "/Approval/FormList/FormList.aspx?system=Approval&alias=Form&mnid=74"; //결재문서 작성 페이지
            }
            else {
                opener.openID = getInfo("fmid") + getInfo("piid") + getInfo("fiid");
                opener.parent.Common.Close(opener.openID);
            }
        }
    } catch (e) {
        alert(e.message);
    }
}

//분리
function setOpenWindow() {
    //작성창 조회창 구분에 따른 값 가져오기 처리
    if (getInfo("templatemode") == "Write") {
        //2012차기버전작업 var sFormXml = getFormXML();
        var sFormXml = getFormXML();
        if (sFormXml.indexOf("<BODY_CONTEXT>") == -1) {
            sFormXml = sFormXml.replace("</formdata>", "");
            sFormXml += makeNode("BODY_CONTEXT", getInfo("BODY_CONTEXT"));
            sFormXml += "</formdata>";
        }
        var xmlFormXML = $.parseXML(sFormXml);

        var FormNodes = xmlFormXML.documentElement.childNodes;
        var FormNode;
        for (var i = 0; i < FormNodes.length; i++) {
            FormNode = FormNodes[i];
            setInfo(FormNode.nodeName, FormNode.textContent);
        }

        document.getElementById("APVLIST").value = $("textarea[name=APVLIST]", opener.document).val();  //HIW

        initOnloadformedit();
    }
    clearInterval(timerID1);
    if (opener.openID != null && opener.openMode == "L") {
        opener.parent.Common.Close(opener.openID);
    } else {
        //작성이외의 LayerPopup에서 새창 떳을때 opener가 사라져, destination 상실 보완 by ssuby 2011-12-29
        if (opener.location.href.toUpperCase().indexOf("/APPROVAL/FORMS/FORMWRITE.ASPX") > -1) {
            opener.document.location.href = "/Approval/FormList/FormList.aspx?system=Approval&alias=Form&mnid=74"; //결재문서 작성 페이지
        }
        else {
            //20120125 By ssuby 새창열릴때 기존 reload대신 opner인 Layer창만 닫는 처리로 변경
            opener.openID = getInfo("fmid") + getInfo("piid") + getInfo("fiid");
            opener.parent.Common.Close(opener.openID);
        }
    }
}


function fn_ChkApvListVicePresident()
{
    var rtn = true;
    
    $(m_oApvList).find("steps > division[divisiontype='send'] >").each(function (idx, item) {
        if ($(item).find("step > ou[code='1E__']").length > 0 || $(item).find("step > ou > person[code='9971268']").length > 0) {
            //delapprovalorder = $(item).find("step").attr("approvalorder");
            $(item).find("step > ou > person[code='9971268']").parent().parent().remove();
            $("#APVLIST").val(CFN_XmlToString(m_oApvList));
            initApvList();
            // alert("결재문서에서 수석부회장님의 결재정보는 결재선에서 자동 삭제 됩니다."); 
            rtn = false;
        }
    });

    return rtn;
}

//보안 결재 혹은 보안 문서일 경우  //KBW 20180412
function fn_SetSecurityDoc(isBool) {


    if (isBool) {
        //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
        if (getInfo("farmCode") == _FarmCode) {
            $("#divbtScheduleAdd").show();//2. 일정추가
            $("#divbtWorkAdd").show();//3. 할일추가
        }
        $("#btMailSend").hide(); //우편함으로
        $("#divbtUrl").hide(); //링크복사
        $("#btReUse").hide(); //재사용
        $("#btCopy").hide(); //복사
        $("#btShare").hide(); //회람    

        $("#divbtAddTemplate").hide(); //템플릿추가
        $("#divbtRemoveTemplate").hide(); //템플릿추가
        $("#divbtPcSave").hide(); //PC저장
        if (getInfo("loct") == "TEMPSAVE" || getInfo("loct") == "DRAFT" || (getInfo("templatemode") == "Write" || getInfo("editmode") == "M")) {
            $("#divbtPreView").show();
        }
        else {
            $("#divbtPrint").show();
        }
    }
    else {
        //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
        if (getInfo("farmCode") == _FarmCode) {
            $("#divbtScheduleAdd").show();//2. 일정추가
            $("#divbtWorkAdd").show();//3. 할일추가
            $("#divbtMailSend").show();//4. 우편함으로  
        }

        $("#divbtUrl").show();// 1. 링크복사

        if ((getInfo("mode") != "DRAFT" && getInfo("mode") != "TEMPSAVE") && getInfo("templatemode") == "Read") {

            //$("#divbtPcSave").show(); //5. PC저장 옵션처리 20171017 hpark
            //if (Common.GetBaseConfig('PCSave_UseYN') == "Y") {
            if (getInfo('PCSave_UseYN') == "Y") {
                $("#divbtPcSave").show();
            } else {
                $("#divbtPcSave").hide();
            }

        }
        if (getInfo("fmpf") != "GOJP_WORKFORM_W01") { // 업무표준은 인쇄버튼 양식에서 제어
            if (getInfo("loct") == "TEMPSAVE" || getInfo("loct") == "DRAFT" || (getInfo("templatemode") == "Write" || getInfo("editmode") == "M")) {
                $("#divbtPreView").show();
            }
            else {
                $("#divbtPrint").show();
            }
        }
        //TO-DO : 현대기아자동차 양식 템플릿 저장 / 해제 버튼 생성
        //2017-04-03 YJYOO    
        //템플릿 추가,삭제버튼제어 --> Approval에서 Complete으로 이동
        //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
        if (getInfo("farmCode") == _FarmCode) {
            if (getInfo("loct") == "COMPLETE" && getInfo("UseAddTemplate") == "Y") {
                TemplateButtonDisplay();
            }
        }
    }

}




function initBtn() {
    //console.log("initBtn Start : " +new Date().getHours() + ":" + new Date().getMinutes() + ":" + new Date().getSeconds() + "." + new Date().getMilliseconds());
    //공지 팝업 버튼 사용여부

    if (getInfo("UseDocPopupBtn") == "Y") {
        document.getElementById("btDocPopup").style.display = "";
    }
    if (getInfo('Dept_comment') == 'Y') {
        $('#CommentTable').css('display', '');
    }

    //TO-DO : 현재 결재선의 결재한 사람존재여부 체크
    //2017-06-08 BY YJYOO
    var currApvListXML = $.parseXML(document.getElementById("APVLIST").value);

    var currApprovalCnt = 0;
    currApprovalCnt = $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='completed'][kind!='charge']").length; //현결재자 존재여부
    //var currApprovalCntt = 0;
    //currApprovalCntt = currApvListXML.querySelectorAll("steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='completed']").length;

    //발신부서 기안자 전결일 경우는 1로 만듬.
    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step").length == 1)
        currApprovalCnt = $(currApvListXML).find("steps > division[divisiontype='send'] > step").length;

    //var SendApprovalCnt = $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='pending'],[status='inactive']").length; //발신부서 결재완료 여부(협조전 확인용)
    var SendApprovalCnt = $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='pending'],[status='inactive'], steps > division[divisiontype='send'] > step >  ou > role > person > taskinfo[status='pending'],[status='inactive']").length; //발신부서 결재완료 여부(협조전 확인용)

    //발신부서 결재완료 카운트 갯수가 맞지 않아 수정
    //var SendApprovalCnt = $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='pending'][status='inactive'], steps > division[divisiontype='send'] > step >  ou > role > person > taskinfo[status='pending'][status='inactive']").length; //발신부서 결재완료 여부(협조전 확인용)
    var RoleApprovalOrder = 1000000;
    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step:has(ou > role)").length > 0)
        RoleApprovalOrder = parseInt($($(currApvListXML).find("steps > division[divisiontype='send'] > step:has(ou > role)")).attr("approvalorder"));

    //TO-DO : 품의서류 협조처 발송여부 체크
    //2017-06-26 BY YJYOO
    var checkHasConsult = false;
    if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "") {
        if ($($.parseXML(getInfo("strConsultJson"))).find("division > step").length > 0) { checkHasConsult = true; }
    }

    /*****************************공통 버튼 활성화 영역*******************************/
    //협조전/3단계 류
    if (SendApprovalCnt == 0 && (getInfo("pdef") == "COOPERATION_PATTERN" || getInfo("pdef") == "STEP3_PATTERN")) {
        if (getInfo("piid_parent") != "") {
            $("#btnReceiptStatus").show();//협조처 수신확인
        }
        else {
            if (getInfo("loct") != "REJECT") {
                $("#btnReceiptStatus").show();//협조처 수신확인
            }
        }
    }
    else {
        //품의서류 협조처 발송시 권한에 관계없이 협조처 상세조회 버튼 활성화
        if (getInfo("CONSULT_LIST") != undefined && getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1) {
            $("#btnCooperationView").show();
        }
    }

    if (getInfo("loct") == "REJECT") {
        if (getInfo("pdef") == "COMPUTATION_PATTERN" || getInfo("pdef") == "STEP4_PATTERN") {
            if ($(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='reject']").length > 0) {
                $("#btDeny_Reason").show();//기각사유
            }
            else {
                $("#btRejectRequest_Reason").show();//반송사유
            }
        }
        else {
            if (getInfo("currentDocumentStateCode") == "SEND") {
                // 협조거부시 기각 의견표시
                if (getInfo("pdef") == "GENERAL_PATTERN" && getInfo("cooperDenyDeptInfo") && getInfo("cooperDenyDeptInfo").split("||").length > 4) { // getInfo("scCooperDenyReject") == "1"
                    $("#btRejectRequest_Reason").show();//반송사유
                } else {
                    $("#btDeny_Reason").show();//기각사유
                }
            }
            else {
                if (getInfo("pdef") == "REQUEST_PATTERN") {
                    $("#btDeny_Reason").show();//기각사유
                }
                else {
                    $("#btRejectRequest_Reason").show();//반송사유
                }
            }
        }

    }
    //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
    //if (getInfo("loct") == "COMPLETE") {
    if (getInfo("loct") == "COMPLETE" && getInfo("farmCode") == _FarmCode) {

        if (CFN_GetQueryString("folder") == "UFOLDER") {
            $("#btDocMove").hide();//관심문서함을 통해서 문서를 열람했을때 숨김
        }
        else {
            $("#btDocMove").show();//관심문서로 등록
        }
    }

    //아이콘 처리  보안결재 혹은 보안 문서일 경우 true 그렇지 않으면 False 수정 KBW20180413 

    if (formJson.oFormData.DOC_LEVEL == "01" && formJson.oFormData.DOC_LEVEL != undefined) {
        fn_SetSecurityDoc(true);
    }
    else if (getInfo("mode") == "DRAFT" && getInfo("SecurityForm") == "Y") { //[파워텍] 기안시 보안 결재 Y 로 셋팅 시 처리 로직  KBW20180413
        fn_SetSecurityDoc(true);
    }
    else if (formJson.BODY_CONTEXT != undefined) { // 임시저장 시 체크 값이 누락되는 현상으로 인해 템플릿 Hidden 필드에 저장 혹은 진행중에서도 사용. KBW20180413
        if (formJson.BODY_CONTEXT.DOCSECURITY == "1" && formJson.BODY_CONTEXT.DOCSECURITY != undefined) {
            fn_SetSecurityDoc(true);
        } //투자품의서 6가지 양식의 경우 DOCSECURITY 데이터가 누락되는 현상 
        else if (getInfo("SecuritySetupAt") == "Y") {
            fn_SetSecurityDoc(true);
        }
        else {
            fn_SetSecurityDoc(false);
        }
    }
    else {
        fn_SetSecurityDoc(false);
    }

    //건설 및 4개사 공문프로세스(REQUEST_CRRF_PATTERN) 완료문서볼때 상단 버튼 많아서 밀리는것 수정
    // 우상단 링크복사 일정추가 할일추가 버튼 안보이도록 20200909 심창훈
    if (getInfo("templatemode") == "Read" && getInfo("loct") == "COMPLETE" && getInfo("pdef") == "REQST_CRRF_PATTERN") {
        $('#divbtUrl').hide();
        $('#divbtScheduleAdd').hide();
        $('#divbtWorkAdd').hide();

    }

    /*****************************공통 버튼 활성화 영역*******************************/
    if (getInfo("loct") == "ADMIN") {
        // 관리자화면에서 공람자 추가 기능 처리 2018-11-12 iwyoon
        if (getInfo("COMPLETED_DATE") != "" && getInfo("documentViewStateCode") != "REJECT" && getInfo("mode") != "PROCESS" && (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN")) {
            $("#btGongRam").show();//공람자 버튼 
        }
    }
    //권한이 없는 사용자(Link로 문서 열었을 경우)
    if (getInfo("gloct") == "NOT_AUTH") {
        $('#CommentTable').css('display', 'none');
        //if (getInfo("loct") != "REJECT") {
        $("#btn_PaymentLine").show()//현황판
        //}
        if (getInfo("mode") == "PREAPPROVAL") {
            if (getInfo("pdef") == "ABROAD_PATTERN" && getInfo("approvalOrder") == RoleApprovalOrder)
                $("#btLinePreapproval").show();
        }
        return;
    }

    setInfo("ChkReceiptManagement", "N");

    if (getInfo("mode") == "APPROVAL" && IsReceiptManagement() && (
        //(getInfo("pdef") == "REQUEST_PATTERN" && getInfo("gloct") == "REQUEST_PLACE" && getInfo("mode_unit") == "RECEIVEDEPT_APPROVAL")
        //(getInfo("pdef") == "COOPERATION_PATTERN" && getInfo("gloct") == "RECEIVE_PLACE")
        (getInfo("pdef") == "REQST_CRRF_PATTERN" && getInfo("gloct") == "RECEIVE_PLACE")
        )) {
        var oPerson = $(currApvListXML).find("step[approverat='Y']:eq(0) > ou > person:eq(0)");
        
        setInfo("managerid", oPerson.attr("code"));

        oPerson.attr("name", getInfo("usdn"));
        oPerson.attr("code", getInfo("usid"));
        oPerson.attr("dutyname", getInfo("ustn"));
        oPerson.attr("dutycode", getInfo("ustc"));
        oPerson.attr("positionname", getInfo("uspn"));
        oPerson.attr("position", getInfo("uspc"));
        oPerson.attr("batchAt", "");

        setInfo("usismanager", "Y");
        setInfo("loct", "APPROVAL");
        setInfo("gloct", "APPROVAL");
        setInfo("openerDivisionType", "RECEIVE");
        setInfo("CurrentApprovalParicipant_approverCompanyCode", getInfo("etid"));
        setInfo("CurrentApprovalParicipant_approverDepartmentCode", getInfo("dpid"));
        if (getInfo("pdef") == "REQUEST_PATTERN") {
            setInfo("mode", "REDRAFT");
        } else if (getInfo("pdef") == "COOPERATION_PATTERN") {
            setInfo("mode", "REDRAFT");
            setInfo("mode_unit", "COOPERATION_APPROVAL");
            setInfo("openerDocumentStepCode", "COOPERATION_REQUEST");
        } else {
            setInfo("mode", "RECAPPROVAL");
            setInfo("mode_unit", "RECEIVE_APPROVAL");
        }

        setInfo("ChkReceiptManagement", "Y");

        $("#APVLIST").val(CFN_XmlToString(currApvListXML));
        initApvList();
    }
    else if (getInfo("gloct") == "SEND_PLACE") { //발신처 부서원
        //부서내류, 부서간류, 3단계류, 전산사용권한류를 제외한 모든 문서 공람자 활성화
        if (getInfo("loct") == "COMPLETE" && (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN")) {
            $("#btGongRam").show();//공람자 버튼 
        }
        $("#btn_PaymentLine").show()//현황판
        return;
    }
    else if (getInfo("gloct") == "COOPERATION_PLACE") { //협조처 부서원
        //부서내류, 부서간류, 3단계류, 전산사용권한류를 제외한 모든 문서 공람자 활성화
        //if (getInfo("loct") == "COMPLETE" && (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN")) {
        if (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN") {
            $("#btGongRam").show();//공람자 버튼 
        }
        $("#btn_PaymentLine").show()//현황판


        return;
    }
    else if (getInfo("gloct") == "RECEIVE_PLACE") { //수신처 부서원
        //if (!IsReceiptManagement()) {
            //부서내류, 부서간류, 3단계류, 전산사용권한류를 제외한 모든 문서 공람자 활성화
            //if (getInfo("loct") == "COMPLETE" && (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN")) {
            if (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN") {
                $("#btGongRam").show();//공람자 버튼 
            }
            $("#btn_PaymentLine").show()//현황판

            //2018.08.23 한규동 대리 요청으로 부서원에게 회람기능 추가.
            //공문 프로세스 회람기능 안보이게 처리
            if (getInfo("pdef") != "REQST_CRRF_PATTERN") {
                if (getInfo("farmCode") == _FarmCode && (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER") && (Common.GetBaseConfig("ShareUseYN") != "N")) {
                    if (((formJson.oFormData.DOC_LEVEL == "01" && formJson.oFormData.DOC_LEVEL != undefined) || (getInfo("SecurityForm") != undefined && getInfo("SecurityForm") == "Y") || (formJson.BODY_CONTEXT != undefined && formJson.BODY_CONTEXT.DOCSECURITY == "1" && formJson.BODY_CONTEXT.DOCSECURITY != undefined))) {
                        $("#btShare").hide();//회람
                    } else {
                        $("#btShare").show();//회람
                    }
                }
            }

            return;
        //} else if (getInfo("mode") == "APPROVAL") {
        //    setInfo("loct", "APPROVAL");
        //}
    }
    else if (getInfo("gloct") == "POST_APPROVAL") {//후결자
        $("#btPostApproved").show();//결재
    }

    if (getInfo("chkPulicObjectYN") == "Y") {
        $("#btn_PublicObjectType").show();//공시여부
    }

    switch (getInfo("loct")) {
        case "PREAPPROVAL":
            {
                //닫기 버튼
                $("#btn_PaymentLine").show()//현황판
                //$("#divbtPrint").show()//인쇄

                //의견추가버튼
                if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "COOPERATION_PATTERN" || getInfo("pdef") == "INVEST_PATTERN" || getInfo("pdef") == "ABROAD_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") {
                    //if (getInfo("fmpf") != "GWOJ_VENDOR_W01") { //대외문은 의견추가를 사용하지 않는다
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        $("#btCommentAdd").show();//의견추가
                    }
                    else if (getInfo("mode_unit") == "APPROVAL") { // 진행중일때 결재자의 경우
                        $("#btCommentAdd").show();//의견추가
                    }
                    //}
                }
                else if (getInfo("pdef") == "COMPUTATION_PATTERN") {
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        $("#btCommentAdd").show();//의견추가
                    }
                }
                else {
                    //의견추가 버튼 //결재선 포함된사용자만
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        $("#btCommentAdd").show();//의견추가
                    }
                }
                // 20200610 hpark 예결함에서 선결
                if (getInfo("scPrecdngApproval") == "1" && getInfo("CurrentDivisionIdx") == "0") {
                	var _isNoneCooperOrComplete = true;

                	//if (getInfo("CONSULT_LIST")) { // 협조처가 있을경우    
                	//	if (getInfo("CONSULT_LIST").indexOf(":N:") > -1) { // 협조처 발송안했을때 선결 불가
                	//		_isNoneCooperOrComplete = false;
                	//	} else { // 협조처가 진행중일때 선결 불가
                	//		var _strConsultApv = getInfo('strConsultJson');
                	//		var _strConsultApvLine;
                	//		if (_strConsultApv != null && _strConsultApv != undefined && _strConsultApv != "") {
                	//			_strConsultApvLine = $.parseXML(_strConsultApv);
                	//			if ($(_strConsultApvLine).find("division[name='COOPERATION_PLACE']").find("person > taskinfo[status='pending']").length > 0) {
                	//				_isNoneCooperOrComplete = false;
                	//			}
                	//		}
                	//	}
                	//}
                	if (getInfo("pdef") == "GENERAL_PATTERN" && getInfo("CONSULT_LIST")) { // 일반품의류에서 협조처가 있으면 선결 불가
                		_isNoneCooperOrComplete = false;
					}
                	if (_isNoneCooperOrComplete) {
                		var arrLastApprover = fn_IsLastApprover('send', 'all', 'approve', 'all').split('|');
                		if (arrLastApprover[0] == getInfo("usid") && arrLastApprover[1] == getInfo("approvalOrder")) {
                			$("#btPrecdngApproval").show();
                		}
                	}
                }

            }
            break;
        case "PROCESS":
        case "RESERVATION":
            {
                if (!(getInfo("templatemode") == "Write" || getInfo("editmode") == "M")) {
                    $("#btn_PaymentLine").show()//현황판
                }
                //$("#divbtPrint").show()//인쇄
                //수신 또는 협조처이면서 부서내류, 부서간류, 3단계류, 전산사용권한류, 신청서를 제외한 모든 문서 공람자 활성화
                if (getInfo('piid_parent') != '' && (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN" && getInfo("pdef") != "REQUEST_PATTERN")) {
                    $("#btGongRam").show();//공람자 버튼 
                }

                //기안 모드일때 품의서류 또는 협조전류 프로세스이면 협조처 버튼을 보이지 않는다.
                if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") {
                    //if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1) {
                    //    $("#btnCooperationView").show();
                    //}
                    //if (getInfo("strConsultJson") != "" && Common.GetSession("UR_IsManager") == "True" && getInfo("currentDocumentStateCode") == "SEND") {
                    if (getInfo("strConsultJson") != "" && getInfo("usismanager") == "Y" && getInfo("currentDocumentStateCode") == "SEND") {
                        //var m_oSubReStep = $(m_oApvList).find("division:has(>taskinfo[status='pending'])>step[unittype='ou']:has(taskinfo[status='pending'][piid='" + getInfo("piid").toUpperCase() + "'])");
                        if (_UR_Code == $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person:has(> taskinfo[status='pending'])").attr("code")) {
                            if (getInfo("WorkingBudgetHasReject") != "Y") {
                                $("#btModifyE").show();
                            }
                            //진행중 협조요청 상태에서 기각버튼 표시
                            if (_UR_Code == $(currApvListXML).find("steps > division[divisiontype='send'] > step[approverat='P'] > ou > person:has(> taskinfo[status='pending'])").attr("code"))
                                $("#btDeny").show();
                        }
                    }
                    //의견추가 버튼 //결재선 포함된사용자만
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        //if (currApprovalCnt == 0) {
                        //    if (!checkHasConsult && getInfo('scDraftCancel') == 1) {
                        //        $("#btWithdraw").show();//상신취소
                        //    }
                        //}
                        if (getInfo('scDraftCancel') == 1) {
                            if (currApprovalCnt == 0) {
                                if (Common.GetBaseConfig("HEC_COMPANY") != "Y") {
                                    if (!checkHasConsult) {
                                        $("#btWithdraw").show();//상신취소
                                    }
                                }
                                else {
                                    $("#btWithdraw").show();//상신취소
                                }
                            }
                            else {
                                if (Common.GetBaseConfig("CANCEL_DOC_INPROC") == "Y")
                                $("#btWithdraw").show();//상신취소
                            }
                        }
                        
                        $("#btCommentAdd").show();//의견추가
                    }
                    else if (getInfo("mode_unit") == "COOPERATION_APPROVAL") { // 협조처 팀장이 열었을경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "") {
                                //협조처의 내 다음 결재자가 아직 결재하지 않은 상태인지 확인
                                //BPM에서 해당사항 수정 후 기능 오픈 예정
                                var prerUserOrder = "";
                                var prevUser = "";
                                var currUser = $($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "'] > ou > person").attr("code");

                                if ($($.parseXML(getInfo("strConsultJson"))).find("division > step[approverat='Y'][processinstanceid='" + getInfo("piid") + "']").prev().length > 0) {
                                    prerUserOrder = $($.parseXML(getInfo("strConsultJson"))).find("division > step[approverat='Y'][processinstanceid='" + getInfo("piid") + "']").prev().attr("approvalorder");
                                    prevUser = $($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + prerUserOrder + "'][processinstanceid='" + getInfo("piid") + "'] > ou > person").attr("code");
                                }
                                var currentOrder = (currUser == prevUser) ? prerUserOrder : getInfo("approvalOrder");

                                if ($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + currentOrder + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0 &&
                                    $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + currentOrder + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                    && $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + currentOrder + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                    $("#btCancelApprove").show();
                                }
                            }
                        }
                    }
                    else if (getInfo("mode_unit") == "EXAMINATION_APPROVAL") { // 검토자가 열었을 경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            //협조처의 내 다음 결재자가 아직 결재하지 않은 상태인지 확인
                            //BPM에서 해당사항 수정 후 기능 오픈 예정
                            if ($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0 &&
                                $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                    && $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                $("#btCancelApprove").show();
                            }
                        }
                    }
                    else if (getInfo("mode_unit") == "APPROVAL") {










                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            //TO-DO : 통합신청서류는 ROLE 결재 이후에는 결재취소 버튼을 활성화 시키지 않는다.
                            var isCompleteRole = false;
                            isCompleteRole = (getInfo("pdef") == "UNITY_REQST_PATTERN" && $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > role").length > 0 && $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > role").find("taskinfo").attr("status") == "completed") ? true : false;
                            if (getInfo("pdef") == "GENERAL_PATTERN" || (getInfo("pdef") == "UNITY_REQST_PATTERN" && !isCompleteRole)) {
                                // 진행중일때 결재자의 경우
                                //품의류 = 협조처에 발송한경우
                                if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "" && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                    //협조처에서 결재자를 지정한 곳이 있는경우
                                    if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length > 0) {
                                        if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                            //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                            if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                                            && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                            && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                                //다음 결재자가 협조 요청을 하면 취소 버튼 안나옴.
                                                var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                                if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0)
                                                    $("#btCancelApprove").show();
                                                if (BPMBeforeApproval == "N")
                                                    $("#btCancelApprove").hide();
                                            }
                                        }
                                    }
                                        //협조처에서 결재자를 지정한 곳이 없으면 결재취소 가능
                                    else {
                                        //기안자이면서 협조 요청 한 사람일 경우(팀장 또는 보직을 가진 사용자)
                                        if (getInfo("approvalOrder") == "100") {
                                            var drafterStep = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']"));
                                            if (drafterStep.attr("approverat") == "P") {
                                                //TO-DO : 기안자가 상신하며 협조요청시 선결재여부에 따라 결재취소/상신취소 여부
                                                if (drafterStep.attr("beforeapprovalat") != null && drafterStep.attr("beforeapprovalat") == "Y") {
                                                    //$("#btWithdraw").show();//상신취소
                                                }
                                                else {
                                                    $("#btCancelApprove").show();//결재취소
                                                }
                                            }
                                            else {
                                                //if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200']").length > 0 && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200']")).attr("approverat") != "P"
                                                //&& $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200'][processinstanceid='" + getInfo("piid") + "']")).find("ou > person > taskinfo").attr("status") == "pending") {
                                                //    if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='200']").length == 0) {
                                                //        $("#btWithdraw").show();//상신취소
                                                //    }
                                                //}
                                            }
                                        }
                                        else {
                                            //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                            if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0) {
                                                if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                                    if (BPMBeforeApproval != "N")
                                                        $("#btCancelApprove").show();
                                                }
                                                else {
                                                    if ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                                        && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                                        //다음 결재자가 협조 요청을 하면 취소 버튼 안나옴.
                                                        var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                                        if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0)
                                                            $("#btCancelApprove").show();
                                                    }
                                                }
                                            }
                                                //마지막 결재자의 경우
                                            else {
                                                if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                                    if (BPMBeforeApproval != "N")
                                                        $("#btCancelApprove").show();
                                                }
                                            }
                                        }
                                    }
                                }
                                    //품의류 = 협조처에 발송하지 않은 경우
                                    //품의류가 아닌 경우
                                else {
                                    //$("#btCancelApprove").show();
                                    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                        //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                        if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                                        && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                        //&& $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("routetype") != "assist"
                                        //TO-DO : 다음결재자가 순차협조자 일때는 결재취소가 가능하게 처리
                                        //2020-08-31 BY YJYOO
                                        && (($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("routetype") == "assist" && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("allottype") == "serial") 
                                            || $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("routetype") != "assist")
                                            //다음 결재자가 참조자인 경우 결재취소 버튼 안보이게 하기 위해 추가 (통합신청서류 및 일반품의류) KBW 20180515
                                        && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("routetype") != "reference"
                                            //다음 결재자가 후결자인 경우 결재취소 버튼 안보이게 하기 위해 추가 (통합신청서류 및 일반품의류) KBW 20180515
                                        && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).find("ou > person > taskinfo").attr("kind") != "review"
                                        && ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending"
                                            || $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > role > taskinfo").attr("status") == "pending")) {
                                            //다음 결재자가 협조 요청을 하면 취소 버튼 안나옴.
                                            var nextApprovalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                            if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprovalorder + "']").length == 0)
                                                $("#btCancelApprove").show();
                                        }
                                        //if($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']")).attr("routetype") == "assist"_
                                        //$("#btCancelApprove").hide();
                                    }
                                    else if (getInfo("scApvAssistHidden") != undefined && getInfo("selPersonSend") != undefined) {
                                        if (getInfo("scApvAssistHidden") == "1" && (!(getInfo("selPersonSend") == "N" || getInfo("selPersonSend") == ""))) {

                                            //결재자 결재취소 버튼 유무 결재문서가 다음결재자로 넘어갔을 경우
                                            if ($(currApvListXML).find("division[divisiontype='send'] > step[approverat='Y'][processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo[status='pending']").length > 0) {
                                                //병렬 협조 - 병렬 결재자 중 결재를 하지 않은 상태인 경우 결재취소 가능
                                                if (($(currApvListXML).find("division[divisiontype='send'] > step[approverat='Y'][allottype='parallel'][processinstanceid='" + getInfo("piid") + "']")).length > 0) {
                                                    if (($(currApvListXML).find("division[divisiontype='send'] > step[approverat='N'][allottype='parallel'][processinstanceid='" + getInfo("piid") + "']")).length == 0) {
                                                        $("#btCancelApprove").show();
                                                    }
                                                }
                                                else if (($(currApvListXML).find("division[divisiontype='send'] > step[allottype!='parallel'][approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") { //병렬 협조자가 없는 경우 체크
                                                    $("#btCancelApprove").show();
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }

                        if (getInfo("scDraftCancel") == 1)//상신취소
                        {
                            //TO-DO : 통합신청서류는 ROLE 결재 이후에는 결재취소 버튼을 활성화 시키지 않는다.
                            var isCompleteRole = false;
                            isCompleteRole = (getInfo("pdef") == "UNITY_REQST_PATTERN" && $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > role").length > 0 && $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > role").find("taskinfo").attr("status") == "completed") ? true : false;
                            if (getInfo("pdef") == "GENERAL_PATTERN" || (getInfo("pdef") == "UNITY_REQST_PATTERN" && !isCompleteRole)) {
                                // 진행중일때 결재자의 경우
                                //품의류 = 협조처에 발송한경우
                                if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "" && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                    //협조처에서 결재자를 지정한 곳이 있는경우
                                    if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length > 0) {
                                        //if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                        //    //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                        //    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                                        //    && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                        //    && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                        //        //다음 결재자가 협조 요청을 하면 취소 버튼 안나옴.
                                        //        var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                        //        if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0)
                                        //            $("#btCancelApprove").show();
                                        //        if (BPMBeforeApproval == "N")
                                        //            $("#btCancelApprove").hide();
                                        //    }
                                        //}
                                    }
                                        //협조처에서 결재자를 지정한 곳이 없으면 결재취소 가능
                                    else {
                                        //기안자이면서 협조 요청 한 사람일 경우(팀장 또는 보직을 가진 사용자)
                                        if (getInfo("approvalOrder") == "100") {
                                            var drafterStep = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']"));
                                            if (drafterStep.attr("approverat") == "P") {
                                                //TO-DO : 기안자가 상신하며 협조요청시 선결재여부에 따라 결재취소/상신취소 여부
                                                if (drafterStep.attr("beforeapprovalat") != null && drafterStep.attr("beforeapprovalat") == "Y") {
                                                    $("#btWithdraw").show();//상신취소
                                                }
                                                else {
                                                    //$("#btCancelApprove").show();//결재취소
                                                }
                                            }
                                            else {
                                                if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200']").length > 0 && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200']")).attr("approverat") != "P"
                                                && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200'][processinstanceid='" + getInfo("piid") + "']")).find("ou > person > taskinfo").attr("status") == "pending") {
                                                    if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='200']").length == 0) {
                                                        $("#btWithdraw").show();//상신취소
                                                    }
                                                }
                                            }
                                        }
                                        else {
                                            //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                            //if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0) {
                                            //    if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                            //        $("#btCancelApprove").show();
                                            //    }
                                            //    else {
                                            //        if ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                            //            && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                            //            //다음 결재자가 협조 요청을 하면 취소 버튼 안나옴.
                                            //            var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                            //            if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0)
                                            //                $("#btCancelApprove").show();
                                            //        }
                                            //    }
                                            //}
                                            //    //마지막 결재자의 경우
                                            //else {
                                            //    if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                            //        $("#btCancelApprove").show();
                                            //    }
                                            //}
                                        }
                                    }
                                }
                                    //품의류 = 협조처에 발송하지 않은 경우
                                    //품의류가 아닌 경우
                                else {
                                    //$("#btCancelApprove").show();
                                    //if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                    //    //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                    //    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                                    //    && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                    //    && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("routetype") != "assist"
                                    //    && ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending"
                                    //        || $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > role > taskinfo").attr("status") == "pending")) {
                                    //        //다음 결재자가 협조 요청을 하면 취소 버튼 안나옴.
                                    //        var nextApprovalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                    //        if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprovalorder + "']").length == 0)
                                    //            $("#btCancelApprove").show();
                                    //    }
                                    //    //if($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']")).attr("routetype") == "assist"_
                                    //    //$("#btCancelApprove").hide();
                                    //}
                                }
                            }
                        }

                        $("#btCommentAdd").show();//의견추가
                    }
                    else if (getInfo("mode_unit") == "AGREEMENT_P_APPROVAL" && getInfo("scApvAssistHidden") != undefined && getInfo("selPersonSend") != undefined) {
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            if (getInfo("scApvAssistHidden") == "1" && (!(getInfo("selPersonSend") == "N" || getInfo("selPersonSend") == ""))) {
                                //결재자 결재취소 버튼 유무 결재문서가 다음결재자로 넘어갔을 경우
                                if ($(currApvListXML).find("division[divisiontype='send'] > step[approverat='Y'][processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo[status='pending']").length > 0) {
                                    //병렬 협조 - 병렬 결재자 중 결재를 하지 않은 상태인 경우 결재취소 가능
                                    if (($(currApvListXML).find("division[divisiontype='send'] > step[approverat='Y'][allottype='parallel'][processinstanceid='" + getInfo("piid") + "']")).length > 0) {
                                        if (($(currApvListXML).find("division[divisiontype='send'] > step[approverat='N'][allottype='parallel'][processinstanceid='" + getInfo("piid") + "']")).length == 0) {
                                            $("#btCancelApprove").show();
                                        }
                                    }
                                    else if (($(currApvListXML).find("division[divisiontype='send'] > step[allottype!='parallel'][approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") { //병렬 협조자가 없는 경우 체크
                                        $("#btCancelApprove").show();
                                    }
                                }
                            }
                        }
                    }

                    if (getInfo("currentDocumentStateCode") == "SEND" && getInfo('SpecialReport') == 'Y') {
                        if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고 결재자이면서 발신부서가 아닐경우 _ 품의서
                    }
                }
                else if (getInfo("pdef") == "COOPERATION_PATTERN") {
                    //협조전류의 협조처에서 의견추가 버튼은 보이지 않는다
                    //if (getInfo("mode_unit") == "COOPERATION_APPROVAL") { //현결재자가 협조처 팀장의 경우
                    //    $("#btCommentAdd").show();//의견추가
                    //}
                    //else if (getInfo("mode_unit") == "EXAMINATION_APPROVAL") { //현결재자가 검토자의 경우
                    //    $("#btCommentAdd").show();//의견추가
                    //}
                    if (getInfo("mode_unit") == "COOPERATION_APPROVAL" || getInfo("mode_unit") == "CHARGE_APPROVAL" || getInfo("mode_unit") == "PARENT_DRAFT") { //현결재자가 협조처 팀장의 경우
                        if (getInfo("scApproveCancel") == 1) {
                            //$("#btCancelApprove").show();//결재취소
                            //협조처의 내 다음 결재자가 아직 결재하지 않은 상태인지 확인
                            //BPM에서 해당사항 수정 후 기능 오픈 예정
                            if ($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0 &&
                                $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                && $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                $("#btCancelApprove").show();
                            }
                        }
                    }

                    //if (SendApprovalCnt == 0) {
                    //    $("#btnReceiptStatus").show();//협조처 수신확인
                    //$("#btGongRam").show();//공람자 버튼 
                    //}

                    //if (getInfo("currentDocumentStateCode") == "RETURN_REQUEST") {
                    //    $("#btRejectRequest_Reason").show();
                    //}

                    //의견추가 버튼 //결재선 포함된사용자만
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        //if (currApprovalCnt == 0 && getInfo('scDraftCancel') == 1) {
                        //    $("#btWithdraw").show();//상신취소
                        //}
                        if (getInfo('scDraftCancel') == 1) {
                            if (currApprovalCnt == 0) {
                                $("#btWithdraw").show();//상신취소
                            }
                            else {
                                if (Common.GetBaseConfig("CANCEL_DOC_INPROC") == "Y")
                                    $("#btWithdraw").show();//상신취소
                            }
                        }
                        //if (getInfo("fmpf") != "GWOJ_VENDOR_W01") { //대외문은 의견추가를 사용하지 않는다
                        $("#btCommentAdd").show();//의견추가
                        //}
                    }
                    if (getInfo("mode_unit") == "APPROVAL") { // 진행중일때 결재자의 경우
                        // 결재취소는 현 결재자가 열람자 다음 사람일 경우
                        if (getInfo("scApproveCancel") == 1) {
                            if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                            && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending")
                                $("#btCancelApprove").show();//결재취소
                        }
                        //if (getInfo("fmpf") != "GWOJ_VENDOR_W01") { //대외문은 의견추가를 사용하지 않는다
                        $("#btCommentAdd").show();//의견추가
                        //}
                    }

                    if (getInfo("currentDocumentStateCode") == "SEND" && getInfo('SpecialReport') == 'Y') {
                        if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고
                    }

                    //발신처이면서 예약결재된 양식이면 협조처 예약발송 버튼 활성화
                    if (getInfo("openerDivisionType") == "SEND" && getInfo("BOOKING_APPROVAL_YN") == "Y") {
                        //버튼에서 라벨로 변경
                        $('#ApvLineTemp_booking').html("<span onclick='fn_PopBooking_Approval();' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_Booking_Approval") + "&gt;" + "</span>");
                    }
                }
                else if (getInfo("pdef") == "COMPUTATION_PATTERN") {
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        if (currApprovalCnt == 0 && getInfo('scDraftCancel') == 1) {
                            $("#btWithdraw").show();//상신취소
                        }
                        $("#btCommentAdd").show();//의견추가
                    }

                    if (getInfo("mode_unit") == "RECEIVE_APPROVAL") {
                        if ($(currApvListXML).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0 &&
                                $($(currApvListXML).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                && $($(currApvListXML).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                            $("#btCancelApprove").show();
                        }
                    }
                }
                else if (getInfo("pdef") == "INVEST_PATTERN") {

                    //진행중 협조요청 상태에서 기각버튼 표시
                    if (getInfo("strConsultJson") != "" && getInfo("currentDocumentStateCode") == "SEND") { // getInfo("usismanager") == "Y"
                        if (_UR_Code == $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > role > person:has(> taskinfo[status='pending'])").attr("code")) {
                            if (_UR_Code == $(currApvListXML).find("steps > division[divisiontype='send'] > step[approverat='P'] > ou > role > person:has(> taskinfo[status='pending'])").attr("code"))
                                $("#btDeny").show();
                        }
                    }

                    //if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1) {
                    //    $("#btnCooperationView").show();
                    //}
                    //의견추가 버튼 //결재선 포함된사용자만
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        if (currApprovalCnt == 0) {
                            if (!checkHasConsult && getInfo('scDraftCancel') == 1) {
                                $("#btWithdraw").show();//상신취소
                            }
                        }
                        $("#btCommentAdd").show();//의견추가
                    }
                    else if (getInfo("mode_unit") == "COOPERATION_APPROVAL") { // 협조처 팀장이 열었을경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "") {
                                //협조처의 내 다음 결재자가 아직 결재하지 않은 상태인지 확인
                                //BPM에서 해당사항 수정 후 기능 오픈 예정
                                if ($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0
                                    && $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                    && $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                    $("#btCancelApprove").show();
                                }
                            }
                        }
                    }
                    else if (getInfo("mode_unit") == "EXAMINATION_APPROVAL") { // 검토자가 열었을 경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            //협조처의 내 다음 결재자가 아직 결재하지 않은 상태인지 확인
                            //BPM에서 해당사항 수정 후 기능 오픈 예정
                            if ($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0
                                && $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                && $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                $("#btCancelApprove").show();
                            }
                        }
                    }
                    else if (getInfo("mode_unit") == "APPROVAL") { // 진행중일때 결재자의 경우
                        // 결재취소는 현 결재자가 열람자 다음 사람일 경우
                        //if (checkHasConsult && $($.parseXML(getInfo("strConsultJson"))).find("division > step > ou > person:has(> taskinfo[status='completed'])").length == 0) {
                        //품의류 = 협조처에 발송한경우
                        if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "" && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                            if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] > step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length > 0 && getInfo('openerDocumentStepCode') == "MANAGEMENT_RECEIVE") {
                                if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                                        && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                        && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                        //다음 결재자가 협조 요청을 하면 취소 버튼 안나옴.
                                        var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                        if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0)
                                            $("#btCancelApprove").show();
                                    }
                                }
                            }
                            else {

                                //기안자이면서 협조 요청 한 사람일 경우(팀장 또는 보직을 가진 사용자)
                                if (getInfo("approvalOrder") == "100") {
                                    //$("#btWithdraw").show();//상신취소

                                    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본
                                    var CurApvPerson = $(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > person:has(taskinfo[status='pending'])");
                                    if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN" && CurApvPerson != null && (formJson.BODY_CONTEXT.CTRL_STEP == $(CurApvPerson).attr("dutycode") && getInfo("usid") == $(CurApvPerson).attr("code"))) {
                                        if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "" && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                            //협조처에서 결재자를 지정한 곳이 있는경우
                                            if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                                var drafterStep = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']"));
                                                if (drafterStep.attr("approverat") == "P") {
                                                    //TO-DO : 기안자가 상신하며 협조요청시 선결재여부에 따라 결재취소/상신취소 여부
                                                    if (drafterStep.attr("beforeapprovalat") != null && drafterStep.attr("beforeapprovalat") == "Y") {
                                                        //$("#btWithdraw").show();//상신취소
                                                    }
                                                    else {
                                                        $("#btCancelApprove").show();//결재취소
                                                    }
                                                }
                                            }

                                        }
                                    }
                                }
                                else {
                                    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0) {
                                        if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                            $("#btCancelApprove").show();
                                        }
                                        else {
                                            if ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                                && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                                var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                                if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0) {
                                                    $("#btCancelApprove").show();
                                                }
                                            }
                                        }
                                    }
                                        //마지막 결재자의 경우
                                    else {
                                        if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                            $("#btCancelApprove").show();
                                        }
                                    }
                                }
                            }
                        }
                            //품의류 = 협조처에 발송하지 않은 경우
                            //품의류가 아닌 경우
                        else {
                            if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0 && $(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().attr("approverat") == "Y") {
                                $("#btCancelApprove").show();
                            }
                        }
                        $("#btCommentAdd").show();//의견추가
                    }

                    if (getInfo("currentDocumentStateCode") == "SEND" && getInfo('SpecialReport') == 'Y' && getInfo('openerDocumentStepCode') != "MANAGEMENT_RECEIVE") {
                        $(currApvListXML).find("steps > division > step:has(taskinfo[status='pending'])").each(function (i, element) {
                            var name = $(element).attr("name");
                            if (name == "MANAGE_DEPT" || name == "MANAGE_SUB_DEPT" || name == "MANAGE_PM" || name == "MANAGE_DIVISION") {
                                //
                            } else {
                                if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고 결재자이면서 발신부서가 아닐경우 _ 품의서
                            }
                        });
                    }

                    if (getInfo("currentDocumentStateCode") == "SEND" && (getInfo('openerDocumentStepCode') == "MANAGEMENT_RECEIVE" || getInfo('openerDocumentStepCode') == "CONTROL_DEPT_RECEIVE")) {
                        $(currApvListXML).find("steps > division > step:has(taskinfo[status='pending'])").each(function (i, element) {
                            var name = $(element).attr("name");
                            if (name == "MANAGE_DEPT" || name == "MANAGE_SUB_DEPT") {
                                $("#btModifyE").show();
                            }
                        });
                    }
                }
                    //해외 출장 품의류
                else if (getInfo("pdef") == "ABROAD_PATTERN") {
                    //if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > - 1) {
                    //    $("#btnCooperationView").show();
                    //}
                    //if (getInfo("strConsultJson") != "" && Common.GetSession("UR_IsManager") == "True" && getInfo("currentDocumentStateCode") == "SEND") {
                    if (getInfo("strConsultJson") != "" && getInfo("usismanager") == "Y" && getInfo("currentDocumentStateCode") == "SEND") {
                        if (_UR_Code == $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person:has(> taskinfo[status='pending'])").attr("code")) {
                            $("#btModifyE").show();
                            //진행중 협조요청 상태에서 기각버튼 표시
                            if (_UR_Code == $(currApvListXML).find("steps > division[divisiontype='send'] > step[approverat='P'] > ou > person:has(> taskinfo[status='pending'])").attr("code"))
                                $("#btDeny").show();
                        }
                    }

                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        if (currApprovalCnt == 0) {
                            if (!checkHasConsult && getInfo('scDraftCancel') == 1) {
                                $("#btWithdraw").show();//상신취소
                            }
                        }
                        $("#btCommentAdd").show();//의견추가
                    }
                    else if (getInfo("mode_unit") == "COOPERATION_APPROVAL") { // 협조처 팀장이 열었을경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "") {
                                //협조처의 내 다음 결재자가 아직 결재하지 않은 상태인지 확인
                                //BPM에서 해당사항 수정 후 기능 오픈 예정
                                if ($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0 &&
                                    $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                 && $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                    $("#btCancelApprove").show();
                                }
                            }
                        }
                    }
                    else if (getInfo("mode_unit") == "EXAMINATION_APPROVAL") { // 검토자가 열었을 경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            //협조처의 내 다음 결재자가 아직 결재하지 않은 상태인지 확인
                            //BPM에서 해당사항 수정 후 기능 오픈 예정
                            if ($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0 &&
                                $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                && $($($.parseXML(getInfo("strConsultJson"))).find("division > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                $("#btCancelApprove").show();
                            }
                        }
                    }
                    else if (getInfo("mode_unit") == "APPROVAL") { // 진행중일때 결재자의 경우
                        // 결재취소는 현 결재자가 열람자 다음 사람일 경우
                        //if (checkHasConsult && $($.parseXML(getInfo("strConsultJson"))).find("division > step > ou > person:has(> taskinfo[status='completed'])").length == 0) {

                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "" && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                //협조처에서 결재자를 지정한 곳이 있는경우
                                if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] > step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length > 0) {
                                    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                        //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                        if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                                             && ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") == "Y"
                                                || $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).find("ou > role > taskinfo").attr("status") == "pending")) {
                                            var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                            if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0)
                                                $("#btCancelApprove").show();
                                        }
                                    }
                                }
                                    //협조처에서 결재자를 지정한 곳이 없으면 결재취소 가능
                                else {
                                    //기안자이면서 협조 요청 한 사람일 경우(팀장 또는 보직을 가진 사용자)
                                    if (getInfo("approvalOrder") == "100") {
                                        if ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']")).attr("approverat") == "P") {
                                            $("#btCancelApprove").show();//결재취소
                                        }
                                        else {
                                            //if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200']").length > 0 && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200']")).attr("approverat") == "Y") {
                                            //    if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='200']").length == 0) {
                                            //        $("#btWithdraw").show();//상신취소
                                            //    }
                                            //}
                                        }
                                    }
                                    else {
                                        //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                        if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0) {
                                            //협조요청했는데 아무데도 검토자 지정한곳 없을경우
                                            if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                                $("#btCancelApprove").show();
                                            }
                                            else {
                                                if ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                                && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                                    var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                                    if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0) {
                                                        $("#btCancelApprove").show();
                                                    }
                                                }
                                            }
                                        }
                                            //마지막 결재자의 경우
                                        else {
                                            if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                                $("#btCancelApprove").show();
                                            }
                                        }
                                    }
                                }
                            }
                                //품의류 = 협조처에 발송하지 않은 경우
                                //품의류가 아닌 경우
                            else {
                                //$("#btCancelApprove").show();
                                if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                    //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                                            && ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") == "Y"
												|| $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).find("ou > role > taskinfo").attr("status") == "pending")) {
                                        $("#btCancelApprove").show();
                                    }
                                }
                            }
                        }

                        if (getInfo("scDraftCancel") == 1)//상신취소
                        {
                            if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "" && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                //협조처에서 결재자를 지정한 곳이 있는경우
                                if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] > step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length > 0) {
                                    //if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                                    //    //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                    //    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                                    //         && ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") == "Y"
                                    //            || $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).find("ou > role > taskinfo").attr("status") == "pending")) {
                                    //        var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                    //        if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0)
                                    //            $("#btCancelApprove").show();
                                    //    }
                                    //}
                                }
                                    //협조처에서 결재자를 지정한 곳이 없으면 결재취소 가능
                                else {
                                    //기안자이면서 협조 요청 한 사람일 경우(팀장 또는 보직을 가진 사용자)
                                    if (getInfo("approvalOrder") == "100") {
                                        if ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']")).attr("approverat") == "P") {
                                            //$("#btCancelApprove").show();//결재취소
                                        }
                                        else {
                                            if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200']").length > 0 && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='200']")).attr("approverat") == "Y") {
                                                if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='200']").length == 0) {
                                                    $("#btWithdraw").show();//상신취소
                                                }
                                            }
                                        }
                                    }
                                    //else {
                                    //    //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                                    //    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0) {
                                    //        //협조요청했는데 아무데도 검토자 지정한곳 없을경우
                                    //        if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                    //            $("#btCancelApprove").show();
                                    //        }
                                    //        else {
                                    //            if ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") != "P"
                                    //            && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                    //                var nextApprvalorder = $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approvalorder");
                                    //                if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + nextApprvalorder + "']").length == 0) {
                                    //                    $("#btCancelApprove").show();
                                    //                }
                                    //            }
                                    //        }
                                    //    }
                                    //        //마지막 결재자의 경우
                                    //    else {
                                    //        if ($($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "']").length > 0 && $($.parseXML(getInfo("strConsultJson"))).find("division[parentapprovalorder='" + getInfo("approvalOrder") + "'] step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length == 0) {
                                    //            $("#btCancelApprove").show();
                                    //        }
                                    //    }
                                    //}
                                }
                            }
                            //품의류 = 협조처에 발송하지 않은 경우
                            //품의류가 아닌 경우
                            //else {
                            //    //$("#btCancelApprove").show();
                            //    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").length > 0) {
                            //        //문서를 연 사람 다음 결재자가 존재하며 다음사람이 문서를 받아서 아직 결재하지 경우
                            //        if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                            //                && ($($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).attr("approverat") == "Y"
                            //					|| $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).find("ou > role > taskinfo").attr("status") == "pending")) {
                            //            $("#btCancelApprove").show();
                            //        }
                            //    }
                            //}
                        }

                        $("#btCommentAdd").show();//의견추가
                    }

                    if (getInfo("currentDocumentStateCode") == "SEND" && getInfo('SpecialReport') == 'Y') {
                        if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고 결재자이면서 발신부서가 아닐경우 _ 품의서
                    }

                }
                else if (getInfo("pdef") == "STEP3_PATTERN") {
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        if (currApprovalCnt == 0 && getInfo('scDraftCancel') == 1) {
                            $("#btWithdraw").show();//상신취소
                        }
                        $("#btCommentAdd").show();//의견추가
                    }

                    if (getInfo("mode_unit") == "RECEIVE_APPROVAL" || getInfo("mode_unit") == "CHARGE_APPROVAL") {
                        // 결재취소는 현 결재자가 열람자 다음 사람일 경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            if ($(currApvListXML).find("division[divisiontype='receive'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0 &&
                                $($(currApvListXML).find("division[divisiontype='receive'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                && $($(currApvListXML).find("division[divisiontype='receive'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                $("#btCancelApprove").show();
                            }
                        }
                    }

                    if (getInfo("mode_unit") == "COOPERATION_APPROVAL") {
                        // 결재취소는 현 결재자가 열람자 다음 사람일 경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            if ($(currApvListXML).find("division[divisiontype='cooperation'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0 &&
                                $($(currApvListXML).find("division[divisiontype='cooperation'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                && $($(currApvListXML).find("division[divisiontype='cooperation'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                $("#btCancelApprove").show();
                            }
                        }
                    }

                    if (SendApprovalCnt == 0) {
                        $("#btnReceiptStatus").show();//협조처 수신확인
                    }
                }
                else if (getInfo("pdef") == "STEP4_PATTERN") {
                    //의견추가 버튼 //결재선 포함된사용자만
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        if (currApprovalCnt == 0 && getInfo('scDraftCancel') == 1) {
                            $("#btWithdraw").show();//상신취소
                        }
                        $("#btCommentAdd").show();//의견추가
                    }
                    if (getInfo("mode_unit") == "RECEIVE_APPROVAL") {
                        // 결재취소는 현 결재자가 열람자 다음 사람일 경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            if ($(currApvListXML).find("division[divisiontype='receive'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next().length > 0 &&
                                $($(currApvListXML).find("division[divisiontype='receive'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).attr("approverat") != "P"
                                && $($(currApvListXML).find("division[divisiontype='receive'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") {
                                $("#btCancelApprove").show();
                            }
                        }
                    }
                }
                    //수신부서에서 결재취소 버튼 비활성화 및 활성화 신규 프로세스
                else if ((getInfo("pdef") == "REQUEST_PATTERN")) {
                    var sDivisiontype = "";
                    if (getInfo("openerDivisionType") == "RECEIVE") sDivisiontype = "receive";
                    else sDivisiontype = "send";

                    //수신담당자 여러명일 경우가 있음
                    var sApprovalOrder = getInfo("approvalOrder");
                    var isBool = true;
                    var index = 0;

                    if (sDivisiontype == "receive") {
                        index = GetDivisionPhase(currApvListXML);
                        if (getInfo("mode_unit") == "RECEIVECHR_APPROVAL" || getInfo("mode_unit") == "RECEIVEDEPT_APPROVAL") {
                            $("#btCancelApprove").hide();
                            isBool = false;

                            if (getInfo("chkAcceptCancelUseYN") != undefined) {
                                if (getInfo("chkAcceptCancelUseYN") == "Y" && $(currApvListXML).find("division:eq(" + index + ") > step[approverat='Y'][processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo[status='pending']").length > 0) {
                                    //수신담당자 혹은 수신부서 담당자
                                    $("#btCancelReceipt").show();
                                }
                            }
                        }
                    }
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        //if (currApprovalCnt == 0 && getInfo('scDraftCancel') == 1) {
                        //    $("#btWithdraw").show();//상신취소
                        //}
                        if (getInfo('scDraftCancel') == 1) {
                            if (currApprovalCnt == 0) {
                                $("#btWithdraw").show();//상신취소
                            }
                            else {
                                if (Common.GetBaseConfig("CANCEL_DOC_INPROC") == "Y")
                                    $("#btWithdraw").show();//상신취소
                            }
                        }
                        $("#btCommentAdd").show();//의견추가
                    }
                    else if (getInfo("scApproveCancel") == 1) {

                        if (isBool) {
                            //결재자 결재취소 버튼 유무 결재문서가 다음결재자로 넘어갔을 경우
                            if ($(currApvListXML).find("division[divisiontype='" + sDivisiontype + "'] > step[approverat='Y'][processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo[status='pending']").length > 0) {
                                //병렬 협조 - 병렬 결재자 중 결재를 하지 않은 상태인 경우 결재취소 가능
                                if (($(currApvListXML).find("division[divisiontype='" + sDivisiontype + "'] > step[approverat='Y'][allottype='parallel'][processinstanceid='" + getInfo("piid") + "']")).length > 0) {
                                    if (($(currApvListXML).find("division[divisiontype='" + sDivisiontype + "'] > step[approverat='N'][allottype='parallel'][processinstanceid='" + getInfo("piid") + "']")).length == 0) {
                                        $("#btCancelApprove").show();
                                    }
                                }
                                else if (($(currApvListXML).find("division[divisiontype='" + sDivisiontype + "'] > step[allottype!='parallel'][approvalorder='" + sApprovalOrder + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") { //병렬 협조자가 없는 경우 체크
                                    $("#btCancelApprove").show();
                                }
                            }
                        }
                    }
                }
                    //수신부서에서 결재취소 버튼 비활성화 및 활성화 신규 프로세스
                else if ((getInfo("pdef") == "REQST_CRRF_PATTERN")) {
                    var sDivisiontype = "";
                    if (getInfo("openerDivisionType") == "RECEIVE") sDivisiontype = "receive";
                    else sDivisiontype = "send";

                    if (SendApprovalCnt == 0) {
                        $("#btnReceiptStatus").show();//협조처 수신확인
                    }
                    else if (getInfo("openerDivisionType") == "RECEIVE")
                    {
                        $("#btnReceiptStatus").show();//협조처 수신확인
                    }

                    //TO-DO : 회람, 정보보호 설정/해제는 협조전의 협조대기 상태에서만 활성화 된다.
                    if (getInfo("currentDocumentStateCode") == "RECEIVE_WAIT") {
                        //if (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER")
                        //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
                        // 20181204 박한 회람사용유무 추가
                        //if (getInfo("farmCode") == _FarmCode && (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER") && (Common.GetBaseConfig("ShareUseYN") != "N"))
                        //    if (((formJson.oFormData.DOC_LEVEL == "01" && formJson.oFormData.DOC_LEVEL != undefined) || (getInfo("SecurityForm") != undefined && getInfo("SecurityForm") == "Y") || (formJson.BODY_CONTEXT != undefined && formJson.BODY_CONTEXT.DOCSECURITY == "1" && formJson.BODY_CONTEXT.DOCSECURITY != undefined))) {
                        //        $("#btShare").hide();//회람
                        //    } else {
                        //        $("#btShare").show();//회람
                        //    }

                        //if (getInfo("informationSecurityAt") == "Y") { // 정보보호 설정 여부
                        //    $("#btResetProtectInfo").show();//정보보호 해제
                        //}
                        //else {
                        //    if (getInfo("chkscInfoSetProtect") == "Y") { $("#btSetProtectInfo").show(); }//정보보호 설정
                        //}
                    }

                    //협조시에는 의견 추가 안 나옴
                    if (getInfo("mode_unit") == "APPROVAL" && getInfo("openerDivisionType") == "SEND") { // 진행중일때 결재자의 경우
                        $("#btCommentAdd").show();//의견추가
                    }

                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        if (getInfo('scDraftCancel') == 1) {
                            if (currApprovalCnt == 0) {
                                $("#btWithdraw").show();//상신취소
                            }
                            else {
                                if (Common.GetBaseConfig("CANCEL_DOC_INPROC") == "Y")
                                    $("#btWithdraw").show();//상신취소
                            }
                        }
                        //if (currApprovalCnt == 0 && getInfo('scDraftCancel') == 1) {
                        //    $("#btWithdraw").show();//상신취소
                        //}
                        $("#btCommentAdd").show();//의견추가
                    }
                    else if (getInfo("scApproveCancel") == 1) {

                        var isBool = true;

                        if (sDivisiontype == "receive") {
                            if (getInfo("mode_unit") == "RECEIVE_APPROVAL") {
                                $("#btCancelApprove").hide();
                                isBool = false;

                                if (getInfo("chkAcceptCancelUseYN") != undefined) {
                                    if (getInfo("chkAcceptCancelUseYN") == "Y" && $(currApvListXML).find("division:eq(1) > step[approverat='Y'][processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo[status='pending']").length > 0) {
                                        //공문프로세스 접수취소 기능
                                        $("#btCancelReceipt").show();
                                    }
                                }
                            }
                        }

                        if (isBool) {
                            var sApprovalOrder = getInfo("approvalOrder");
                            //결재자 결재취소 버튼 유무 결재문서가 다음결재자로 넘어갔을 경우
                            if ($(currApvListXML).find("division[divisiontype='" + sDivisiontype + "'] > step[approverat='Y'][processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo[status='pending']").length > 0) {
                                //병렬 협조 - 병렬 결재자 중 결재를 하지 않은 상태인 경우 결재취소 가능
                                if (($(currApvListXML).find("division[divisiontype='" + sDivisiontype + "'] > step[approverat='Y'][allottype='parallel'][processinstanceid='" + getInfo("piid") + "']")).length > 0) {
                                    if (($(currApvListXML).find("division[divisiontype='" + sDivisiontype + "'] > step[approverat='N'][allottype='parallel'][processinstanceid='" + getInfo("piid") + "']")).length == 0) {
                                        $("#btCancelApprove").show();
                                    }
                                }
                                else if (($(currApvListXML).find("division[divisiontype='" + sDivisiontype + "'] > step[allottype!='parallel'][approvalorder='" + sApprovalOrder + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending") { //병렬 협조자가 없는 경우 체크
                                    $("#btCancelApprove").show();
                                }
                            }
                        }
                    }
                }
                else {

                    //의견추가 버튼 //결재선 포함된사용자만
                    if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                        if (currApprovalCnt == 0 && getInfo('scDraftCancel') == 1) {
                            $("#btWithdraw").show();//상신취소
                        }
                        $("#btCommentAdd").show();//의견추가
                    }
                    if (getInfo("mode_unit") == "APPROVAL") { // 진행중일때 결재자의 경우
                        // 결재취소는 현 결재자가 열람자 다음 사람일 경우
                        if (getInfo("scApproveCancel") == 1)//결재취소
                        {
                            //품의류 = 협조처에 발송한경우
                            if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "" && $($.parseXML(getInfo("strConsultJson"))).find("steps > division > step").length > 0) {
                                if ($($.parseXML(getInfo("strConsultJson"))).find("division > step > ou > person:has(> taskinfo[status='completed'],[status='reject'])").length > 0) {
                                    if ($($.parseXML(getInfo("strConsultJson"))).find("division > step > ou > person:has(> taskinfo[status='pending'],[status='inactive'])").length == 0) {
                                        $("#btCancelApprove").show();
                                    }
                                } else {
                                    //기안자이면서 협조 요청 한 사람일 경우(팀장 또는 보직을 가진 사용자)
                                    if (getInfo("approvalOrder") == "100") {
                                        //$("#btWithdraw").show();//상신취소
                                    }
                                    else {
                                        $("#btCancelApprove").show();
                                    }
                                }
                            }
                                //품의류 = 협조처에 발송하지 않은 경우
                                //품의류가 아닌 경우
                            else {
                                $("#btCancelApprove").show();
                            }
                        }
                    }
                }

                if (getInfo("editmode") == "M") {
                    if (getInfo("currentDocumentStateCode") == "SEND" && (getInfo('openerDocumentStepCode') == "MANAGEMENT_RECEIVE" || getInfo('openerDocumentStepCode') == "CONTROL_DEPT_RECEIVE")) {
                        $(currApvListXML).find("steps > division > step:has(taskinfo[status='pending'])").each(function (i, element) {
                            var name = $(element).attr("name");
                            if (name == "MANAGE_DEPT" || name == "MANAGE_SUB_DEPT") {
                                $("#btModifyE").hide();//편집
                                $("#btchangeSave").show();//저장
                                if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") != "A") {
                                    $("#btnReceiptAddDel").show();//협조처추가삭제
                                }
                            }
                        });
                    }
                    else {
                        $("#btchangeSave").show();//저장
                        $("#btModifyE").hide();//편집
                        $("#btnReceiptAddDel").show();//편집
                    }
                }
            }
            break;
        case "COMPLETE":
            {
                $("#btn_PaymentLine").show()//현황판
                //부서내류, 부서간류, 3단계류, 전산사용권한류를 제외한 모든 문서 공람자 활성화
                if (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN") {
                    $("#btGongRam").show();//공람자 버튼 
                }


                //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                //2020-08-20 HJW : || getInfo("fmpf") == "GWOK_REPORT_W03" 조건 제거
                if (getInfo("pdef") == "COOPERATION_PATTERN") {
                    //완료함에서 기안자만 결재문서 삭제요청이 가능하다.

                    if (getInfo('Approval_mail') == 'Y' && formJson && formJson.oFormData && formJson.oFormData.REQ_DEL_YN != "Y" && getInfo("piid_parent") == "") {
                        var Initiator_GR_Code = "";
                        var Initiator_Object = Common.GetObjectInfo("UR", getInfo("INITIATOR_ID"), "GR_Code");
                        if (Initiator_Object.Table.length > 0) {
                            Initiator_GR_Code = Initiator_Object.Table[0].GR_Code;
                        }
                        var tmp_Initiator_Manager = "";
                        if (Initiator_GR_Code != "") {
                            tmp_Initiator_Manager = Common.GetObjectInfo("GR", Initiator_GR_Code, "ManagerCode").Table[0].ManagerCode;
                        }
                        if ((getInfo("mode_unit") == "DRAFT_APPROVAL" || tmp_Initiator_Manager == getInfo("usid"))) {
                            var vapvlist = $.parseXML($("#APVLIST").val());
                            var vLastStep = $(vapvlist).find("steps division:eq(0) step:last()");
                            var vLastAppDate;
                            var vDate_AddDay;
                            var vStr_AddDay;
                            var vDate_Today;
                            var vStr_Today;
                            // 발신부서 결재완료 이후 익일 자정까지만 삭제가 가능하다.
                            if ($(vLastStep).find("taskinfo").attr("status") != undefined && $(vLastStep).find("taskinfo").attr("status").toUpperCase() == "COMPLETED") {
                                vLastAppDate = $(vLastStep).find("taskinfo").attr("datecompleted");
                                if (vLastAppDate) {
                                    var tmp_year = "";
                                    var tmp_month = "";
                                    var tmp_day = "";

                                    vDate_AddDay = new Date(addDate("d", 1, CFN_TransLocalTime(vLastAppDate, "yyyy/MM/dd"), "/"));
                                    tmp_year = vDate_AddDay.getFullYear() + "";
                                    tmp_month = (vDate_AddDay.getMonth() + 1 < 10) ? "0" + (vDate_AddDay.getMonth() + 1) : (vDate_AddDay.getMonth() + 1);
                                    tmp_day = (vDate_AddDay.getDate() < 10) ? "0" + vDate_AddDay.getDate() : vDate_AddDay.getDate();
                                    vStr_AddDay = tmp_year + "" + tmp_month + "" + tmp_day;

                                    vDate_Today = new Date();
                                    tmp_year = vDate_Today.getFullYear() + "";
                                    tmp_month = (vDate_Today.getMonth() + 1 < 10) ? "0" + (vDate_Today.getMonth() + 1) : (vDate_Today.getMonth() + 1);
                                    tmp_day = (vDate_Today.getDate() < 10) ? "0" + vDate_Today.getDate() : vDate_Today.getDate();
                                    vStr_Today = tmp_year + "" + tmp_month + "" + tmp_day;

                                    if (vStr_AddDay >= vStr_Today) {
                                        $("#btDeleteDoc").show();
                                    }
                                }
                            }
                        }
                    }//문서삭제
                    else if (getInfo("currentDocumentStateCode") == "COOPERATION") {//2019.08.23 한규동 대리 요청. 협조완료시에도 회람 기능 추가.
                        if (getInfo("farmCode") == _FarmCode && (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER") && (Common.GetBaseConfig("ShareUseYN") != "N")) {
                            if (((formJson.oFormData.DOC_LEVEL == "01" && formJson.oFormData.DOC_LEVEL != undefined) || (getInfo("SecurityForm") != undefined && getInfo("SecurityForm") == "Y") || (formJson.BODY_CONTEXT != undefined && formJson.BODY_CONTEXT.DOCSECURITY == "1" && formJson.BODY_CONTEXT.DOCSECURITY != undefined))) {
                                $("#btShare").hide();//회람
                            } else {
                                $("#btShare").show();//회람
                            }
                        }
                    }

                    //if (getInfo("currentDocumentStateCode") == "SEND") {
                    if (getInfo("openerDivisionType") == "SEND") {
                    	$("#btReSend").show();//재송

						// 20200819 hpark 협조처 사용하는 양식만 협조처추가 버튼 활성화
                        if (getInfo("scInformationAppV") != "" && getInfo("scInformationAppV").length > 2
							&& (getInfo("scInformationAppV").substring(1, 2) == "1" || getInfo("scInformationAppV").substring(2, 3) == "1")) {
                        	$("#btReCCSend").show();//참조처 추가
                        }
                    }
                    $("#btnReceiptStatus").show();//협조처 수신확인
                    
                    //발신처이면서 예약결재된 양식이면 협조처 예약발송 버튼 활성화
                    if (getInfo("openerDivisionType") == "SEND" && getInfo("BOOKING_APPROVAL_YN") == "Y") {
                        //버튼에서 라벨로 변경
                        $('#ApvLineTemp_booking').html("<span onclick='fn_PopBooking_Approval();' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_Booking_Approval") + "&gt;" + "</span>");

                    }
                }
                if (getInfo("pdef") == "STEP3_PATTERN") {
                    $("#btnReceiptStatus").show();//협조처 수신확인
                    //TO-DO : 완료된 고객만족 처리전을 국내고객가치팀은 편집할 수 있어야 한다.
                    if ((_DN_Code == "H101" || _DN_Code == "K101") && _DeptCode == "KIAA") {
                        $("#btModifyComplete").show();
                    }
                }

                //공문 - 신규 프로세스 
                if (getInfo("pdef") == "REQST_CRRF_PATTERN") {
                    $("#btnReceiptStatus").show();//협조처 수신확인

                    if (getInfo("openerDivisionType") == "SEND") {
                        $("#btReSend").show();//재송
                    }

                    // 완료된 문서 접수 취소
                    if (getInfo("openerDivisionType") == "RECEIVE") {
                        fnCompleteCancelReceipt();
                    }
                }

                switch (getInfo("mode")) {
                    case "TCINFO":
                    	$("#btReSend").hide();//재송
                    	$("#btReCCSend").hide();//참조처 추가
                        break;
                    default:

                        break;
                }
                if (getInfo("openerDivisionType") == "SEND") {
                    //발신프로세스 role 결재 빼고
                    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[processinstanceid ='" + getInfo("piid") + "'][approvalorder ='" + getInfo("approvalOrder") + "'] > ou > person").length > 0)
                        //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
                        //if (getInfo("chkscCopyFunction_YN") == "Y") {
                        //TO-DO : 마이그레이션 된 결재문서 DOC_SUMMARY에 값을 M으로 넣었음 재사용 방지(복사,재사용,템플릿 추가/삭제 동일)
                        //2019-02-12 BY YJYOO
                        if (getInfo("chkscCopyFunction_YN") == "Y" && getInfo("DOC_SUMMARY") != "M" && getInfo("farmCode") == _FarmCode) {
                            $("#btCopy").show();
                        }
                }
            }
            break;
        case "CANCEL":
            {
                //case "JOBDUTY":
                //case "REVIEW":
            }
        case "REJECT":
            {
                $("#btn_PaymentLine").show()//현황판
                //$("#divbtPrint").show()//인쇄

                var tmpApvList = $.parseXML($("#APVLIST").val());
                var tmpSendPiid = $(tmpApvList).find("division[divisiontype='send'] > step:eq(0)").attr("processinstanceid");

                if (getInfo("INITIATOR_ID") == _UR_Code && getInfo("piid") == tmpSendPiid) {
                    //TO-DO : 마이그레이션 된 결재문서 DOC_SUMMARY에 값을 M으로 넣었음 재사용 방지(복사,재사용,템플릿 추가/삭제 동일)
                    //2019-02-12 BY YJYOO
                    if (getInfo("chkscReuseFunction_YN") == "Y" && getInfo("DOC_SUMMARY") != "M") { $("#btReUse").show(); }//재사용
                }

                
                //공문 - 신규 프로세스 
                if (getInfo("pdef") == "REQST_CRRF_PATTERN") {
                    // 완료된 문서 접수 취소
                    if (getInfo("openerDivisionType") == "RECEIVE") {
                        fnCompleteCancelReceipt();
                    }
                }

                //기안 모드일때 품의서류 또는 협조전류 프로세스이면 협조처 버튼을 보이지 않는다.
                //if (getInfo('pdef') == 'GENERAL_PATTERN' || getInfo('pdef') == 'UNITY_REQST_PATTERN') { //기각사유_품의서
                //    if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1)
                //        $("#btnCooperationView").show();
                //} else if (getInfo("pdef") == "INVEST_PATTERN") {
                //    if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1) {
                //        $("#btnCooperationView").show();
                //    }
                //}
                //else if (getInfo("pdef") == "ABROAD_PATTERN") {
                //    if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1) {
                //        $("#btnCooperationView").show();
                //    }
                //}
                //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                //if (getInfo('pdef') == 'COOPERATION_PATTERN') {
                //    if (SendApprovalCnt == 0) {
                //        $("#btnReceiptStatus").show();//협조처 수신확인
                //    }
                //}
                //if(getInfo("currentDocumentStateCode") == "SEND") {
                //    $("#btDeny_Reason").show();//기각사유
                //}
                //else {
                //    $("#btRejectRequest_Reason").show(); //반송사유_협조전
                //}
            }
            break;
        case "DRAFT":
            {
                //작성중 문서의 버튼은 작성자만 볼수 있게--> 양유빈
                //메일첨부 링크로 들어온 사용자는 볼수 없게 처리
                if (formJson.oFormData.INITIATOR_ID != undefined && formJson.oFormData.INITIATOR_ID != _UR_Code
					&& formJson.oFormData.INITIATOR_OU_ID != undefined && formJson.oFormData.INITIATOR_ID != getInfo("dpid_apv")) {
                    //다른쪽에서 Show 되어 다시 hide 처리됨
                    $("#btDocLinked").hide();
                    alert(Common.GetDic("msg_apv_NotMatchDeptInfo")); // 부서/사용자 정보가 일치하지 않아 결재/저장이 불가능 합니다. 겸직이 설정된 경우 부서변경 후 작성 해주세요.
                }
                else {
                    //TO-DO : 기안모드일때 양식의 첨부파일 TR 보이지 않게 처리
                    //2016-08-08 BY YJYOO
                    document.getElementById("trAttFileInfo").style.display = "none";
                    $("#tr_WF_COMMENT").hide();//댓글 저장 버튼
                    //$("#divbtPreView").show()//미리보기
                    $("#btDraft").show();//기안
                    if (getInfo("scInformationAppV") != "000" || getInfo("scInformationApp_ref_person") != "0" || getInfo("scInformationApp_coop_only") != "0") { // 20200427 hpark 참조자 추가 // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
                        $("#btLine").show();//결재선
                    }
                    $("#btSave").show();//임시저장           
                    //if (getInfo("fmpf") == "GWOJ_VENDOR_W01" || getInfo("fmpf") == "GWOE_COOPER_CL_W01") {
                    if (getInfo("pdef") == "COOPERATION_PATTERN") {
                        if (getInfo("Form_Reservation") == "Y") { $("#btn_Booking_Approval").show(); }
                    }
                    //}
                }


            }
            break;
        case "PREDRAFT":
        case "TEMPSAVE":
            {
                if (formJson.oFormData.INITIATOR_ID != undefined && formJson.oFormData.INITIATOR_ID != _UR_Code
									&& formJson.oFormData.INITIATOR_OU_ID != undefined && formJson.oFormData.INITIATOR_ID != getInfo("dpid_apv")) {
                    //다른쪽에서 Show 되어 다시 hide 처리됨
                    $("#btDocLinked").hide();
                    alert(Common.GetDic("msg_apv_NotMatchDeptInfo")); // 부서/사용자 정보가 일치하지 않아 결재/저장이 불가능 합니다. 겸직이 설정된 경우 부서변경 후 작성 해주세요.
                } else {
                    $("#tr_WF_COMMENT").hide();//댓글 저장 버튼
                    //$("#divbtPreView").show()//미리보기
                    $("#btDraft").show();//기안
                    if (getInfo("scInformationAppV") != "000" || getInfo("scInformationApp_ref_person") != "0" || getInfo("scInformationApp_coop_only") != "0") { // 20200427 hpark 참조자 추가 // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
                        $("#btLine").show();//결재선
                    }
                    $("#btSave").show();//임시저장
                    //if (getInfo("fmpf") == "GWOJ_VENDOR_W01" || getInfo("fmpf") == "GWOE_COOPER_CL_W01") {
                    if (getInfo("pdef") == "COOPERATION_PATTERN") {
                        if (getInfo("Form_Reservation") == "Y") { $("#btn_Booking_Approval").show(); }
                    }
                }
                //}
            }
            break;
        case "REDRAFT":
        case "JOBFUNCTION":
        case "APPROVAL":
            {
                if (!(getInfo("templatemode") == "Write" || getInfo("editmode") == "M")) {
                    $("#btn_PaymentLine").show()//현황판
                }
                switch (getInfo("mode")) {
                    case "SHARER":
                    case "APPROVAL": //일반결재
                    case "RECAPPROVAL": //일반결재
                        //수신 또는 협조처이면서 부서내류, 부서간류, 3단계류, 전산사용권한류, 신청서를 제외한 모든 문서 공람자 활성화
                        //공문 프로세스에 경우 편집 시 공람자 버튼 비활성화
                        if (getInfo('piid_parent') != '' && (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN" && getInfo("pdef") != "REQUEST_PATTERN" && !(getInfo("pdef") == "REQST_CRRF_PATTERN" && getInfo("editmode") == "M"))) {
                            $("#btGongRam").show();//공람자 버튼 
                        }

                        if (getInfo("mode_unit") == "COOPERATION_APPROVAL") { //현결재자가 협조처 팀장의 경우
                            if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") { // 품의서일 경우
                                //$("#divbtPrint").show()//인쇄
                                $("#btAssignReviewer").show(); //협조결재
                                $("#btRejectConsult").show(); //협조거부
                                //$("#btCommentAdd").show();//의견추가
                                //$("#btnCooperationView").show();

                                //여기에 협조기한 연장 한적이 있는지 추가 체크가 되어야 함
                                if (getInfo("INCREASE_CONSULT_DATE_YN") != "Y") {
                                    $("#btIncreaseCooperation").show();
                                }
                            }
                            else if (getInfo("pdef") == "COOPERATION_PATTERN") {
                                //TO-DO : 회람, 정보보호 설정/해제는 협조전의 협조대기 상태에서만 활성화 된다.
                                if (getInfo("currentDocumentStateCode") == "COOPERATION_WAIT") {
                                    //if (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER")
                                    //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
                                    // 20181204 박한 회람사용유무 추가
                                    if (getInfo("farmCode") == _FarmCode && (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER") && (Common.GetBaseConfig("ShareUseYN") != "N"))
                                        if (((formJson.oFormData.DOC_LEVEL == "01" && formJson.oFormData.DOC_LEVEL != undefined) || (getInfo("SecurityForm") != undefined && getInfo("SecurityForm") == "Y") || (formJson.BODY_CONTEXT != undefined && formJson.BODY_CONTEXT.DOCSECURITY == "1" && formJson.BODY_CONTEXT.DOCSECURITY != undefined))) {
                                            $("#btShare").hide();//회람
                                        } else {
                                            $("#btShare").show();//회람
                                        }

                                    if (getInfo("informationSecurityAt") == "Y") { // 정보보호 설정 여부
                                        $("#btResetProtectInfo").show();//정보보호 해제
                                    }
                                    else {
                                        if (getInfo("chkscInfoSetProtect") == "Y") { $("#btSetProtectInfo").show(); }//정보보호 설정
                                    }
                                }
                                //$("#divbtPrint").show()//인쇄
                                $("#btApproved").show();//결재
                                //scCHBis == 발신부서 편집가능
                                //scRCHBis == 수신부서 편집가능
                                if ((getInfo('scLCHBis') == '1' && SendApprovalCnt > 0) || (getInfo('scRCHBis') == '1' && SendApprovalCnt == 0)) {
                                    if (getInfo("editmode") == "Y") {
                                        document.getElementById("btchangeSave").style.display = "";//저장
                                        document.getElementById("btModify").style.display = "none";//편집
                                    }
                                    else {
                                        document.getElementById("btchangeSave").style.display = "none";//저장
                                        document.getElementById("btModify").style.display = "";//편집
                                    }
                                }

                                if (getInfo('piid_parent') == '') { // 발신부서에서는 기각만 있음 
                                    $("#btDeny").show();//기각
                                }
                                if (getInfo('piid_parent') != '') {
                                    $("#btReject").show();//반송
                                }
                                //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                                if (SendApprovalCnt == 0) {
                                    $("#btnReceiptStatus").show();//협조처 수신확인
                                    //$("#btGongRam").show();//공람자 버튼 
                                }
                            }
                            else if (getInfo("pdef") == "STEP3_PATTERN") {
                                //$("#divbtPrint").show()//인쇄
                                $("#btApproved").show();//결재
                                if (getInfo('piid_parent') != '') {
                                    $("#btReject").show();//반송
                                }
                                //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                                if (SendApprovalCnt == 0) {
                                    $("#btnReceiptStatus").show();//협조처 수신확인
                                    //$("#btGongRam").show();//공람자 버튼 
                                }
                            }
                            else if (getInfo("pdef") == "ABROAD_PATTERN") {
                                $("#btAssignReviewer").show(); //협조결재
                                $("#btRejectConsult").show(); //협조거부
                                //$("#btCommentAdd").show();//의견추가
                                //$("#btnCooperationView").show();

                                //여기에 협조기한 연장 한적이 있는지 추가 체크가 되어야 함
                                if (getInfo("INCREASE_CONSULT_DATE_YN") != "Y") {
                                    $("#btIncreaseCooperation").show();
                                }
                            }
                            else {
                                if (getInfo("pdef") == "INVEST_PATTERN") {
                                    //$("#btnCooperationView").show();

                                    //여기에 협조기한 연장 한적이 있는지 추가 체크가 되어야 함
                                    if (getInfo("INCREASE_CONSULT_DATE_YN") != "Y") {
                                        $("#btIncreaseCooperation").show();
                                    }
                                }
                                //별도보고 상태 발신측에서 
                                if (getInfo('piid_parent') == '') {
                                    if (getInfo('SpecialReport') == 'Y') {
                                        if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고
                                    }
                                }
                                //$("#divbtPrint").show()//인쇄
                                $("#btAssignReviewer").show(); //협조결재
                                $("#btRejectConsult").show(); //협조거부
                            }
                        }
                        else if (getInfo("mode_unit") == "EXAMINATION_APPROVAL") { //현결재자가 검토자의 경우
                            //$("#divbtPrint").show()//인쇄
                            $("#btCompleteReview").show();//검토완료
                            //$("#btnCooperationView").show();
                            //$("#btCommentAdd").show();//의견추가
                            //여기에 협조기한 연장 한적이 있는지 추가 체크가 되어야 함
                            if (getInfo("INCREASE_CONSULT_DATE_YN") != "Y") {
                                $("#btIncreaseCooperation").show();
                            }
                        }
                        else if (getInfo("mode_unit") == "PARENT_DRAFT") { //상위 결재자
                            //$("#divbtPrint").show()//인쇄
                            $("#btApproved").show();//결재
                            if (getInfo('piid_parent') == '') { // 발신부서에서는 기각만 있음 
                                $("#btDeny").show();//기각
                            }
                            if (getInfo('piid_parent') != '') {
                                //발신부서 안에서도 process가 '협조전' 가 아닐경우 
                                if (getInfo('pdef') == 'COOPERATION_PATTERN' || getInfo("pdef") == "STEP3_PATTERN") {
                                    $("#btReject").show();//반송
                                    $("#btnReceiptStatus").show();//협조처 수신확인
                                }
                            }
                        }
                        else {
                            //$("#divbtPrint").show()//인쇄
                            $("#btApproved").show();//결재
                            //TO-DO : 보류버튼 활성화 여부(협조자는 사용불가)
                            //2020-08-13 BY YJYOO
                            if (getInfo("chkDeferUseYN") == "Y" && getInfo("mode_open") != "RESERVATION") {
                                var cur_user_allottype = "";
                                if (getInfo("mode_unit") == "AGREEMENT_APPROVAL" || getInfo("mode_unit") == "AGREEMENT_P_APPROVAL") {
                                    cur_user_allottype = $(currApvListXML).find("steps > division > step:has(> ou > person[code='" + getInfo("usid") + "'] > taskinfo[status='pending'])").attr("allottype");
                                }
                                if (cur_user_allottype != "parallel") {
                                    if (getInfo("openerDivisionType") == "SEND") {
                                        $("#btHold").show();//보류
                                    }
                                    else if (getInfo("openerDivisionType") == "RECEIVE") {
                                        if (getInfo("pdef") == "REQUEST_PATTERN") {
                                            $("#btHold").show();//보류
                                        }
                                    }
                                }
                            }
                            if (getInfo("templatemode") == "Write" || getInfo("editmode") == "M") {
                                if (getInfo("scInformationAppV") != "000" || getInfo("scInformationApp_ref_person") != "0" || getInfo("scInformationApp_coop_only") != "0") { // 20200427 hpark 참조자 추가 // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
                                    $("#btLine").show();//결재선
                                }

                                if ((getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "ABROAD_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN" || getInfo("pdef") == "INVEST_PATTERN") && getInfo("CONSULT_LIST").indexOf(":Y:") > -1) {
                                    if (getInfo("pdef") == "INVEST_PATTERN") {
                                        var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본
                                        var CurApvPerson = $(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > person:has(taskinfo[status='pending'])");

                                        // HMB 투자품의 해외 투품(INVEST_PROCESS_TYPE="A")과 프로세스는 같지만, 협조요청 시기만 다름 (결재자가 부서장이라면 바로 협조요청)
                                        if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && Common.GetBaseConfig("INVEST_PROCESS_SUBTYPE") == "MUST" && CurApvPerson != null) {
                                            var tmp_step_name = $(m_oApvList).find("steps > division[divisiontype='send'] > step:has(ou person taskinfo[status='pending'])").attr("name");
                                            if (tmp_step_name == undefined) tmp_step_name = $(m_oApvList).find("steps > division[divisiontype='send'] > step:has(ou role taskinfo[status='pending'])").attr("name");
                                            if (tmp_step_name != "MANAGE_DEPT" && tmp_step_name != "EXAMINATION_RECEIVE") {
                                                //if (getInfo("CONSULT_LIST").indexOf(":N:") == -1) {
                                                $("#btnReceiptAddDel").show();//협조처추가삭제	
                                                //}
                                            }
                                        }
                                        if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && CurApvPerson != null && (formJson.BODY_CONTEXT.CTRL_STEP == $(CurApvPerson).attr("dutycode") && getInfo("usid") == $(CurApvPerson).attr("code"))) {
                                            if (getInfo("CONSULT_LIST").indexOf(":N:") == -1) {
                                                $("#btnReceiptAddDel").show();//협조처추가삭제
                                            }
                                        }
                                        else {
                                            if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") != "A") {
                                                $(currApvListXML).find("steps > division > step:has(taskinfo[status='pending'])").each(function (i, element) {
                                                    if ($(element).attr("name") == "MANAGE_DEPT" || $(element).attr("name") == "MANAGE_SUB_DEPT") {
                                                        $("#btnReceiptAddDel").show();//협조처추가삭제
                                                    }
                                                });
                                            }
                                        }

                                        $("#btDocLink").hide();
                                    }
                                    // KMM 경상,PR은 일반품의류지만 통제단계가 있고 해당위치에서만 협조처 발송함
                                    else if ((getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMM" || getInfo("fmpf") == "WF_KMM_FI_PURCHASE") && CurApvPerson != null && (formJson.BODY_CONTEXT.CTRL_STEP == $(CurApvPerson).attr("dutycode") && getInfo("usid") == $(CurApvPerson).attr("code"))) {
                                    	if (getInfo("CONSULT_LIST").indexOf(":N:") == -1) {
                                    		$("#btnReceiptAddDel").show();//협조처추가삭제
                                    	}
                                    	$("#btDocLink").hide();
                                    } else {
                                        $("#btnReceiptAddDel").show();
                                        $("#btDocLink").hide();
                                        // 해외출장품의 결재선 삭제
                                        if (getInfo("fmpf").indexOf("_OVER_BIZ_TRIP_MF") > 0) {
                                            $("#btLine").hide();
                                        }
                                    }

                                    $("#btLine").find("a>em>span>strong").html(Common.GetDic("lbl_apv_assignapprover"));
                                    if (getInfo("pdef") == "ABROAD_PATTERN") {
                                        $("#btn_SetCoDept").hide();
                                    }
                                }
                            }

                            //파워텍 OR 트랜시스 이면서 통합신청서류 일시 결재정보 보이게 하기. KBW 20180202
                            if (getInfo("openerDocumentStepCode") == "CHARGE_RECEIVE") {
                                if (Common.GetBaseConfig("LOCAL_DisplayYN") == "Y" && getInfo("pdef") == "UNITY_REQST_PATTERN") {
                                    //if ($(currApvListXML).find("division > step").attr("unittype") == "role")
                                    //if ($(currApvListXML).find("steps > division > step > ou > role:has(person)").length == 0)
                                    if (getInfo("scInformationAppV") != "000" || getInfo("scInformationApp_ref_person") != "0" || getInfo("scInformationApp_coop_only") != "0") { // 20200427 hpark 참조자 추가 // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
                                        $("#btLine").show();//결재선
                                    }
                                }
                            }
                            //수신부서(Role 결재 이후)에 [별도보고], [편집] 버튼 삭제 
                            //별도보고 상태 발신측에서 
                            if (getInfo('piid_parent') == '') {
                                if (getInfo('SpecialReport') == 'Y' && parseInt(getInfo("approvalOrder")) < RoleApprovalOrder) {
                                    if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고
                                }
                            }
                            //scCHBis == 발신부서 편집가능
                            //scRCHBis == 수신부서 편집가능

                            if ((getInfo('scLCHBis') == '1' && SendApprovalCnt > 0) || (getInfo('scRCHBis') == '1' && SendApprovalCnt == 0)) {
                                if (getInfo("editmode") == "Y") {
                                    document.getElementById("btchangeSave").style.display = "";//저장
                                    document.getElementById("btModify").style.display = "none";//편집
                                } else if (getInfo("editmode") == "M") {
                                    $("#btchangeSave").show();//저장
                                    $("#btModifyE").hide();//편집
                                    //$("#btnReceiptAddDel").show();//편집
                                }
                                else {

                                    document.getElementById("btchangeSave").style.display = "none";//저장
                                    if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "ABROAD_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN" || getInfo("pdef") == "INVEST_PATTERN") {//20170922 해외출장품의류 추가
                                        var ConsultJson = getInfo("strConsultJson");
                                        if (getInfo("fmpf").indexOf("_OVER_BIZ_TRIP_MF") > 0) {////20171108 해외출장품의 협조요청 후 편집 제약
                                            if (checkHasConsult) {
                                                $("#btModifyE").show();
                                            } else {
                                                $("#btModify").show();
                                            }
                                        }
                                            //else if (ConsultJson != "" && $($.parseXML(ConsultJson)).find("division > step").length > 0 && $($.parseXML(ConsultJson)).find("division > step > ou > person > taskinfo[status!='completed']").length > 0) {
                                        else if (getInfo("pdef") == "UNITY_REQST_PATTERN" && parseInt(getInfo("approvalOrder")) >= RoleApprovalOrder)
                                                ;
                                        else if (getInfo("fmpf") == "GOJP_WORKFORM_W01" && getInfo("openerDocumentStepCode") == "REGISTER_RECEIVE") //업무표준 양식이면서 등록처이면 본문 편집가능하도록 허용한다.
                                        {
                                            $("#btModify").show();
                                        }
                                        else if (getInfo("LOCAL_HPT_ApprovalYN") == "Y" && getInfo("fmpf") == "GWOK_GENERAL") { //일반품의 양식 [파워텍]이면서 협조결재 후 결재자는 본문 편집가능하도록 허용한다. KBW20180105
                                            $("#btModify").show();
                                        }
                                        else if (ConsultJson != "" && $($.parseXML(ConsultJson)).find("division > step").length > 0) {
                                            if (getInfo("WorkingBudgetHasReject") != "Y") {
                                                $("#btModifyE").show();
                                            }
                                        }
                                        else if (getInfo("scApvAssistHidden") == "1") { // 협조자 편집여부(순차 가능 , 병렬 불가)
                                            if (getInfo("mode_unit") != "AGREEMENT_P_APPROVAL") {
                                                $("#btModify").show();
                                            } else if ($(currApvListXML).find("steps > division > step:has(> ou > person[code='" + getInfo("usid") + "'] > taskinfo[status='pending'])").attr("allottype") == "serial") {
                                                $("#btModify").show();
                                            }
                                        }
                                        else if (getInfo("mode_unit") != "AGREEMENT_P_APPROVAL") {
                                            $("#btModify").show();
                                        }
                                    }
                                        //else if (getInfo("pdef") == "STEP4_PATTERN") {
                                        //    $("#btModifyE").show();
                                        //}
                                        //문화회관 시설물 양식의 경우 발신처이후 편집버튼 비활성화 처리
                                    else if (getInfo("pdef") == "DEPT_INTER_PATTERN") {
                                        if ($(currApvListXML).find("steps > division > step > ou > role:has(person)").length == 0 && getInfo("fmpf") == "KWHK_CUL_ADT_W01") {
                                            $("#btModifyE").show();
                                        }
                                    }
                                    else {
                                        if (getInfo("WorkingBudgetHasReject") != "Y") {
                                            if (getInfo("mode_unit") != "AGREEMENT_P_APPROVAL") { // 협조자 편집여부(순차 가능 , 병렬 불가)
                                                $("#btModify").show();
                                            } else if ($(currApvListXML).find("steps > division > step:has(> ou > person[code='" + getInfo("usid") + "'] > taskinfo[status='pending'])").attr("allottype") == "serial") {
                                                $("#btModify").show();
                                            }
                                        }
                                    }
                                }
                            }
                            if (getInfo('piid_parent') == '') { // 발신부서에서는 기각만 있음 
                                $("#btDeny").show();//기각
                            }
                            if (getInfo('piid_parent') != '') {
                                //발신부서 안에서도 process가 '협조전' 가 아닐경우 
                                if (getInfo('pdef') == 'COOPERATION_PATTERN' || getInfo('pdef') == 'STEP4_PATTERN') {
                                    $("#btReject").show();//반송
                                }
                            }
                            //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                            if (getInfo("pdef") == "COOPERATION_PATTERN") {
                                if (SendApprovalCnt == 0) {
                                    $("#btnReceiptStatus").show();//협조처 수신확인
                                    //$("#btGongRam").show();//공람자 버튼 
                                }
                                //발신처이면서 예약결재된 양식이면 읽기 모드이면 협조처 예약발송 버튼 활성화
                                if (getInfo("openerDivisionType") == "SEND" && getInfo("BOOKING_APPROVAL_YN") == "Y" && getInfo("templatemode") == "Read") {
                                    //버튼에서 라벨로 변경
                                    $('#ApvLineTemp_booking').html("<span onclick='fn_PopBooking_Approval();' style='color:red;font-weight:bold;cursor:pointer;'>" + "<" + Common.GetDic("btn_Booking_Approval") + ">" + "</span>");

                                }
                                //if (getInfo("fmpf") == "GWOJ_VENDOR_W01" || getInfo("fmpf") == "GWOE_COOPER_CL_W01") {
                                if (getInfo("pdef") == "COOPERATION_PATTERN") {
                                    if (getInfo("openerDivisionType") == "SEND" && getInfo("templatemode") == "Write") {
                                        if (getInfo("Form_Reservation") == "Y") { $("#btn_Booking_Approval").show(); }
                                    }
                                }
                                //}
                            }
                            //기안 모드일때 품의서류 또는 협조전류 프로세스이면 협조처 버튼을 보이지 않는다.
                            if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") {
                                //if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1)
                                //    $("#btnCooperationView").show();
                            }

                            if (getInfo("pdef") == "INVEST_PATTERN") {
                                //if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1)
                                //    $("#btnCooperationView").show();

                                $(currApvListXML).find("steps > division > step:has(taskinfo[status='pending'])").each(function (i, element) {
                                    var name = $(element).attr("name");
                                    if (name == "MANAGE_DEPT" || name == "MANAGE_PM" || name == "MANAGE_SUB_DEPT" || name == "MANAGE_DIVISION") {
                                        $("#btSpecialReport").hide();//별도보고 버튼 hide
                                    } else {
                                        if (getInfo('SpecialReport') == 'Y' && (getInfo("fmpf").indexOf("GWOK_INVEST") > -1 || getInfo("fmpf").indexOf("GWOK_PINVEST") > -1)) {
                                            if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고 버튼 show
                                        }
                                    }
                                });
                            }

                            if (getInfo("pdef") == "COMPUTATION_PATTERN" && getInfo("mode") == "RECAPPROVAL") {
                                $("#btReject").show();
                            }
                            if (getInfo("pdef") == "STEP3_PATTERN") {
                                if (SendApprovalCnt == 0) {
                                    $("#btnReceiptStatus").show();//협조처 수신확인
                                    //$("#btGongRam").show();//공람자 버튼 
                                }
                            }
                            if (getInfo("pdef") == "REQUEST_PATTERN") { //수신부서에서 편집 시 결재정보버튼 보이게 하기 사용할지 여부 신규 프로세스
                                if (getInfo("openerDivisionType") == "RECEIVE") {
                                    $("#btDeny").show(); //기각

                                    //수신담당자추가여부사용
                                    //읽기 모드 일 경우
                                    if (getInfo("templatemode") == "Read") {
                                        if (getInfo("scChgrAdd") != undefined) {
                                            if (getInfo("scChgrAdd") == "1") {
                                                //수신 부서 담당자가 담당자를 추가 할 경우
                                                //문제 있을 시 [approvalorder='" + getInfo("approvalOrder") + "'] 추가
                                                if ($(currApvListXML).find("division[divisiontype='receive']:has(taskinfo[status='pending']) > step[routetype='multi_charge'][processinstanceid='" + getInfo("piid") + "'] > ou> person[code ='" + getInfo("usid") + "'] > taskinfo[status='pending']").length > 0) {
                                                    //담당자 ADD 버튼 보이게 하기
                                                    $("#btChargeAdd").show();
                                                }
                                            }
                                        }
                                    }

                                    if (getInfo("chkAcceptCancelUseYN") != undefined) {
                                        if (getInfo("chkAcceptCancelUseYN") == "Y") {
                                            //수신담당자 및 수신부서원이 아니면서
                                            if (!(getInfo("mode_unit") == "RECEIVECHR_APPROVAL" || getInfo("mode_unit") == "RECEIVEDEPT_APPROVAL")) {
                                                //병렬이 아닌 사람만 접수 취소 버튼 활성화
                                                if ($(currApvListXML).find("division[divisiontype='receive']:has(taskinfo[status='pending']) > step[approverat='Y'][allottype!='parallel'][processinstanceid='" + getInfo("piid") + "']").length > 0) {
                                                    $("#btCancelReceipt").show();
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else if (getInfo("pdef") == "REQST_CRRF_PATTERN") { //수신부서에서 편집 시 결재정보버튼 보이게 하기 사용할지 여부 신규 프로세스

                                //if (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER")
                                //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
                                // 20181204 박한 회람사용유무 추가
                                //if (getInfo("farmCode") == _FarmCode)
                                //    if (((formJson.oFormData.DOC_LEVEL == "01" && formJson.oFormData.DOC_LEVEL != undefined) || (getInfo("SecurityForm") != undefined && getInfo("SecurityForm") == "Y") || (formJson.BODY_CONTEXT != undefined && formJson.BODY_CONTEXT.DOCSECURITY == "1" && formJson.BODY_CONTEXT.DOCSECURITY != undefined))) {
                                //        $("#btShare").hide();//회람
                                //    } else {
                                //        if (getInfo('piid_parent') == '') {
                                //            $("#btShare").hide();//회람
                                //        }
                                //        else {
                                //            $("#btShare").show();//회람
                                //        }
                                ////    }
                                //if (getInfo("CurrentDivisionIdx") == "" || getInfo("CurrentDivisionIdx") == "0") {
                                //    $("#btModify").show();
                                //}
                                //else {
                                //    $("#btModifyE").show();
                                //}

                                $("#btModify").hide();
                                document.getElementById("btchangeSave").style.display = "none";//저장
                                if (getInfo('piid_parent') == '') { // 발신부서에서는 기각만 있음 
                                    $("#btDeny").show();//기각
                                }

                                $("#btApproved").show();//결재
                                //수신인 경우
                                if (getInfo('piid_parent') != '') {
                                    $("#btDeny").show();//기각
                                    //문구만 반송
                                    $("#btDeny").find("a>em>span").html(Common.GetDic("lbl_apv_reject"));

                                    if (getInfo('scRCHBis') == '1') {
                                        if (getInfo("editmode") == "M") {
                                            $("#btModifyE").hide();
                                        }
                                        else {
                                            $("#btModifyE").show();
                                        }
                                    }
                                    //$("#btReject").show();//반송
                                }
                                else {

                                    if (getInfo('scLCHBis') == '1') {
                                        if (getInfo("editmode") == "Y") {
                                            document.getElementById("btchangeSave").style.display = "";//저장
                                            document.getElementById("btModify").style.display = "none";//편집
                                        }
                                        else {
                                            if (getInfo("mode_unit") != "AGREEMENT_P_APPROVAL") { // 협조자 편집여부(순차 가능 , 병렬 불가)
                                                document.getElementById("btModify").style.display = "";//편집
                                            } else if ($(currApvListXML).find("steps > division[divisiontype='send'] > step:has(> ou > person[code='" + getInfo("usid") + "'] > taskinfo[status='pending'])").attr("allottype") == "serial") {
                                                document.getElementById("btModify").style.display = "";//편집
                                            }
                                        }
                                    }
                                }
                                //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                                if (getInfo("openerDivisionType") == "RECEIVE") {
                                    $("#btnReceiptStatus").show();//협조처 수신확인
                                }

                                //if (SendApprovalCnt == 0) {
                                //    $("#btnReceiptStatus").show();//협조처 수신확인
                                //}
                                //별도보고 상태 발신측에서 
                                if (getInfo('piid_parent') == '') {
                                    if (getInfo('SpecialReport') == 'Y') {
                                        if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고
                                    }
                                }
                            }
                        }
                        break;
                    case "AUDIT": //감사
                    case "PCONSULT": //개인합의			                   
                        break;
                    case "RECAPPROVAL": //수신결재
                        break;
                    case "SUBAPPROVAL": //부서합의내결재
                        break;
                    case "DEPART": //부서
                        break;
                    case "CHARGE": //담당자				
                    case "REDRAFT": //재기안
                    	//수신 또는 협조처이면서 부서내류, 부서간류, 3단계류, 전산사용권한류, 신청서를 제외한 모든 문서 공람자 활성화
                    	if (getInfo('piid_parent') != '' && (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN" && getInfo("pdef") != "REQUEST_PATTERN")) {
                            $("#btGongRam").show();//공람자 버튼 
                        }
                        if (getInfo("pdef") == "COOPERATION_PATTERN") {
                            //$("#divbtPrint").show()//인쇄
                            $("#btApproved").show();//결재
                            //if (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER")
                            //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
                            // 20181204 박한 회람사용유무 추가
                            if (getInfo("farmCode") == _FarmCode && (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER") && (Common.GetBaseConfig("ShareUseYN") != "N"))
                                if (((formJson.oFormData.DOC_LEVEL == "01" && formJson.oFormData.DOC_LEVEL != undefined) || (getInfo("SecurityForm") != undefined && getInfo("SecurityForm") == "Y") || (formJson.BODY_CONTEXT != undefined && formJson.BODY_CONTEXT.DOCSECURITY == "1" && formJson.BODY_CONTEXT.DOCSECURITY != undefined))) {
                                    $("#btShare").hide();//회람
                                } else {
                                    $("#btShare").show();//회람
                                }

                            if (getInfo("editmode") == "Y") {
                                document.getElementById("btchangeSave").style.display = "";//저장
                                document.getElementById("btModify").style.display = "none";//편집
                            }

                            if (getInfo('piid_parent') == '') { // 발신부서에서는 기각만 있음 
                                $("#btDeny").show();//기각
                            }
                            if (getInfo('piid_parent') != '') {
                                if (getInfo("mode_unit") == "CHARGE_APPROVAL")
                                    $("#btRejectRequest").show();//반송요청
                                else
                                    $("#btReject").show();//반송
                            }

                            else {
                                document.getElementById("btchangeSave").style.display = "none";//저장
                                if (getInfo('scLCHBis') == '1') {
                                    document.getElementById("btModify").style.display = "";//편집
                                } //test 스키마->발신부서 변경일때만이라도 변경하게 하였음 수정해야함 _최우석
                            }
                            //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                            if (SendApprovalCnt == 0) {
                                $("#btnReceiptStatus").show();//협조처 수신확인
                                //$("#btGongRam").show();//공람자 버튼 
                            }
                        } else if (getInfo('pdef') == 'STEP4_PATTERN' || getInfo('pdef') == 'STEP3_PATTERN' || getInfo('pdef') == 'COMPUTATION_PATTERN') {
                            //$("#divbtPrint").show()//인쇄
                            $("#btApproved").show();//결재
                            if (getInfo("editmode") == "Y") {
                                document.getElementById("btchangeSave").style.display = "";//저장
                                document.getElementById("btModify").style.display = "none";//편집
                            }
                            else {
                                if (getInfo('pdef') == 'STEP4_PATTERN') {
                                    document.getElementById("btchangeSave").style.display = "none";//저장
                                    document.getElementById("btModify").style.display = "";//편집
                                }
                            }

                            if (getInfo('piid_parent') == '') { // 발신부서에서는 기각만 있음 
                                $("#btDeny").show();//기각
                            }
                            if (getInfo('piid_parent') != '') {
                                //if (getInfo("mode_unit") == "CHARGE_APPROVAL")
                                //    $("#btRejectRequest").show();//반송요청
                                //else
                                //    $("#btReject").show();//반송
                                //신청서는 담당자도 반송임.
                                $("#btReject").show();//반송
                            }

                            else {
                                document.getElementById("btchangeSave").style.display = "none";//저장
                                if (getInfo('scLCHBis') == '1') {
                                    document.getElementById("btModify").style.display = "";//편집
                                } //test 스키마->발신부서 변경일때만이라도 변경하게 하였음 수정해야함 _최우석
                            }
                            //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                            if (SendApprovalCnt == 0) {
                                if (getInfo('pdef') != 'STEP4_PATTERN') {
                                    $("#btnReceiptStatus").show();//협조처 수신확인
                                    //$("#btGongRam").show();//공람자 버튼 
                                }
                                else {
                                    if (getInfo("mode_unit") != "CHARGE_APPROVAL") {
                                        $("#btnReceiptStatus").show();//협조처 수신확인
                                        //$("#btGongRam").show();//공람자 버튼 
                                    }
                                }
                            }
                        }                         
                        else if (getInfo("pdef") == "REQUEST_PATTERN" && getInfo("openerDivisionType") == "RECEIVE") {
                            //수신담당부서일 경우 부서원 결재 가능 여부 수신부서원 접수가능여부 Y 이면 BPM customAttribute06 : Y
                            if (getInfo("loct") == "APPROVAL") {
                                if ($(currApvListXML).find("division[divisiontype='receive']:has(taskinfo[status='pending']) > step[approverat='Y'][routetype='receive_dept'] > ou > person[code ='" + getInfo("usid") + "'] > taskinfo[status='pending']").length == 0) {
                                    var tbUR = Common.GetObjectInfo('UR', getInfo("usid")).Table[0];
                                    if (tbUR == null || tbUR == undefined) {
                                        Common.Warning(Common.GetDic("msg_apv_ApprovalLineSetFail2"));  // 결재선 세팅을 실패하였습니다.
                                        return;
                                    }
                                    var tbDN = Common.GetObjectInfo('DN', getInfo("ENT_CODE")).Table[0];
                                    if (tbDN == null || tbDN == undefined) {
                                        Common.Warning(Common.GetDic("msg_apv_ApprovalLineSetFail2"));  // 결재선 세팅을 실패하였습니다.
                                        return;
                                    }

                                    $(currApvListXML).find("division[divisiontype='receive']:has(taskinfo[status='pending']) > step[approverat='Y'][routetype='receive_dept'] > ou").remove();
                                    var step = $(currApvListXML).find("division[divisiontype='receive']:has(taskinfo[status='pending']) > step[approverat='Y'][routetype='receive_dept']");

                                    var oOU = currApvListXML.createElement("ou");
                                    var oPerson = currApvListXML.createElement("person");
                                    var oTaskinfo = currApvListXML.createElement("taskinfo");


                                    $(oOU).append(oPerson);
                                    $(oPerson).append(oTaskinfo);

                                    $(oOU).attr("code", tbUR.DeptCode);
                                    $(oOU).attr("name", tbUR.ExGroupName);
                                    $(oOU).attr("companycode", tbUR.DN_Code);
                                    $(oOU).attr("companyname", tbDN.ExDisplayName);
                                    $(oOU).attr("originidccode", tbDN.FarmCode);

                                    $(oPerson).attr("code", tbUR.UR_Code);
                                    $(oPerson).attr("name", tbUR.ExDisplayName);
                                    $(oPerson).attr("oucode", tbUR.DeptCode);
                                    $(oPerson).attr("ouname", tbUR.ExGroupName);
                                    $(oPerson).attr("position", tbUR.JobPositionCode);
                                    $(oPerson).attr("positionname", tbUR.ExJobPositionName);
                                    $(oPerson).attr("dutycode", "");
                                    $(oPerson).attr("dutyname", "");
                                    $(oPerson).attr("batchAt", "");
                                    $(oPerson).attr("delegationAt", "");
                                    $(oPerson).attr("documentstepcode", "");
                                    $(oPerson).attr("title", "");
                                    $(oPerson).attr("level", "");
                                    $(oPerson).attr("sipaddress", "");

                                    $(oTaskinfo).attr("status", "pending");
                                    $(oTaskinfo).attr("result", "pending");
                                    $(oTaskinfo).attr("kind", "normal");

                                    $(step).append(oOU);
                                    $("#APVLIST").val(CFN_XmlToString(currApvListXML));
                                    initApvList();
                                }
                            }

                            //수신부서에서 편집 시 결재정보버튼 보이게 하기 사용할지 여부 신규 프로세스
                            //공람 버튼 비활성화

                            if (getInfo('scRCHBis') == '1') {
                                if (getInfo("templatemode") == "Write") {
                                    $("#btModify").hide();
                                    $("#btLine").show();//결재선
                                }
                                else {
                                    $("#btModify").show();
                                }
                            }

                            $("#btApproved").show();//결재
                            if (getInfo("editmode") == "Y") {
                                document.getElementById("btchangeSave").style.display = "";//저장
                                document.getElementById("btModify").style.display = "none";//편집
                            }

                            $("#btDeny").show();//기각

                        }
                        else if (getInfo("pdef") == "REQST_CRRF_PATTERN") {
                            //수신부서에서 편집 시 결재정보버튼 보이게 하기 사용할지 여부 신규 프로세스
                            if (getInfo('scRCHBis') == '1') {
                                if (getInfo("templatemode") == "Write") {
                                    $("#btModify").hide();
                                    $("#btLine").show();//결재선
                                }
                                else {
                                    $("#btModify").show();
                                }
                            }

                            //if (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER")
                            //TO-DO : 사간결재 문서 이면서 사용자의 FarmCode가 기안자 회사의 FarmCode와 다른경우
                            // 20181204 박한 회람사용유무 추가
                            //if (getInfo("farmCode") == _FarmCode)
                            //    if (((formJson.oFormData.DOC_LEVEL == "01" && formJson.oFormData.DOC_LEVEL != undefined) || (getInfo("SecurityForm") != undefined && getInfo("SecurityForm") == "Y") || (formJson.BODY_CONTEXT != undefined && formJson.BODY_CONTEXT.DOCSECURITY == "1" && formJson.BODY_CONTEXT.DOCSECURITY != undefined))) {
                            //        $("#btShare").hide();//회람
                            //    } else {
                            //        if (getInfo('piid_parent') == '') {
                            //            $("#btShare").hide();//회람
                            //        }
                            //        else {
                            //            $("#btShare").show();//회람
                            //        }
                            //    }

                            if (getInfo('piid_parent') == '') { // 발신부서에서는 기각만 있음 
                                $("#btDeny").show();//기각
                            }

                            $("#btApproved").show();//결재
                            if (getInfo('piid_parent') != '') {
                                $("#btDeny").show();//기각
                                //문구만 반송
                                $("#btDeny").find("a>em>span").html(Common.GetDic("lbl_apv_reject"));
                            }
                            else {
                                document.getElementById("btchangeSave").style.display = "none";//저장
                                if (getInfo('scLCHBis') == '1') {
                                    document.getElementById("btModify").style.display = "";//편집
                                }
                            }
                            //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                            if (SendApprovalCnt == 0) {
                                $("#btnReceiptStatus").show();//협조처 수신확인
                            }
                            //별도보고 상태 발신측에서 
                            if (getInfo('piid_parent') == '') {
                                if (getInfo('SpecialReport') == 'Y') {
                                    if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고
                                }
                            }

                        }
                        break;
                    case "SUBREDRAFT": //합의재기안
                        break;
                }
            }
            break;
        case "SPECIAL_REPORT":
            {
                $("#btn_PaymentLine").show()//현황판
                switch (getInfo("mode")) {
                    case "PROCESS":
                        //$("#divbtPrint").show();//인쇄
                        //의견추가 버튼 //결재선 포함된사용자만
                        if (getInfo("mode_unit") == "DRAFT_APPROVAL") { // 진행중일때 기안자의 경우
                            if (currApprovalCnt == 0 && getInfo('scDraftCancel') == 1) {
                                $("#btWithdraw").show();//상신취소
                            }
                            $("#btCommentAdd").show();//의견추가

                            if (getInfo('SpecialReport') == 'Y') {
                                if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고
                            }
                            // 상신취소는 문서가 완료되지 않은 상태에서 결재처리한 결재자가 1명이라도 있는 경우?
                            //상신취소 버튼
                        }
                        if (getInfo("mode_unit") == "APPROVAL") { // 진행중일때 결재자의 경우
                            // 결재취소는 현 결재자가 열람자 다음 사람일 경우
                            if (getInfo("scApproveCancel") == 1) {
                                if ($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0
                                && $($(currApvListXML).find("steps > division[divisiontype='send'] > step[approvalorder='" + getInfo("approvalOrder") + "'][processinstanceid='" + getInfo("piid") + "']").next()).find("ou > person > taskinfo").attr("status") == "pending")
                                    $("#btCancelApprove").show();//결재취소
                            }
                            $("#btCommentAdd").show();//의견추가

                            if (getInfo('SpecialReport') == 'Y') {
                                if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고 결재자이면서 발신부서가 아닐경우 _ 품의서
                            }

                        }
                        //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                        if (getInfo("pdef") == "COOPERATION_PATTERN") {
                            if (SendApprovalCnt == 0)
                                $("#btnReceiptStatus").show();//협조처 수신확인
                        }
                        //기안 모드일때 품의서류 또는 협조전류 프로세스이면 협조처 버튼을 보이지 않는다.
                        if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") {
                            //if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1)
                            //    $("#btnCooperationView").show();
                        }

                        if (getInfo("pdef") == "INVEST_PATTERN") {
                            //if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1)
                            //    $("#btnCooperationView").show();
                        }
                        break;
                    case "APPROVAL":
                        if (getInfo("mode_unit") == "COOPERATION_APPROVAL") { //현결재자가 협조처 팀장의 경우
                            if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") { // 품의서일 경우
                                //$("#divbtPrint").show()//인쇄
                                $("#btAssignReviewer").show(); //협조결재
                                $("#btRejectConsult").show(); //협조거부
                                //$("#btnCooperationView").show();
                            }
                            else if (getInfo("pdef") == "COOPERATION_PATTERN") {
                                //$("#divbtPrint").show()//인쇄
                                $("#btApproved").show();//결재
                                if (getInfo("editmode") == "Y") {
                                    document.getElementById("btchangeSave").style.display = "";//저장
                                    document.getElementById("btModify").style.display = "none";//편집
                                }

                                if (getInfo('piid_parent') == '') { // 발신부서에서는 기각만 있음 
                                    $("#btDeny").show();//기각
                                }
                                if (getInfo('piid_parent') != '') {
                                    $("#btReject").show();//반송
                                }

                                else {
                                    document.getElementById("btchangeSave").style.display = "none";//저장
                                    if (getInfo('scLCHBis') == '1') {
                                        document.getElementById("btModify").style.display = "";//편집
                                    } //test 스키마->발신부서 변경일때만이라도 변경하게 하였음 수정해야함 _최우석
                                }
                                //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                                if (getInfo("pdef") == "COOPERATION_PATTERN") {
                                    if (SendApprovalCnt == 0)
                                        $("#btnReceiptStatus").show();//협조처 수신확인
                                }
                            }
                            else {
                                //$("#divbtPrint").show()//인쇄
                                $("#btAssignReviewer").show(); //협조결재
                                $("#btRejectConsult").show(); //협조거부
                            }
                        }
                        else if (getInfo("mode_unit") == "EXAMINATION_APPROVAL") { //현결재자가 검토자의 경우
                            //$("#divbtPrint").show()//인쇄
                            $("#btCompleteReview").show();//검토완료
                            //$("#btnCooperationView").show();
                        }
                        else {
                            //$("#divbtPrint").show()//인쇄
                            $("#btApproved").show();//결재
                            if (getInfo("templatemode") == "Write") {
                            	if (getInfo("scInformationAppV") != "000" || getInfo("scInformationApp_ref_person") != "0" || getInfo("scInformationApp_coop_only") != "0") { // 20200427 hpark 참조자 추가 // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
                                    $("#btLine").show();//결재선
                                }
                            }
                            if (getInfo("mode_open") != "SPECIAL_REPORT") {
                                //별도보고 버튼
                                if (getInfo('SpecialReport') == 'Y') {
                                    if (getInfo("SpecialReport")) { $("#btSpecialReport").show(); }//별도보고
                                }
                            }

                            if (getInfo("editmode") == "Y") {
                                document.getElementById("btchangeSave").style.display = "";//저장
                                document.getElementById("btModify").style.display = "none";//편집
                            }

                            if (getInfo('piid_parent') == '') { // 발신부서에서는 기각만 있음 
                                $("#btDeny").show();//기각
                            }
                            if (getInfo('piid_parent') != '') {
                                //발신부서 안에서도 process가 '협조전' 가 아닐경우 
                                if (getInfo('pdef ') == 'COOPERATION_PATTERN') {
                                    $("#btReject").show();//반송
                                }
                            }

                            else {
                                document.getElementById("btchangeSave").style.display = "none";//저장
                                if (getInfo('scLCHBis') == '1') {
                                    document.getElementById("btModify").style.display = "";//편집
                                } //test 스키마->발신부서 변경일때만이라도 변경하게 하였음 수정해야함 _최우석
                            }
                            //협조전의 협조처 접수확인은 협조처 측에서만 확인이 가능하다.
                            if (getInfo("pdef") == "COOPERATION_PATTERN") {
                                if (SendApprovalCnt == 0)
                                    $("#btnReceiptStatus").show();//협조처 수신확인
                            }
                            //기안 모드일때 품의서류 또는 협조전류 프로세스이면 협조처 버튼을 보이지 않는다.
                            //if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") {
                            //    if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1)
                            //        $("#btnCooperationView").show();
                            //}

                            //if (getInfo("pdef") == "INVEST_PATTERN") {
                            //    if (getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1)
                            //        $("#btnCooperationView").show();
                            //}
                        }
                        break;
                }
            }
            break;
        case "ADMIN":
        	break;
    	case "AFTER_CONFIRM": // 20200610 hpark 예결함에서 선결
    		if (getInfo("documentViewStateCode") == "PRE_COMPLETE" && getInfo("mode") == "APPROVAL") {
    			$("#btn_PaymentLine").show();
    			$("#btAfterConfirm").show();
			}
    		break;
    }

    //관리자
    if (admintype == "ADMIN") {
        switch (getInfo("loct")) {
            case "PREAPPROVAL":
            case "APPROVAL":
            case "PROCESS":
                if (getInfo("mode") == "PROCESS") {
                    m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
                    var elmRoot = $(m_evalXML).find("steps");
                    var strDate;
                    //합의부서 삭제 - 
                    var elmAssist = $(elmRoot).find("division:has(taskinfo[status='pending']) > step:has(taskinfo[status='pending'])[routetype='assist'][unittype='ou'] > ou:has(taskinfo[status='pending'])");
                    if (getInfo("scDCooRemove") == "1" && elmAssist.length > 0) {
                        var bPendigOUs = false;
                        $(elmAssist).each(function (ia, elmaOU) {
                            var elmaPerson = $(elmaOU).find("person");
                            if (elmaPerson.length == 0) {
                                bPendigOUs = true; return false;
                            }
                        });
                        if (bPendigOUs) {
                            document.getElementById("btDCooRemove").style.display = "";
                        }
                    }
                    if (elmAssist.length == 0) {//합의단계가 아닐 경우에 결재선 변경 가능
                        document.getElementById("btAPVLINEModify").style.display = "";//결재선변경
                    }
                } else {
                    document.getElementById("btAPVLINEModify").style.display = "";//결재선변경
                    if (getInfo("mode") == "APPROVAL" || getInfo("mode") == "RECAPPROVAL" || getInfo("mode") == "SUBAPPROVAL") {
                        //if(getInfo("ptid")==getInfo("pfpfid")) btForward.style.display = "";
                        $('#btDeptLineW').css("display", "none");
                    }
                }
                document.getElementById("btAdminAbort").style.display = ""; //관리자 강제 취소 - 진행 중 문서도 취소가 됨
                break;

        }
        document.getElementById("btModify").style.display = "";//문서편집
        if (getInfo('Approval_mail')) { document.getElementById("btDeleteDoc").style.display = ""; } //문서삭제
        //hjw modi 관리자>사용자문서보기에서 버튼 숨기기
    }

    //전달기능 주석처리
    //if ((admintype == "ADMIN") && (getInfo("loct") == "APPROVAL" || getInfo("loct") == "REDRAFT") && (getInfo("mode") == "APPROVAL" || getInfo("mode") == "PCONSULT" || getInfo("mode") == "SUBREDRAFT" || getInfo("mode") == "SUBAPPROVAL" || getInfo("mode") == "RECAPPROVAL")) {
    //    document.getElementById("btForward").style.display = "";
    //}

    if (getInfo("readtype") == "openwindow") //새창보기
    {
        return;
    }
    //if (getInfo("mode") == 'ADMIN') {
    //    //관리자모드에서 fmpt로 구분하여 연동재실행 버튼 보임
    //    if (getInfo('fmpf') == "WF_FORM_DRAFT") {
    //        document.getElementById("btRerunAction").style.display = "";
    //    }
    //}

    //신세계 Layer 수정 적용
    //2016-06-08
    //YJYOO
    try {
        if (openMode == "L") {
            //var openID = CFN_GetQueryString("openID");
            if (openID != "") {//Layer popup 실행
                var openID = CFN_GetQueryString("openID");
                if ($("#" + openID + "_if", parent.document).length > 0) {
                    m_oInfoSrc = $("#" + openID + "_if", parent.document)[0].contentWindow;
                } else { //바닥 popup
                    m_oInfoSrc = parent;
                }
            } else {
                m_oInfoSrc = top.opener;
            }

            if (m_oInfoSrc.location.href.toUpperCase().indexOf("/LIST.ASPX") > -1) {
                if (m_oInfoSrc.strPiid_List != "") {
                    document.getElementById("btPreList").style.display = "";
                    document.getElementById("btNextList").style.display = "";
                }
            }

        }
        else if (opener != null && admintype != "ADMIN") {   //hjw modi 관리자>사용자문서보기에서 버튼 숨기기
            if (opener.location.href.toUpperCase().indexOf("/LIST.ASPX") > -1) {
                if (opener.strPiid_List != "") {
                    document.getElementById("btPreList").style.display = "";
                    document.getElementById("btNextList").style.display = "";
                }
            }
        }
    } catch (e) { }
    //console.log("initBtn END : " +new Date().getHours() + ":" + new Date().getMinutes() + ":" + new Date().getSeconds() + "." + new Date().getMilliseconds());
}
//function displayBtn(sDraft, schangeSave, sDoc, sPost, sLine, sRecDept, sAction, sDeptDraft, sDeptLine, sSave, sMail, sAttach, sPreview, sCommand, sRec, sTempMemo, sInfo) {
//    document.getElementById("btDraft").style.display = sDraft;//"기안하기"
//    document.getElementById("btPost").style.display = sPost;//"게시"
//    document.getElementById("btLine").style.display = sLine;//"결재선관리"

//    document.getElementById("btRecDept").style.display = sRecDept;//"수신처지정"
//    document.getElementById("btAction").style.display = sAction;//="결재하기"
//    document.getElementById("btDeptDraft").style.display = sDeptDraft; //"재기안"
//    document.getElementById("btDeptLine").style.display = sDeptLine; //"내부결재선관리"
//    document.getElementById("btDeptLineConsult").style.display = sDeptLine; //"내부결재선관리"


//    if (getInfo("fmpf") != "WF_FORM_CORP_CARD_EXPENSE") {
//        document.getElementById("btSave").style.display = sSave; //"임시저장"
//    } else {    //lka 법인카드 양식은 임시서장버튼 대신 저장버튼을 사용함 임시저장기능 없음
//        document.getElementById("btSave").style.display = "none"; //"임시저장"
//        if (getInfo("mode") == "DRAFT") { document.getElementById("btDataSave").style.display = ""; }   //"저장"
//        else { document.getElementById("btDataSave").style.display = "none"; }    //"저장"
//    }

//    document.getElementById("btAttach").style.display = sAttach;//"파일첨부"
//    document.getElementById("btPreView").style.display = sPreview;//"미리보기"

//    //if (g_szEditable) document.getElementById("btPreView").style.display = "none"; // 미리보기 버튼

//    document.getElementById("btnTempMemo").style.display = "none"; //20120125 by ssuby 임시메모 사용하지 않는다

//    //기밀문서 권한 지정
//    if (getInfo("secdoc") == "1") {
//        document.getElementById("chk_secrecy").checked = true;
//    }

//    //'문서이관' 체크박스 상태값 확인 2005.08.03 박형진 추가
//    if (getInfo("edms_document") == "1") {
//        document.getElementById("chk_edmschk").checked = true;
//    }
//    //TO-DO : 신세계에서는 긴급결재 사용하지 않음
//    //2016-07-19 YJYOO
//    document.getElementById("urgent").style.display = "none";//긴급결재 기안시 지정
//    if (getInfo("pipr") == "5") document.getElementById("chk_urgent").checked = true;	//긴급결재 기안시 지정




//    if (getInfo("scApv") == "1" && sAction == "")  //개별버튼사용시 
//    {
//        document.getElementById("btAction").style.display = "none"; //="결재하기"
//        var bReviewr = fn_GetReview();
//        if (getInfo("mode") == "REDRAFT" || getInfo("mode") == "SUBREDRAFT") {
//            if (getInfo("pfsk") == "T008") { //담당자 재기안일 경우 결재버튼 활성화
//                document.getElementById("btApproved").style.display = "";
//                if (!bReviewr) document.getElementById("btReject").style.display = "";
//            }
//        } else {
//            //20110318 확인결재추가
//            if (getInfo("pfsk") == "T019" || getInfo("pfsk") == "T005" || getInfo("pfsk") == "T020") {//확인결재
//                document.getElementById("spanbtApproved").innerHTML = gLabel_confirm;
//                document.getElementById("btApproved").style.display = "";
//            } else {

//                document.getElementById("btApproved").style.display = "";
//                if (!fn_GetReview()) document.getElementById("btReject").style.display = "";

//            }
//        }
//        switch (getInfo("mode")) {
//            case "AUDIT":
//                if (Common.GetBaseConfig('useHold') == "Y" && getInfo("ptid") == getInfo("usid")) { document.getElementById("btHold").style.display = ""; }
//                if (getInfo("scRJTO") == "1" && fn_checkrejectedtoA()) { document.getElementById("btRejectedto").style.display = ""; }
//                break;
//            case "PCONSULT":
//                if (getInfo("pfsk") == "T009") {
//                    document.getElementById("spanbtApproved").innerHTML = gLabel_agree;
//                    document.getElementById("spanbtReject").innerHTML = gLabel_disagree;
//                }
//                if (getInfo("scRJTO") == "1" && fn_checkrejectedtoA()) { document.getElementById("btRejectedto").style.display = ""; }

//                if (Common.GetBaseConfig('useHold') == "Y" && getInfo("ptid") == getInfo("usid") && getInfo("pfsk") != "T019") { document.getElementById("btHold").style.display = ""; }
//                break;
//            case "SUBAPPROVAL": //합의부서내 결재
//                if (getInfo("scRJTO") == "1" && fn_checkrejectedtoA()) { document.getElementById("btRejectedto").style.display = ""; }

//                if (Common.GetBaseConfig('useHold') == "Y" && getInfo("ptid") == getInfo("usid") && getInfo("pfsk") != "T019") { document.getElementById("btHold").style.display = ""; }
//                if (getInfo("scRJTODept") == "1") { if (!bReviewr) document.getElementById("btRejectedtoDept").style.display = ""; } //2013.12.18 부서내반송 버튼 display
//                break;
//            case "RECAPPROVAL": //수신부서내 결재
//                if (getInfo("scRJTO") == "1" && fn_checkrejectedtoA()) { if (!bReviewr) document.getElementById("btRejectedto").style.display = ""; }
//                if (getInfo("scRJTODept") == "1") { if (!bReviewr) document.getElementById("btRejectedtoDept").style.display = ""; }

//                if (Common.GetBaseConfig('useHold') == "Y" && getInfo("ptid") == getInfo("usid") && getInfo("pfsk") != "T019") { if (!bReviewr) document.getElementById("btHold").style.display = ""; }
//                break;
//            case "APPROVAL":
//                if (getInfo("scRJTO") == "1" && fn_checkrejectedtoA()) { if (!bReviewr) document.getElementById("btRejectedto").style.display = ""; }

//                if (Common.GetBaseConfig('useHold') == "Y" && getInfo("ptid") == getInfo("usid") && getInfo("pfsk") != "T019") {
//                    if (!bReviewr) document.getElementById("btHold").style.display = "";
//                    //신세계 Customizing 미결함에 수신된 담당업무 결재문서 열었을 경우 처리
//                    //2016-10-17 BY YJYOO
//                    var m_apvXML = $.parseXML(document.getElementById("APVLIST").value);
//                    var rolenode = $(m_apvXML).find("steps > division > step > ou > role:has(taskinfo[status='pending'])");
//                    if (rolenode.length > 0) {
//                        document.getElementById("btHold").style.display = "none";
//                    }
//                    return false;
//                }
//                break;
//            case "CHARGE":
//                break;
//            case "REDRAFT":
//                if (Common.GetBaseConfig('useHold') == "Y" && getInfo("pfsk") == "T008" && getInfo("loct") == "APPROVAL" && getInfo("gloct") == "JOBFUNCTION") { document.getElementById("btHold").style.display = ""; }

//                //if (getInfo("fmpf") == "WF_FORM_DRAFT_IC0_003") {
//                if (getInfo('scApvLineTypeauto') == 'R') {
//                    document.getElementById("btDeptLine").style.display = "none";
//                }
//                break;
//        }
//    }
//    if (getInfo("loct") == "REVIEW" && getInfo("mode") == "APPROVAL") {
//        if (getInfo("scReviewV") == "1") {//공람결재
//            $("#btApproved").css({ "display": "" }); $("#spanbtApproved").html(gLabel_confirm);
//        } else {//공람열람
//            var sItems = "<request>";
//            sItems += "<item wiid=\"" + getInfo("wiid") + "\" ptid=\"" + getInfo("ptid") + "\" pfid=\"" + getInfo("pfid") + "\" pfsk=\"" + getInfo("pfsk") + "\" usid=\"" + getInfo("ptid") + "\" />";
//            sItems += "</request>";
//            CFN_CallAjax("../InstMgr/switchWI2Complete.aspx", sItems, function (data) {
//                receiveGeneralQuery(data);
//            }, false, "xml");
//        }
//    }
//    //사용자 문서 조회 및 수정
//    if (admintype == "ADMIN") {
//        if (getInfo("loct") == "PREAPPROVAL" || getInfo("loct") == "APPROVAL" || getInfo("loct") == "PROCESS" || getInfo("loct") == "COMPLETE" || getInfo("loct") == "REJECT") {
//            document.getElementById("btModify").style.display = "";	//편집버튼 활성화

//            switch (getInfo("mode")) {
//                case "PREAPPROVAL": //예고함
//                    break;
//                case "APPROVAL":		//미결함
//                    document.getElementById("btAction").style.display = "none";
//                    break;
//                case "PROCESS":			//진행함
//                    if (getInfo("gloct") != "DEPART") {		// [2015-01-23 modi] 부서진행함 - 조건 없이 실행하던걸 if추가하여 안에 넣음
//                        btWithdraw.style.display = "none";
//                    }
//                    break;
//                case "COMPLETE":		//완료함				    
//                    break;
//                case "REJECT":			//부결함
//                    break;
//            }
//        }
//    }

//    //feedback 사용
//    if (getInfo("feedback") == "1") {
//        document.getElementById("chk_feedback").checked = true;
//        document.getElementById("selfeedback").value = getInfo("selfeedback");
//    }

//    //2017.02 yu2mi : 현기차 협조프로세스 시연용
//    //if (getInfo("fmpf") == "WF_FORM_DRAFT_IC0_999") {
//    if (getInfo('scApvLineTypeauto') == 'D') {
//        if (getInfo("iWIBusinessData4") == "Y") {
//            document.getElementById("btApproveD").style.display = "";
//            document.getElementById("btApproveCancel").style.display = "none";
//        }
//    }

//    if (getInfo("mode") == "SUBAPPROVAL" || getInfo("mode") == "RECAPPROVAL") {
//        if (getInfo("usismanager") == "true") {
//            //document.getElementById("btDeptLineConsult2").style.display = "";
//            document.getElementById("btApproved").style.display = "none";
//            document.getElementById("btHold").style.display = "none";
//            document.getElementById("btDeptLineConsult").style.display = "none";
//            //결재선 버튼
//            document.getElementById("btLine").style.display = "none";
//            //승인 버튼
//            document.getElementById("btApproveD").style.display = "none";
//            //반려 
//            document.getElementById("btReject").style.display = "none";
//            document.getElementById("btDeptLineW").style.display = "none";
//            document.getElementById("btRejectedtoDept").style.display = "none";
//            document.getElementById("btModify").style.display = "none";

//            //현재 결재가 부서협조가 완료된 후에 결재자에게 온것이면 진짜 승인버튼을
//            if (getInfo("iWIBusinessData4") == "Y") {
//                document.getElementById("btApproved").style.display = "none";
//                document.getElementById("btApproveD").style.display = "";
//            } else {
//                document.getElementById("btApproved").style.display = "";
//                document.getElementById("btApproveD").style.display = "none";
//            }

//            //현재 결재가 부서협조 완료 전에 결재자에게 온것이면 가짜 승인버튼을 보여줌.
//        } else {
//            document.getElementById("btDeptLineConsult2").style.display = "";
//            document.getElementById("btDeptLineConsult").style.display = "none";
//            document.getElementById("btApproved").style.display = "none";
//            document.getElementById("btHold").style.display = "none";
//            document.getElementById("btReject").style.display = "none";
//            document.getElementById("btModify").style.display = "none";
//            document.getElementById("btRejectedtoDept").style.display = "none";
//            //
//            document.getElementById("btForward").style.display = "none";
//            document.getElementById("btDeptLineW").style.display = "none";


//        }
//    }
//    if (getInfo("mode") == "REDRAFT") {
//        if (getInfo("usismanager") == "true") {
//            document.getElementById("btReject").style.display = "";
//            $("#spanbtReject").text("협조거부");
//            document.getElementById("btModify").style.display = "none";
//            document.getElementById("btDeptLineConsult").style.display = "";
//        } else {
//            document.getElementById("btDeptLineConsult").style.display = "none";
//            document.getElementById("btModify").style.display = "none";

//        }
//    }

//    if (getInfo("mode") == "SUBREDRAFT") {
//        if (getInfo("usismanager") == "true") {
//            document.getElementById("btReject").style.display = "";
//            $("#spanbtReject").text("협조거부");
//            document.getElementById("btModify").style.display = "none";
//            document.getElementById("btDeptLineConsult").style.display = "";
//            document.getElementById("btDeptLine").style.display = "none";
//        } else {
//            document.getElementById("btDeptLineConsult").style.display = "none";
//            document.getElementById("btModify").style.display = "none";
//            document.getElementById("btDeptLine").style.display = "none";
//        }
//    }
//}
function displayBtnTrans() {//시행문변환관련버튼
    if (getInfo("loct") != 'COMPLETE') {
        switch (getInfo("pfsk")) {
            case "T001":
                document.getElementById("btITrans").style.display = "";
                document.getElementById("btTrans").style.display = "none";
                document.getElementById("btRecDept").style.display = "";		//"수신처지정"
                iBody.style.display = "";
                break;
            case "T002":
                document.getElementById("btTrans").style.display = "none";
                document.getElementById("btOTrans").style.display = "";
                document.getElementById("btRecDept").style.display = "none";//"수신처지정"
                break;
            case "T003":
                document.getElementById("btSign").style.display = ""; break;
            case "T007": break;
        }
    } else {
        if (getInfo("fmpf") == "DRAFT") document.getElementById("btOTrans").style.display = "";
    }
}
function getDisplayMode(sReadMode, sSchemaOption) {//스키마 옵션에 따른 버튼 활성화	
    if (getInfo(sSchemaOption) == "1") { return ""; } else { return "none"; }
}
function disableBtns(bDisable) {
    if (document.getElementById("btDraft") != null) {
        document.getElementById("btDraft").disabled = bDisable;
        //document.getElementById("btExit").disabled = bDisable;
        //document.getElementById("btPrint").disabled = bDisable;
    }
    if (document.getElementById("btDraft") != null) {
        document.getElementById("btDraft").disabled = bDisable;
    }
    if (document.getElementById("btchangeSave") != null) {
        document.getElementById("btchangeSave").disabled = bDisable;
    }
    if (document.getElementById("btSave") != null) {
        document.getElementById("btSave").disabled = bDisable;
    }
    if (document.getElementById("btApproved") != null) {
        document.getElementById("btApproved").disabled = bDisable;
    }
}
//1인결재 및 담당자 추가 관련 수정 20006.08 by sunny
function evaluateForm() {
    var truthBeTold = false;
    switch (getInfo("fmpf")) {
        case "DRAFT":
        case "OUTERPUBLISH":
            if ((getInfo("mode") == "TEMPSAVE" || getInfo("mode") == "DRAFT") && document.getElementById("SUBJECT").value.trim() == "") {
                Common.Warning(gMessage28); return false; //"제목을 입력하세요."
            }
        case "REQUEST":
    	default:

    		// 20200821 hpark 기본결재선 상신시/수신부서 접수시 필수체크
    		if (getInfo("USE_BASIC_APPROVAL_LINE") == "Y") { // 기본결재선을 사용하는 회사만
    			if (!fn_ValidBasicApvList()) return false;
    		}

            //첨부파일 처리
            //if (!XFN_FileUpload()) return;
            if (getInfo("WorkingBudgetHasReject") == "Y") {
                alert(Common.GetDic("msg_apv_Workingbudget_Reject"));
                return false;
            }

            //개인협조 가능 여부 체크
            if (getInfo("scApvAssistHidden") == "1") {
                var assistOption = "";
                var index = getInfo("CurrentDivisionIdx");

                if (index == "1") assistOption = "selPersonReceive1";
                else if (index == "2") assistOption = "selPersonReceive2";
                else assistOption = "selPersonSend";

                if (getInfo("chkFinalCooperationYN") == "Y" && (getInfo(assistOption) == "S" || getInfo(assistOption) == "P" || getInfo(assistOption) == "SP")) {
                    if ($(document.getElementById("APVLIST").value).find("division:eq(" + index + ") > step:not(:first):last[allottype='parallel']").length > 0
                        && $(document.getElementById("APVLIST").value).find("division:eq(" + index + ")").attr("divisiontype") != "cooperation"
                        && (getInfo("pdef") != "COOPERATION_PATTERN" || index == "0")) {
                        Common.Warning(Common.GetDic("lbl_assist_parallel_01"));
                        return;
                    }
                }
                else {
                    if ($(document.getElementById("APVLIST").value).find("division:eq(" + index + ") > step:not(:first):last[routetype='assist']").length > 0
                        && $(document.getElementById("APVLIST").value).find("division:eq(" + index + ")").attr("divisiontype") != "cooperation"
                        && (getInfo("pdef") != "COOPERATION_PATTERN" || index == "0")) {
                        Common.Warning(Common.GetDic("lbl_assist_parallel_02"));
                        return;
                    }
                }
            }

            // 20181106 박한 양식 공통 Read모드에서 Validation - checkFormForRead (필요한 양식에 정의해서 사용)
            if (getInfo("templatemode") == "Read") {
                if (typeof checkFormForRead == "function" || typeof checkFormForRead == "object") {
                    if (!checkFormForRead()) return false;
                }
            }

            // 편집 혹은 작성모드이면서 첨부파일 필수여부 체크
            if (getInfo("chkAttachRequireYN") == "Y" && (getInfo("editmode") == "Y" || getInfo("templatemode") == "Write")) {
                //GetAttachFilesCnt() == 0 안되면 이걸로 교체
                if ($("#iframeHTML5_if").length > 0) {
                    if (GetAttachFilesCnt() == 0) {
                        alert(Common.GetDic("msg_AddAttachFile")); // "첨부파일을 추가해 주세요."
                        return false;
                    }
                }
                else {
                    alert(Common.GetDic("msg_AddAttachFile")); // "첨부파일을 추가해 주세요."
                    return false;
                }
            }

            if (m_sReqMode != "TEMPSAVE" && m_sReqMode != "APPROVE" && m_sReqMode != "DEPTDRAFT") {
                m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
                var elmRoot = $(m_evalXML).find("steps");
                var elmList;

                if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") {
                    elmList = $(elmRoot).find("division:has(taskinfo[status='inactive']) > step[routetype='approve'] > ou > person:has(taskinfo[kind!='charge']),division:has(taskinfo[status='inactive']) > step[routetype='approve'] > ou > role:has(taskinfo[kind!='charge'])");
                } else if (getInfo("mode") == "REDRAFT") {
                    if (m_sReqMode == "CHARGE") {
                        elmList = $(elmRoot).find("division[divisiontype='receive'] > step");
                    } else {
                        elmList = $(elmRoot).find("division[divisiontype='receive'] > step[routetype='approve'] > ou > person:has(taskinfo[kind!='charge']),division[divisiontype='receive'] > step[routetype='approve'] > ou > role:has(taskinfo[kind!='charge'])");
                    }
                } else if (getInfo("mode") == "SUBREDRAFT") {
                    if (m_sReqMode == "CHARGE") {
                        elmList = $(elmRoot).find("division:has(taskinfo[status='pending']) > step > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "'])");
                    } else {
                        elmList = $(elmRoot).find("division:has(taskinfo[status='pending']) > step > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "']) > person:has(taskinfo[kind!='charge']),division:has(taskinfo[status='pending']) > step > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "']) > role:has(taskinfo[kind!='charge']) ");
                    }
                } else {
                    elmList = $(elmRoot).find("division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > person:has(taskinfo[kind!='charge']),division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > role:has(taskinfo[kind!='charge'])");
                }

                if (elmList.length == 0 && admintype != "ADMIN") {
                    //[2016-03-04] Kimjh 임시저장시 1인결재일 가능 
                    if (getInfo("scChrDraft") == "1" && (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE")) {
                        //if (!confirm(gMessage198)) return false;
                    } else if (getInfo("scChrRedraft") == "1" && getInfo("mode") == "REDRAFT") {
                        //if (!confirm(gMessage198)) return false;
                    } else {
                        Common.Warning(gMessage29); //"결재선이 지정되지 않았습니다."
                        return false;
                    }
                }
                if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") {
                    //TO-DO : 기안 시 전결권자가 보직을 가진 사람인지 체크로직 수행
                    if (getInfo("UseCheckApproveOwner") == "Y" && !CheckApprovalOrder()) {
                        alert(Common.GetDic("msg_CheckApprovalOwner"));
                        return false;
                    }
                }
                //품의류 템플릿일 경우 협조기한일 Validation 수행
                if (getInfo("templatemode") == "Write" && getInfo("typeImg") == "T2" && getInfo("fmpf") != "GWOK_REPORT_W03") {
                    fnConsultDate();
                }

                // [2015-10-12 add] 예약배포/예약기안시 validation 체크 (10분이후 시간부터만 가능하도록)
                if (getInfo("mode") == "DRAFT" && (getInfo("scReserved") || getInfo("scDistribute"))) {
                    if ($("#chk_reserved").is(":checked")) {

                        if ($("#ReservedTime").val() == "") {
                            alert("예약 날짜를 입력해주세요.");
                            return false;
                        }

                        var objToday, todayYear, todayMonth, todayDay, todayHour, todayMinute, tmpTodayStr, tmpReservedStr;
                        objToday = new Date(Date.parse(new Date()) + 1000 * 60 * 10);

                        todayYear = objToday.getFullYear() + "";

                        todayMonth = objToday.getMonth() + 1;
                        todayMonth = (todayMonth < 10) ? "0" + todayMonth : todayMonth + "";

                        todayDay = objToday.getDate();
                        todayDay = (todayDay < 10) ? "0" + todayDay : todayDay + "";

                        todayHour = objToday.getHours();
                        todayHour = (todayHour < 10) ? "0" + todayHour : todayHour + "";

                        todayMinute = objToday.getMinutes();
                        todayMinute = (todayMinute < 10) ? "0" + todayMinute : todayMinute + "";

                        tmpTodayStr = todayYear + todayMonth + todayDay + todayHour + todayMinute;

                        tmpReservedStr = $("#ReservedTime").val().replace(/-/g, "").replace(/\./g, "") + $("#selThisHour").val() + $("#selThisMin").val();

                        if (tmpReservedStr <= tmpTodayStr) {
                            alert("현재 시간으로부터 10분 이후 시간에만 예약 가능 합니다.");
                            return false;
                        }
                    }

                }

                var elmRecList = $(elmRoot).find("division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > person:has(taskinfo[kind!='charge']), division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > role:has(taskinfo[kind!='charge'])");
                if (getInfo("scDRec") == 1 && (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE" || getInfo("mode") == "APPROVAL")) {
                    var elmOu = $(elmRoot).find("division > step[routetype='receive'] > ou");
                    if (elmOu.length == 0) {
                        if (confirm(gMessage199)) return checkForm((m_sReqMode == "TEMPSAVE" ? true : false)); //"경유부서 없이 진행하시겠습니까?"
                    } else {
                        //
                    }
                }

                if (getInfo("scPRec") == 1 && (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE" || getInfo("mode") == "APPROVAL")) {
                    var elmOu = $(elmRoot).find("division > step[routetype='receive'] > ou > person");

                    if (elmOu.length == 0) {
                        if (getInfo("scPRecV") == "select") {
                            if (!confirm(gMessage201)) return false; //"담당자 지정없이 진행하시겠습니까?"
                        } else {
                            if (getInfo("scDRec") == 1 && (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE" || getInfo("mode") == "APPROVAL")) {
                                elmOu = $(elmRoot).find("division > step[routetype='receive']");
                                if (elmOu.length == 0) {
                                    alert(gMessage181); //"담당자를 지정하십시요"
                                    return false;
                                }
                            } else {
                                alert(gMessage181); //"담당자를 지정하십시요"
                                return false;
                            }
                        }
                    } else {
                        //담당업무를 1개만 지정하도록 수정 2005.04.21 황선희
                        var elmReceive = $(elmRoot).find("division > step[unittype='person'][routetype='receive']");

                        //한번에 두개 이상의 담당업무를 지정 할 경우 Check
                        if (elmReceive.length > 0) {
                            var ouReceive = $(elmReceive[0]).find("person");
                        }
                    }
                }

                if (getInfo("Form_Deputy_YN") == "N" && (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE")) {
                    //if (getInfo("UseDocHelpApproval") == "N" && (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE")) {
                    try {
                        var bDeputyFlag = false;
                        m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
                        var elmRoot = $(m_evalXML).find("steps");
                        //$(elmRoot).find("division > step > ou > person:has(taskinfo[kind!='charge'])").each(function (i, elm) {
                        //    var sURL = "/Approval/Controls/ApprovalWebservice.asmx";
                        //    var oResult = CFN_CallAjaxJson(sURL + "/GetUserDeputy", "{ur_code:'" + $(elm).attr("code") + "', gr_code:'" + $($(elm).parent()).attr("companycode") + "_" + $(elm).attr("oucode") + "'}", false, null);
                        //    var oRsltJSON = $.parseJSON(oResult);
                        //    var jsonObj = JSON.parse(oRsltJSON.d);
                        //    var Table = jsonObj.NewDataSet.Table;

                        //    if (typeof (Table.Deputy_YN) != "undefined") {
                        //        var bDeputy_YN = Table.Deputy_YN;
                        //        if (bDeputy_YN == "1") {
                        //            bDeputyFlag = true;
                        //        }
                        //    }
                        //});
                        var ur_codeList = "";
                        var gr_codeList = "";
                        $(elmRoot).find("division > step > ou > person:has(taskinfo[kind!='charge'])").each(function (i, elm) {
                            ur_codeList += $(elm).attr("code") + ";";
                            gr_codeList += $($(elm).parent()).attr("companycode") + "_" + $(elm).attr("oucode") + ";";
                        });

                        var sURL = "/Approval/Controls/ApprovalWebservice.asmx";
                        var oResult = CFN_CallAjaxJson(sURL + "/GetUserDeputyList", "{ur_codeList:'" + ur_codeList + "', gr_codeList:'" + gr_codeList + "'}", false, null);
                        var oRsltJSON = $.parseJSON(oResult);
                        var jsonObj = JSON.parse(oRsltJSON.d);
                        var Table = jsonObj.NewDataSet.Table;

                        if (typeof (Table.Deputy_YN) != "undefined") {
                            var bDeputy_YN = Table.Deputy_YN;
                            if (parseInt(bDeputy_YN) > 0) {
                                bDeputyFlag = true;
                            }
                        }
                        if (bDeputyFlag) {
                            Common.Warning(Common.GetDic("msg_apv_432"), "", function (result) {
                                doButtonAction($("#btLine")[0]);

                                return false;
                            });
                        } else {
                            return checkForm((m_sReqMode == "TEMPSAVE" ? true : false));
                        }
                    } catch (e) {
                    }
                } else {

                    //문서이관 관련 check
                    //if (getInfo("scEdmsLegacy") == "1" && m_sReqMode == "DRAFT" && (document.getElementById("DOC_LEVEL").value == "" || document.getElementById("SAVE_TERM").value == "" || document.getElementById("DOC_CLASS_NAME").value == "")) {
                    //    Common.Warning(gMessage202); //"문서관리시스템 이관을 위한 문서정보를 입력하십시오."
                    //    return false;
                    //}
                    return checkForm((m_sReqMode == "TEMPSAVE" ? true : false));
                    break;
                }
            } else {
                //수신부서 1인결재 확인
                if ((m_sReqMode == "APPROVE" || m_sReqMode == "DEPTDRAFT") && (getInfo("mode") == "REDRAFT" || (getInfo("pdef") == "REQUEST_PATTERN" && (getInfo("mode") == "REDRAFT" || getInfo("mode") == "RECAPPROVAL")))
                    && document.getElementById("ACTIONINDEX").value != "reject" && document.getElementById("ACTIONINDEX").value != "reserve" && document.getElementById("ACTIONINDEX").value != "rejectedto") { // [2015-07-21 han modi] 부서수신함/담당업무함 관련 조건추가 (dobuttoncase 에서 m_sReqMode=approve로 넘어와서)
                    m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
                    var elmRoot = $(m_evalXML).find("steps");
                    var elmList;

                    if (getInfo("mode") == "REDRAFT" || (getInfo("pdef") == "REQUEST_PATTERN" && (getInfo("mode") == "REDRAFT" || getInfo("mode") == "RECAPPROVAL"))) {
                        if (m_sReqMode == "CHARGE") {
                            elmList = $(elmRoot).find("division[divisiontype='receive'] > step");
                        } else if (getInfo("pdef") == "REQUEST_PATTERN" && getInfo("openerDivisionType") == "RECEIVE") {
                            var division_idx = getInfo("CurrentDivisionIdx");
                            division_idx = (division_idx * 1) - 1;
                            elmList = $(elmRoot).find("division[divisiontype='receive']:eq(" + division_idx + ")> step:not(:first)");
                        } else {
                            elmList = $(elmRoot).find("division[divisiontype='receive'] > step[routetype='approve'] > ou > person:has(taskinfo[kind!='charge']),division[divisiontype='receive'] > step[routetype='approve'] > ou > role:has(taskinfo[kind!='charge'])");
                        }
                    } else if (getInfo("mode") == "SUBREDRAFT") {
                        if (m_sReqMode == "CHARGE") {
                            elmList = $(elmRoot).find("division:has(taskinfo[status='pending']) > step > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "'])");
                        } else {
                            elmList = $(elmRoot).find("division:has(taskinfo[status='pending']) > step > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "']) > person:has(taskinfo[kind!='charge']),division:has(taskinfo[status='pending']) > step > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "']) > role:has(taskinfo[kind!='charge']) ");
                        }
                    } else {
                        elmList = $(elmRoot).find("division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > person:has(taskinfo[kind!='charge']),division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > role:has(taskinfo[kind!='charge'])");
                    }

                    if (elmList.length == 0 && admintype != "ADMIN") {
                        if (XFN_IsNullOrEmptyToString(getInfo("scChrRedraft")) != "1" && getInfo("openerDivisionType") == "RECEIVE" && (getInfo("pdef") == "REQUEST_PATTERN" && (getInfo("mode") == "REDRAFT" || getInfo("mode") == "RECAPPROVAL")))
                        {
                            Common.Warning(Common.GetDic("msg_apv_514")); //"결재선이 지정되지 않았습니다."
                            return false;
                        } else if (getInfo("scChrRedraft") == "1" && getInfo("mode") == "REDRAFT") {
                            //if (!confirm(gMessage198)) return false;
                        } else {
                            //TO-DO : 신세계 Customizing 신세계는 재기안이 없기 때문에 수신부서에 담당자만 있어도 승인/반려 가능함
                            //Common.Warning(gMessage29); //"결재선이 지정되지 않았습니다."
                            //return false;
                        }
                    }
                }
                if (getInfo("mode_unit") == "APPROVAL") {
                    if (m_sReqMode == "APPROVE" && getInfo("UseCheckApproveOwner") == "Y" && !CheckApprovalOrder()) {
                        alert(Common.GetDic("msg_CheckApprovalOwner"));
                        return false;
                    }
                }

                if (getInfo("editmode") == "Y") {
                    return checkForm((m_sReqMode == "TEMPSAVE" ? true : false));
                } else {
                    if (getInfo("scCheckApproval") == "1") {
                        return checkForm((m_sReqMode == "TEMPSAVE" ? true : false));
                    }
                    return true;
                }
            }
    }
}

function getDefaultXML() {
    var sXML
    = makeNode("piid", (m_sReqMode == "TEMPSAVE" ? "" : null)) + makeNode("wiid") + makeNode("pdef") + makeNode("pfsk") + makeNode("ptid")
    + (getInfo("pfsk") == "T008" ? makeNode("mode", "REDRAFT") : makeNode("mode")) + makeNode("etid") + makeNode("dpid") + makeNode("usid") + makeNode("informationSecurityAt") + makeNode("sabun") + makeNode("dpid_apv") + makeNode("dpdn_apv", getInfo("dpdn_apv").replace("&", "&amp;")) + makeNode("usdn") + makeNode("dpdsn")
    + makeNode("fmid") + makeNode("fmnm") + makeNode("fmpf") + makeNode("fmbt") + makeNode("fmrv") + makeNode("UseCheckApproveOwner") + makeNode("Form_Deputy_YN") + makeNode("ChkReceiptManagement")
    + makeNode("fiid") + makeNode("ftid") + makeNode("pfid") + makeNode("scid") + makeNode("fmfn") + makeNode("fiid_response") + makeNode("fiid_spare") + makeNode("TEMPLATEMODE", getInfo("templatemode"))
    + makeNode("approvalOrder")
    + makeNode("alramKind", $("#ALRAM_KIND").val())
    //+ makeNode("ppiid", CFN_GetQueryString("parentProcessInstanceId"))
    + makeNode("ppiid", (getInfo("piid_parent") != null && getInfo("piid_parent") != "undefined" && getInfo("piid_parent") != "") ? getInfo("piid_parent") : "")
    + makeNode("farmCode", Common.GetBaseConfig("FarmCode"))
    + getFormInfosXML()
    + getApvList();
    // 수주품의(장용욱) 
    if (getInfo("fmpf") == "GWOK_GENERAL_AES") {
        sXML += getConsultApvList();
    }
    if (getInfo("pfsk") == "T005" || getInfo("pfsk") == "T018") {
    } else {
        sXML = sXML + (m_bFrmExtDirty ? getFormInfoExtXML() : ""); // T005 후결, T018 공람
    }

    if ((getInfo("fmpf").indexOf("GWOK_INVEST") > -1 || getInfo("fmpf").indexOf("GWOK_PINVEST") > -1) && INVEST.INFO.IS_CHAIRMAN) {
        //회장님 정보를 가져온다
        var tbUR = Common.GetObjectInfo('UR', "0000134").Table[0];

        var sXML
        = makeNode("piid", (m_sReqMode == "TEMPSAVE" ? "" : null)) + makeNode("wiid") + makeNode("pdef") + makeNode("pfsk") + makeNode("ptid")
        + (getInfo("pfsk") == "T008" ? makeNode("mode", "REDRAFT") : makeNode("mode"))
        + "<etid>" + tbUR.DN_Code + "</etid>"//tbUR.DN_Code
        + "<dpid>" + tbUR.DeptCode + "</dpid>"//tbUR.DeptCode
        + "<usid>" + tbUR.UR_Code + "</usid>"//tbUR.UR_Code
        + "<sabun>" + tbUR.UR_Code + "</sabun>"//tbUR.UR_Code
        + "<dpid_apv>" + tbUR.DeptCode + "</dpid_apv>"//tbUR.DeptCode
        + "<dpdn_apv>" + tbUR.ExGroupName.replace("&", "&amp;") + "</dpdn_apv>" //tbUR.ExGroupName.replace("&", "&amp;"))
        + "<usdn>" + tbUR.ExDisplayName.replace("&", "&amp;") + "</usdn>"//tbUR.ExDisplayName.replace("&", "&amp;"))
        + "<dpdsn></dpdsn>"
        + makeNode("fmid") + makeNode("fmnm") + makeNode("fmpf") + makeNode("fmbt") + makeNode("fmrv")
        + makeNode("fiid") + makeNode("ftid") + makeNode("pfid") + makeNode("scid") + makeNode("fmfn") + makeNode("fiid_response") + makeNode("fiid_spare") + makeNode("TEMPLATEMODE", getInfo("templatemode"))
        + makeNode("approvalOrder")
        + makeNode("alramKind", $("#ALRAM_KIND").val())
        + makeNode("ppiid", CFN_GetQueryString("parentProcessInstanceId"))
        + getFormInfosXML()
        + getApvList();
        if (getInfo("pfsk") == "T005" || getInfo("pfsk") == "T018") {
        } else {
            sXML = sXML + (m_bFrmExtDirty ? getFormInfoExtXML() : ""); // T005 후결, T018 공람
        }
    }
    return sXML;
}

function setForwardApvList(elmRoot) {//전달일 경우 처리
    try {
        var xmlApv = $.parseXML("<apvlist>" + getInfo("apst") + "</apvlist>");
        if (getInfo("mode") == "APPROVAL" || getInfo("mode") == "PCONSULT" || getInfo("mode") == "RECAPPROVAL" || getInfo("mode") == "SUBAPPROVAL") { //기안부서결재선 및 수신부서 결재선
            var oFirstNode;
            if (admintype == "ADMIN") {
                if (getInfo("mode") == "APPROVAL") {
                    oFirstNode = $(xmlApv).find("apvlist > steps > division > step[routetype='approve'] > ou > person[code='" + getInfo("ptid") + "'] > taskinfo[status='pending'],apvlist > steps > division > step[routetype='approve'] > ou > role:has(person[code='" + getInfo("ptid") + "']) > taskinfo[status='pending']");
                } else if (getInfo("mode") == "PCONSULT") {
                    oFirstNode = $(xmlApv).find("apvlist > steps > division > step:has(taskinfo[status='pending']) > ou > person[code='" + getInfo("ptid") + "'] > taskinfo[status='pending'],apvlist > steps > division > step:has(taskinfo[status='pending']) > ou > role:has(person[code='" + getInfo("ptid") + "']) > taskinfo[status='pending']");
                } else if (getInfo("mode") == "SUBAPPROVAL") {
                    oFirstNode = $(xmlApv).find("apvlist > steps > division > step:has(taskinfo[status='pending']) > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "']) > person[code='" + getInfo("ptid") + "'] > taskinfo[status='pending'],apvlist > steps > division > step:has(taskinfo[status='pending']) > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "']) > role:has(person[code='" + getInfo("ptid") + "']) > taskinfo[status='pending']");
                } else {
                    oFirstNode = $(xmlApv).find("apvlist > steps > division > step[unittype='ou'][routetype='receive'] > ou > person[code='" + getInfo("usid") + "'] > taskinfo[kind!='charge'][status='pending']");
                }
            } else {
                if (getInfo("mode") == "APPROVAL" || getInfo("mode") == "RECAPPROVAL") {
                    oFirstNode = $(xmlApv).find("apvlist > steps > division > step[routetype='approve'] > ou > person[code='" + getInfo("ptid") + "'] > taskinfo[status='pending'],apvlist > steps > division > step[routetype='approve'] > ou > role:has(person[code='" + getInfo("ptid") + "']) > taskinfo[status='pending']");
                } else if (getInfo("mode") == "PCONSULT") {
                    oFirstNode = $(xmlApv).find("apvlist > steps > division > step:has(taskinfo[status='pending']) > ou > person[code='" + getInfo("ptid") + "'][code='" + getInfo("usid") + "'] > taskinfo[status='pending'],apvlist > steps > division > step:has(taskinfo[status='pending']) > ou > role:has(person[code='" + getInfo("ptid") + "'][code='" + getInfo("usid") + "']) > taskinfo[status='pending']");
                } else if (getInfo("mode") == "SUBAPPROVAL") {
                    oFirstNode = $(xmlApv).find("apvlist > steps > division > step:has(taskinfo[status='pending']) > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "']) > person[code='" + getInfo("ptid") + "'][code='" + getInfo("usid") + "'] > taskinfo[status='pending'],apvlist > steps > division > step:has(taskinfo[status='pending']) > ou:has(taskinfo[piid='" + getInfo("piid").toUpperCase() + "']) > role:has(person[code='" + getInfo("ptid") + "'][code='" + getInfo("usid") + "']) > taskinfo[status='pending']");
                } else {
                    oFirstNode = $(xmlApv).find("apvlist > steps > division > step[unittype='ou'][routetype='receive'] > ou > person[code='" + getInfo("usid") + "'] > taskinfo[kind!='charge'][status='pending']");
                }
            }
            if (oFirstNode.length > 0) {
                m_bDeputy = true; m_bApvDirty = true; var elmOU; var elmPerson; var elmInactivePerson;
                switch (getInfo("mode")) {
                    case "APPROVAL":
                    case "PCONSULT":
                        //
                        break;
                    case "SUBAPPROVAL":
                        elmInactivePerson = $(elmOU).find("person:has(taskinfo[status='inactive'])");
                        break;
                    case "RECAPPROVAL":
                        //
                        break;
                }
                elmOU = $(oFirstNode).parent().parent();
                elmPerson = $(oFirstNode);

                var elmTaskInfo = $(elmPerson).find("taskinfo");
                var skind = $(oFirstNode).attr("kind");
                //taskinfo kind 현재 결재자의 kind=conveyance, 다음 결재자는 원결재자의 kind를 받는다.
                $(oFirstNode).attr("status", "completed");
                $(oFirstNode).attr("result", "completed");
                $(oFirstNode).attr("kind", "conveyance");
                $(oFirstNode).attr("datecompleted", getInfo("svdt"));
                if (admintype == "ADMIN") {
                    $(oFirstNode).attr("visible", "n");
                }
                //전달받은 사용자 결재선 생성
                var oStep = xmlApv.createElement("step");
                var oOU = xmlApv.createElement("ou");
                var oPerson = xmlApv.createElement("person");
                var oTaskinfo = xmlApv.createElement("taskinfo");
                if (getInfo("mode") == "RECAPPROVAL" || getInfo("mode") == "SUBAPPROVAL") {
                    if (elmInactivePerson != null) {
                        $(elmOU).insertBefore(oPerson, elmInactivePerson);
                        $(oPerson).append(oTaskinfo);
                    } else {
                        $(elmOU).append(oPerson);
                        $(oPerson).append(oTaskinfo);
                    }
                } else {
                    $(elmOU).append(oPerson);
                    $(oPerson).append(oTaskinfo);
                }
                $(oPerson).attr("code", $(elmRoot).find("item > AN").text());
                $(oPerson).attr("name", $(elmRoot).find("item > DN").text());
                $(oPerson).attr("position", $(elmRoot).find("item").attr("po"));
                $(oPerson).attr("title", $(elmRoot).find("item").attr("tl"));
                $(oPerson).attr("level", $(elmRoot).find("item").attr("lv"));
                $(oPerson).attr("oucode", $(elmRoot).find("item > RG").text());
                $(oPerson).attr("ouname", $(elmRoot).find("item > RGNM").text());
                $(oPerson).attr("sipaddress", $(elmRoot).find("item > SIP").text());
                $(oTaskinfo).attr("status", "pending");
                $(oTaskinfo).attr("result", "pending");
                $(oTaskinfo).attr("kind", skind);
                $(oTaskinfo).attr("datereceived", getInfo("svdt"));
                var oResult = $(xmlApv).find("apvlist > steps");

                document.getElementById("APVLIST").value = CFN_XmlToString(oResult[0]);
            } else { document.getElementById("APVLIST").value = getInfo("apst"); }
        } else { document.getElementById("APVLIST").value = getInfo("apst"); }
    } catch (e) { alert(e.message); }
}

function setApvList() {//대결일 경우 처리
    try {
        var xmlApv = $.parseXML("<apvlist>" + getInfo("apst") + "</apvlist>");

        //TO-DO : 신세계 Customizing 수신부서 결재선도 결재자가 지정하기 때문에 재기안 모드일때도 대결자 셋팅 진행함
        //2016-10-05 BY YJYOO
        //if (getInfo("mode") == "APPROVAL" || getInfo("mode") == "PCONSULT" || getInfo("mode") == "RECAPPROVAL") { //기안부서결재선 및 수신부서 결재선
        if (getInfo("mode") == "APPROVAL" || getInfo("mode") == "PCONSULT" || getInfo("mode") == "RECAPPROVAL" || getInfo("mode") == "REDRAFT") { //기안부서결재선 및 수신부서 결재선
            var oFirstNode; //step에서 taskinfo select로 변경20111126

            if (getInfo("mode") == "APPROVAL" || getInfo("mode") == "RECAPPROVAL") {
                oFirstNode = $(xmlApv).find("apvlist > steps > division > step[routetype='approve'] > ou > person[code='" + getInfo("ptid") + "'][code!='" + getInfo("usid") + "' ] > taskinfo[status='pending'], apvlist > steps > division > step[routetype='approve'] > ou > role:has(person[code='" + getInfo("ptid") + "'][code!='" + getInfo("usid") + "'])");
                if (oFirstNode.length == 0) { // 2015.03.23 편집 후 결재 시 대결 오류로 인하여 소스 추가
                    oFirstNode = $(xmlApv).find("apvlist > steps > division > step[routetype='approve'] > ou > person[code='" + getInfo("usid") + "' ] > taskinfo[status='pending'][kind='substitute']");
                }
            } else if (getInfo("mode") == "PCONSULT") {
                oFirstNode = $(xmlApv).find("apvlist > steps > division > step > ou > person[code='" + getInfo("ptid") + "'][code!='" + getInfo("usid") + "'] > taskinfo[status='pending'], apvlist > steps > division > step > ou > role > taskinfo:has(person[code='" + getInfo("ptid") + "'][code!='" + getInfo("usid") + "'])[status='pending']");
            } else if (getInfo("mode") == "AUDIT") {
                oFirstNode = $(xmlApv).find("apvlist > steps > division > step[routetype='audit'] > ou > person[code='" + getInfo("ptid") + "'][code!='" + getInfo("usid") + "' ] > taskinfo[status='pending'], apvlist > steps > division > step[routetype='audit'] > ou > role:has(person[code='" + getInfo("ptid") + "'][code!='" + getInfo("usid") + "'])");
            } else {
                //oFirstNode = $(xmlApv).find("apvlist > steps > division > step[unittype='ou'][routetype='receive'] > ou > person[code!='" + getInfo("usid") + "'] > taskinfo[@kind!='charge'][status='pending']");
                oFirstNode = $(xmlApv).find("apvlist > steps > division > step[unittype='person'][routetype='receive'] > ou > person[code!='" + getInfo("usid") + "'] > taskinfo[status='pending']");
            }
            if (oFirstNode.length != 0) {
                m_bDeputy = true; m_bApvDirty = true; var elmOU; var elmPerson;
                switch (getInfo("mode")) {
                    case "APPROVAL":
                    case "PCONSULT":
                        elmOU = $(oFirstNode).parent().parent();
                        elmPerson = $(oFirstNode).parent();
                        break;
                    case "REDRAFT":
                    case "RECAPPROVAL":
                        elmOU = $(oFirstNode).parent().parent();
                        elmPerson = $(oFirstNode).parent();
                        break;
                }
                var elmTaskInfo = $(elmPerson).find("taskinfo");
                var skind = $(elmTaskInfo).attr("kind");
                var sallottype = "serial";
                var elmStep = $(elmOU).parent();
                try { if ($(elmStep).attr("allottype") != null) sallottype = $(elmStep).attr("allottype"); } catch (e) { }
                //taskinfo kind에 따라 처리  일반결재 -> 대결, 대결->사용자만 변환, 전결->전결, 기존사용자는 결재안함으로
                switch (skind) {
                    case "substitute": //대결
                        if (getInfo("mode") == "APPROVAL") {
                            $(elmOU).attr("code", getInfo("dpid_apv"));
                            $(elmOU).attr("name", getInfo("dpdn_apv"));
                        }
                        $(elmPerson).attr("code", getInfo("usid"));
                        $(elmPerson).attr("name", getInfo("usdn"));
                        $(elmPerson).attr("position", getInfo("uspc") + ";" + getInfo("uspn"));
                        $(elmPerson).attr("title", getInfo("ustc") + ";" + getInfo("ustn"));
                        $(elmPerson).attr("level", getInfo("uslc") + ";" + getInfo("usln"));
                        $(elmPerson).attr("oucode", getInfo("dpid"));
                        $(elmPerson).attr("ouname", getInfo("dpdn"));
                        $(elmPerson).attr("sipaddress", getInfo("ussip"));
                        $(elmTaskInfo).attr("datereceived", getInfo("svdt"));
                        break;
                    case "authorize"://전결 결재안함
                        $(elmTaskInfo).attr("status", "completed");
                        $(elmTaskInfo).attr("result", "skipped");
                        $(elmTaskInfo).attr("kind", "skip");
                        $(elmTaskInfo).removeAttr("datereceived");
                        break;
                    case "consent": //합의 -> 후열
                    case "charge":  //담당 -> 후열
                    case "consult":
                    case "normal":  //일반결재 -> 후열
                        $(elmTaskInfo).attr("status", "inactive");
                        $(elmTaskInfo).attr("result", "inactive");
                        $(elmTaskInfo).attr("kind", "bypass");
                        $(elmTaskInfo).removeAttr("datereceived");
                        break;
                }
                if (skind == "authorize" || skind == "normal" || skind == "consent" || skind == "charge" || skind == "consult") {
                    var oStep = xmlApv.createElement("step");
                    var oOU = xmlApv.createElement("ou");
                    var oPerson = xmlApv.createElement("person");
                    var oTaskinfo = xmlApv.createElement("taskinfo");
                    if (getInfo("mode") == "APPROVAL" && sallottype == "serial") {
                        $(oPerson).insertBefore(elmPerson);
                        $(oPerson).append(oTaskinfo);
                    } else {//수신부서 person 포함.
                        $(oPerson).insertBefore(elmPerson);
                        $(oPerson).append(oTaskinfo);
                    }
                    $(oPerson).attr("code", getInfo("usid"));
                    $(oPerson).attr("name", getInfo("usdn"));
                    $(oPerson).attr("position", getInfo("uspc") + ";" + getInfo("uspn"));
                    $(oPerson).attr("title", getInfo("ustc") + ";" + getInfo("ustn"));
                    $(oPerson).attr("level", getInfo("uslc") + ";" + getInfo("usln"));
                    $(oPerson).attr("oucode", getInfo("dpid"));
                    $(oPerson).attr("ouname", getInfo("dpdn"));
                    $(oPerson).attr("sipaddress", getInfo("ussip"));

                    $(oTaskinfo).attr("status", "pending");
                    $(oTaskinfo).attr("result", "pending");
                    if (getInfo("mode") == "REDRAFT")
                        $(oTaskinfo).attr("kind", skind);
                    else
                        $(oTaskinfo).attr("kind", (skind == "authorize") ? skind : "substitute");
                    $(oTaskinfo).attr("datereceived", getInfo("svdt"));
                    if (skind == 'charge') {
                        oFirstNode = oStep;
                        var oStep = xmlApv.createElement("step");
                        var oOU = xmlApv.createElement("ou");
                        var oPerson = xmlApv.createElement("person");
                        var oTaskinfo = xmlApv.createElement("taskinfo");
                        $(xmlApv).find("steps > division").insertBefore(oStep, elmStep);
                        $(oStep).append(oOU); $(oOU).append(oPerson); $(oPerson).append(oTaskinfo);
                        $(oStep).attr("unittype", "person");
                        $(oStep).attr("routetype", "approve");
                        $(oStep).attr("name", gLabel__writer);
                        $(oOU).attr("code", getInfo("dpid_apv"));
                        $(oOU).attr("name", getInfo("dpdn_apv"));
                        $(oPerson).attr("code", getInfo("usid"));
                        $(oPerson).attr("name", getInfo("usdn"));
                        $(oPerson).attr("position", getInfo("uspc") + ";" + getInfo("uspn"));
                        $(oPerson).attr("title", getInfo("ustc") + ";" + getInfo("ustn"));
                        $(oPerson).attr("level", getInfo("uslc") + ";" + getInfo("usln"));
                        $(oPerson).attr("oucode", getInfo("dpid"));
                        $(oPerson).attr("ouname", getInfo("dpdn"));
                        $(oPerson).attr("sipaddress", getInfo("ussip"));

                        $(oTaskinfo).attr("status", "complete");
                        $(oTaskinfo).attr("result", "complete");
                        $(oTaskinfo).attr("kind", "charge");
                        $(oTaskinfo).attr("datereceived", getInfo("svdt"));
                        $(oTaskinfo).attr("datecompleted", getInfo("svdt"));
                    }
                }

                var oResult = $(xmlApv).find("apvlist > steps");

                document.getElementById("APVLIST").value = CFN_XmlToString(oResult[0]);
            }
            else {
                document.getElementById("APVLIST").value = getInfo("apst");
            }
        }
        else {
            document.getElementById("APVLIST").value = getInfo("apst");
        }
    }
    catch (e) {
        alert(e.message);
    }
}

function getApvList() {
    var xmlApv = $.parseXML("<apvlist>" + document.getElementById("APVLIST").value + "</apvlist>");
    if (m_sReqMode == "RECREATE" && getInfo("scRec") == "1") {
        var oFirstNode = $(xmlApv).find("apvlist > steps > division:has(taskinfo[status='pending'])[divisiontype='receive'][oucode='" + getInfo("dpid_apv") + "']");
        if (oFirstNode.length == 0) {
            var oDiv = xmlApv.createElement("division");
            var oStep = xmlApv.createElement("step");
            var oOU = xmlApv.createElement("ou");
            var oTaskinfo = xmlApv.createElement("taskinfo");
            $(xmlApv).find("apvlist > steps").append(oDiv);
            $(oDiv).append(oStep);
            $(oStep).append(oOU);
            $(oOU).append(oTaskinfo);
            $(oStep).attr("unittype", "person");//ou
            $(oStep).attr("routetype", "approve"); //receive
            $(oStep).attr("name", gLabel__ChargeDept_Rec);
            $(oOU).attr("code", getInfo("dpid_apv"));
            $(oOU).attr("name", getInfo("dpdn_apv"));
            $(oTaskinfo).attr("status", "pending");
            $(oTaskinfo).attr("result", "pending");
            $(oTaskinfo).attr("kind", "normal");
            $(oTaskinfo).attr("datereceived", getInfo("svdt"));
            oFirstNode = $(xmlApv).find("apvlist > steps > division:has(taskinfo[status='pending'])[divisiontype='receive'][oucode='" + getInfo("dpid_apv") + "'] > step > ou");
        }
        if ($(oFirstNode).find("person[code='" + getInfo("usid") + "'] > taskinfo[kind='charge']") == null) {
            var oPerson = xmlApv.createElement("person");
            var oTaskinfo = xmlApv.createElement("taskinfo");
            $(xmlApv).find("apvlist > steps > division:has(taskinfo[status='pending'][divisiontype='receive'][@oucode='" + getInfo("dpid_apv") + "'] > step > ou)").append(oPerson);
            $(oPerson).append(oTaskinfo);

            $(oPerson).attr("code", getInfo("usid"));
            $(oPerson).attr("name", getInfo("usdn"));
            $(oPerson).attr("position", getInfo("uspc") + ";" + getInfo("uspn"));
            $(oPerson).attr("title", getInfo("ustc") + ";" + getInfo("ustn"));
            $(oPerson).attr("level", getInfo("uslc") + ";" + getInfo("usln"));
            $(oPerson).attr("oucode", getInfo("dpid"));
            $(oPerson).attr("ouname", getInfo("dpdn"));
            $(oPerson).attr("sipaddress", getInfo("ussip"));

            $(oTaskinfo).attr("status", "pending");
            $(oTaskinfo).attr("result", "pending");
            $(oTaskinfo).attr("kind", "charge");
            $(oTaskinfo).attr("datereceived", getInfo("svdt"));
        }

        if (getInfo("pfsk") == "RE") {//공람으로 저장일 경우 다음 결재자 삭제
            var oApprovalNode = $(xmlApv).find("apvlist > steps > division:has(taskinfo[status='pending'])[divisiontype='receive'][oucode='" + getInfo("dpid_apv") + "'] > step:has(> ou > person > taskinfo[kind != 'charge'])");
            if (oApprovalNode.length > 0) {
                oApprovalNode.each(function (i, elm) {
                    $(xmlApv).find("apvlist > steps > division:has(taskinfo[status='pending'])[divisiontype='receive'][oucode='" + getInfo("dpid_apv") + "']")[0].removeChild(elm);
                });
            }
            $(xmlApv).find("apvlist > steps > division:has(taskinfo[status='pending'])[divisiontype='receive'][oucode='" + getInfo("dpid_apv") + "'] > step > ou > person[code='" + getInfo("usid") + "'] > taskinfo[kind='charge']").attr("visible", "n");
        }
    }
    //2006.9.20 김현태 결재선 임시 저장 관련 수정 - 기안자만 있는 경우 넘기지 결재선을 넘기지 않는다.
    if (m_sReqMode == "TEMPSAVE") {
        var oFirstNodeList = $(xmlApv).find("apvlist > steps > division > step > ou > person");
        // 2013.08.08 : yu2mi : 기안자만 있는 경우 초기화  시키는데, 그럴경우 추가된 참조자도 사라짐.*/
        var oCurrentDivNode = $(xmlApv).find("apvlist > steps > division[divisiontype='send']");
        var oChargeNode = $(oCurrentDivNode).find("step:has(ou > person > taskinfo[kind='charge'])");
        if (oChargeNode.length != 0) oCurrentDivNode[0].removeChild(oChargeNode[0]);
        var oCurrentDivTaskinfo = $(oCurrentDivNode).find("taskinfo");
        $(oCurrentDivTaskinfo).attr("status", "inactive");
        $(oCurrentDivTaskinfo).attr("result", "inactive");
        try { $(oCurrentDivTaskinfo).removeAttr("datereceived"); } catch (e) { }
        try { $(oCurrentDivTaskinfo).removeAttr("datecompleted"); } catch (e) { }
        try { $(oCurrentDivTaskinfo).removeAttr("customattribute1"); } catch (e) { }
        try { $(oCurrentDivTaskinfo).removeAttr("wiid"); } catch (e) { }
        try { $(oCurrentDivTaskinfo).removeAttr("mobilegubuns"); } catch (e) { }
        try { $(oCurrentDivNode).find("taskinfo>comment").parent()[0].removeChild($(oCurrentDivNode).find("taskinfo>comment")[0]); } catch (e) { }
        //그외 노드의 경우 status result datereceived
        var oTaskinfos = $(oCurrentDivNode).find("step > ou > person > taskinfo[status='pending']");
        $(oTaskinfos).each(function (i, elm) {
            $(elm).attr("status", "inactive");
            $(elm).attr("result", "inactive");
            $(elm).removeAttr("datereceived");
            $(elm).removeAttr("datecompleted");
            $(elm).removeAttr("wiid");
            $(elm).removeAttr("mobilegubun");
        });
        oTaskinfos = $(oCurrentDivNode).find("step > taskinfo[status='pending']");
        $(oTaskinfos).each(function (i, elm) {
            $(elm).attr("status", "inactive");
            $(elm).attr("result", "inactive");
            $(elm).removeAttr("datereceived");
            $(elm).removeAttr("datecompleted");
        });
        //참조 셋팅 yu2mi: 2013-08-07
        var oCcinfo = $(xmlApv).find("apvlist > steps > ccinfo");
        try {
            $(oCcinfo).each(function (i, elm) {
                $(elm).attr("datereceived", "");
            });
        } catch (e) { }
    }
    return CFN_XmlToString(xmlApv);
}

// 협조처 결재선 가져오기
function getConsultApvList() {
    return "<consult_apvlist>" + getInfo("strConsultJson") + "</consult_apvlist>";
}

/* 결재선 유지 및 초기화 2011.12.07*/
function getApvListReUse() {
    var chk_initiatorChange = false;
    var xmlApv = $.parseXML(getInfo("apst"));
    var elmRoot = $(xmlApv).find("steps");

    $(elmRoot).attr("status", "inactive");

    if ($(elmRoot).attr("datecreated")) { $(elmRoot).removeAttr("datecreated"); }
    if ($(elmRoot).attr("datecompleted")) { $(elmRoot).removeAttr("datecompleted"); }
    if ($(elmRoot).attr("result")) { $(elmRoot).removeAttr("result"); }

    //var elmList = $(elmRoot).find("division:first-child");  //기안부서만(:first-child)
    var elmList = $(elmRoot).find("division[divisiontype='send']");  //기안부서만(:first-child)
    $(elmList).removeAttr("parentapprovalorder");
    $(elmList).removeAttr("approvalgrouporder");
    var oCCinfo = $(elmRoot).find("ccinfo");   //참조

    // [2015-07-25 han add] 지정반려 시 필요없는 결재선 지우기
    //$(elmList).find("step:has(ou > person > taskinfo[rejectee='y'])").remove();

    //division/taskinfo
    var oDivTaskinfo = $(elmList).find("taskinfo");
    $(oDivTaskinfo).attr("status", "inactive");
    $(oDivTaskinfo).attr("result", "inactive");
    $(oDivTaskinfo).attr("datereceived", "");
    if ($(oDivTaskinfo).attr("datecompleted")) { $(oDivTaskinfo).removeAttr("datecompleted"); }

    //$(elmRoot).empty().append($(elmList)[0]); //모두 지우고 기안부서만 남김.
    $(elmRoot).empty().append($(elmList)); //모두 지우고 기안부서만 남김.
    var sendPersonCnt = $(elmRoot).find("division[divisiontype='send'] > step").length;
    //division/step	 
    // TO-DO : 대결자 설정된 결재선 정보는 원결재자 정보로 셋팅한다.
    $(elmRoot).find("division > step").each(function (i, elm) {
        if ($(this).find("ou > person").attr("delegationAt") != null && $(this).find("ou > person").attr("delegationAt") != "" && $(this).find("ou > person").attr("delegationAt") != "I") {
            //var originDN_Code = $(this).find("ou > person").attr("delegationAt").split(/|/g)[0];
            //var originDeptCode = $(this).find("ou > person").attr("delegationAt").split(/|/g)[1];
            //var originUR_Code = $(this).find("ou > person").attr("delegationAt").split(/|/g)[2];
            var originDN_Code = $(this).find("ou > person").attr("delegationAt").split('|')[0];
            var originDeptCode = $(this).find("ou > person").attr("delegationAt").split('|')[1];
            var originUR_Code = $(this).find("ou > person").attr("delegationAt").split('|')[2];


            var oStep = $(this);
            var oOU = $(this).find("ou");
            var oPerson = $(this).find("ou > person");
            var oTaskinfo = $(this).find("ou > person > taskinfo");

            if (originUR_Code != null && originUR_Code != "") {
                var tbUR = Common.GetObjectInfo('UR', originUR_Code).Table[0];
                if (tbUR != null && tbUR != "") {
                    var tbDN = Common.GetObjectInfo('DN', tbUR.DN_Code).Table[0];

                    $(oStep).attr("unittype", "person");

                    $(oOU).attr("code", tbUR.DeptCode);
                    $(oOU).attr("name", tbUR.ExGroupName);
                    $(oOU).attr("companycode", tbUR.DN_Code);
                    $(oOU).attr("companyname", tbDN.ExDisplayName);
                    $(oOU).attr("originidccode", tbDN.FarmCode);

                    $(oPerson).attr("code", tbUR.UR_Code);
                    $(oPerson).attr("name", tbUR.ExDisplayName);
                    $(oPerson).attr("position", tbUR.JobPositionCode);
                    $(oPerson).attr("positionname", tbUR.ExJobPositionName);
                    $(oPerson).attr("title", "");
                    $(oPerson).attr("level", "");
                    $(oPerson).attr("ouname", tbUR.ExGroupName);
                    $(oPerson).attr("oucode", tbUR.DeptCode);
                    $(oPerson).attr("dutycode", tbUR.JobTitleCode);
                    $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
                    $(oPerson).attr("batchAt", '');
                    $(oPerson).attr("delegationAt", '');

                    $(oTaskinfo).attr("status", "inactive");
                    $(oTaskinfo).attr("result", "inactive");
                }
            }
        }
    });

    var oDivStep = $(elmRoot).find("division > step")
    $(oDivStep).each(function (j, elm2) {
        //division/step/ou
        var tmp_stepIdx = j;
        $(elm2).removeAttr("approverat");
        $(elm2).removeAttr("processinstanceid");
        $(elm2).removeAttr("beforeapprovalat");
        var oOU = $(elm2).find("ou");
        //$(oOU).removeAttr("originidccode");
        if (j == 0 && $(oOU).find("person > taskinfo").attr("kind") == "charge") {
            $(oOU).attr("code", getInfo("dpid_apv"));    //겸직처리를 위해 수정
            $(oOU).attr("name", getInfo("dpdn_apv"));    //겸직처리를 위해 수정

            //division
            $(oOU).closest("division").attr("oucode", getInfo("dpid_apv"));
            $(oOU).closest("division").attr("ouname", getInfo("dpdn_apv"));

            //steps
            $(elmRoot).attr("initiatoroucode", getInfo("dpid_apv"));
        }

        //division/step/ou/taskinfo
        var oOUTaskinfo = $(elm2).find("ou > taskinfo");
        if ($(oOUTaskinfo).length != 0) {
            $(oOUTaskinfo).each(function (idx, _oOUTaskinfo) {
                $(_oOUTaskinfo).attr("status", "inactive");
                $(_oOUTaskinfo).attr("result", "inactive");
                $(_oOUTaskinfo).attr("datereceived", "");

                if ($(_oOUTaskinfo).attr("datecompleted")) { $(_oOUTaskinfo).removeAttr("datecompleted"); }
                if ($(_oOUTaskinfo).attr("wiid")) { $(_oOUTaskinfo).removeAttr("wiid"); }

                if ($(_oOUTaskinfo).find("comment")[0]) { $(_oOUTaskinfo).find("comment").remove(); }
            });
        }
        //division/step/person/taskinfo
        var oPersonTaskinfo = $(elm2).find("ou > person > taskinfo");
        if ($(oPersonTaskinfo).length != 0) {

            $(oPersonTaskinfo).each(function (idx, _persontaskinfo) {
                $(_persontaskinfo).attr("status", "inactive");
                $(_persontaskinfo).attr("result", "inactive");
                if ($(_persontaskinfo).attr("kind") == "charge" || tmp_stepIdx == 0)
                    $(_persontaskinfo).attr("datereceived", getInfo("svdt"));
                else
                    $(_persontaskinfo).attr("datereceived", "");


                if ($(_persontaskinfo).attr("datecompleted")) { $(_persontaskinfo).removeAttr("datecompleted"); }
                if ($(_persontaskinfo).attr("wiid")) { $(_persontaskinfo).removeAttr("wiid"); }
                if ($(_persontaskinfo).attr("customattribute1")) { $(_persontaskinfo).removeAttr("customattribute1"); }
                if ($(_persontaskinfo).attr("mobilegubun")) { $(_persontaskinfo).removeAttr("mobilegubun"); }

                if ($(_persontaskinfo).find("comment")[0]) { $(_persontaskinfo).find("comment").remove(); }
                //TO-DO : 발신처 전결일 경우 Taskinfo Kind 변경 필요
                if (sendPersonCnt == 1 || tmp_stepIdx == 0) {
                    $(_persontaskinfo).attr("kind", "charge");
                    $(_persontaskinfo).attr("status", "inactive");
                    $(_persontaskinfo).attr("result", "inactive");
                    if ($(_persontaskinfo).attr("datecompleted")) { $(_persontaskinfo).removeAttr("datecompleted"); }

                }
            });
        }

        //TO-DO : 신세계 Customizing 결재선 담당업무 초기화
        //2016-08-23 BY YJYOO
        //division/step/ou/role
        //var oRoleTaskinfo = $(elm2).find("ou > role > taskinfo");
        //if ($(oRoleTaskinfo).length != 0) {
        //    $(oRoleTaskinfo).attr("status", "inactive");
        //    $(oRoleTaskinfo).attr("result", "inactive");
        //    $(oRoleTaskinfo).attr("datereceived", "");
        //    if ($(oRoleTaskinfo).find("comment")[0]) { $(oRoleTaskinfo).find("comment").remove(); }
        //    if ($(oRoleTaskinfo).attr("datecompleted")) { $(oRoleTaskinfo).removeAttr("datecompleted"); }
        //    if ($(oRoleTaskinfo).attr("customattribute1")) { $(oPersonTaskinfo).removeAttr("customattribute1"); }
        //    if ($(oRoleTaskinfo).parent().find("person").length > 0) { $(oRoleTaskinfo).parent().find("person").remove(); }
        //}

        ////division/step/ou/role/person
        //var oRolePersonTaskinfo = $(elm2).find("ou > role > person> taskinfo");
        //if ($(oRolePersonTaskinfo).length != 0) {
        //    $(oRolePersonTaskinfo).attr("status", "inactive");
        //    $(oRolePersonTaskinfo).attr("result", "inactive");
        //    $(oRolePersonTaskinfo).attr("datereceived", "");
        //    if ($(oRolePersonTaskinfo).find("comment")[0]) { $(oRolePersonTaskinfo).find("comment").remove(); }
        //    if ($(oRolePersonTaskinfo).attr("datecompleted")) { $(oRolePersonTaskinfo).removeAttr("datecompleted"); }
        //    if ($(oRolePersonTaskinfo).attr("customattribute1")) { $(oRolePersonTaskinfo).removeAttr("customattribute1"); }
        //    if ($(oRolePersonTaskinfo).parent().find("person").length > 0) { $(oRolePersonTaskinfo).parent().find("person").remove(); }
        //}
        if ($(elm2).attr("unittype") == "role") {
            var oTaskinfo = xmlApv.createElement("taskinfo");
            $(oTaskinfo).attr("status", "inactive");
            $(oTaskinfo).attr("result", "inactive");
            $(oTaskinfo).attr("kind", "normal");
            $(oTaskinfo).attr("datereceived", "");
            $(oTaskinfo).attr("customattribute1", "");
            $(oTaskinfo).attr("wiid", "");

            if ($(elm2).find("ou > role > person").length > 0) {
                $(elm2).find("ou > role > person").remove();
            }
            else {
                $(elm2).find("ou > role > taskinfo").remove();
            }
            $(elm2).find("ou > role").append(oTaskinfo);
        }

        //2014.01.20 기안자가 겸직변경 했을 경우를 대비해 결재선 재정비

        if (j == 0 && $(oPersonTaskinfo).attr("kind") == "charge") {
            var oPerson = $(oPersonTaskinfo).parent();
            if ($(oPerson).attr("code") != getInfo("usid")) {
                chk_initiatorChange = true;
                if (getInfo("reuse") != "P") { // 템플릿재사용 중 [본문]일 경우(Reuse == "P")는 메세지 표출 안함
                    alert(Common.GetDic("msg_apv_initLine")); // 기안자가 아니므로 결재선을 초기화합니다.
                }
            }

            $(oPerson).attr("code", getInfo("usid"));
            $(oPerson).attr("name", getInfo("usdn"));
            $(oPerson).attr("position", getInfo("uspc"));
            $(oPerson).attr("positionname", getInfo("uspn"));
            $(oPerson).attr("titlename", getInfo("ustn"));
            $(oPerson).attr("title", getInfo("ustc"));
            //$(oPerson).attr("level", getInfo("uslc") + ";" + getInfo("usln"));
            $(oPerson).attr("oucode", getInfo("dpid_apv"));  //겸직처리를 위해 수정
            $(oPerson).attr("ouname", getInfo("dpdn_apv"));  //겸직처리를 위해 수정
            $(oPerson).attr("dutyname", getInfo("ustn"));	// 기안자 초기화시 보직이있는 사용자 표시 위해 수정
            $(oPerson).attr("dutycode", getInfo("ustc"));

            if (getInfo("Form_Deputy_YN") == "Y" && getInfo("usismanager") == "Y" && _UR_IsManager == "False") {
                var tbUR = Common.GetObjectInfo("UR", Common.GetSession("ManagerCode")).Table[0];
                if (tbUR != null && tbUR.ExJobPositionName != null) {
                    $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
                    $(oPerson).attr("dutycode", tbUR.JobTitleCode);
                    $(oPerson).attr("delegationAt", "I");
                } else {
                    $(oPerson).attr("delegationAt", "");
                }
            } else {
                $(oPerson).attr("delegationAt", "");
            }
        }
    });

    // TO-DO : 인사발령품의 와 문화회관시설물은 롤결재자 이후의 결재자를 모두 초기화 한다.
    if (getInfo("fmpf") == "GW_REQUEST_W05" || getInfo("fmpf") == "KWHK_CUL_ADT_W01") {
        //var oDivStep = $(elmRoot).find("division > step")
        var roleApprovalOrder = $(elmRoot).find("division > step[unittype='role']").attr("approvalorder");
        if (roleApprovalOrder != null && roleApprovalOrder != undefined && roleApprovalOrder != "") {
            $(elmRoot).find("division > step").each(function (i, elm) {
                if (getInfo("fmpf") == "GW_REQUEST_W05" && $(elm).attr("unittype") == "role") {
                    $(elm).remove();
                }
                else {
                    if ($(elm).attr("approvalorder") != null && $(elm).attr("approvalorder") != undefined && $(elm).attr("approvalorder") == roleApprovalOrder) {
                        var oTaskinfo = xmlApv.createElement("taskinfo");
                        $(oTaskinfo).attr("status", "inactive");
                        $(oTaskinfo).attr("result", "inactive");
                        $(elm).find("ou > role > person").remove();
                        $(elm).find("ou > role").append(oTaskinfo);
                    }
                    if ($(elm).attr("approvalorder") != null && $(elm).attr("approvalorder") != undefined && parseInt($(elm).attr("approvalorder")) > parseInt(roleApprovalOrder)) {
                        $(elm).remove();
                    }
                }
            });
        }
    }
        // TO-DO :파워텍 재작성시 롤 담당자 이후의 결재자를 모두 초기화 한다.
        // 파워텍이 아니라도 공통으로 사용해야 할 듯.. 단 통합신청서류에 한해서만. KBW 20180423
    else if (getInfo("pdef") == "UNITY_REQST_PATTERN") {
        //var oDivStep = $(elmRoot).find("division > step")
        var roleApprovalOrder = $(elmRoot).find("division > step[unittype='role']").attr("approvalorder");
        if (roleApprovalOrder != null && roleApprovalOrder != undefined && roleApprovalOrder != "") {
            $(elmRoot).find("division > step").each(function (i, elm) {
                if (getInfo("pdef") == "UNITY_REQST_PATTERN" && $(elm).attr("unittype") == "role") {
                    $(elm).remove();
                }
                else {
                    if ($(elm).attr("approvalorder") != null && $(elm).attr("approvalorder") != undefined && $(elm).attr("approvalorder") == roleApprovalOrder) {
                        var oTaskinfo = xmlApv.createElement("taskinfo");
                        $(oTaskinfo).attr("status", "inactive");
                        $(oTaskinfo).attr("result", "inactive");
                        $(elm).find("ou > role > person").remove();
                        $(elm).find("ou > role").append(oTaskinfo);
                    }
                    if ($(elm).attr("approvalorder") != null && $(elm).attr("approvalorder") != undefined && parseInt($(elm).attr("approvalorder")) > parseInt(roleApprovalOrder)) {
                        $(elm).remove();
                    }
                }
            });
        }
    }



    $(oCCinfo).attr("datereceived", "");

    //참조 부서 추가
    //if (getInfo("reuse") == "Y") {
    //    $(elmRoot).append(oCCinfo);
    //}
    //else if (getInfo("reuse") == "C") {
    //    //if (typeof formJson.BODY_CONTEXT != "undefined" && typeof formJson.BODY_CONTEXT.INITIATOR_ID != "undefined" && formJson.BODY_CONTEXT.INITIATOR_ID == getInfo("usid"))
    //    if($($(elmRoot).find("division > step > ou > person")[0]).attr("code") == getInfo("usid"))
    //        $(elmRoot).append(oCCinfo);
    //}
    $(elmRoot).append(oCCinfo);


    //재사용결재선 퇴직자
    //TO-DO : 퇴직자 체크 로직 수정(기안자를 제외한 모든 결재선 초기화) , 기안자가 아닐경우 초기화(복사시)
    //2016-08-24 BY YJYOO 
    if (chkAbsent($(elmRoot).find("division")) == false || chk_initiatorChange) {
        $(elmRoot).find("division[divisiontype='send'] > step > ou > person > taskinfo[kind!='charge']").parent().remove();
        $(elmRoot).find("division[divisiontype='send'] > step").each(function (i, obj) {
            if (i != 0) {
                $(this).remove();
            }
        })
        $(elmRoot).find("division[divisiontype='receive']").remove();
    }
    return CFN_XmlToString($(elmRoot)[0]);
}

function getFormInfosXML() {
    var forminfos = getPIDC();
    return forminfos;
}
function getPIDC() {
    var m_oFormInfos = $.parseXML("<ClientAppInfo><App name='FormInfo'><forminfos><forminfo/></forminfos></App></ClientAppInfo>");
    var currNode = $(m_oFormInfos).find("forminfo")[0];
    $(currNode).attr("prefix", getInfo("fmpf"));
    $(currNode).attr("revision", getInfo("fmrv"));
    $(currNode).attr("instanceid", getInfo("fiid"));
    $(currNode).attr("id", getInfo("fmid"));
    $(currNode).attr("name", getInfo("fmnm"));
    $(currNode).attr("schemaid", getInfo("scid"));
    $(currNode).attr("index", "0");
    $(currNode).attr("filename", getInfo("fmfn"));
    $(currNode).attr("subject", ((document.getElementById("SUBJECT") == undefined) ? getInfo("SUBJECT") : document.getElementById("SUBJECT").value));
    //$(currNode).attr("secure_doc", (document.getElementById("chk_secrecy").checked == true) ? "1" : "0");
    //TO-DO : 신세계 Customizing 기밀문서 여부 의견창으로 옮기면서 checkbox를 hidden으로 변경함
    //2016-07-20 BY YJYOO
    $(currNode).attr("secure_doc", (document.getElementById("chk_secrecy").value == "") ? "0" : document.getElementById("chk_secrecy").value);
    $(currNode).attr("req_response", ((document.getElementById("REQ_RESPONSE") == undefined) ? "" : document.getElementById("REQ_RESPONSE").value));

    //첨부파일 유무 확인
    var sIsFile = "0";
    if (document.getElementById("ATTACH_FILE_INFO").value != "") {
        var oIsFile = $.parseXML(document.getElementById("ATTACH_FILE_INFO").value);
        sIsFile = ($(oIsFile).find("fileinfos > fileinfo > file").length > 0) ? "1" : "0";
    }
    $(currNode).attr("isfile", sIsFile);

    //feedback 추가
    $(currNode).attr("feedback", (document.getElementById("chk_feedback").checked == true) ? "1" : "0");
    $(currNode).attr("selfeedback", document.getElementById("selfeedback").value);

    //첨부파일 확장자
    $(currNode).attr("fileext", XFN_GetFileExt());

    //의견갯수
    var iCommentCount = 0;
    if (document.getElementById("APVLIST").value != "") {
        iCommentCount = $($.parseXML(document.getElementById("APVLIST").value)).find("comment").length;
    }
    $(currNode).attr("comment", iCommentCount);

    //예약발송 배포설정
    if (document.getElementById("reserved") != null && document.getElementById("reserved").style.display == "") {
        $(currNode).attr("reserved", (document.getElementById("chk_reserved").checked == true) ? "1" : "0");
        $(currNode).attr("reserved_gubun", document.getElementById("select_reserved").value);
        $(currNode).attr("reserved_time", document.getElementById("ReservedTime").value + " " + document.getElementById("selThisHour").value + ":" + document.getElementById("selThisMin").value);
    }
    return CFN_XmlToString(m_oFormInfos).replace("<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "").replace("<?xml version=\"1.0\"?>", ""); //(new XMLSerializer()).serializeToString(m_oFormInfos).replace("<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "");
}

function getFormInfoExtXML() {
    var forminfoext = "";
    /* 각 양식으로 내려보낼것 forminfoext = m_oFormEditor.getFormInfoExtXML();*/
    forminfoext = "<forminfoext><forminfo>"
    + makeNode("outerpub", (getInfo("scOPub") == '1' ? "True" : "False"))
    + makeNode("innerpub", (getInfo("scIPub") == '1' ? "True" : "False"))
    + makeNode("innerpost", (getInfo("fmpf") == 'WF_PUBLIC_BOARD' ? "True" : "False"));
    //각 부서함들 저장여부 설정
    forminfoext += makeNode("scABox", getInfo("scABox"))
        + makeNode("scSBox", getInfo("scSBox"))
        + makeNode("scRBox", getInfo("scRBox"))
        + makeNode("scRPBox", getInfo("scRPBox"))
        + makeNode("scCBox", getInfo("scCBox"))
        + makeNode("scCPBox", getInfo("scCPBox"))
        + makeNode("scGARBox", getInfo("scGARBox"))
        + makeNode("scGAPBox", getInfo("scGAPBox"))
        + makeNode("scSAPBox", getInfo("scSAPBox"))
        + makeNode("scSARBox", getInfo("scSARBox"))
        + makeNode("scFAPBox", getInfo("scFAPBox"))
        + makeNode("scJFBox", getInfo("scJFBox"))
        + makeNode("scJFBoxV", getInfo("scJFBoxV"))
        + makeNode("scAutoReview", getInfo("scAutoReview"))
        + makeNode("scAutoLegacy", getInfo("scAutoLegacy"));  //자동연동사용

    // 20181108 박한 프로세스설정 추가 (협조처거부시기각,협조처자동발송,협조요청시선결재)
    forminfoext += makeNode("scCooperDenyReject", (getInfo("scCooperDenyReject")) ? getInfo("scCooperDenyReject") : "")
				+ makeNode("scCooperAutoSend", (getInfo("scCooperAutoSend")) ? getInfo("scCooperAutoSend") : "")
				+ makeNode("scCooperPreApprove", (getInfo("scCooperPreApprove")) ? getInfo("scCooperPreApprove") : "");

    if (getInfo("scOPub") == '1' && getInfo("scOPubV") != "") {
        forminfoext += makeNode("outerpub_doctype", getInfo("scOPubV"));
    }

    var sIsLegacy = "";
    if (getInfo("scAutoLegacy") == "1") {
        sIsLegacy = getInfo("autoIsLegacy");
    }
    else if (getInfo("scLegacy") == "1") {
        sIsLegacy = getInfo("scLegacyV");
    }

    //if (getInfo("scIPub") == '1' || getInfo("scOPub") == '1') {
    //    //forminfoext += makeNode("receiptlist", (getInfo("scOPub") == '1' ? "" : document.getElementById("RECEIPT_LIST").value));
    //} else { forminfoext += makeNode("receiptlist", ""); }

    //대외공문품의서 s
    if (getInfo("fmpf") == "WF_FORM_EXTERNAL") {
        var strRegistratorName = "";
        try {
            if (getInfo("mode") == "TEMPSAVE" || getInfo("mode") == "DRAFT") {
                strRegistratorName = $("#NO").val();
            } else {
                strRegistratorName = $("#NO").html();
            }
            forminfoext += makeNode("RegistratorName", ((strRegistratorName != "") ? strRegistratorName : ''));
        }
        catch (ex) { }
    }
    //2013-03-07 "수신공문품의서" 발신번호,발신처(기안자 입력) e
    forminfoext += makeNode("sealauthority", m_sReqMode == "SIGN" ? (getInfo("dpid_apv") + ';' + getInfo("dpdsn")) : '')
    + makeNode("scEdms", getInfo("scEdms") == '1' ? "True" : "False")
    + makeNode("scEdmsLegacy", getInfo("scEdmsLegacy") == '1' ? "True" : "False") //2006.08추가 by sunny
    + makeNode("docclass", getInfo("scDocClassV"))
    + makeNode("issuedocno", getInfo("scDNum") == '1' ? "True" : "False");
    var sdocinfo = makeNode("outerpubdocno", m_sOPubDocNO) //외부공문번호 넣어줄것
    + makeNode("docno", (document.getElementById("DOC_NO") == undefined) ? '' : document.getElementById("DOC_NO").value)
    + makeNode("recno", (document.getElementById("RECEIVE_NO") == undefined) ? '' : getReceiveNo())
    + makeNode("dpdsn", getInfo("dpdsn"))
    + makeNode("catcode", (document.getElementById("DOC_CLASS_ID") == undefined) ? '' : document.getElementById("DOC_CLASS_ID").value)
    + makeNode("catname", (document.getElementById("DOC_CLASS_NAME") == undefined) ? '' : document.getElementById("DOC_CLASS_NAME").value)
    + makeNode("keepyear", (document.getElementById("SAVE_TERM") == undefined) ? '' : document.getElementById("SAVE_TERM").value)
    + makeNode("fiscalyear", (document.getElementById("APPLIED") == undefined) ? '' : getFiscalYear(document.getElementById("APPLIED").value))
    + makeNode("enforcedate", (document.getElementById("APPLIED") == undefined) ? '' : document.getElementById("APPLIED").value)
    + makeNode("docsec", (document.getElementById("DOC_LEVEL") == undefined) ? '' : document.getElementById("DOC_LEVEL").value)
    + makeNode("ispublic", (document.getElementById("ISPUBLIC") == undefined) ? '' : ((document.getElementById("ISPUBLIC").value == gLabel__open) ? 'Y' : 'N'))
    + makeNode("deptcode", getInfo("dpid")) + makeNode("deptpath", getInfo("dppathdn"))
    //+ "<attach>" + (m_sReqMode == "TEMPSAVE" ? "" : getFormInfoExtAttachXML()) + "</attach>"	//첨부파일path
    + "<attach></attach>" // 첨부파일 물리 경로 필요 없음. k96mi005 - 2017.06.19
    + makeNode("circulation", (getInfo("scOPub") == '1' ? '1' : '1'))
    + makeNode("sentunitname", (document.getElementById("SENT_OU_NAME") == undefined) ? '' : document.getElementById("SENT_OU_NAME").value)
    + makeNode("regcomment", (document.getElementById("REGISTRATION_COMMENT") == undefined) ? '' : document.getElementById("REGISTRATION_COMMENT").value);
    +makeNode("sel_entpart", (document.getElementById("SEL_ENTPART") == undefined) ? '' : document.getElementById("SEL_ENTPART").value);
    forminfoext += "<docinfo>" + sdocinfo + "</docinfo>"
    + makeNode("JFID", getJFID())//담당자처리
    + makeNode("IsChargeConfirm", (getInfo("scChgrConf") == '1' ? 'true' : 'false'))//담당자 확인
    + makeNode("ChargeOU", getChargeOU())
    + makeNode("ChargePerson", getChargePerson())
    + makeNode("rejectedto", (getInfo("scRJTO") == '1' ? 'true' : 'false'))
    + makeNode("MakeReport", (getInfo("scMRPT") == '1' ? getInfo("scMRPTV") : ''))
    + makeNode("WORKREQUEST_ID", (document.getElementById("WORKREQUEST_ID") == undefined) ? '' : document.getElementById("WORKREQUEST_ID").value)
    //+ makeNode("parentfiid", (document.getElementById("REPLY_PARENT_FORM_INST_ID") == undefined) ? "" : document.getElementById("REPLY_PARENT_FORM_INST_ID").value)
    + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : ""))
    + makeNode("entcode", (document.getElementById("ENT_CODE") == undefined) ? getInfo("ENT_CODE") : document.getElementById("ENT_CODE").value)
    + makeNode("entname", (document.getElementById("ENT_NAME") == undefined) ? getInfo("ENT_NAME") : document.getElementById("ENT_NAME").value)
    + makeNode("docnotype", getInfo("scDNumV"))
    + makeNode("ConsultOK", (getInfo("scConsultOK") == "1" ? 'true' : 'false'))
    + makeNode("IsMobile", (getInfo("scMobile") == "1" ? 'true' : 'false'))
    + makeNode("IsSubReturn", (getInfo("scDCooReturn") == "1" ? 'true' : 'false'))
    + makeNode("IsDeputy", (gDeputyType == "T" ? 'true' : 'false'))
    + makeNode("scAutoCmm", getInfo("scAutoCmm"))
    + makeNode("scAutoCmmV", getInfo("scAutoCmmV"))
    + makeNode("IsReUse", getInfo("reuse"))
    + makeNode("scDocBoxRE", getInfo("scDocBoxRE"))
    + makeNode("nCommitteeCount", "2")
    + makeNode("RecDocFolderKind", $("#hidRecDocFolderKind").val())   //SAP양식여부(SAP양식:SAP , 일반양식:GW) (2013-10-14 HIW)
    + makeNode("RecDocFolderID", $("#hidRecDocFolderID").val())   //기록물철 분류폴더ID (2013-10-14 HIW)
    + makeNode("IsReserved", (document.getElementById("chk_reserved").checked == true) ? "True" : "False")  //예약여부
    + makeNode("scASSBox", getInfo("scASSBox")) //개인합의 부서함저장
    + makeNode("scPreDocNum", getInfo("scPreDocNum"))  //문서번호선발번
    + makeNode("docNoAfterYN", (getInfo("chkDocNoAfterYN")) ? getInfo("chkDocNoAfterYN") : "N")  //문서번호 사후 발번여부
    + makeNode("chkApvReceiveYN", (getInfo("chkApvReceiveYN")) ? getInfo("chkApvReceiveYN") : "N")  //수신부서원 접수가능여부
    + makeNode("personSend", (getInfo("selPersonSend")) ? getInfo("selPersonSend") : "N")  //개인 협조사용여부(발신)
    + makeNode("personReceive1", (getInfo("selPersonReceive1")) ? getInfo("selPersonReceive1") : "N")  //개인 협조사용여부(수신1)
    + makeNode("personReceive2", (getInfo("selPersonReceive2")) ? getInfo("selPersonReceive2") : "N")   ///개인 협조사용여부(수신1)
    + makeNode("deferUseYN", (getInfo("chkDeferUseYN")) ? getInfo("chkDeferUseYN") : "N");  // 보류사용여부


    ;
    if (document.getElementById("chk_reserved").checked == true) {
        forminfoext += makeNode("ReservedGubun", document.getElementById("select_reserved").value) //예약발송,배포 구분
        + makeNode("ReservedTime", document.getElementById("ReservedTime").value + " " + document.getElementById("selThisHour").value + ":" + document.getElementById("selThisMin").value);  //예약일자,시간
    }
    +makeNode("scAuthorizer", getInfo("scAuthorizer"))  //전결권사용 _ 최우석 value 값사용시 V 붙여줘야함
    + makeNode("scSaganApproval", (getInfo("chkscSaganApproval") == "Y" ? "1" : "0"))  //사간결재 사용 _ 최우석 value 값사용시 V 붙여줘야함 makeNode("scSaganApproval", getInfo("scSaganApproval"))
    + makeNode("scBojigUse", getInfo("scBojigUse"))  //사간결재 사용 _ 최우석 value 값사용시 V 붙여줘야함 
    + makeNode("company", getInfo("scddlCompanyV"))  //
    + makeNode("scApvLineTypeauto", getInfo("scApvLineTypeautoV"))  //
    forminfoext += "</forminfo></forminfoext>";

    return forminfoext;
}

function getJFID() {
    var _return = "";
    if (getInfo("scChgr") == '1') {
        _return = getInfo("scChgrV");
    } else if (getInfo("scChgrEnt") == '1') {
        if (getInfo("scChgrEntV") != "") {
            var sEtId = (document.getElementById("ENT_CODE") == undefined) ? getInfo("ENT_CODE") : document.getElementById("ENT_CODE").value;
            var oChgrEntV = $.parseXML(getInfo("scChgrEntV"));
            if ($(oChgrEntV).find("E > ENT_" + sEtId).length > 0) {
                _return = $(oChgrEntV).find("E > ENT_" + sEtId).text();
            }
        }
    } else if (getInfo("scChgrReg") == '1') {
        if (getInfo("scChgrRegV") != "") {
            var oChgrRegV = $.parseXML(getInfo("scChgrRegV"));
            if ($(oChgrRegV).find("R > REG_" + getInfo("regionid")).length > 0) {
                _return = $(oChgrRegV).find("R > REG_" + getInfo("regionid")).text();
            }
        }
    }

    return _return;
}
function getChargeOU() {
    var _return = "";
    if (getInfo("scChgrOU") == '1') {
        _return = getInfo("scChgrOUV");
    } else if (getInfo("scChgrOUEnt") == '1') {
        if (getInfo("scChgrOUEntV") != "") {
            var sEtId = (document.getElementById("ENT_CODE") == undefined) ? getInfo("ENT_CODE") : document.getElementById("ENT_CODE").value;
            var oChgrOUEntV = $.parseXML(getInfo("scChgrOUEntV"));
            if ($(oChgrOUEntV).find("E > ENT_" + sEtId + " > items > item").length > 0) {
                $(oChgrOUEntV).find("E > ENT_" + sEtId + " > items > item").each(function (i, element) {
                    if (i > 0) _return += "^";
                    _return += $(element).find("AN").text() + "@" + $(element).find("DN").text();
                });
            }
        }
    } else if (getInfo("scChgrOUReg") == '1') {
        if (getInfo("scChgrOURegV") != "") {
            var oChgrOURegV = $.parseXML(getInfo("scChgrOURegV"));
            if ($(oChgrOURegV).find("R > REG_" + getInfo("regionid") + " > items > item").length > 0) {
                $(oChgrOURegV).find("R > REG_" + getInfo("regionid") + " > items > item").each(function (i, element) {
                    if (i > 0) _return += "^";
                    _return += $(element).find("AN").text() + "@" + $(element).find("DN").text();
                });
            }
        }
    }
    return _return;
}
function getChargePerson() {
    var _return = "";
    if (getInfo("scChgrPerson") == '1') {
        var chargePersonValue = getInfo('scChgrPersonV');
        var retChgrPerson = '';

        if ('' != chargePersonValue) {
            var oChargePerson = $.parseXML(chargePersonValue.substring(chargePersonValue.indexOf('<items>')));

            if ($(oChargePerson).find('items > item').length > 0) {
                $(oChargePerson).find('items > item').each(function (i, element) {
                    if (i > 0) {
                        retChgrPerson += "^";
                    }

                    retChgrPerson += $(element).find('AN').text()
                        + '@' + $(element).find('DN').text()
                        + '@' + $(element).find('GR_Code').text()
                    ;
                });
            }
        }

        _return = retChgrPerson;
    }
    return _return;
}
function getFiscalYear(sApplyDate) {
    var sFiscalYear = "";
    sFiscalYear = sApplyDate.substring(0, 4)
    return sFiscalYear;
}

/*
    evalXML(sXML)
    deleted and remains in formedit.js
    by KJW : 2014.04.22 : XFORM PRJ.
*/
function receiveProcessHTTP(dataresponseXML) {
    var xmlReturn = dataresponseXML;
    var bCompensate = false;
    var sParam = "top.close()";

    try {
        //TO-DO : 현대건설 사특화 통합결재 및 레거시 양식 닫을때 안내메세지 표시여부
        //2020-08-07 BY YJYOO
        if ((getInfo("fmpf").indexOf("FORM_UNIFIED") > -1 || getInfo("fmpf").indexOf("FORM_LGY") > -1) && typeof isShowCloseMessage != "undefined") {
            isShowCloseMessage = false;
        }
    }
    catch (e) {
    }

    if (m_sReqMode == "EDMS") sParam = null;
    var errorNode = $(xmlReturn).find("response > error");
    if (errorNode.length > 0) {
        bCompensate = true;
        sParam = null;

        fnformmenuCallBack($(errorNode).text(), true);
        //if ($(errorNode).text().indexOf("{") > -1 && $(errorNode).text().indexOf("}") > -1) {

        //    // [2015-07-20 han add] 오류나면 로딩 창 닫히도록
        //    fnformmenuCallBack("Desc: " + $(errorNode).text().substring($(errorNode).text().indexOf("{") + 1, $(errorNode).text().indexOf("}")), true);

        //} else {

        //    // [2015-07-20 han add] 오류나면 로딩 창 닫히도록
        //    fnformmenuCallBack("Desc: " + $(errorNode).text(), true);

        //}
        //Common.AlertClose();
        //ToggleLoadingImage();
    } else {
        ToggleLoadingImage();

        switch (m_sReqMode) {
            case "CHARGE":
            case "REDRAFT":
            case "OTRANS":
        	case "APPROVE": // 결재
        	case "PREAPPROVE": // 결재 // 20200610 hpark 예결함에서 선결
            case "DENY": //기각
            case "REJECT": //반송
            case "RETURN_REQUEST": //반송요청
            case "RECREATE":
            case "REQUESTCONSULT": // 협조 요청
            case "REJECTCONSULT": // 협조 거부
            case "COMPLETEREVIEW": // 검토완료
            case "COMPLETECONSULT": // 협조완료
            case "WITHDRAW": // 회수
            case "MANAGER_APPROVAL": //"협조전 협조처 팀장결재"
            case "CHARGE_APPROVAL": //"협조전 협조처 담당자 결재"
            case "PARENT_APPROVAL": //"협조전 협조처 상위결재자 결재"
            case "ASSIGNREVIEW":
            case "STAFF_ASSIGN":
            case "PARENT_REJECT": //상위결재자 반송
            case "MANAGER_REJECT": //상위결재자 반송
            case "REFERENCEDISPLAY": // 공람
            case "CTRL_DEPT_COMPT_EXMNT": // 검토완료
                //fnformmenuCallBack(gMessage170); break;
                fnformmenuCallBack();
                break;
            case "ABORT":
            case "APPROVECANCEL":
            case "FORCEDCONSENT":
            case "CHANGEREVIEW": //2013.07 : 현결재자 변경 후 후결 셋팅
            case "WORKFORM_COMPT"://업무표준-완료
            case "WORKFORM_OLDDOC"://업무표준-구본
            case "WORKFORM_DELDOC"://업무표준-폐기
            case "HOLD": // 보류
                fnformmenuCallBack(Common.GetDic("msg_Processed"));
                break;
            case "SIGN":
                sParam = null; document.getElementById("btSign").style.display = "none";
                break;
            case "DRAFT":
                try {
                    if (wgCEPSBas.CEPD.ID != '') {
                        wgCEPSBas.location = wgCEPSBas.location.toString();
                    }
                }
                catch (e) {
                }
                if (getInfo("mode") == "TEMPSAVE" && getInfo("ustmplistview") != "Y") {//2010.11 개인환경설정이용
                    // 임시저장 정보 삭제를 위하여 FIID와 FIID_SPARE를 변경하여 전달하는 부분을 하기 와 같이 변경
                    // Script 오류로 인하여 fiid 와 fiid_spare가 바뀌지 않았을시 기안된 form Instance가 삭제되는 현상이 발생됨
                    // 임시 저장된 FORM_INSTANCE 삭제 용도의 Attibute 추가
                    // Author : YJYOO
                    // Date : 2016-04-06

                    //var sFiid = getInfo("fiid");
                    //setInfo("fiid", getInfo("fiid_spare"));
                    //setInfo("fiid_spare", sFiid);
                    //var sItem = "<request><item id=\"" + getInfo("ftid") + "\" fitn=\"" + getInfo("fitn") + "\" fiid=\"" + getInfo("fiid") + "\" fmpf=\"" + getInfo("fmpf") + "\"/></request>";
                    var sItem = "<request><item id=\"" + getInfo("ftid") + "\" fitn=\"" + getInfo("fitn") + "\" fiid=\"" + getInfo("fiid") + "\" fiid_spare=\"" + getInfo("fiid_spare") + "\" fmpf=\"" + getInfo("fmpf") + "\" isAuto=\"Y\"/></request>";
                    var sFiid = getInfo("fiid");
                    setInfo("fiid", getInfo("fiid_spare"));
                    setInfo("fiid_spare", sFiid);

                    evalXML(sItem);

                    var sUrl = "/Approval/InstMgr/switchFT2Del.aspx";
                    CFN_CallAjax(sUrl, sItem, function (data) {
                        receiveGeneralQuery(data);
                    }, false, "xml");
                } //fiid switching
                fnformmenuCallBack(gMessage70); break;
                break;
            case "TEMPSAVE":
                if (getInfo("mode") == "TEMPSAVE" || getInfo("mode") == "DRAFT") {
                    if (!m_bTabForm) {
                        //gotoFolder 함수 자체가 주석 처리 됨
                        gotoFolder('../list.aspx?uid=' + getInfo("usid") + '&location=TEMPSAVE', '임시함');
                    }
                }
                //setInfo("mode", "TEMPSAVE");
                setInfo("ftid", $(xmlReturn).find("response > ftid").text());

                //업무표준 예외처리: 완료함에서 개정 적용시 다른 폼은 Reaload 되지만 업무표준은 아무 메세지 없이 작성중 문서로 이동, 2017.10.25 양유빈 
                //if (getInfo("fmpf") == "GOJP_WORKFORM_W01" && getInfo("reuse") == "Y") {
                //미주 - HT 업무표준 추가
                if ((getInfo("fmpf") == "GOJP_WORKFORM_W01" || getInfo("fmpf") == "GOJP_WORKFORM_OVERSEAS") && _g_workform_revision) {
                    _g_workform_revision = false;
                    var url = "/Approval/Forms/Form.aspx?mode=TEMPSAVE&fmid=" + getInfo("fmid") + "&fiid=" + getInfo("fiid") + "&ftid=" + getInfo("ftid") + "&fitn=WF_FORM_INSTANCE";
                    if (g_IS_TabUI == "Y") { url = url + "&IS_TabUI=Y"; }
                    //location.href = "/Approval/Forms/Form.aspx?mode=TEMPSAVE&fmid=" + getInfo("fmid") + "&fiid=" + getInfo("fiid") + "&ftid=" + getInfo("ftid") + "&fitn=WF_FORM_INSTANCE";
                    location.href = url;
                }
                else {
                    //ToggleLoadingImage();
                    if (_g_b_smartDocChange || _g_SmartreportReuse) {
                        if (getInfo("mode") == "DRAFT") {
                            var url = "/Approval/Forms/Form.aspx?mode=TEMPSAVE&fmid=" + getInfo("fmid") + "&fiid=" + getInfo("fiid") + "&ftid=" + getInfo("ftid") + "&fitn=WF_FORM_INSTANCE";
                            if (g_IS_TabUI == "Y") {
                                url = url + "&IS_TabUI=Y";
                            }
                            location.href = url
                        }
                        else {
                            //location.reload();
                            document.location.href = document.location.href;
                        }
                        _g_b_smartDocChange = false;
                        _g_SmartreportReuse = false;
                    } else {

                        //통합결재 편집시 임시저장함에 결재선및 첨부등 저장하고 이동 하기 위해 분기문 처리
                        //[GreatJSK][20200710]
                        if (TempApprovalState) {
                            TempApprovalState = false;
                            //통합결재 편집이동
                            EditIntegratedApproval();
                        } else {
                            Common.Inform(gMessage71, Common.GetDic("lbl_Alram"), function (result) {
                                if (getInfo("mode") == "DRAFT") {
                                    var url = "/Approval/Forms/Form.aspx?mode=TEMPSAVE&fmid=" + getInfo("fmid") + "&fiid=" + getInfo("fiid") + "&ftid=" + getInfo("ftid") + "&fitn=WF_FORM_INSTANCE";
                                    if (g_IS_TabUI == "Y") {
                                        url = url + "&IS_TabUI=Y";
                                    }
                                    location.href = url
                                }
                                else {
                                    //location.reload();

                                    var reload_url = document.location.href.replace("&boxkey=TEMPSAVE", "").replace("&openApv=Y", "");
                                    var hashIndex = reload_url.lastIndexOf('#');
                                    if (hashIndex > -1) {
                                        reload_url = reload_url.substring(0, hashIndex);
                                    }
                                    //document.location.href = document.location.href;
                                    document.location.href = reload_url;
                                }
                            });
                        }
                    }
                }
                break;
            case "EDMS":
                setInfo("fmbd", "<html><head></head><body>" + $(xmlReturn).find("response").text() + "</body></html>");
                break;
            case "ADDTEMPLATE": //2017.04.03 : 사용자 양식 템플릿 추가
                //ToggleLoadingImage();
                alert(Common.GetDic("msg_Processed"));

                document.getElementById("divbtAddTemplate").style.display = "none";
                document.getElementById("divbtRemoveTemplate").style.display = "block";
                break;
            case "REMOVETEMPLATE": //2017.04.03 : 사용자 양식 템플릿 삭제
                //ToggleLoadingImage();
                alert(Common.GetDic("msg_Processed"));
                document.getElementById("divbtAddTemplate").style.display = "block";
                document.getElementById("divbtRemoveTemplate").style.display = "none";
                break;

            case "SPECIALREPORT": // 별도보고
                //ToggleLoadingImage();
                Common.Inform(Common.GetDic("msg_37"), 'Information Dialog', function (result) {
                    var sLINKUrl;
                    //TO-DO : TAB UI 파라미터 전환작업 2017-12-07 BY YJYOO
                    //if (parent.g_strApprovalTabUI_YN == "Y" && parent.g_IS_NewWindow != "Y") {
                    //if (parent.g_IS_TabUI == "Y") {
                    //if (parent.document.location.href.toUpperCase().indexOf("APPROVAL_PORTAL") > -1) {
                    if (g_IS_TabUI == "Y") {
                        var currentTabID = parent.document.getElementById("hidMasterCurrentTab").value;
                        var currentIframe = parent.document.getElementById("ifrTabContent_" + currentTabID).contentWindow;
                        sLINKUrl = currentIframe.location.href;
                        if (sLINKUrl.indexOf('&ReOpen=Y') > -1) {
                            sLINKUrl = sLINKUrl;
                        } else {
                            sLINKUrl = sLINKUrl + "&ReOpen=Y";
                        }
                        currentIframe.location.href = sLINKUrl;
                    }
                    else {
                        sLINKUrl = parent.window.location.href;
                        if (sLINKUrl.indexOf('&ReOpen=Y') > -1) {
                            sLINKUrl = sLINKUrl;
                        } else {
                            sLINKUrl = sLINKUrl + "&ReOpen=Y";
                        }
                        location.href = sLINKUrl;
                    }
                });

                break;
            case "REMOVESPECIALREPORT":
                var sLINKUrl;
                //TO-DO : TAB UI 파라미터 전환작업 2017-12-07 BY YJYOO
                //if (parent.g_strApprovalTabUI_YN == "Y" && parent.g_IS_NewWindow != "Y") {
                //if (parent.g_IS_TabUI == "Y") {
                //if (parent.document.location.href.toUpperCase().indexOf("APPROVAL_PORTAL") > -1) {
                if (g_IS_TabUI == "Y") {
                    var currentTabID = parent.document.getElementById("hidMasterCurrentTab").value;
                    var currentIframe = parent.document.getElementById("ifrTabContent_" + currentTabID).contentWindow;
                    sLINKUrl = currentIframe.location.href;
                    if (sLINKUrl.indexOf('&ReOpen=Y') > -1) {
                        sLINKUrl = sLINKUrl;
                    } else {
                        sLINKUrl = sLINKUrl + "&ReOpen=Y";
                    }
                    currentIframe.location.href = sLINKUrl;
                }
                else {
                    sLINKUrl = parent.window.location.href;
                    if (sLINKUrl.indexOf('&ReOpen=Y') > -1) {
                        sLINKUrl = sLINKUrl;
                    } else {
                        sLINKUrl = sLINKUrl + "&ReOpen=Y";
                    }
                    location.href = sLINKUrl;
                }
                break;
            default:
                fnformmenuCallBack();
                break;
        }
    }
    if (bCompensate) {
        switch (m_sReqMode) {
            case "DRAFT":
                if (getInfo("mode") == "TEMPSAVE") { var sFiid = getInfo("fiid_spare"); setInfo("fiid_spare", getInfo("fiid")); setInfo("fiid", sFiid); }	//fiid switching
                break;
            default: break;
        }
    }

    if (sParam != null) { //다중 문서 open 경우로 수정
        //
    }
}
function fnformmenuCallBack(pmsg, error) {
    disableBtns(false);

    if (pmsg && pmsg.indexOf("FAIL_SAP") > -1) {
        error = false;
    }
    //ToggleLoadingImage();   //함수가 한번 호출되면 로딩이미지가 나오고 한번더 호출되면 이미지가 사라진다.
    if (error == undefined) {
        error = false;
    }

	// 양식 에러발생시 로딩바 제거 , 리스트 리프레시 제거
    if (error) {
    	if (pmsg != null) {
    		Common.Inform(pmsg, Common.GetDic("lbl_Alram"), function (result) {
    			//ToggleLoadingImage();
    			$('#divLoading').hide();
    			$('#loading_overlay').hide();
    		});
    	}
    	else {
    		//ToggleLoadingImage();
    		$('#divLoading').hide();
    		$('#loading_overlay').hide();
    	}
    	return;
    }

    if (pmsg != null) {
        if (openMode == "L" || openMode == "P" || openMode == "B") {
            Common.Inform(pmsg, Common.GetDic("lbl_Alram"), function (result) {
                //TO-DO : TAB UI 파라미터 전환작업 2017-12-07 BY YJYOO
                //if (parent.g_strApprovalTabUI_YN == "Y" && parent.g_IS_NewWindow != "Y") {
                //if (parent.g_IS_TabUI == "Y") {
                //if (parent.document.location.href.toUpperCase().indexOf("APPROVAL_PORTAL") > -1) {
                if (g_IS_TabUI == "Y") {
                    if (typeof (parent.SetTimeoutAPVCNT) == 'function' || typeof (parent.SetTimeoutAPVCNT) == 'object') {
                        setTimeout(function () {
                            parent.SetTimeoutAPVCNT();
                        }, 1000);
                    }

                    parent.XFN_ReLoadHash();
                    var currentTabID = parent.document.getElementById("hidMasterCurrentTab").value;
                    if (!error) {
                        var current_form = parent.$("#divTabContent_" + currentTabID).find("iframe[name='ifrTabContent']")[0].contentWindow;
                        if (typeof current_form.isShowCloseMessage != "undefined") { current_form.isShowCloseMessage = false; }
                        parent.Master_TabClose_OnClick_ByFunction(currentTabID);
                    }
                }
                else {
                    if (openMode == "P") { //포탈에서 띄움(브라우져전체 --> 전자결재포탈로 우선 이동
                        opener.XFN_ReLoadHash();
                    }
                    else if (openMode == "L") {
                        parent.XFN_ReLoadHash();
                    } else if (openMode == "B") {
                        try {
                            if (typeof (opener.SetTimeoutAPVCNT) == 'function' || typeof (opener.SetTimeoutAPVCNT) == 'object') {
                                setTimeout(function () {
                                    opener.SetTimeoutAPVCNT();
                                }, 1000);
                            }

                            if (opener.document.location.href.toUpperCase().indexOf("/WORKVIEW/") > -1) {
                                //if (typeof (opener.go_page) == 'function' || typeof (opener.go_page) == 'object') {
                                //    opener.go_page('c');
                                //}
                                opener.clearContents();
                                opener.queryGetData();
                            }

                            opener.XFN_ReLoadHash();


                            if ((_ie || this.agent.safari) && !error) {
                                window.open('about:blank', '_self').close(); //2014.04.10 : "지금 보고 있는 웹 페이지 창을 닫으려고 합니다" 메시지 삭제
                            }

                            if (!error) {
                                window.close();
                            }
                            //}
                        } catch (e) {
                            window.open('about:blank', '_self').close(); //2014.04.10 : "지금 보고 있는 웹 페이지 창을 닫으려고 합니다" 메시지 삭제
                        }

                    }
                    m_TempSave = false;
                }
            });
        }
    }
    else {
        if (openMode == "L" || openMode == "P" || openMode == "B") {
            //TO-DO : TAB UI 파라미터 전환작업 2017-12-07 BY YJYOO
            //if (parent.g_strApprovalTabUI_YN == "Y" && parent.g_IS_NewWindow != "Y") {
            //if (parent.g_IS_TabUI == "Y") {
            //if (parent.document.location.href.toUpperCase().indexOf("APPROVAL_PORTAL") > -1) {
            if (g_IS_TabUI == "Y") {
                if (typeof (parent.SetTimeoutAPVCNT) == 'function' || typeof (parent.SetTimeoutAPVCNT) == 'object') {
                    if (parent != null) {
                        setTimeout(function () {
                            parent.SetTimeoutAPVCNT();
                        }, 1000);
                    }
                }
                if (parent != null) parent.XFN_ReLoadHash();
                if (parent != null)
                    var currentTabID = parent.document.getElementById("hidMasterCurrentTab").value;
                if (!error) {
                    if (parent != null) {
                        var current_form = parent.$("#divTabContent_" + currentTabID).find("iframe[name='ifrTabContent']")[0].contentWindow;
                        if (typeof current_form.isShowCloseMessage != "undefined") { current_form.isShowCloseMessage = false; }
                        parent.Master_TabClose_OnClick_ByFunction(currentTabID);
                    }
                }
            }
            else {
                if (openMode == "P") { //포탈에서 띄움(브라우져전체 --> 전자결재포탈로 우선 이동
                    opener.XFN_ReLoadHash();
                } else if (openMode == "L") {
                    parent.XFN_ReLoadHash();
                } else if (openMode == "B") {
                    try {
                        if (typeof (opener.SetTimeoutAPVCNT) == 'function' || typeof (opener.SetTimeoutAPVCNT) == 'object') {
                            opener.SetTimeoutAPVCNT();
                        }

                        if (opener.document.location.href.toUpperCase().indexOf("/WORKVIEW/") > -1) {
                            //if (typeof (opener.go_page) == 'function' || typeof (opener.go_page) == 'object') {
                            //    opener.go_page('c');
                            //}
                            opener.clearContents();
                            opener.queryGetData();
                        }

                        opener.XFN_ReLoadHash();
                        if ((_ie || this.agent.safari) && !error) {
                            window.open('about:blank', '_self').close(); //2014.04.10 : "지금 보고 있는 웹 페이지 창을 닫으려고 합니다" 메시지 삭제
                        }

                        if (!error) {
                            window.close();
                        }
                    } catch (e) {
                        if ((_ie || this.agent.safari) && !error) {
                            window.open('about:blank', '_self').close(); //2014.04.10 : "지금 보고 있는 웹 페이지 창을 닫으려고 합니다" 메시지 삭제
                        }
                    }
                }

                m_TempSave = false;
            }
        }
    }
}

/*
    event_noop()
    moved to form.refactor.deleted.js
    by KJW : 2014.04.22 : XFORM PRJ.
*/

var _AutoCmm = false;
function requestProcess(sReqMode) {
    ////debugger;
    m_sReqMode = sReqMode;
    //if (sReqMode != "APPROVE" && sReqMode != "RECREATE") {
    //    if (getInfo("usmsgboxview") == "Y") {
    //        Common.Confirm(gMessage77, "Confirmation Dialog", function (result) {
    //            if (result) {
    //                requestProcessDetail(sReqMode);
    //            } else {
    //                return;
    //            }
    //        });
    //    } else {
    //        requestProcessDetail(sReqMode);
    //    }
    //} else {
    
    //TO-DO : 결재문서 수정내역 관리를 위하여 수정일자 관리적용(전체 그룹사 공통 적용 : 현대엔지니어링-> 수신복수 담당자(MULTIUSER), 그외 그룹사 : 수신담당자(ROLE))
    //2020-09-17 BY YJYOO
    if (sReqMode == "APPROVE" || sReqMode == "DENY") {
        try {
            var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
            var current_user_type = "";
            var current_taskinfo = $(m_oApvList).find("person > taskinfo[status='pending']");
            if (current_taskinfo.length > 0 && $(current_taskinfo[0]).parent().parent()[0].nodeName.toUpperCase() == "ROLE") {
                current_user_type = "ROLE";
            }
            if (current_taskinfo.length > 0 && $(current_taskinfo[0]).parent().parent().parent()[0].nodeName.toUpperCase() == "STEP" && $(current_taskinfo[0]).parent().parent().parent().attr("routetype") == "multi_charge") {
                current_user_type = "MULTI_CHARGE";
            }
            if (current_taskinfo.length > 0 && $(current_taskinfo[0]).parent().parent().parent()[0].nodeName.toUpperCase() == "STEP" && $(current_taskinfo[0]).parent().parent().parent().attr("routetype") == "receive_dept") {
                current_user_type = "RECEIVE_DEPT";
            }
            if (current_user_type != "") {
                var getInfo_LastModifyDateTime = getInfo("LAST_MODIFIED_DATE");
                var if_LastModifyDateTime = "";
                var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/GetDocLastModifiedDate";
                var Param = String.format("{ piid:'{0}' }", (typeof getInfo("piid_parent") != "undefined" && getInfo("piid_parent") != "") ? getInfo("piid_parent") : getInfo("piid"));
                CFN_CallAjaxJson(szURL, Param, false, function (pObjData) {
                    if_LastModifyDateTime = String($.parseJSON(pObjData).d);

                    if (getInfo_LastModifyDateTime != if_LastModifyDateTime) {
                        Common.Warning(Common.GetDic("HDEC_LBL_ITG_EDIT_ERROR"));
                        return;
                    }
                    else {
                        requestProcessDetailPre(sReqMode);
                    }
                });

            }
            else {
                requestProcessDetailPre(sReqMode);
            }
        }
        catch (e) {
            requestProcessDetail(sReqMode);
        }
    }
    else {
        requestProcessDetailPre(sReqMode);
    }
    //}
}

function requestProcessDetailPre(sReqMode) {
    try {
        disableBtns(true);
        ToggleLoadingImage();

        //TO-DO : 현결재자 변경(팀장 -> 접수 담당자)
        //2020-09-29 BY JWLEE
        if (getInfo("ChkReceiptManagement") == "Y") {
            var sAddage = "";
            sAddage += makeNode("type", "CHANGE_APPROVER");
            sAddage += makeNode("approvalOrder", "100");
            sAddage += makeNode("processInstanceId", getInfo("piid"));

            sAddage += makeNode("companyCodeFrom", getInfo("etid"));
            sAddage += makeNode("departmentCodeFrom", getInfo("dpid"));
            sAddage += makeNode("userIdFrom", getInfo("managerid"));

            sAddage += makeNode("languageCode", getInfo("uslng"));
            sAddage += makeNode("companyCode", getInfo("etid"));
            sAddage += makeNode("departmentCode", getInfo("dpid"));
            sAddage += makeNode("userId", getInfo("managerid"));

            var sItemInfo = "";
            sItemInfo += "<JobTitleCode><![CDATA[" + getInfo("ustc") + "]]></JobTitleCode>";
            sItemInfo += "<ExJobTitleName><![CDATA[" + getInfo("ustn") + "]]></ExJobTitleName>";
            sItemInfo += "<JobPositionCode><![CDATA[" + getInfo("uspc") + "]]></JobPositionCode>";
            sItemInfo += "<ExJobPositionName><![CDATA[" + getInfo("uspn") + "]]></ExJobPositionName>";
            sItemInfo += "<UR_Code><![CDATA[" + getInfo("usid") + "]]></UR_Code>";
            sItemInfo += "<ExDisplayName><![CDATA[" + getInfo("usdn") + "]]></ExDisplayName>";
            sItemInfo += "<DeptCode><![CDATA[" + getInfo("dpid") + "]]></DeptCode>";
            sItemInfo += "<GroupName><![CDATA[" + getInfo("dpdn") + "]]></GroupName>";
            sItemInfo += "<DN_Code><![CDATA[" + getInfo("etid") + "]]></DN_Code>";
            sItemInfo += "<DomainName><![CDATA[" + getInfo("etnm") + "]]></DomainName>";
            sItemInfo += "<MSN_SipAddress><![CDATA[" + getInfo("ussip") + "]]></MSN_SipAddress>";

            var changeUser = "<ItemInfo>" + sItemInfo + "</ItemInfo>";
            var strApvLine = xmlToJson2($.parseXML(changeUser));
            sAddage += makeNode("strJsonApprover", JSON.stringify(strApvLine));
            var sText = "<request>" + sAddage + "</request>";

            var szURL = "/Approval/Forms/SubmitBpm.aspx";
            CFN_CallAjax(szURL, sText, function (data) {
                var errorNode = $(data).find("response > error");
                if (errorNode.length > 0) {
                    Common.Warning(Common.GetDic("MSG_CHG_APPROVER_ERROR"));
                    return;
                } else {
                    requestProcessDetail(sReqMode);
                }
            }, true, "xml");
        } else {
            requestProcessDetail(sReqMode);
        }
    } catch (e) {
        //Common.Error(e.message);
    }
}

function requestProcessDetail(sReqMode) {
    try {
        var sTargetURL = "submitForm.aspx";
        var sMsgTitle;
        var sAddage = "";
        var aReqForm = getInfo("fmpf").split("_");
        m_bFileSave = true;

        // XForm 저장연동 (장용욱:20160323)              
        var writelink_count = 0;        // XForm 저장연동 여부
        var extdatatype = "";
        $('*[ext-data-type1="writelink_d_text"]').each(function () {
            writelink_count = writelink_count + 1;
            extdatatype = "writelink_d_text";
        });
        if (writelink_count > 0) {
            fn_writelink(extdatatype);
            //return;
        }
        if ((sReqMode == "DRAFT" || sReqMode == "REQUESTCONSULT")
            && _transferCooperationInfo != "" && _sCONSULT_LIST != "" && BPMBeforeApproval == "N") {
            setInfo("transferCooperationInfo", _transferCooperationInfo);
            $("#CONSULT_LIST").val(_sCONSULT_LIST);
        }
        switch (sReqMode) {
            case "DRAFT": //"기안"
                XFN_FileSave();
                fnFormAttachUpload();
                sMsgTitle = gLabel__draft;

                //3단계류 이면서 고객만족 처리전일때 협조처 정보 바인딩
                if (getInfo("pdef") == "STEP3_PATTERN" && getInfo("fmpf") == "KWEK_CUST_SATIS_W01") {
                    if ($("#ChargerApproval").is(':checked')) {
                        var HasConsult = false;
                        var HasMustSend = true;
                        var transferCooperationInfo = "";
                        var sCONSULT_LIST = "";
                        var arrReturn = EditSendConsultCheck();
                        transferCooperationInfo = arrReturn[3];
                        sCONSULT_LIST = arrReturn[2];
                        setInfo("transferCooperationInfo", transferCooperationInfo);
                        $("#CONSULT_LIST").val(sCONSULT_LIST);
                    }
                }

                sAddage = makeNode("pipo", (document.getElementById("chk_urgent").checked == true) ? "5" : "3")
                    + makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "DRAFT") + getFormXML()
                    + makeNode("transferCooperationInfo")
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("1:1:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM프로세스 실행:연동 실행여부:알람발송 실행)
                if ($('#TDMStyle05').val() != '') { //기안할때 댓글 있을시 추가 
                    sAddage += makeNode("DraftOpinion", setLineFeedDel($('#TDMStyle05').val()));

                    if (sAddage.indexOf("&shy;") > -1) {
                        sAddage = fn_ReplaceAll(sAddage, "&shy;", "");
                    }
                }

                if (getInfo("fmpf") == "WF_KMC_OVER_BIZ_TRIP_MF" && $("#DOC_NO").val() != "") { //기아해외출장품의 문서번호 미리 생성
                    sAddage += makeNode("documentNo", $("#DOC_NO").val());
                }

                m_bFrmExtDirty = true;

                break;
            case "CHANGEAPV": //"결재선변경"
                sMsgTitle = gLabel__changeapprover;
                m_bFileSave = true;
                sTargetURL = "ReassignApvList.aspx";
                sAddage = getChangeFormXML() + makeNode("PIID", getInfo("piid")) + makeNode("admintype", admintype)
                        + makeNode("divisionplace", getInfo("openerDivisionType"))
                        + getEnableProcessStep("0:0:1:0:0"); //(BPM프로세스 실행)
                m_bFrmExtDirty = true;
                break;
                //case "BYPASS": //"결재선변경"
                //    sMsgTitle = gLabel__changeapprover;

                //    m_bFileSave = true;
                //    sTargetURL = "ReassignApvList.aspx";
                //    sAddage = makeNode("PIID", getInfo("piid")) + makeNode("wfid", m_wfid) + makeNode("name", "", null, true);

                //    m_bFrmExtDirty = true;
                //    break;
            case "CHARGE": //"담당자 지정"
                sMsgTitle = gLabel__Charger;
                var szdoclisttype = "2";
                if (getInfo("scChgr") == 1
                    || getInfo("scChgrEnt") == "1"
                    || getInfo("scChgrReg") == "1"
                    || getInfo("scDRec") == 1
                    || getInfo("scChgrOU") == 1
                    || getInfo("scChgrOUEnt") == "1"
                    || getInfo("scChgrOUReg") == "1") { szdoclisttype = "6"; }

                XFN_FileSave();
                fnFormAttachUpload();

                sTargetURL = "reassignWorkItem.aspx";
                sAddage = makeNode("gubun", m_sAddList)
                + makeNode("id", document.getElementById("CHARGEID").value, null, true) + makeNode("name", document.getElementById("CHARGENAME").value) + makeNode("ouid", document.getElementById("CHARGEOUID").value)
                + makeNode("dpid") + makeNode("dpid_apv") + makeNode("dpdsn")
                + makeNode("isissuedocno", 'false') + makeNode("doclisttype", szdoclisttype) + getFormXML() + makeNode("admintype", admintype)
                + makeNode("divisionplace", getInfo("openerDivisionType"))
                + getEnableProcessStep("1:1:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM프로세스 실행:연동 실행여부:알람발송 실행)
                m_bFrmExtDirty = true;
                break;
            case "RECREATE": //"재기안"
                //sMsgTitle = gLabel__redraft;
                //var szdoclisttype = "2";
                //if (getInfo("scChgr") == 1
                //    || getInfo("scChgrEnt") == "1"
                //    || getInfo("scChgrReg") == "1"
                //    || getInfo("scDRec") == 1
                //    || getInfo("scChgrOU") == 1
                //    || getInfo("scChgrOUEnt") == "1"
                //    || getInfo("scChgrOUReg") == "1"
                //    || getInfo("scPRec") == 1) {
                //    szdoclisttype = "6";
                //}

                //XFN_FileSave();

                //if (getInfo("scSign") == "1" && document.getElementById("SIGNIMAGETYPE").value == "") {
                //    document.getElementById("SIGNIMAGETYPE").value = getInfo("usit");
                //}

                //sAddage = makeNode("pipo", (document.getElementById("chk_urgent").checked == true) ? "5" : "3") + makeNode("dpid") + makeNode("dpid_apv") + makeNode("dpdsn") + makeNode("actidx", document.getElementById("ACTIONINDEX").value) + makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true) + makeNode("signimagetype", document.getElementById("SIGNIMAGETYPE").value, null, true)
                //+ makeNode("isissuedocno", getIsIssueDocNo()) + makeNode("doclisttype", szdoclisttype) + makeNode("signimagetype", document.getElementById("SIGNIMAGETYPE").value, null, true) + ((getInfo("REQ_RESPONSE") == "Y") ? getFormXML() : getChangeFormXML()) + makeNode("islast", getIsLast()) //2007.08추가
                //+ makeNode("divisionplace", getInfo("openerDivisionType"))
                //+ getEnableProcessStep("1:1:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM프로세스 실행:연동 실행여부:알람발송 실행)

                //m_bFrmExtDirty = true;
                //if (getInfo("REQ_RESPONSE") == "Y") m_bFrmInfoDirty = true;
                XFN_FileSave();
                fnFormAttachUpload();
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "PARENT_DRAFT") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + makeNode("referenceDisplayInfo", GongRam) + ((getInfo("REQ_RESPONSE") == "Y") ? getFormXML() : getChangeFormXML());
                if (getInfo("pdef") == "COOPERATION_PATTERN") {
                    sAddage += ((getInfo("REQ_RESPONSE") == "Y") ? getEnableProcessStep("1:0:1:1:1") : getEnableProcessStep("0:0:1:1:1")); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                } else {
                    sAddage += ((getInfo("REQ_RESPONSE") == "Y") ? getEnableProcessStep("1:1:1:1:1") : getEnableProcessStep("0:1:1:1:1")); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "MANAGER_ASSIGN":// 4단계 회계팀 검토자 승인 > 팀장한테 다시감.
            case "MANAGER_APPROVAL": //"협조전 협조처 팀장결재"
            case "CHARGE_APPROVAL": //"협조전 협조처 담당자 결재"
            case "PARENT_APPROVAL": //"협조전 협조처 상위결재자 결재"            
        	case "APPROVE": //"결재"
        	case "PREAPPROVE": //"선결재" // 20200610 hpark 예결함에서 선결
            case "CTRL_DEPT_SET_EXMNT": //"총괄부서 검토자지정"

                var tmp_formChangeText = "";
                sMsgTitle = gLabel__app;

                XFN_FileSave();
                fnFormAttachUpload();

                /* 현기차 문서이면서 대외문이 아니고 조직장이 결재 할때 */
                formAttach_DrmCheck(sReqMode);
                /* 현기차 문서이면서 대외문이 아니고 조직장이 결재 할때 */

                tmp_formChangeText = getChangeFormXML();
                // + makeNode("dpid") + makeNode("dpid_apv") + makeNode("dpdsn") + makeNode("usid") + makeNode("usdn")
                sAddage = makeNode("pipo", (document.getElementById("chk_urgent").checked == true) ? "5" : "3") + makeNode("usem") + makeNode("deputy", (m_bDeputy) ? "true" : "false")
                + makeNode("actidx", document.getElementById("ACTIONINDEX").value)
                + makeNode("actcmt", ChangeIncentive(document.getElementById("ACTIONCOMMENT").value), null, true)
                + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                + makeNode("type", sReqMode)
                + makeNode("signimagetype", document.getElementById("SIGNIMAGETYPE").value, null, true)
                + makeNode("isissuedocno", getIsIssueDocNo())
                + makeNode("doclisttype", "1")
                + makeNode("referenceDisplayInfo", GongRam)
                + makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) // 참조처 정보 세팅
                + tmp_formChangeText + makeNode("islast", getIsLast()) //변경내용 부분은 확인필요
                + makeNode("divisionplace", getInfo("openerDivisionType"));


                //일괄겸직 협조완료 처리 작업 진행중
                //setInfo("DocumentInfo_CustomAttribute09", "KRHQ001;12345;H101;TCAD;경영분석팀;BUSINESS ANALYSIS TEAM|");
                if (sReqMode == "MANAGER_APPROVAL" && GongRam == "" && getInfo("DocumentInfo_CustomAttribute09").indexOf("|") > -1) {
                    var bunaleApprovalOuName = "";
                    var aItemList = getInfo("DocumentInfo_CustomAttribute09").split("|");
                    for (var i = 0; i < aItemList.length; i++) {
                        var aItem = aItemList[i].split(";");
                        if (aItem.length > 4 && getInfo("CurrentApprovalParicipant_approverDepartmentCode") != aItem[3])
                            bunaleApprovalOuName += ",[" + aItem[4] + "]";
                    }
                    if (confirm(bunaleApprovalOuName.substring(1) + Common.GetDic("msg_bunaleApproval").replace(/<br>/g, "\r\n"))) sAddage += makeNode("bundleApproval", getInfo("DocumentInfo_CustomAttribute09"));
                }
                if (getInfo("pdef") == "COOPERATION_PATTERN") {
                    var tmp_formChangeXml = $.parseXML("<changeData>" + tmp_formChangeText + "</changeData>");
                    if ($(tmp_formChangeXml).find("formdata")[0].childElementCount > 0) {
                        if (getInfo("piid_parent") == "")
                            sAddage += getEnableProcessStep("1:1:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                        else
                            sAddage += getEnableProcessStep("1:0:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                    } else {
                        if (getInfo("piid_parent") == "")
                            sAddage += getEnableProcessStep("0:1:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                        else
                            sAddage += getEnableProcessStep("0:0:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                    }
                }
                else {
                    sAddage += getEnableProcessStep("1:1:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }

                //BPM Json 용
                //sAddage += makeNode("bpmformdata", getFormXML());
                if (getInfo("pdef") == "STEP3_PATTERN") { // 3단계류 일때만 협조처 정보 생성할수 있도록
                    sAddage += makeNode("transferCooperationInfo")
                }

                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                if (getInfo("mode") == 'APPROVAL' || getInfo("mode") == 'RECAPPROVAL' || getIsIssueDocNo() == "true") m_bFrmExtDirty = true; //결재,수신결재일경우만넘김																				

                m_bFrmExtDirty = true;
                m_bFrmInfoDirty = true;
                //
                m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
                var elmRoot = $(m_evalXML).find("steps");
                var oRecSteps = $(elmRoot).find("division:has(taskinfo[status='pending'])[divisiontype='receive'] > step > ou > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip' ]"); // ) or (@routetype!='review' and  @unittype='ou' and taskinfo/@status='inactive')) or @status='inactive' ]
                var oinaciveRecSteps = $(elmRoot).find("division:has(taskinfo[status='pending'])[divisiontype='receive'] > step[routetype!='review'][unittype='person'] > ou > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='inactive'], division:has(taskinfo[status='pending'])[divisiontype='receive'] > step[routetype!='review'][unittype='ou'] > ou:has(taskinfo[status='inactive']) > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='inactive']");
                if (getInfo("scAutoCmm") == "1" && oRecSteps.length == getInfo("scAutoCmmV") && oinaciveRecSteps.length == 1) {
                    Common.Confirm(gMessage324, "Confirmation Dialog", function (result) {
                        if (result) {
                        } else {
                            _AutoCmm = true;
                        }
                    });
                }

                if (sLastComment != "") {
                    var eml = $(m_evalXML).find("steps > division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > person[code='" + getInfo("usid") + "']  > taskinfo[status='pending']");
                    //결재선에 <comment> 추가 후 의견 저장
                    var oComment = $.parseXML("<root><commentLast><![CDATA[" + sLastComment + "]]></commentLast></root>");
                    var oCommentNode = $(oComment).find("root > commentLast");
                    if (eml.length > 0) {
                        var emlComment = $(eml).find("commentLast");
                        if ($(emlComment).length > 0) {
                            var delemlComment = eml[0].removeChild(emlComment[0]);
                        }
                        $(eml).append($(oCommentNode));
                    }
                    document.getElementById("APVLIST").value = CFN_XmlToString($(m_evalXML)[0]);
                }
                break;
            case "MEET_APPROVE": //"대면결재"
                var tmp_formChangeText = "";
                sMsgTitle = gLabel__app;

                XFN_FileSave();
                fnFormAttachUpload();
                tmp_formChangeText = getChangeFormXML();
                // + makeNode("dpid") + makeNode("dpid_apv") + makeNode("dpdsn") + makeNode("usid") + makeNode("usdn")
                sAddage = makeNode("pipo", (document.getElementById("chk_urgent").checked == true) ? "5" : "3") + makeNode("usem") + makeNode("deputy", (m_bDeputy) ? "true" : "false")
                + makeNode("actidx", document.getElementById("ACTIONINDEX").value)
                + makeNode("actcmt", ChangeIncentive(document.getElementById("ACTIONCOMMENT").value), null, true)
                + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                + makeNode("type", sReqMode)
                + makeNode("signimagetype", document.getElementById("SIGNIMAGETYPE").value, null, true)
                + makeNode("isissuedocno", getIsIssueDocNo())
                + makeNode("doclisttype", "1")
                + makeNode("referenceDisplayInfo", GongRam)
                + makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) // 참조처 정보 세팅
                + tmp_formChangeText + makeNode("islast", getIsLast()) //변경내용 부분은 확인필요
                + makeNode("divisionplace", getInfo("openerDivisionType"));
                sAddage += getEnableProcessStep("1:1:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";

                m_bFrmExtDirty = true;
                m_bFrmInfoDirty = true;

                break;
            case "TEMPSAVE": //"임시함"					
                XFN_FileSave();
                fnFormAttachUpload();
                sMsgTitle = gLabel__composing;
                //if(getInfo("mode")=="REJECT"){} 반려뿐만 아니라 전체 문서 임시저장 가능
                //HT 미주 업무표준으로 인해 if 문 조건 변경
                if (!(getInfo("fmpf") == "GOJP_WORKFORM_W01" || getInfo("fmpf") == "GOJP_WORKFORM_OVERSEAS")) {
                    if (getInfo("mode") != "DRAFT" && getInfo("mode") != "TEMPSAVE") { var sFiid = getInfo("fiid"); setInfo("fiid", getInfo("fiid_spare")); setInfo("fiid_spare", sFiid); }
                }
                sTargetURL = "/Approval/TempSave/SaveForm.aspx";
                sAddage = getFormXML();
                if (m_TempSaveInfo == true) {
                    document.getElementById("SUBJECT").value = "";
                }

                if ($('#TDMStyle05').val() != '') { //기안할때 댓글 있을시 추가 
                    sAddage += makeNode("DraftOpinion", setLineFeedDel($('#TDMStyle05').val()));

                    if(sAddage.indexOf("&shy;") > -1)
                    {
                        sAddage = fn_ReplaceAll(sAddage, "&shy;", "");
                    }
                }
                //HT 미주 업무표준으로 인해 if 문 변경
                if (getInfo("fmpf") == "GOJP_WORKFORM_W01" || getInfo("fmpf") == "GOJP_WORKFORM_OVERSEAS") {
                    sAddage += makeNode("revision_flag", "1");
                }

                m_TempSaveInfo = false;
                m_TempSave = true;
                m_bFrmExtDirty = true;
                break;
            case "WITHDRAW": //"결재문서 회수"
                sMsgTitle = gLabel__Doc_back;
                //sTargetURL = "/Approval/InstMgr/switchPI2Abort.aspx";
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "withdraw") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:1:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "SETPROTECT": //"정보보호 설정"
                sMsgTitle = gLabel__Doc_back;
                //sTargetURL = "/Approval/InstMgr/switchPI2Abort.aspx";
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "setprotect") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:0:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                break;
            case "HOLD": //"보류"
                sMsgTitle = gLabel__Doc_back;
                //sTargetURL = "/Approval/InstMgr/switchPI2Abort.aspx";
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "HOLD") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:0:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                break;
            case "RESETPROTECT": //"정보보호 설정 해제"
                sMsgTitle = gLabel__Doc_back;
                //sTargetURL = "/Approval/InstMgr/switchPI2Abort.aspx";
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "resetprotect") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:0:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                break;
            case "CONSULTWITHDRAW": //"결재문서 협조회수_최우석"
                alert('버튼을 클릭 하였을때 협조된 부서의 진행사항을 받아야합니다. 상태 값에 따라 승인메일을 창을 띄울지, 문서를 취소여부는 공통에서 처리 예정입니다.');
                sMsgTitle = gLabel__Doc_back;
                //sTargetURL = "../InstMgr/ConSultswitchPI2Abort.aspx";
                sAddage = makeNode("actcmt", "", null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "withdraw") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                break;
                //<!--BPM엔진 테스트 용도의 임시 버튼 영역 시작-->
            case "DENY": //"기각"
                sMsgTitle = gLabel__Doc_back;

                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "DENY") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"));

                if (getInfo("loct") == "PROCESS") {
                    setSendConsultCancel();
                    sAddage += getChangeFormXML();
                    sAddage += getEnableProcessStep("1:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                } else {
                    sAddage += getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "CHARGE_REJECT":// 팀장 반송
            case "MANAGER_REJECT":// 팀장 반송
                //sMsgTitle = gLabel__Doc_back;
                //sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                //    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                //    + makeNode("type", "MANAGER_REJECT") +makeNode("IsLegacy",(getInfo("scLegacy") == "1" ? getInfo("scLegacyV"): 'false'))
                //    + makeNode("divisionplace", getInfo("openerDivisionType"))
                //    + getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                //sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                //m_bFrmExtDirty = true;
                //break;
            case "PARENT_REJECT": //상위결재자 반송
            case "RETURN_REQUEST": //담당자 반송요청
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", sReqMode) + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "CANCELRECEIPT": //"접수취소"
            case "CANCELAPPROVE": //"결재취소"
            case "CANCELAPPROVE_RECEIVE": //"결재취소(수신처)"
            case "APPROVAL_CANCEL": //"협조처 결재취소"
            case "CANCELRECEIPT_RESEND": // "완료된 문서 접수취소 후 재송"

                // 협조처 삭제 후 다시 추가 프로세스
                if (sReqMode == "CANCELRECEIPT_RESEND") {
                    $("#CONSULT_LIST").val($("#CONSULT_LIST").val().replace(":Y:", ":N:"));
                    var arrReturn = EditSendConsultCheck();
                    var transferCooperationInfo = arrReturn[3];
                    var modifyCoopInfo = "";

                    var coopArray = transferCooperationInfo.split("|");
                    for (var i = 0; i < coopArray.length; i++) {
                        var coopInfoArray = coopArray[i].split(";");

                        if (coopInfoArray[0] == Common.GetBaseConfig("FarmCode") && coopInfoArray[1] == getInfo("etid") && coopInfoArray[3] == getInfo("dpid")) {
                            modifyCoopInfo = coopArray[i] + "|";
                        }
                    }

                    setInfo("transferCooperationInfo", modifyCoopInfo.replace(";C|", ";D|") + modifyCoopInfo);
                }

                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", sReqMode) + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'));

                if (sReqMode == "CANCELRECEIPT_RESEND") { //완료된 문서 접수취소 후 재송
                    sAddage += makeNode("transferCooperationInfo", getInfo("transferCooperationInfo"))
                            + getFormXML()
                            + makeNode("divisionplace", getInfo("openerDivisionType"))
                            + getEnableProcessStep("1:0:1:0:1") //(양식정보 저장 실행:첨부파일저장:BPM 프로세스 실행:연동 실행:알람발송 실행)
                            + "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                }
                else {
                    sAddage += getChangeFormXML()
                            + makeNode("divisionplace", getInfo("openerDivisionType"))
                            + getEnableProcessStep("1:0:1:1:1") //(양식정보 저장 실행:첨부파일저장:BPM 프로세스 실행:연동 실행:알람발송 실행)
                            + "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                }

                m_bFrmExtDirty = true;
                break;
            case "REQUESTCONSULT": //"협조요청"

                //협조요청 부서가 있고, 결재시 첨부파일을 수정 했을 때 
                XFN_FileSave();
                fnFormAttachUpload();

                /* 현기차 문서이면서 대외문이 아니고 조직장이 결재 할때 */
                formAttach_DrmCheck(sReqMode);
                /* 현기차 문서이면서 대외문이 아니고 조직장이 결재 할때 */

                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "REQUESTCONSULT") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + getChangeFormXML()
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                //+ getEnableProcessStep("1:1:1:0:1"); //(BPM 프로세스 실행:알람발송 실행)
                /// <ModifySpc>
                /// #수정일 : 2019-01-08, #수정내용 : 일반품의서(케피코), 추가예산품의(로템), 국내출장품의(구), 해외출장품의(위아), 오트론 EAI 협조 요청 연동을 위한 FORM_PREFIX 하드코딩, #Task ID : 
                /// </ModifySpc>                //
                if (getInfo("fmpf") == "GWOK_GENERAL_KEFICO" || getInfo("fmpf") == "RWOK_GNRL_BUDGET" || getInfo("fmpf") == "GWOK_BIZ_TRIP_WIA" || getInfo("fmpf") == "GWOK_OVER_BIZ_TRIP_WIA" || getInfo("fmpf") == "GWOK_GENERAL_AUTRON_EAI" ||
                    getInfo("fmpf") == "WF_HDEC_BEGIN_CONSTRUCTION") {
                    sAddage += getEnableProcessStep("1:1:1:1:1"); //(양식정보 저장 실행:첨부파일저장:BPM 프로세스 실행:연동 실행:알람발송 실행)
                }
                else {
                    sAddage += getEnableProcessStep("1:1:1:0:1"); //(양식정보 저장 실행:첨부파일저장:BPM 프로세스 실행:알람발송 실행)
                }
                sAddage += makeNode("transferCooperationInfo")
                sAddage += makeNode("referenceDisplayInfo", getInfo("referenceDisplayInfo"))
                sAddage += makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) // 참조처 정보 세팅
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                if (sAddage.indexOf("<formdata_ext>") > -1) {
                    sAddage += makeNode("isApvChange", "true");
                }
                m_bFrmExtDirty = true;
                break;
            case "RESENDREQUESTCONSULT": //"재송_최우석"
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "REQUESTCONSULT") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:0:1"); //(BPM 프로세스 실행:알람발송 실행)
                sAddage += "<bpmformdata>" + getFormXML() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;

                //case "REQUESTCONSULT": //"협조처 추가" 
                //    sMsgTitle = gLabel__Doc_back;
                //    sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true) + makeNode("type", "REQUESTCONSULT") + makeNode("IsMobile", (getInfo("scMobile") == "1" ? 'true' : 'false')) + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + getInfoBodyContext();
                //    sAddage += "<bpmformdata>" + getFormXML() + "</bpmformdata>";
                //    break;

            case "REJECTCONSULT": //"협조거부"
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", ChangeIncentive(document.getElementById("ACTIONCOMMENT").value), null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "REJECTCONSULT") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                if (IsFormSave() && getInfo("editmode") == "Y") {
                    sAddage += getEnableProcessStep("1:0:1:1:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                } else {
                    sAddage += getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "COMPLETECONSULT": //"협조완료"
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", ChangeIncentive(document.getElementById("ACTIONCOMMENT").value), null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "COMPLETECONSULT") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + getChangeFormXML("COMPLETECONSULT")
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                if (IsFormSave() && getInfo("editmode") == "Y") {
                    sAddage += getEnableProcessStep("1:0:1:1:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                else if (getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01" || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMI" || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W02_KMI"
                      || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMM" || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_HMMR" || getInfo("fmpf") == "WF_KMM_FI_PURCHASE"
                      || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_HAOS" || getInfo("fmpf") == "WF_EB_SUPPLEMENT_HMMC" || getInfo("fmpf") == "WF_EB_RELEASE_HMMC")  // 터키(HAOS) 경상예산품의, 체코(HMMC) 경상예산증액, 체코(HMMC) 경상예산해제 add. beokim. 2020-09-07
                {
                    sAddage += getEnableProcessStep("1:0:1:1:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                else {
                    sAddage += getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                //+ getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
                //case "MANAGER_ASSIGN": // 4단계 회계팀 검토자 승인 > 팀장한테 다시감.
                //    sMsgTitle = gLabel__Doc_back;
                //    sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                //        + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                //        + makeNode("type", sReqMode) + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))  + makeNode("referenceDisplayInfo", GongRam)
                //        + makeNode("divisionplace", getInfo("openerDivisionType"))
                //        + getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                //    sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                //    m_bFrmExtDirty = true;
                //    break;
            case "ASSIGNREVIEW": //"검토자지정_최우석"
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", ChangeIncentive(document.getElementById("ACTIONCOMMENT").value), null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", sReqMode) + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + getChangeFormXML("ASSIGNREVIEW")
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                //+ getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                if (IsFormSave() && getInfo("editmode") == "Y") {
                    sAddage += getEnableProcessStep("1:0:1:1:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                else if (getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01" || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMI" || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W02_KMI"
                      || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMM" || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_HMMR" || getInfo("fmpf") == "WF_KMM_FI_PURCHASE"
                      || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_HAOS" || getInfo("fmpf") == "WF_EB_SUPPLEMENT_HMMC" || getInfo("fmpf") == "WF_EB_RELEASE_HMMC")  // 터키(HAOS) 경상예산품의, 체코(HMMC) 경상예산증액, 체코(HMMC) 경상예산해제 add. beokim. 2020-09-07
                {
                    sAddage += getEnableProcessStep("1:0:1:1:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                else {
                    sAddage += getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                sAddage += makeNode("strConsultJson");
                //sAddage += makeNode("strConsultREVIEW", $("#hidConsultList").val())
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "STAFF_ASSIGN"://담당자지정(공람자포함)
                //sTargetURL = "SubmitBpm.aspx";
                if (getInfo("pdef") == "STEP4_PATTERN" && (getInfo("fmpf") == "GWOK_REMITTANCE" || getInfo("fmpf") == "HKMC_GWOK_REMITTANCE")) {
                    XFN_FileSave();
                    fnFormAttachUpload();
                }
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", UserComment, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "STAFF_ASSIGN") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + makeNode("referenceDisplayInfo", GongRam)
                    + makeNode("divisionplace", getInfo("openerDivisionType"));
                if (getInfo("fmpf") == "KWEK_CUST_SATIS_W01")
                    sAddage += makeNode("actcmtAdd", document.getElementById("ACTIONCOMMENT").value, null, true)
                if ((getInfo("pdef") == "STEP3_PATTERN" && getInfo("fmpf") == "KWEK_CUST_SATIS_W01") || getInfo("pdef") == "STEP4_PATTERN" && (getInfo("fmpf") == "GWOK_REMITTANCE" || getInfo("fmpf") == "HKMC_GWOK_REMITTANCE")) {
                    sAddage += getChangeFormXML()
                    sAddage += getEnableProcessStep("1:0:1:1:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                else {
                    sAddage += getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }

                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "REFERENCEDISPLAY": //"공람자최우석"
                //sTargetURL = "SubmitBpm.aspx";
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", UserComment, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "REFERENCEDISPLAY") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + makeNode("referenceDisplayInfo", GongRam)
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:0:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "CANCELREVIEW": //"검토자검토취소"
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "CANCELREVIEW") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "COMPLETEREVIEW": //"검토자검토완료"
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", ChangeIncentive(document.getElementById("ACTIONCOMMENT").value), null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "COMPLETEREVIEW") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + getChangeFormXML("COMPLETEREVIEW")
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                if (IsFormSave() && getInfo("editmode") == "Y") {
                    sAddage += getEnableProcessStep("1:0:1:1:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                else if (getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01" || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMI" || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W02_KMI"
                      || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMM" || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_HMMR"
                      || getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_HAOS" || getInfo("fmpf") == "WF_EB_SUPPLEMENT_HMMC" || getInfo("fmpf") == "WF_EB_RELEASE_HMMC")  // 터키(HAOS) 경상예산품의, 체코(HMMC) 경상예산증액, 체코(HMMC) 경상예산해제 add. beokim. 2020-09-07
                {
                    sAddage += getEnableProcessStep("1:0:1:1:1"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                    //sAddage += getEnableProcessStep("1:0:0:0:0"); //(양식정보 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                else {
                    sAddage += getEnableProcessStep("0:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                }
                //+ getEnableProcessStep("1:0:1:1:1"); //(BPM 프로세스 실행:연동 실행여부:알람발송 실행)
                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "CTRL_DEPT_COMPT_EXMNT": //"총괄부서 검토자 검토완료"
                var tmp_formChangeText = "";
                sMsgTitle = gLabel__app;
                tmp_formChangeText = getChangeFormXML();
                sAddage = makeNode("pipo", (document.getElementById("chk_urgent").checked == true) ? "5" : "3") + makeNode("usem") + makeNode("deputy", (m_bDeputy) ? "true" : "false")
                + makeNode("actidx", document.getElementById("ACTIONINDEX").value)
                + makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                + makeNode("type", sReqMode)
                + makeNode("signimagetype", document.getElementById("SIGNIMAGETYPE").value, null, true)
                + makeNode("isissuedocno", getIsIssueDocNo())
                + makeNode("doclisttype", "1")
                + makeNode("referenceDisplayInfo", GongRam)
                + makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) // 참조처 정보 세팅
                + tmp_formChangeText + makeNode("islast", getIsLast()) //변경내용 부분은 확인필요
                + makeNode("divisionplace", getInfo("openerDivisionType"));

                sAddage += getEnableProcessStep("1:1:1:1:1"); //(양식정보 저장 실행:첨부파일 저장 실행:BPM 프로세스 실행:연동 실행여부:알람발송 실행)

                sAddage += "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata>";
                if (getInfo("mode") == 'APPROVAL' || getInfo("mode") == 'RECAPPROVAL' || getIsIssueDocNo() == "true") m_bFrmExtDirty = true; //결재,수신결재일경우만넘김																				

                m_bFrmExtDirty = true;
                m_bFrmInfoDirty = true;
                //
                m_evalXML = $.parseXML(document.getElementById("APVLIST").value);

                if (sLastComment != "") {
                    var eml = $(m_evalXML).find("steps > division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > person[code='" + getInfo("usid") + "']  > taskinfo[status='pending']");
                    //결재선에 <comment> 추가 후 의견 저장
                    var oComment = $.parseXML("<root><commentLast><![CDATA[" + sLastComment + "]]></commentLast></root>");
                    var oCommentNode = $(oComment).find("root > commentLast");
                    if (eml.length > 0) {
                        var emlComment = $(eml).find("commentLast");
                        if ($(emlComment).length > 0) {
                            var delemlComment = eml[0].removeChild(emlComment[0]);
                        }
                        $(eml).append($(oCommentNode));
                    }
                    document.getElementById("APVLIST").value = CFN_XmlToString($(m_evalXML)[0]);
                }
                break;
            case "SPECIALREPORT": //"별도보고"
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "SPECIALREPORT") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + makeNode("spapprovaluser", document.getElementById("APPROVALPARTICIPANTLIST").value, null, false)
                    + makeNode("spapprovalinfo", document.getElementById("APPROVALINFO").value, null, false)
                    + getEnableProcessStep("0:0:1:0:1"); //(BPM 프로세스 실행:알람발송 실행)

                if (document.getElementById("PARENTPROCESSINSTANCEID").value != "") {
                    sAddage += makeNode("sparentpiid", document.getElementById("PARENTPROCESSINSTANCEID").value, null, false);
                }

                sAddage += "<bpmformdata>" + getFormXML() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            case "REMOVESPECIALREPORT": //"별도보고삭제_최우석"
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "REMOVESPECIALREPORT") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("spapprovaluser", document.getElementById("APPROVALPARTICIPANTLIST").value, null, false)
                    + makeNode("spapprovalinfo", document.getElementById("APPROVALINFO").value, null, false)
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + getEnableProcessStep("0:0:1:0:1"); //(BPM 프로세스 실행:알람발송 실행)
                sAddage += "<bpmformdata>" + getFormXML() + "</bpmformdata>";
                if (document.getElementById("PARENTPROCESSINSTANCEID").value != "") {
                    sAddage += makeNode("sparentpiid", document.getElementById("PARENTPROCESSINSTANCEID").value, null, false);
                }
                m_bFrmExtDirty = true;
                break;
                //<!--BPM엔진 테스트 용도의 임시 버튼 영역 종료-->
            case "ABORT": //"결재문서 취소"
                sMsgTitle = gLabel__Doc_cancel;
                sTargetURL = "/Approval/InstMgr/switchPI2Abort.aspx";
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "abort") + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'));
                sAddage += "<bpmformdata>" + getFormXML() + "</bpmformdata>";
                break;
            case "APPROVECANCEL": //"승인 취소"
                sMsgTitle = gLabel__Approve_cancel;
                sTargetURL = "/Approval/InstMgr/switchWI2Cancel.aspx";
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false);
                sAddage += "<bpmformdata>" + getFormXML() + "</bpmformdata>";
                break;
            case "MONITOR": //"결재문서 확인"
                sMsgTitle = gLabel__Doc_OK;
                sTargetURL = "/Approval/InstMgr/switchMonitorOK.aspx";
                break;
            case "DELETEDOC":   //결재문서삭제
                sMsgTitle = "결재문서 삭제";
                m_bFileSave = true; sTargetURL = "/Approval/InstMgr/switchFT2Del.aspx";
                if (getInfo("mode") == "TEMPSAVE") {//회수문서 삭제
                    sAddage = makeNode("item", getInfo("ftid"))
                    + makeNode("fitn", getInfo("fitn"))
                    + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("deltype", "WITHDRAW")
                    + getInfoBodyContext();
                } else if (getInfo("mode") == "COMPLETE" && getInfo("loct") == "REJECT") {
                    sAddage = makeNode("item", getInfo("piid"))
                    + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false'))
                    + makeNode("deltype", "REJECT")
                    + getInfoBodyContext();
                }
                else {
                    sAddage = makeNode("usid")
                    + makeNode("DOC_NO", (document.getElementById("DOC_NO") == undefined) ? "" : document.getElementById("DOC_NO").value)
                    + makeNode("OfficialDocNo", getInfo("scOfficialDocNo"));
                }
                break;
            case "FORCEDCONSENT": //강제합의
                sMsgTitle = "결재문서 삭제";
                m_bFileSave = true; sTargetURL = "/Approval/InstMgr/ForcedConsent.aspx";
                sAddage = makeNode("usid");
                sAddage = makeNode("PARENT_PROCESS_ID", getInfo("piid2"));
                break;
            case "CHANGEREVIEW": //2013.07 : 현결재자 변경 후 후결 셋팅
                m_sReqMode = "CHANGEREVIEW"
                sMsgTitle = "";
                sAddage = makeNode("ChangeReviewXml", document.getElementById("CHANGEREVIEWXML").value, null, false);
                sAddage += makeNode("ChangeReview", m_bTempFlag, null, false);
                sTargetURL = "/Approval/InstMgr/switchWI2ReassignNReview.aspx";
                break;
            case "ADDTEMPLATE": //2017.04.03 : 사용자 양식 템플릿 추가
                sMsgTitle = "템플릿 추가";
                sAddage += makeNode("type", "ADDTEMPLATE")
                sAddage += makeNode("FORM_INST_ID", getInfo("FORM_INST_ID"));
                sAddage += makeNode("CRUD_TYPE", "INSERT");
                //sAddage += makeNode("usid", getInfo("usid"));
                sTargetURL = "/Approval/InstMgr/InstTemplateMgr.aspx";
                break;
            case "REMOVETEMPLATE"://2017.04.03 : 사용자 양식 템플릿 삭제
                sMsgTitle = "템플릿 삭제";
                sAddage += makeNode("type", "REMOVETEMPLATE")
                sAddage += makeNode("FORM_INST_ID", getInfo("FORM_INST_ID"));
                sAddage += makeNode("CRUD_TYPE", "DELETE");
                //sAddage += makeNode("usid", getInfo("usid"));
                sTargetURL = "/Approval/InstMgr/InstTemplateMgr.aspx";
                break;
            case "WORKFORM_COMPT": //업무표준--완료
                sMsgTitle = "템플릿 추가";
                sAddage += makeNode("type", "WORKFORM_COMPT")
                sAddage += makeNode("FORM_INST_ID", getInfo("FORM_INST_ID"));
                sTargetURL = "/Approval/InstMgr/workFormMgr.aspx";
                break;
            case "WORKFORM_OLDDOC"://업무표준--구본
                sMsgTitle = "템플릿 삭제";
                sAddage += makeNode("type", "WORKFORM_OLDDOC")
                sAddage += makeNode("FORM_INST_ID", getInfo("FORM_INST_ID"));
                sTargetURL = "/Approval/InstMgr/workFormMgr.aspx";
                break;
            case "WORKFORM_DELDOC"://업무표준--폐기
                sMsgTitle = "템플릿 삭제";
                sAddage += makeNode("type", "WORKFORM_DELDOC")
                sAddage += makeNode("FORM_INST_ID", getInfo("FORM_INST_ID"));
                sTargetURL = "/Approval/InstMgr/workFormMgr.aspx";
                break;
            case "POST_APPROVAL": //"후결 결재처리"
                sMsgTitle = gLabel__Doc_back;
                sAddage = makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
                    + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
                    + makeNode("type", "POST_APPROVAL") + makeNode("IsLegacy", 'false')
                    + makeNode("divisionplace", getInfo("openerDivisionType"))
                    + makeNode("spapprovaluser", document.getElementById("APPROVALPARTICIPANTLIST").value, null, false)
                    + makeNode("spapprovalinfo", document.getElementById("APPROVALINFO").value, null, false)
                    + getEnableProcessStep("0:0:1:0:0"); //(BPM 프로세스 실행:알람발송 실행)

                if (document.getElementById("PARENTPROCESSINSTANCEID").value != "") {
                    sAddage += makeNode("sparentpiid", document.getElementById("PARENTPROCESSINSTANCEID").value, null, false);
                }

                sAddage += "<bpmformdata>" + getFormXML() + "</bpmformdata>";
                m_bFrmExtDirty = true;
                break;
            default:
                alert("[" + sReqMode + "]" + gMessage72); //는 지정되지 않은 모드입니다.
                return;
        }

        try {
            if (m_bFileSave == true) {
                if (getInfo("mode") == "PREDRAFT") { setInfo("mode", "DRAFT"); }
                if (sReqMode == "DRAFT" && getInfo("mode") == "TEMPSAVE") {
                    var sFiid = getInfo("fiid");
                    setInfo("fiid", getInfo("fiid_spare"));
                    setInfo("fiid_spare", sFiid);

                    /* 공시여부 fiid 업데이트
                    fiid가 변경이 되기 때문에 기존에 등록된 fiid를 변경해야 됨
                    */
                    if (getInfo("chkPulicObjectYN") == "Y") {
                        var sURL = "/Approval/Controls/ApprovalWebservice.asmx";
                        var oResult = CFN_CallAjaxJson(sURL + "/GetPublicObjectUpdate", "{fiid:'" + getInfo("fiid_spare") + "', fiid_new:'" + getInfo("fiid") + "'}", false, null);
                    }
                    /* 공시여부 fiid 업데이트 */

                    //sAddage += makeNode("fiid_spare", getInfo("fiid_spare"));
                }	//fiid switching

                //var defaultXML = getDefaultXML();
                //if (_AutoCmm) {
                //    defaultXML = defaultXML.replace("<scAutoCmm>1", "<scAutoCmm>0");
                //}
                //var sText = XFN_ChangeInputValue("<request>" + getDefaultXML() + sAddage + "</request>");
                var sText = "<request>" + getDefaultXML() + sAddage + "</request>";

                try {
                    CFN_CallAjax(sTargetURL, sText, function (data) {
                        receiveProcessHTTP(data);
                    }, true, "xml");
                } catch (e) {
                    //Common.Error(e.message);
                }
            } else {
                disableBtns(false);
                Common.Error(gMessage203); //"첨부파일이 정상적으로 처리되지 않았습니다."
            }
        } catch (e) {
            disableBtns(false);
            Common.Error(gMessage73 + "\n" + e.description + "\nError number: " + e.number); //"저장하지 못했습니다."
        }
    } catch (e) { Common.Error(e.description + "\nError number: " + e.number); }
}

/*-------------------------------------------------------
 메뉴 버튼 이벤트 분기 처리 함수 : KJW : 2014.04.23 : XFORM PRJ.
---------------------------------------------------------*/

//메뉴 이벤트 분기 처리 오브젝트 : KJW : 2014.04.23 : XFORM PRJ.
var doButtonCase = {};

//메뉴 이벤트 공통 처리 오브젝트 : KJW : 2014.04.23 : XFORM PRJ.
var doButtonDefault = {
    sUrl: "",
    iWidth: "640",
    iHeight: "800",
    sSize: "fix",
    formNm: "", //not used
    m_evalXML: "",
    elmlength: 0, //not used
    commentCount: 0, //not used
    elmComment: "",
    df_btnType: "", // 20171127 hpark 결재의견 명칭정리
    IS_Tab: "",
    preProcess: function () {
        this.formNm = getInfo("fmpf")
        var filename = getInfo("htmlfilename");
        if (typeof filename === 'undefined' || filename == '') return;

        if (getInfo("templatemode") == "Read") {

            var m_evalXML, elmlength, commentCount, elmComment;

            //[2014-12-24 modi]
            if ('' != document.getElementById("APVLIST").value) {
                m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
                elmlength = $(m_evalXML).find("steps > division > step").length;

                for (k = 0; k < elmlength; k++) {
                    commentCount = 0;
                    elmComment = $(m_evalXML).find("steps > division > step > ou > person > taskinfo > comment");
                    if (elmComment != null) { ++commentCount; }
                }

                this.m_evalXML = m_evalXML;
                this.elmlength = elmlength;
                this.commentCount = commentCount;
                this.elmComment = elmComment;
            }
        }
    }

}

var printDiv;
//메뉴 이벤트 처리 Main function : KJW : 2014.04.23 : XFORM PRJ.
//[2016-02-29 add kh] 의견창 타이틀
var commentPopupTitle = '';

//var visiblePopup_CallCount = 0;
////리사이징후 보이기
//function visiblePopup() {

//    //떠있는경우 return;
//    if (parent.$(".layer_divpop").css("visibility") == "visible") {
//        return;
//    }

//    if (parent.$(".bgiframe").contents().find(".l-popup__functions").position() == undefined) {

//        //{{ 1회만 리콜(타이머 시간이 짧아서 안 뜨는 경우가 있어 다시 10회 호출) - 빌드가 된경우, 속도가 무지하게 느린경우를 감안
//        if (visiblePopup_CallCount > 10) {
//            return;
//        }

//        setTimeout(function () { visiblePopup() }, 800);
//        visiblePopup_CallCount++;
//        return;
//        //}}
//    }

//    ///높이계산
//    parent.$(".divpop_contents").height(parent.$(".bgiframe").contents().find(".l-popup__functions").position().top + 120);
//    ////center 로 위치
//    parent.$(".divpop_contents").offset({ top: (screen.height - (parent.$(".divpop_contents").height() + 120)) / 2, left: (screen.width - parent.$(".divpop_contents").width()) / 2 });
//    //팝업 보이기
//    parent.$(".layer_divpop").css("visibility", "visible");

//    //parent.Common.AlertClose();
//}
function doButtonAction(obj) {
    //debugger;

    //통합결재인터페이스 본문편집 수정이력 확인
    if (typeof formJson.BODY_CONTEXT != "undefined") {
        if (typeof formJson.BODY_CONTEXT.LGY_SYSTEM_ID != "undefined" && typeof formJson.BODY_CONTEXT.RECEIPT_EDIT_DEPTH != "undefined" && typeof formJson.BODY_CONTEXT.RECEIPT_EDIT_MODE != "undefined") {
            if (obj.id == "btApproved" && formJson.BODY_CONTEXT.LGY_SYSTEM_ID == "IWF" && (getInfo("etid") == "H147" || getInfo("etid") == "H139" || getInfo("etid") == "H150" || getInfo("etid") == "H151" || getInfo("etid") == "H152" || getInfo("etid") == "H153")) {
                var ReceiptEditDepth = formJson.BODY_CONTEXT.RECEIPT_EDIT_DEPTH;
                var ReceiptEditMode = formJson.BODY_CONTEXT.RECEIPT_EDIT_MODE;
                var ApprovalPhase = getApprovalPhase();

                if (ReceiptEditDepth == "A" || ReceiptEditDepth == ApprovalPhase) {
                    if (ApprovalPhase != ReceiptEditMode) {
                        Common.Warning(Common.GetDic("HDEC_MSG_DOC_MODIFY_CHECK"));
                        return;
                    }
                }
            }
        }
    }

    var l_AcessLogType = $(obj).attr("acesslogtype");
    //통합 로그 기록
    if (l_AcessLogType != undefined) {
        var l_EventCode;
        var l_BizCode = $(obj).text();
        if (l_AcessLogType == "Common") {
            l_EventCode = AccessEventCodeType.Common;
        } else if (l_AcessLogType == "Attribute") {
            l_EventCode = AccessEventCodeType.Attribute;
        } else if (l_AcessLogType == "Print") {
            l_EventCode = AccessEventCodeType.Print;
        } else if (l_AcessLogType == "Etc") {
            l_EventCode = AccessEventCodeType.Etc;
        }
        if (l_BizCode == "" || l_BizCode == "undefined" || l_BizCode == undefined)
            l_BizCode = $(obj).attr("title");
        //통합로그 기록
        XFN_AccessLogWrite("102", LogType.Event, getInfo("piid"), getInfo("fmpf"), getInfo("fmnm"), l_BizCode, "", BizCode.ApprovalForm, AccessTargetType.Page, l_EventCode);
    }

    ////visiblePopup 함수 호출 횟수 초기화
    //visiblePopup_CallCount = 0;

    //parent.Common.Loading(Common.GetDic("lbl_Loding"));
    if (getInfo("fmpf").indexOf("GWOK_OVERSEA_INVST") > -1) {
        if (!ButtonActionBefore(obj)) return;
    }

    if (getInfo("fmpf").indexOf("GWOK_WORKINGBUDGET_W01_HAOS") > -1) {
        if (!ButtonActionBefore(obj)) return;
    }

    if (getInfo("fmpf").indexOf("GWOK_WORKINGBUDGET_W01_HMMC") > -1) {
        if (!ButtonActionBefore(obj)) return;
    }

    if (getInfo("fmpf").indexOf("GWOK_INVEST") > -1 || getInfo("fmpf").indexOf("GWOK_PINVEST") > -1) {
        if (!ButtonActionBefore(obj)) return;
    }

    if (getInfo("fmpf").indexOf("OVER_BIZ_TRIP_MF") > -1 || getInfo("fmpf") == "WF_HMC_OVER_BIZ_RPT_MF" || getInfo("fmpf") == "WF_HMC_OVER_BIZ_TRIP_O_EXPN_MF") {
        if (!ButtonActionBefore(obj)) return;
    }

    // 제철 통합결재 > AS보상품의서(WF_HSTEEL_TOTAL_APPROVAL_AS), 제품반품요청(WF_HSTEEL_TOTAL_APPROVAL) 저장전 이벤트 필요로 인해 추가. 20200211 beokim S. 
    if (getInfo("fmpf") == "WF_HSTEEL_TOTAL_APPROVAL_AS" || getInfo("fmpf") == "WF_HSTEEL_TOTAL_APPROVAL") {
        if (!ButtonActionBefore(obj)) return;
    }
    // 제철 통합결재 > AS보상품의서(WF_HSTEEL_TOTAL_APPROVAL_AS), 제품반품요청(WF_HSTEEL_TOTAL_APPROVAL) 저장전 이벤트 필요로 인해 추가. 20200211 beokim E. 

    //[2016-02-29 add kh] 의견창 타이틀
    commentPopupTitle = $(obj).find('span').eq(0).text();

    if (obj.id == "btApproved") {
        if (!chkWARCOMMENT()) {
            return;
        }
    }
    //clone object
    var baseVariableObject = jQuery.extend(true, {}, doButtonDefault);


    //case 전 공통 처리
    baseVariableObject.preProcess();

    if (typeof _ieOrgVer === 'undefined') return;

    if (_ieOrgVer < 8) {
        Common.Warning(Common.GetDic("msg_apv_ieversionCheck"));
        return;
    }

    try {
        //버튼 분기 처리 함수 호출
        if (typeof doButtonCase[obj.id] === 'function') {
            //필요한 경우 return 값 반환하여 처리
            var ret = doButtonCase[obj.id]($(obj), baseVariableObject);
        } else {
            console.log(obj.id + ' : case not defined');
        }

        //분기 처리 후 공통 처리
        doButtonPostProcess(baseVariableObject);

    } catch (e) {
        alert(e.description);
        throw e;
    }

    ////1초 후 리사이징 완료된 팝업 보이기
    //setTimeout(function () { visiblePopup() }, 800);
}

//메뉴 이벤트 분기 처리 후 공통 처리 함수 : KJW : 2014.04.23 : XFORM PRJ.
function doButtonPostProcess(retVariableObject) {
    //console.log("doButtonPostProcess Start : " +new Date().getHours() + ":" +new Date().getMinutes() + ":" +new Date().getSeconds() + "." +new Date().getMilliseconds());
    var sUrl = retVariableObject.sUrl,
        iWidth = retVariableObject.iWidth,
        iHeight = retVariableObject.iHeight,//retVariableObject.iHeight,
        sSize = retVariableObject.sSize,
        formNm = retVariableObject.formNm,
        m_evalXML = retVariableObject.m_evalXML,
        elmlength = retVariableObject.elmlength,
        commentCount = retVariableObject.commentCount,
        elmComment = retVariableObject.elmComment,
		df_btnType = retVariableObject.df_btnType,
        IS_Tab = retVariableObject.IS_Tab; // 20171127 hpark 결재의견 명칭정리
// 스마트보고 확대사용시 결재창 팝업 스크롤 작업 2020.03.03 STS hk.cho 
    var ichkZoom = 1;
    if(browseris.ie9standardUp == true)
        ichkZoom = window.screen.deviceXDPI / window.screen.logicalXDPI;

  
    $('#result2').append('POST > iWidth:' + iWidth).append('<br>');
    if (IS_Tab == "Y") {
        if (sUrl.indexOf('\?') > -1)
            sUrl = sUrl + "&IS_Tab=Y";
        else
            sUrl = sUrl + "?IS_Tab=Y";
    }
    if (sUrl != null && sUrl != '') {
        if (sUrl.indexOf("ApvlineMgr") > -1) {
            //alert('ApvlineMgr');
            //if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE" || getInfo("mode") == "REDRAFT") { iWidth = 1135; iHeight = 750; }
        	if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE" || getInfo("mode") == "REDRAFT") { iWidth = 1310; iHeight = 675; } //{ iWidth = 1200; iHeight = 675; } // 20200626 hpark 결재선지정창 사이즈 확장
                //else { iWidth = 1135; iHeight = 750; }
                //else { iWidth = 1149; iHeight = 750; }
                //else { iWidth = 1171; iHeight = 800; }
        	else { iWidth = 1310; iHeight = 660; } //{ iWidth = 1200; iHeight = 660; } // 20200626 hpark 결재선지정창 사이즈 확장
            if (openMode == "L" || openMode == "P" || openMode == "B") {
                var nLeft = (screen.width - iWidth) / 4;
                var nTop = (screen.height - iHeight) / 4;
                var sWidth = "";
                
                if (!_ie) {
                    sWidth = (parseInt(iWidth) + 40).toString() + "px";
                }
                else {
                    sWidth = iWidth.toString() + "px";
                }

                var sHeight = iHeight.toString() + "px";

                if (sUrl.indexOf('\?') > -1) {// [16-03-11] kimhs, 파라미터 여러개일 경우 &로 연결
                    parent.Common.ShowDialog("btLine", "btLine" + getInfo("fiid"), $("#btLine").text() + "|||" + gLabel_apvlinecomment, sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");
                } else {
                    parent.Common.ShowDialog("btLine", "btLine" + getInfo("fiid"), $("#btLine").text() + "|||" + gLabel_apvlinecomment, sUrl + "?openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");
                }
            } else {
                //CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);
                CFN_OpenWindow(sUrl, "", iWidth, iHeight, "scroll");
            }
        } else if (sUrl.indexOf("ApvInfo") > -1) {
            if (openMode == "L" || openMode == "P") {
                var nLeft = (screen.width - iWidth) / 4;
                var nTop = (screen.height - iHeight) / 4;
                var sWidth = iWidth.toString() + "px";
                var sHeight = iHeight.toString() + "px";

                parent.Common.ShowDialog("btLine", "DivPop_" + openID, $("#btLine").text(), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
            } else {
                if (CFN_GetQueryString("CFN_OpenLayerName") == 'undefined')
                    openID = CFN_GetQueryString("CFN_OpenWindowName");
                else
                    if (CFN_GetQueryString("CFN_OpenWindowName") == 'undefined')
                        openID = getInfo("fmid");

                var nLeft = (screen.width - iWidth) / 2;
                var nTop = (screen.height - iHeight) / 2;
                var sWidth = iWidth.toString() + "px";
                var sHeight = iHeight.toString() + "px";
                var sActIndx = "";
                var sTitle = $("#btn_PaymentLine").text()
                parent.Common.ShowDialog("btn_PaymentLine", "btn_PaymentLine", sTitle, sUrl + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");
            }
        } else if (sUrl.indexOf("SetApvChargerAndPublicity") > -1) {
            //if (openMode == "L" || openMode == "P") {
            var nLeft = (screen.width - iWidth) / 4;
            var nTop = (screen.height - iHeight) / 4;
            var sWidth = iWidth.toString();
            var sHeight = iHeight.toString();
            if (Common.GetBaseConfig("LOCAL_DisplayPublicityYN") == "Y") {
                sHeight = (iHeight + 50).toString();
            }
            parent.Common.ShowDialog("", "SetApvChargerAndPublicity", Common.GetDic("btn_apv_Circulate"), sUrl + "&openID=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth + "px", sHeight + "px", "iframe-ifNoScroll");    // 레이블 수정 필요.
            //} else {
            //    CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);
            //}
        }
        else if (sUrl.indexOf("SetApvCharger") > -1) { //수신담당자추가
            //if (openMode == "L" || openMode == "P") {
            var nLeft = (screen.width - iWidth) / 4;
            var nTop = (screen.height - iHeight) / 4;
            var sWidth = iWidth.toString();
            var sHeight = iHeight.toString();
            parent.Common.ShowDialog("", "SetApvCharger", Common.GetDic("btn_apv_chargeAdd"), sUrl + "&openID=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth + "px", sHeight + "px", "iframe-ifNoScroll");    // 레이블 수정 필요.
            //} else {
            //    CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);
            //}
        }
        else if (sUrl.indexOf("comment_view") > -1) {
            if (openMode == "L" || openMode == "P") {

                //20120131 by ssuby, 의견창위치 화면 중앙으로 맞추기
                var nLeft = (screen.width - iWidth) / 2;
                var nTop = (screen.height - iHeight) / 2;
                var sWidth = iWidth.toString() + "px";
                var sHeight = iHeight.toString() + "px";
                // 20171127 hpark 결재의견 명칭정리
                if (df_btnType == "btCommentView")
                    parent.Common.ShowDialog("btCommentView", "DivPop_" + openID, Common.GetDic("btn_Apporval_opnion_Exist"), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
                else
                    parent.Common.ShowDialog("btCommentView", "DivPop_" + openID, $("#btCommentView").text(), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
            } else {
                var sWidth = iWidth.toString() + "px";
                var sHeight = iHeight.toString() + "px";
                // 20171127 hpark 결재의견 명칭정리
                if (df_btnType == "btCommentView")
                    parent.Common.ShowDialog("btCommentView", "DivPop_" + openID, Common.GetDic("btn_Apporval_opnion_Exist"), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
                else
                    parent.Common.ShowDialog("btCommentView", "DivPop_" + openID, $("#btCommentView").text(), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
                //원본 
                //CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);
            }
        } else if (sUrl.indexOf("ApvActBasic") > -1) {
            if (openMode == "L" || openMode == "P" || navigator.userAgent.toString().indexOf("COVI_HYBRID", 0) > -1) {
                var nLeft = (screen.width - iWidth) / 2;
                var nTop = (screen.height - iHeight) / 2;
                var sWidth = iWidth.toString() + "px";
                var sHeight = iHeight.toString() + "px";
                var sActIndx = "";
                var sTitle = "";
                if (document.getElementById("ACTIONINDEX").value == "") {
                    sActIndx = ""
                }
                else { sActIndx = document.getElementById("ACTIONINDEX").value; }

                //의견입력창 타이틀 표기
                if (sActIndx == "reject") { // 반려
                    sTitle = $("#btReject").text();
                }
                else if (sActIndx == "reserve") { //보류
                    sTitle = $("#btHold").text();
                }

                else if (sActIndx == "CANCELAPPROVE" || sActIndx == "APPROVAL_CANCEL" || sActIndx == "CANCELAPPROVE_RECEIVE") { // 결재취소
                    sTitle = $("#btCancelApprove").text();
                }
                else if (sActIndx == "ASSIGNREVIEWER") { // 협조결재
                    sTitle = $("#btAssignReviewer").text();
                }
                else if (sActIndx == "REJECTCONSULT") { // 협조거부
                    sTitle = $("#btRejectConsult").text();
                }
                else if (sActIndx == "COMPLETECONSULT") { // 협조완료
                    sTitle = $("#btCompleteConsult").text();
                }
                else if (sActIndx == "COMPLETEREVIEW") { // 검토완료
                    sTitle = $("#btCompleteReview").text();
                }
                else if (sActIndx == "CANCELREVIEW") { // 검토취소
                    sTitle = $("#btCancelReview").text();
                }
                else if (sActIndx == "SPECIALREPORT") { // 별도보고
                    sTitle = $("#btSpecialReport").text();
                }
                else if (sActIndx == "COMMENTADD") { // 의견추가
                    sTitle = $("#btCommentAdd").text();
                }
                else if (sActIndx == "DENY") { //기각사유 
                    sTitle = $("#btDeny").text();
                }
                else if (sActIndx == "CTRL_DEPT_COMPT_EXMNT") { //총괄부서 검토완료 
                    sTitle = $("#btCtrlExamination_Complete").text();
                }
                    
                else if (sActIndx == "REMOVEREASON") { //문서삭제
                    sTitle = $("#btDeleteDoc").text();
                }
                else if (sActIndx == "RejectRequest_Reason") { //반송사유 
                    sTitle = $("#btRejectRequest_Reason").text();
                }
                else if (sActIndx == "meetapprove") { //대면결재 
                    sTitle = $("#btMeetApproval").text();
                }


                //alert("sActIndx : " + sActIndx);
                if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") {
                    if (sUrl.indexOf("?") > -1) {
                        if (getInfo("fmpf") == "GWOK_REPORT_W03" && ichkZoom > 1) // 스마트보고 인터넷창 확대사용시 팝업모드 : auto STS hk.cho
                            parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx + "&encManagerCode=" + $("#hidEncManagerCode").val(), sWidth, sHeight, "iframe");    // 승인 등의 openID 처리 용
                        else
                            parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx + "&encManagerCode=" + $("#hidEncManagerCode").val(), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                    } else {
                        parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "?openID=" + openID + "&actionIndx=" + sActIndx + "&encManagerCode=" + $("#hidEncManagerCode").val(), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                    }

                    //parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx, sWidth, sHeight, "iframe-ifNoScroll");    // 기안, 임시저장 시 openID 처리용
                } else {
                    if (sUrl.indexOf("?") > -1) {
                        parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx, sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                    } else {
                        parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "?openID=" + openID + "&actionIndx=" + sActIndx, sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                    }
                }
            } else {
                // 모바일에서 기안할 경우 레이어팝업으로 변경
                if (document.location.href.indexOf("/Mobile/Approval/ApprovalWrite.aspx") > -1) {
                    if (sUrl.indexOf("?") > -1) {
                        Common.ShowDialog("", "divApvActBasic", "의견", sUrl + "&IsMobile=Y&actionIndx=" + sActIndx, iWidth, iHeight, "iframe-ifNoScroll");
                    } else {
                        Common.ShowDialog("", "divApvActBasic", "의견", sUrl + "?IsMobile=Y&actionIndx=" + sActIndx, iWidth, iHeight, "iframe-ifNoScroll");
                    }
                } else {
                    //TO-DO : 신세계 Customizing 기안/승인/반려 의견창은 무조건 Layer Popup으로 띄운다.
                    //CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);
                    //CFN_GetQueryString("CFN_OpenWindowName")
                    //CFN_GetQueryString("CFN_OpenLayerName")
                    if (CFN_GetQueryString("CFN_OpenLayerName") == 'undefined')
                        openID = CFN_GetQueryString("CFN_OpenWindowName");
                    else
                        if (CFN_GetQueryString("CFN_OpenWindowName") == 'undefined')
                            openID = getInfo("fmid");

                    var nLeft = (screen.width - iWidth) / 2;
                    var nTop = (screen.height - iHeight) / 2;
                    var sWidth = iWidth.toString() + "px";
                    var sHeight = iHeight.toString() + "px";
                    var sActIndx = "";
                    var sTitle = ""
                    if (document.getElementById("ACTIONINDEX").value == "") { sActIndx = "" }
                    else { sActIndx = document.getElementById("ACTIONINDEX").value; }
                    //의견입력창 타이틀 표기
                    if (sActIndx == "reject") { // 반려
                        sTitle = $("#btReject").text();
                    }
                    else if (sActIndx == "reserve") { //보류
                        sTitle = $("#btHold").text();
                    }
                    else if (sActIndx == "ASSIGNREVIEWER") { // 협조결재
                        sTitle = $("#btAssignReviewer").text();
                    }
                    else if (sActIndx == "REJECTCONSULT") { // 협조거부
                        sTitle = $("#btRejectConsult").text();
                    }
                    else if (sActIndx == "COMPLETECONSULT") { // 협조완료
                        sTitle = $("#btCompleteConsult").text();
                    }
                    else if (sActIndx == "COMPLETEREVIEW") { // 검토완료
                        sTitle = $("#btCompleteReview").text();
                    }
                    else if (sActIndx == "CANCELREVIEW") { // 검토취소
                        sTitle = $("#btCancelReview").text();
                    }
                    else if (sActIndx == "SPECIALREPORT") { // 별도보고

                        // 20171127 hpark 결재의견 명칭정리 일부러 처리한것같은데 다시 요청이와서 수정(협조전도 그냥 [별도보고] 로 표시
                        //협조전일경우 협조전+별도보고 라고 표시 
                        //if (getInfo('pdef') == 'COOPERATION_PATTERN') {
                        //    sTitle = Common.GetDic("FormTitle_GWOE_COOPER_CL_W01") + $("#btSpecialReport").text();
                        //} else {
                        //    sTitle = $("#btSpecialReport").text();
                        //}
                        sTitle = $("#btSpecialReport").text();


                    } else if (sActIndx == "COMMENTADD") { // 별도보고
                        sTitle = $("#btCommentAdd").text();
                    }
                    else if (sActIndx == "DENY") { //기각 
                        sTitle = $("#btDeny").text();
                    }
                    else if (sActIndx == "CTRL_DEPT_COMPT_EXMNT") { //총괄부서 검토완료 
                        sTitle = $("#btCtrlExamination_Complete").text();
                    }
                    else if (sActIndx == "RejectRequest_Reason") { //반송사유 
                        sTitle = $("#btRejectRequest_Reason").text();
                    }
                    else if (sActIndx == "DENYREASON") { //기각사유 
                        sTitle = $("#btDeny_Reason").text();
                    }
                    else if (sActIndx == "CANCELAPPROVE" || sActIndx == "APPROVAL_CANCEL" || sActIndx == "CANCELAPPROVE_RECEIVE") { //결재취소 
                        sTitle = $("#btCancelApprove").text();
                    }
                    else if (sActIndx == "REMOVEREASON") { //문서삭제
                        sTitle = $("#btDeleteDoc").text();
                    }
                    else if (sActIndx == "meetapprove") { //대면결재 
                        sTitle = $("#btMeetApproval").text();
                    }
                    else {
                        sTitle = $("#btDraft").text();
                    }
                    if (sUrl.indexOf("ApvActBasic_Send") > -1 || sUrl.indexOf("ApvActBasic.aspx") > -1) {
                        if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") {
                            if (sUrl.indexOf("?") > -1) {
                                if (getInfo("fmpf") == "GWOK_REPORT_W03" && ichkZoom > 1) // 스마트보고 인터넷창 확대사용시 팝업모드 : auto STS hk.cho
                                    parent.Common.LoadShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx + "&encManagerCode=" + $("#hidEncManagerCode").val() + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe");    // 승인 등의 
                                else
                                    parent.Common.LoadShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx + "&encManagerCode=" + $("#hidEncManagerCode").val() + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                            } else {
                                if (getInfo("fmpf") == "GWOK_REPORT_W03" && ichkZoom > 1) // 스마트보고 인터넷창 확대사용시 팝업모드 : auto STS hk.cho
                                    parent.Common.LoadShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "?openID=" + openID + "&actionIndx=" + sActIndx + "&encManagerCode=" + $("#hidEncManagerCode").val() + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe");    // 승인 등의 openID 처리 용
                                else
                                    parent.Common.LoadShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "?openID=" + openID + "&actionIndx=" + sActIndx + "&encManagerCode=" + $("#hidEncManagerCode").val() + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                            }
                            //parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx, sWidth, sHeight, "iframe-ifNoScroll");    // 기안, 임시저장 시 openID 처리용
                        } else {
                            if (sUrl.indexOf("?") > -1) {
                                if (getInfo("fmpf") == "GWOK_REPORT_W03" && ichkZoom > 1) // 스마트보고 인터넷창 확대사용시 팝업모드 : auto STS hk.cho
                                    parent.Common.LoadShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe");    // 승인 등의 openID 처리 용
                                else
                                    parent.Common.LoadShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                                //CFN_OpenWindow(sUrl,"", "900", "900", "fix");
                            } else {
                                parent.Common.LoadShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "?openID=" + openID + "&actionIndx=" + sActIndx + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                            }
                        }
                    }
                    else {
                        if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") {
                            if (sUrl.indexOf("?") > -1) {
                                parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx + "&encManagerCode=" + $("#hidEncManagerCode").val() + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                            } else {
                                parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "?openID=" + openID + "&actionIndx=" + sActIndx + "&encManagerCode=" + $("#hidEncManagerCode").val() + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                            }
                            //parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx, sWidth, sHeight, "iframe-ifNoScroll");    // 기안, 임시저장 시 openID 처리용
                        } else {
                            if (sUrl.indexOf("?") > -1) {
                                parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "&openID=" + openID + "&actionIndx=" + sActIndx + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                                //CFN_OpenWindow(sUrl,"", "900", "900", "fix");
                            } else {
                                parent.Common.ShowDialog("btapproved", "DivPop_btapproved", sTitle, sUrl + "?openID=" + openID + "&actionIndx=" + sActIndx + "&ParentLayerName=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 승인 등의 openID 처리 용
                            }
                        }
                    }
                }
            }
        } else if (sUrl.indexOf("comment_") > -1
                   || sUrl.indexOf("CirculationMgr") > -1
                   || sUrl.indexOf("Circulation_Read_View") > -1
                   || sUrl.indexOf("ReceiptList") > -1
                   || sUrl.indexOf("HistoryList") > -1
                   || sUrl.indexOf("selectOUs") > -1
                   || sUrl.indexOf("ApvprocessDraft") > -1
                   || sUrl.indexOf("PaymentLine") > -1) {
            if (openMode == "L" || openMode == "P") {
                var nLeft = (screen.width - iWidth) / 2;
                var nTop = (screen.height - iHeight) / 2;
                var sWidth = iWidth.toString() + "px";
                var sHeight = iHeight.toString() + "px";
                if (sUrl.indexOf("ReceiptList") > -1) {
                    parent.Common.ShowDialog("", "DivPop_ReceiptList", Common.GetDic("lbl_apv_receipt_view"), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
                } else if (sUrl.indexOf("HistoryList") > -1) {
                    parent.Common.ShowDialog("", "DivPop_ReceiptList", $("#btHistory").text(), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 히스트로 제목 필요.
                } else if (sUrl.indexOf("comment_") > -1) {
                    parent.Common.ShowDialog("", "DivPop_" + openID, Common.GetDic("lbl_Opinion"), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 완료함_의견 제목 필요.
                } else if (sUrl.indexOf("CirculationMgr") > -1) {
                    parent.Common.ShowDialog("", "DivPop_" + openID, Common.GetDic("lbl_apv_setschema_Circulation"), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 완료함_회람 제목 필요.
                } else if (sUrl.indexOf("Circulation_Read_View") > -1) {
                    parent.Common.ShowDialog("", "DivPop_" + openID, Common.GetDic("MsgApprovalState_ApprovalConsulted"), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 완료함_참조/회람 제목 필요.
                } else if (sUrl.indexOf("PaymentLine") > -1) {
                    parent.Common.ShowDialog("", "DivPop_" + openID, Common.GetDic("MsgApprovalState_ApprovalConsulted"), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 완료함_참조/회람 제목 필요.
                }
                else {
                    if (sUrl.indexOf("?") > -1) {
                        parent.Common.ShowDialog("", "DivPop_" + openID, commentPopupTitle, sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
                    } else {
                        parent.Common.ShowDialog("", "DivPop_" + openID, commentPopupTitle, sUrl + "?openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.ReSize
                    }
                }
            } else {
                CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);
            }
        } else {
            if (openMode == "L" || openMode == "P") {
                var nLeft = (screen.width - iWidth) / 2;
                var nTop = (screen.height - iHeight) / 2;
                var sWidth = iWidth.toString() + "px";
                var sHeight = iHeight.toString() + "px";
                if (sUrl.indexOf("ReceiptList") > -1) {
                    parent.Common.ShowDialog("", "DivPop_ReceiptList", commentPopupTitle, sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
                } else {
                    if (sUrl == "Print.aspx" || sUrl == "PrintForm.aspx") {
                        CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);
                    } else if (sUrl.indexOf("Pubpreview") > -1) {
                        parent.Common.ShowDialog("", "DivPop_" + openID, Common.GetDic("lbl_apv_OTransPV"), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 대외공문 미리보기 
                    } else if (sUrl.indexOf("?") > -1) {
                        parent.Common.ShowDialog("", "DivPop_" + openID, commentPopupTitle, sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
                    } else {
                        parent.Common.ShowDialog("", "DivPop_" + openID, commentPopupTitle, sUrl + "?openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.ReSize
                    }
                }
            } else {
                openID = CFN_GetQueryString("CFN_OpenWindowName");
                var nLeft = (screen.width - iWidth) / 2;
                var nTop = (screen.height - iHeight) / 2;
                var sWidth = iWidth.toString() + "px";
                var sHeight = iHeight.toString() + "px";


                // //debugger;
                // parent.Common.ShowDialog("", "DivPop_" + openID, commentPopupTitle, sUrl + "?openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
                if (sUrl.indexOf('preview') > -1) {
                    CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize); //미리보기일때 openID제거 
                } else if (sUrl.indexOf('PrintForm.aspx') > -1) {//인쇄미리보기창 스크롤추가
                    if (sUrl.indexOf('\?') > -1) {
                        sUrl = sUrl + "&openID=" + openID;
                    }
                    else {
                        sUrl = sUrl + "?openID=" + openID;
                    }

                    CFN_OpenWindow(sUrl, "", iWidth, iHeight, "scroll");
                    //CFN_OpenWindow("", pStrPopupId, nWindowPopWidth, nWindowPopHeight, "scroll");

                } else {
                    if (sUrl.indexOf('\?') > -1) {
                        sUrl = sUrl + "&openID=" + openID;
                    }
                    else {
                        sUrl = sUrl + "?openID=" + openID;
                    }

                    CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);

                }

            }
            //CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);
        }
    }
    //console.log("doButtonPostProcess END : " + new Date().getHours() + ":" + new Date().getMinutes() + ":" + new Date().getSeconds() + "." + new Date().getMilliseconds());
}

/*-------------------------------------------------------
 메뉴 버튼 이벤트 분기 처리 함수 : KJW : 2014.04.23 : XFORM PRJ.
--------------------------------------------------------- 
[버튼 이벤트 처리 방법] 
버튼이 추가되면 아래의 구문을 추가한다.
기존의 switch case 에 정의되는 것이 독립한 함수로 분화한 형태로 사용.

doButtonCase['버튼 아이디'] = function (oBtn, oVar) {
    // 처리 구문
}
--------------------------------------------------------- 
[파라미터]
oBtn :	이벤트가 발생한 개체로 jquery 개체.
		예) oBtn.css('border', 'solid 1px #f00');

oVar :	버튼 이벤트 처리에 사용되는 공통 variable을 담은 오브젝트. 
		아래는 참조 가능한 속성

		sUrl : "",
		iWidth : "640",
		iHeight : "480",
		sSize : "fix",
		formNm : "",
		m_evalXML : "",
		elmlength : 0,
		commentCount : 0,
		elmComment : "",
		preProcess : function()
--------------------------------------------------------------
 분기 처리 함수 <시작> : KJW : 2014.04.23 : XFORM PRJ.
-------------------------------------------------------------*/
doButtonCase['bt_receive_cc'] = function (oBtn, oVar) {//수신/참조
    receiveOpen();
}

doButtonCase['btreceive'] = function (oBtn, oVar) {//수신
    oVar.iWidth = 400; oVar.iHeight = 400;
    receiveOpen();
}

doButtonCase['btCC'] = function (oBtn, oVar) {//참조
    oVar.iWidth = 400; oVar.iHeight = 400;
    ccOpen();
}

doButtonCase['btCirculate'] = function (oBtn, oVar) {//회람
    //if ((document.getElementById("tblFormSubject").style.display != "none" && document.getElementById("SUBJECT").style.display != "none") && document.getElementById("SUBJECT").value == "") {
    if (document.getElementById("tblFormSubject").style.display != "none" && document.getElementById("SUBJECT").value.trim() == "") {
        alert("제목을 입력하세요");
        return;
    }

    //oVar.iWidth = 960; oVar.iHeight = 648;
    oVar.iWidth = 990; oVar.iHeight = 648;
    oVar.sSize = "resize";
    var _state = "";
    if (getInfo("mode") == "DRAFT") { _state = "288"; }
    else { _state = "528"; }
    //oVar.sUrl = "/Approval/Circulation/CirculationMgr.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&openDo=Circulate&openType=C&pState=528"; //hjy				
    //TO-DO : 신세계 Customizing 회람창 신규제작
    oVar.sUrl = "/Approval/Circulation/CirculationMain.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&Type=D9&AllCompany=Y&Group=Y&Target=U&SubSystem=CIRCULATION&TreeKind=Dept&Caller=User&SelectedItemID=circulationinfotxt_ref&pState=" + _state;
    //parent.XFN_OrgMapShow_WindowOpen("btSend", "popBody", "txtItem", "wReceive", "OrgMap_CallBack", "D9", "Y", "Y", "U", "Approval", "", "");

    //alert(document.getElementById("SUBJECT").value);
    //if (document.getElementById("SUBJECT").value == "") {
    //    var subject = XFN_GetDicInfo(getInfo("usdn")) + " - " + getInfo("fmnm");
    //    document.getElementById("SUBJECT").value = subject;
    //    m_TempSaveInfo = true;
    //    m_TempSave = true;
    //}

}

doButtonCase['btReCCSend'] = function (oBtn, oVar) {//참조처 추가_완료된 문서에서 참조처를 추가되는것
    var pdef = getInfo("pdef");
    var approvalOrder = getInfo("approvalOrder");
    var process_instance_id = getInfo("PROCESS_INSTANCE_ID");
    var bookingYN = getInfo("BOOKING_APPROVAL_YN");
    var bookingSUCCESS = getInfo("BOOKING_SUCCESS_REFER_YN");
    var b_booking = (bookingYN == "Y" && bookingSUCCESS.trim() == "") ? "Y" : "N";

    // 재송 - var strURL = String.format("/Approval/Forms/Templates/popup/ReceiptStatusAddDel_Popup.aspx?pdef={0}&process_instance_id={1}&approvalorder={2}&Type=ReSend", pdef, process_instance_id, approvalOrder);
    // 협조처추가삭제 - var strURL = String.format("/Approval/Forms/Templates/popup/ReceiptStatusAddDel_Popup.aspx?pdef={0}&process_instance_id={1}&approvalorder={2}&formPrefix={3}", pdef, process_instance_id, approvalOrder, fmpf);
    var strURL = String.format("/Approval/Forms/Templates/popup/CCStatusAddDel_Popup.aspx?pdef={0}&process_instance_id={1}&approvalorder={2}&bookingYN={3}", pdef, process_instance_id, approvalOrder, b_booking);

    var Title = Common.GetDic("btn_apv_reccsend");

    Common.Show("ApvReCCsend", "CCStatusAddDel", Title, strURL, "600px", "610px", "iframe");
    return false;
}

var ReSendDept = '';
doButtonCase['btReSend'] = function (oBtn, oVar) {//재송_완료된 문서에서 발송 보내는것, 재송클릭시 조회된 협조처는 삭제되서는 안됨, 따라서 type를 Resend로 보냄

    var pdef = getInfo("pdef");
    var approvalOrder = getInfo("approvalOrder");
    var process_instance_id = getInfo("PROCESS_INSTANCE_ID");
    var strURL = String.format("/Approval/Forms/Templates/popup/ReceiptStatusAddDel_Popup.aspx?pdef={0}&process_instance_id={1}&approvalorder={2}&Type=ReSend&approverAt=P", pdef, process_instance_id, approvalOrder);
    var Title = Common.GetDic("btn_apv_resend");

    Common.Show("ApvResend", "ReceiptStatusAddDel", Title, strURL, "600px", "610px", "iframe");
    return false;

}
//일정추가
doButtonCase['btScheduleAdd'] = function (oBtn, oVar) {
    if (getInfo('mode') == 'DRAFT') {
        // '작성한 문서를 저장 후 이용 가능합니다.
        Common.Warning(Common.GetDic("msg_Request_NeedSave"));
    }
    else {
        var Title = Common.GetDic("lbl_apv_scheduleAdd");//일정추가
        var strURL = "/Approval/ApvProcess/ScheduleAdd.aspx?type=ScheduleAdd";
        Common.Show("ScheduleAdd", "1", Title, strURL, "500px", "340px", "iframe");
    }
    return false;
}
//할일추가
doButtonCase['btWorkAdd'] = function (oBtn, oVar) {
    if (getInfo('mode') == 'DRAFT') {
        // '작성한 문서를 저장 후 이용 가능합니다.
        Common.Warning(Common.GetDic("msg_Request_NeedSave"));
    }
    else {
        var Title = Common.GetDic("lbl_apv_workAdd");//할일추가
        var strURL = "/Approval/ApvProcess/ScheduleAdd.aspx?type=WORKADD";
        Common.Show("WorkAdd", "1", Title, strURL, "500px", "340px", "iframe");
    }
    return false;
}
//기계번역읽기모드추가
doButtonCase['btTranslateRead'] = function (oBtn, oVar) {
    var blankURL = Common.GetBaseConfig("MachineTranslationHtmlURL");
    var separator = Common.GetBaseConfig("MachineTranslationSeparator");//&★¿&
    //strURL += "?transhtml=" + document.getElementById("templateContainer").innerText + "&contenttype=cooperation";//post로 보낼 파라미터 추가( 1. transhtml - 번역대상 HTML,    2. contentstype - cooperation / mail (콘텐츠 구분: 결재 문서 / 메일))
    //test용 데이터
    //var contentHtml = " <div class=\"defaultHeader\">	<!-- 메뉴가 들어 올 영역 -->	<script src=\"Templates/STANDARD/GWOE_COOPER_CL_W01_V0.js?v=20200205_1\" type=\"text/javascript\"></script> <div style=\"border: 0px currentColor; border-image: none;\">aa</div> <div class=\"documentSection\">		<div class=\"top\">문서 번호</div>		<div class=\"bottom\">TAHG-20200512-023015</div>	</div>	<div class=\"mainTitle\">		<div class=\"top\">신뢰경영 ・ 현장경영 ・ 투명경영</div>		<div class=\"bottom\">협조전</div>	</div>	<div class=\"director\">		<div class=\"top\">업무전결 규정 및 지출승인 규정에 의거전결권자 표시</div>		<div class=\"bottom\">실장</div>	</div></div><div class=\"cooperationTitle\">	<div class=\"left\">제 목</div>	<div class=\"right\"></div></div><div class=\"contentSection\">	<p></p></div>	";
    //var contentHtml = "        <div class=\"con_in\">                    <!-- 메뉴가 들어 올 영역 -->                                        <!--[2014-07-08 박한 mod] class=\"app_formbox\" 추가 (디자인팀 요청사항) --><div class=\"app_formbox\" id=\"app_formboxHeader\" style=\"border: 0px currentColor; border-image: none; width: 93.5%; position: fixed; z-index: 99; box-sizing: border-box; background-color: white;\">    <!-- [2014-10-14 박한 add] 에디터(태그프리)가 양식 상단 메뉴를 덮는 현상 수정 -->    <!--<div style=\"width: 100%; height: 73px; position:absolute;\"><iframe width=\"100%\" height=\"73\" frameborder=\"0\"></iframe></div>-->    <div class=\"approval_btop\" id=\"divMenu\" style=\"background: none;\">        <div>            <!--[2014-06-30 박한 add] 디자인팀 요청사항-->            <div class=\"logo\"></div>            <ul class=\"approval_btop_g_d\" style=\"height: 0px;\">                <li>                    <!----------------------------------------------------------파란색 강조 버튼 영역---------------------------------------------------------->                    <!-- 기아해외출장품의 - 접수 --><span id=\"btn_receipt\" style=\"display: none;\" onclick=\"fn_Accept_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">접수</span></em></a></span>                    <!-- 기아해외출장품의 - 완료처리 --><span id=\"btn_Complete_Process\" style=\"display: none;\" onclick=\"fn_ProcComplete_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">완료처리</span></em></a></span>                    <!-- 승인 --><span id=\"btApproved\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">결재</span></em></a></span>                    <!-- 승인 --><span id=\"btPostApproved\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">결재</span></em></a></span>                    <!-- 기안 --><span id=\"btDraft\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">결재</span></em></a></span>										<!-- 선결 --><span id=\"btPrecdngApproval\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">btn_apv_preapproval.</span></em></a></span> <!-- 20200610 hpark 예결함에서 선결 -->					<!-- 확인 --><span id=\"btAfterConfirm\" style=\"display: none;\" onclick=\"fnAfterConfirm();\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">btn_apv_confirm_approval.</span></em></a></span><!-- 20200610 hpark 예결함에서 선결 -->                    <!-- 결재선 --><span id=\"btDeptLine\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">결재선</span></em></a></span>                    <!-- 검토 --><span id=\"btDeptLineConsult\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">협조결재^결재</span></em></a></span>                    <!-- 협조완료(APPROVAL) --><span id=\"btCompleteConsult\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">협조완료</span></em></a></span>                    <!-- 협조결재(APPROVAL) --><span id=\"btAssignReviewer\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">협조결재</span></em></a></span>                    <!-- 투자품의 총괄부서 검토자지정 --><span id=\"btAssignExamination\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">검토자 지정</span></em></a></span>                    <!-- 투자품의 총괄부서 검토자 검토완료 --><span id=\"btCtrlExamination_Complete\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">검토완료</span></em></a></span>                    <!-- 검토자검토완료(APPROVAL) --><span id=\"btCompleteReview\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">검토완료</span></em></a></span>                    <!-- 반송 --><span id=\"btReject\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">반송</span></em></a></span>                    <!-- 반송요청 --><span id=\"btRejectRequest\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\" id=\"spanbtReject\">반송요청</span></em></a></span>                    <!-- 기각(APPROVAL) --><span id=\"btDeny\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">기각</span></em></a></span>                    <!-- 기아해외출장품의 - 완료처리 --><span id=\"btn_PopResvNoList\" style=\"display: none;\" onclick=\"fn_PopResvNoList(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">출장계획서 등록</span></em></a></span>                                        <!----------------------------------------------------------파란색 강조 버튼 영역---------------------------------------------------------->                    <!----------------------------------------------------------흰색 버튼 영역---------------------------------------------------------->                    <!-- 임시저장 --><span id=\"btSave\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">저장</strong></span></em></a></span>                    <!-- 상신취소 --><span id=\"btWithdraw\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">상신 취소</strong></span></em></a></span>                    <!-- 결재취소(PROCESS) --><span id=\"btCancelApprove\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">결재취소</strong></span></em></a></span>                    <!-- 별도보고(APPROVAL) --><span id=\"btSpecialReport\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">별도보고</strong></span></em></a></span>                    <!-- 의견추가 --><span id=\"btCommentAdd\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">의견추가</strong></span></em></a></span>                    <!-- 저장 --><span id=\"btchangeSave\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">저장</strong></span></em></a></span>                    <!-- 저장(기완료된 고객만족 처리전) --><span id=\"btchangeSave_CUSTOMERSAT\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">저장</strong></span></em></a></span>                    <!-- 결재정보 --><span id=\"btLine\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">결재정보</strong></span></em></a></span>                    <!-- 결재정보(예결함용) --><span id=\"btLinePreapproval\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">결재정보</strong></span></em></a></span>                    <!-- 검토자검토취소(APPROVAL) --><span id=\"btCancelReview\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">검토자검토취소</strong></span></em></a></span>                    <!-- 협조거부(APPROVAL) --><span id=\"btRejectConsult\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">협조거부</strong></span></em></a></span>                    <!-- 기각사유 --><span id=\"btDeny_Reason\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">기각 사유</strong></span></em></a></span>                    <!-- 반송사유 --><span id=\"btRejectRequest_Reason\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">반송사유</strong></span></em></a></span>                    <!-- 이전 --><span id=\"btPreList\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"><img class=\"ico_btn\" style=\"padding-top: 10px;\" alt=\"\" src=\"/Images/Images/Approval/ico_top.gif\"></strong></span></em></a></span>                    <!-- 다음 --><span id=\"btNextList\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"><img class=\"ico_btn\" style=\"padding-top: 10px;\" alt=\"\" src=\"/Images/Images/Approval/ico_down.gif\"></strong></span></em></a></span>                    <!-- 지정반송 --><span id=\"btRejectedto\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">지정반려</strong></span></em></a></span>                    <!-- 보류 --><span id=\"btHold\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">보류</strong></span></em></a></span>                    <!-- 편집 --><span id=\"btModify\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">편집</strong></span></em></a></span>                    <!-- 편집 --><span id=\"btModifyE\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">편집</strong></span></em></a></span>                    <!-- 통합결재 편집 --><span id=\"btModifyITG\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_modify_itg_approval.</strong></span></em></a></span>                    <!-- 편집(기완료된 고객만족 처리전) --><span id=\"btModifyComplete\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">편집</strong></span></em></a></span>                    <!-- 후열 --><span id=\"btBypass\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">현결재자후열</strong></span></em></a></span>                    <!-- 부서내반송 --><span id=\"btRejectedtoDept\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">부서내반송</strong></span></em></a></span>                    <!-- 전달 --><span id=\"btForward\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">전달</strong></span></em></a></span>                    <!-- 현결재자 후결변경 --><span id=\"btApproverChangeReview\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">현결재자변경</strong></span></em></a></span>                    <!-- 대결자로 지정 --><span id=\"btApproverChangeDeputy\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">대결자&nbsp;지정</strong></span></em></a></span>                    <!-- 재송 --><span id=\"btReSend\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Etc\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">재송</strong></span></em></a></span>					<!-- 참조처 추가 --><span id=\"btReCCSend\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Etc\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">참조처 추가</strong></span></em></a></span>                    <!-- 협조처접수확인 --><span id=\"btnReceiptStatus\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">협조처 접수확인</strong></span></em></a></span>                    <!-- 협조처접 추가삭제--><span id=\"btnReceiptAddDel\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">협조처추가삭제</strong></span></em></a></span>                    <!-- 히스토리 --><span id=\"btHistory\" style=\"display: none;\" onclick=\"javascript:doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">히스토리</strong></span></em></a></span>                    <!-- 협조기한 연장 --><span id=\"btIncreaseCooperation\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">협조기한 연장</strong></span></em></span>                    <!-- 수신처 변경-협조전류 --><span id=\"btn_SetReceiveDept\" style=\"display: none;\" onclick=\"setReceiveDept();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">수신처</strong></span></em></a></span>                    <!-- 수신처 --><span id=\"btRecDept\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">수신처</strong></span></em></a></span>                    <!-- 기아해외출장품의 - 협조처지정 --><span id=\"btn_SetCoDept\" style=\"display: none;\" onclick=\"doButtonAction(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">협조처</strong></span></em></a></span>                    <!-- 문서연결 --><span id=\"btDocLinked\" style=\"display: none;\"><a name=\"cbBTN\" id=\"btDocLink\" style=\"vertical-align: middle;\" onclick=\"DocLink();\" href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">결재 문서 첨부</strong></span></em></a></span>                    <!-- 공람 --><span id=\"btGongRam\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"><img class=\"ico_btn\" alt=\"\" src=\"/Images/Images/Approval/ico_preview.gif\">공람자</strong></span></em></a></span>                    <!-- 공람자확인 --><span id=\"btGongRamList\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"><img class=\"ico_btn\" alt=\"\" src=\"/Images/Images/Approval/ico_preview.gif\">공람자확인</strong></span></em></a></span>                    <!-- 문서삭제(협조전) --><span id=\"btDeleteDoc\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">문서삭제</strong></span></em></a></span>                    <!-- 서식등록신청서 - 개정 --><span id=\"btnFixFormRevision\" style=\"display: none;\" onclick=\"doButtonAction(this);\" acesslogtype=\"Etc\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">개정</strong></span></em></a></span>                    <!-- 서식등록신청서 - 폐기 --><span id=\"btnFixFormAbolition\" style=\"display: none;\" onclick=\"fn_FixFormAbolition_Click();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">폐기</strong></span></em></a></span>                    <!-- 관심문서 등록 --><span id=\"btDocMove\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">관심문서 등록</strong></span></em></a></span>                    <!-- 정보보호 설정 --><span id=\"btSetProtectInfo\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">정보보호 설정</strong></span></em></a></span>                    <!-- 정보보호 해제 --><span id=\"btResetProtectInfo\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">정보보호 해제</strong></span></em></a></span>                    <!-- 회람 --><span id=\"btShare\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">회람</strong></span></em></a></span>                    <!-- 취소 --><span id=\"btAbort\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">취소</strong></span></em></a></span>                    <!-- 게시 --><span id=\"btPost\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">게시</strong></span></em></a></span>                    <!-- 변환 --><span id=\"btTrans\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">변환</strong></span></em></a></span>                    <!-- 시행 --><span id=\"btITrans\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">시행</strong></span></em></a></span>                    <!-- 대외공문미리보기 --><span id=\"btOTrans\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">공문미리보기</strong></span></em></a></span>                    <!-- 성안문 --><span id=\"btArchives\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">성안문</strong></span></em></a></span>                    <!-- 번호발행 --><span id=\"btDocNo\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">번호발행</strong></span></em></a></span>                    <!-- 직인 --><span id=\"btSign\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">직인</strong></span></em></a></span>                    <!-- 접수 --><span id=\"btRec\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">접수</strong></span></em></a></span>                    <!-- 공람문서로저장 --><span id=\"btRecRE\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">공람문서로저장</strong></span></em></a></span>                    <!-- 재기안 --><span id=\"btDeptDraft\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">재기안</strong></span></em></a></span>                    <!-- 재기안 --><span id=\"btDeptRejectDraft\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">재기안R</strong></span></em></a></span>                    <!-- 담당자 --><span id=\"btCharge\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">담당자</strong></span></em></a></span>                    <!-- 결재선(흰색) --미결함일때만 이걸로 보임 --><span id=\"btDeptLineW\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">결재선</strong></span></em></a></span>                    <!-- 결재선변경 --><span id=\"btAPVLINEModify\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">결재선 수정</strong></span></em></a></span>                    <!-- 결재선저장 --><span id=\"btChgApv\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">결재선저장</strong></span></em></a></span>                    <!-- 저장(Corp. Card Expense양식에서 쓰는 버튼) --><span id=\"btDataSave\" style=\"display: none;\" onclick=\"doDataSave(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">저장</strong></span></em></a></span>                    <!-- 임시보관함열기 --><span id=\"btSaveInfo\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">정보</strong></span></em></a></span>                    <!-- 본문가져오기 --><span id=\"btComFormInfo\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">본문가져오기</strong></span></em></a></span>                    <!-- 재사용 --><span id=\"btReUse\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">재작성</strong></span></em></a></span>                    <!-- 복사 --><span id=\"btCopy\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">복사</strong></span></em></a></span>                    <!-- 재사용 --><span id=\"btBizrip\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">출장복명서 작성</strong></span></em></a></span>                    <!-- 수신부서 재사용 --><span id=\"btReUseR\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">재작성R</strong></span></em></a></span>                    <!-- 파일첨부 --><span id=\"btAttached\" style=\"display: none;\"><a name=\"cbBTN\" id=\"btAttach\" style=\"vertical-align: middle;\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">파일첨부</strong></span></em></a></span>                    <!-- 확인 --><span style=\"display: none;\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"></strong></span></em></a></span>                    <!-- 강제합의	 --><span id=\"btForcedConsent\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">강제합의</strong></span></em></a></span>                    <!-- 합의부서삭제 --><span id=\"btDCooRemove\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">합의부서삭제</strong></span></em></a></span>                    <!--(관)기안취소--><span id=\"btAdminAbort\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">기안취소</strong></span></em></a></span>                    <!-- 문서이관 --><span id=\"bt_adminedms\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">문서이관</strong></span></em></a></span>                    <!-- 수신/참조 --><span id=\"li_bt_receive_cc\" style=\"display: none;\"><a name=\"cbBTN\" id=\"bt_receive_cc\" style=\"display: none;\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">수신/통보</strong></span></em></a></span>                    <!-- 추가기능 --><span id=\"btExt\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"><span id=\"spanExt\">인쇄</span></strong></span></em></a></span>                    <!-- 잉크쓰기 --><span id=\"btInkWrite\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">잉크쓰기</strong></span></em></a></span>                    <!-- SAP재연동 --><span id=\"btSapRetunt\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">SAP재연동</strong></span></em></a></span>                    <!-- EPRO재연동 --><span id=\"btEproRetunt\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">EPRO재연동</strong></span></em></a></span>                    <!-- SRM재연동 --><span id=\"btSrmRetunt\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">SRM재연동</strong></span></em></a></span>                    <!-- 관심문서 등록 --><span id=\"btDocMove\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">관심문서 등록</strong></span></em></a></span>                    <!-- 대외문으로 --><span id=\"btOTDocTrans\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Etc\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">대외문으로</strong></span></em></a></span>                    <!-- 연동재실행(2013-10-14 HIW) --><span id=\"btRerunAction\" style=\"display: none;\" onclick=\"fnRerunAction();\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">연동재실행</strong></span></em></a></span>                    <!--예약결재 --><span id=\"btn_Booking_Approval\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">협조처 예약발송</strong></span></em></a></span>                    <!-- 결재선 조회(파워텍 - 구문서 전용) --><span id=\"btArchiveBoxApvLine\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">결재선 조회</strong></span></em></a></span>                    <!-- 현대건설, 현대 엔지니어링 담당자 추가--><span id=\"btChargeAdd\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_apv_chargeadd.</strong></span></em></a></span>                    <!-- 접수취소(현대걸설, 현대엔지니어링) --><span id=\"btCancelReceipt\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_apv_cancelreceipt.</strong></span></em></a></span>                    <!--현황판 --><span id=\"btn_PaymentLine\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">결재선보기</strong></span></em></a></span>                    <!--메일로 복사하기--><span id=\"btn_CopyToMail\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">메일로 복사</strong></span></em></a></span>                    <!--메일로 전달(임시추가)--><span id=\"btn_ForwardMail\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_forwardmail.</strong></span></em></a></span>                    <!--공시여부 --><span id=\"btn_PublicObjectType\" onclick=\"fn_PublicObjectType(this);\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">공시여부</strong></span></em></a></span>                                       <!-- 재사용 --><span id=\"btReApproval\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">재작성</strong></span></em></a></span>                    <!-- 미주 버튼(HAEA) 추가 Reverse Form --><span id=\"btReverseForm\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">Reverse Form</strong></span></em></a></span>                    <!-- 미주 버튼(HAEA) 추가 Launch GAR --><span id=\"btLaunchGar\" style=\"display: none;\" onclick=\"fn_ES_To_LaunchGAR(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">Launch GAR</strong></span></em></a></span>					<!-- 미주 버튼(HAEA) 추가 ES Addendum 20181029 박한 ES양식 --><span id=\"btAddendumES\" style=\"display: none;\" onclick=\"fn_addemdum(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\" id=\"strAddendumES\">Addendum</strong></span></em></a></span>                    <!-- 미주 버튼(KMMG) 추가 Completed --><span id=\"btCompleted\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">Completed</strong></span></em></a></span>                    <!-- 미주 버튼(KMMG) 추가 Resend To SAP --><span id=\"btResendToSAP\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">Resend To SAP</strong></span></em></a></span>                    <!-- 사전승인대상(글로비스 법인인감 신청서) --><span id=\"btPriorApproval\" style=\"display: none;\" onclick=\"fn_PriorApproval(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">사전승인대상</strong></span></em></a></span>                    <!-- 사후관리(글로비스 법인인감신청서) --><span id=\"PostResult\" style=\"display: none;\" onclick=\"PostResult_Click(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">사후관리</strong></span></em></a></span>                                        <!-- 사후관리(글로비스 법인인감신청서) --><span id=\"OverResult\" style=\"display: none;\" onclick=\"OverResult_Click(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">연장신청</strong></span></em></a></span>                                        <!-- 사후관리(글로비스 법인인감신청서) --><span id=\"ExpireResult\" style=\"display: none;\" onclick=\"ExpireResult_Click(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">파기신청</strong></span></em></a></span>                                        <!-- 인센티브(다이모스 품의(R&D 시행)) --><span id=\"btIncentive\" style=\"display: none;\" onclick=\"Incentive_Click(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">lbl_incentive.</strong></span></em></a></span>                                        <!-- 전결규정(다이모스 품의(R&D 시행)) --><span id=\"btRuleInfo\" style=\"display: none;\" onclick=\"openRuleWindow();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">전결규정</strong></span></em></a></span>                    <!-- 포탈 평가 --><span id=\"btn_ConferenceAppraisal\" style=\"display: none;\" onclick=\"fnPopUp_ConferenceAppraisal();\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">회의평가</strong></span></em></a></span>                    <!-- 파기신청(북경 글로비스 법인인감신청서) --><span id=\"PostResultBJG\" style=\"display: none;\" onclick=\"PostResult_Click(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_corpseal_post.</strong></span></em></a></span>                    <!-- 사후관리(북경 글로비스 법인인감신청서) --><span id=\"ExpireResultBJG\" style=\"display: none;\" onclick=\"ExpireResult_Click(this);\" name=\"cbBTN\" acesslogtype=\"Common\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_corpseal_expr.</strong></span></em></a></span>                                        <!-- 연동문서 링크 --><span id=\"btRefDocLink\" style=\"display: none;\" onclick=\"fnRefDocLink();\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"></strong></span></em></a></span>                    <!-- 체크리스트 --><span id=\"btCheckList\" style=\"display: none;\" onclick=\"fnCheckList();\" name=\"cbBTN\" acesslogtype=\"Attribute\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_checklist.</strong></span></em></a></span>                                        <!----------------------------------------------------------흰색 버튼 영역---------------------------------------------------------->                    <!--수신처 전 임직원 개인 메일 발송 -->                    <span id=\"receiverSendMail\" style=\"padding-top: 5px; display: none;\" name=\"rs\" acesslogtype=\"Attribute\">                        <label class=\"txt_btn_ws\" style=\"cursor: pointer;\" onclick=\"chk_receiverSendMail();\">                            <em class=\"btn_ws_l\"><span class=\"txt-btn_ws\"><strong class=\"txt_btn_ws\"><input name=\"chk_receiverSendMail\" class=\"input_check\" id=\"chk_receiverSendMail\" type=\"checkbox\" value=\"0\"> lbl_receiversendmail. </strong></span></em>                        </label>                    </span>                    <span id=\"receiverSendMailNotice\" style=\"padding-left: 10px; display: none;\" onclick=\"fn_ShowMessageSendMail();\" name=\"rsn\" acesslogtype=\"Attribute\">                        <a class=\"txt_btn_ws\" href=\"javascript:void(0);\">                            <em class=\"btn_ws_l\"><span class=\"txt-btn_ws\"><strong class=\"txt_btn_ws\"> lbl_receiversendmailnotice. </strong></span></em>                        </a>                    </span>                    <span class=\"ct\">                        <!--긴급--><span id=\"urgent\" style=\"display: none; cursor: default;\"><input name=\"chk_urgent\" class=\"input_check\" id=\"chk_urgent\" onclick=\"chk_urgent_onclick();\" type=\"checkbox\" value=\"0\"><span class=\"txt_gn11\"> 긴급결재</span></span>                        <!--emds첨부--><span id=\"edmschk\" style=\"display: none;\"><input name=\"chk_edmschk\" class=\"input_check\" id=\"chk_edmschk\" onclick=\"chk_edmschk_onclick();\" type=\"checkbox\" value=\"0\"><span class=\"txt_gn11\"> 문서이관</span></span>                        <!--기밀--><span class=\"c-tooltip\" id=\"secrecy\" style=\"display: none; cursor: pointer;\"><!--<input type=\"hidden\" name=\"chk_secrecy\" id=\"chk_secrecy\" value=\"0\" />--><input name=\"chk_secrecy\" class=\"input_check\" id=\"chk_secrecy\" onclick=\"chk_secrecy_onclick();chk_secrecy_menu();\" type=\"checkbox\" value=\"0\"><span class=\"txt_gn11\" id=\"spSecrecy\" style=\"font-size: 13px;\"> 보안결재</span><span class=\"c-tooltip__box c-tooltip__box\" id=\"HPT\" style=\"font-size: 12px; min-width: 600px;\">결재선에서 지정된 사용자의 개인문서함에서 보이며, 부서분서함에서는 보이지 않는 결재 문서입니다.</span>                        </span>                        <!--feedback기능 -->                        <span id=\"feedback\" style=\"display: none;\">                            <input name=\"chk_feedback\" class=\"input_check\" id=\"chk_feedback\" onclick=\"chk_feedback_onclick();\" type=\"checkbox\" value=\"0\"> <span class=\"txt_gn11\">feedback</span>&nbsp;<select name=\"selfeedback\" id=\"selfeedback\" onchange=\"selfeedback_onchange(this.value);\">                                <option value=\"1\" selected=\"\">1개월</option>                                <option value=\"2\">2개월</option>                            </select>                        </span>                        <!--예약--><span id=\"reserved\" style=\"display: none;\"><input name=\"chk_reserved\" class=\"input_check\" id=\"chk_reserved\" onclick=\"chk_reserved_onclick();\" type=\"checkbox\" value=\"0\"><span class=\"txt_gn11\"> 예약</span></span>                    </span>                    <span class=\"rt\">                        <!--2012.02.13 추가 시작-->                        <!-- 삼양그룹 본문비교 --><span id=\"btDocBodyHistory\" style=\"display: none;\" onclick=\"doButtonAction(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"><img class=\"ico_btn\" style=\"height: 10px;\" alt=\"\" src=\"/Images/Images/Approval/ico_blank.gif\"> 본문비교</strong></span></em></a></span>                        <!-- 즐겨찾기 등록 --><span id=\"favorformadd\" style=\"display: none;\" onclick=\"favorform('insert');\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"><img class=\"ico_btn\" style=\"height: 10px;\" alt=\"\" src=\"/Images/Images/Approval/icon_pin.gif\"> 즐겨찾기등록</strong></span></em></a></span>                        <!-- 즐겨찾기 제거 --><span id=\"favorformdelete\" style=\"display: none;\" onclick=\"favorform('delete');\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"><img class=\"ico_btn\" style=\"height: 12px;\" alt=\"\" src=\"/Images/Images/Approval/icon_del.gif\"> 즐겨찾기제거</strong></span></em></a></span>                        <!--2012.02.13 추가 끝-->                        <!-- 미리보기 --><!--<span id=\"btPreView\" name=\"cbBTN\" onclick=\"doButtonAction(this);\" style=\"display:none;\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"><img src=\"/Images/Images/Approval/ico_preview.gif\" alt=\"\" class=\"ico_btn\" />인쇄</strong></span></em></a></span>-->                        <!-- 인쇄 --><!--<span id=\"btPrint\" name=\"cbBTN\" onclick=\"doButtonAction(this);\" style=\"display:none;\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">인쇄</strong></span></em></a></span>-->                        <!-- 인쇄미리보기 --><!--<span id=\"btPrintView\" name=\"cbBTN\" onclick=\"doButtonAction(this);\" style=\"display:none ;\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">인쇄미리보기</strong></span></em></a></span>-->                        <!-- 의견보기 --><span id=\"li_btCommentView\" style=\"display: none;\"><span id=\"btCommentView\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">의견보기</strong></span></em></a></span></span>                        <!-- 닫기 --><span id=\"btExit\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">닫기</strong></span></em></a></span>                        <!-- 닫기(preview) --><!--<span id=\"btExitPreView\" onclick=\"top.close();\" style=\"display:none;\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">닫기</strong></span></em></a></span>-->                        <!-- 닫기(preview) --><span id=\"btExitPreView\" style=\"display: none;\" onclick=\"doButtonAction(this);\"><a href=\"javascript:void(0)\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">닫기</strong></span></em></a></span>                        <!-- 기타 --><span style=\"display: none;\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"></strong></span></em></a></span>                        <!-- 임시메모 --><span id=\"btnTempMemo\" style=\"display: none;\" onclick=\"tempMemo();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">임시메모</strong></span></em></a></span>                        <!-- 미니창 --><span id=\"btMinimize\" style=\"display: none;\" onclick=\"Minimize()\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">창 최소화</strong></span></em></a></span>                        <!-- //[2014-12-09 add] 보존년한 변경 --><span id=\"btPreserveDateUpdate\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">보존연한 만료일 변경</strong></span></em></a></span>                        <!-- 템플릿 저장 --><!--<span id=\"btAddTemplate\" onclick=\"doButtonAction(this);\" style=\"display:none;\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">템플릿 추가</strong></span></em></a></span>-->                        <!-- 템플릿 해제 --><!--<span id=\"btRemoveTemplate\" onclick=\"doButtonAction(this);\" style=\"display:none;\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">템플릿 해제</strong></span></em></a></span>-->                        <!-- 투자품의 RND --><span id=\"btAutoOnePopUp\" style=\"display: none;\" onclick=\"AutoOnePopUp(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">연구개발 투자목표</strong></span></em></a></span>                        <!-- 투자품의 집행품의 보기 --><span id=\"btInvestFromView\" style=\"display: none;\" onclick=\"InvestFormView_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"> 집행품의 조회</strong></span></em></a></span>                        <!-- 투자품의 수정품의 작성 --><span id=\"btEditForm\" style=\"display: none;\" onclick=\"EditForm_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"> 수정품의 작성</strong></span></em></a></span>                        <!-- 투자품의 완료보고서작성 --><span id=\"btFinishForm\" style=\"display: none;\" onclick=\"FinishForm_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"> 완료보고 작성</strong></span></em></a></span>                        <!-- 투자품의 완료보고 보기 --><span id=\"btFinishFormView\" style=\"display: none;\" onclick=\"FinishFormView_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"> 완료보고 조회</strong></span></em></a></span>                        <!-- 투자품의 수기결재용 인쇄 --><span id=\"btInvestPrint\" style=\"display: none;\" onclick=\"doButtonAction(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"> 보고서 출력</strong></span></em></a></span>                        <!-- 기아해외출장품의 - 출장비계산 --><span id=\"btn_CalcOverBizExpn\" style=\"display: none;\" onclick=\"fn_CalcExpn_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">출장비 계산</strong></span></em></a></span>                        <!-- 업무표준 - 개정 --><span id=\"btWorkFormRevision\" style=\"display: none;\" onclick=\"RevisionTempSave_Click();\" acesslogtype=\"Etc\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">개정</strong></span></em></a></span>                        <!-- 수주품의-프로젝트 코드 조회 --><span id=\"btnGeneralAes\" style=\"display: none;\" onclick=\"fn_GeneralAES_Click('0');\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">프로젝트 코드 조회</strong></span></em></a></span>                        <!-- 수주품의-수주품의 전결기준 --><span id=\"btn_GeneralAesGuide\" style=\"display: none;\" onclick=\"fn_GeneralAESGuide_Click('0');\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">수주품의 전결기준</strong></span></em></a></span>                        <!-- 수주품의-수정품의 --><span id=\"btnGeneralAesEditForm\" style=\"display: none;\" onclick=\"fnGeneralAesEditForm();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">수정품의</strong></span></em></a></span>                        <!-- 고정자산처분품의서 - 전결규정조회 --><span id=\"btnFixedAssetRuleInfo\" style=\"display: none;\" onclick=\"fn_FixedAssetRuleInfo_Click();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">전결규정조회</strong></span></em></a></span>                        <!-- 고정자산처분품의서 - 명세서수정 --><span id=\"btnDescriptEdit\" style=\"display: none;\" onclick=\"fn_DescriptEdit_Click();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">명세서수정</strong></span></em></a></span>                        <!-- 고정자산처분품의서 - 완료접수 --><span id=\"btnApproveReceipt\" style=\"display: none;\" onclick=\"fn_ApproveReceipt_Click();\" acesslogtype=\"Etc\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">완료접수</strong></span></em></a></span>                        <!-- 작성요령 및 Code 표 --><span id=\"btnWriteAndCodeTable\" style=\"display: none;\" onclick=\"fn_WriteAndCodeTable_Click();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">작성요령 및 Code 표</strong></span></em></a></span>                        <!-- 서식첨부 --><span id=\"btnFixedForm\" style=\"display: none;\" onclick=\"fn_FixForm_Click();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">서식첨부</strong></span></em></a></span>                        <!-- 교육집행품의 완료보고서작성 --><span id=\"btEducationFinishForm\" style=\"display: none;\" onclick=\"FinishEducationForm_Click();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"> 완료보고 작성</strong></span></em></a></span>                        <!-- 현대해외출장품의 기타비용작성 --><span id=\"btn_EtcOtherForm\" style=\"display: none;\" onclick=\"FinishForm_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"> 기타비용 작성</strong></span></em></a></span>                        <!-- 현대해외출장품의 기타비용보기 --><span id=\"btn_EtcOtherView\" style=\"display: none;\" onclick=\"OtherExpnView_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"> 기타비용 보기</strong></span></em></a></span>                        <!--업무표준-완료--><span id=\"btnWorkFormComplete\" style=\"display: none;\" onclick=\"requestProcess('WORKFORM_COMPT');\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">완료</strong></span></em></a></span>                        <!--업무표준-구본--><span id=\"btnWorkFormOldDoc\" style=\"display: none;\" onclick=\"requestProcess('WORKFORM_OLDDOC');\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">구본</strong></span></em></a></span>                        <!--업무표준-폐기--><span id=\"btnWorkFormDelDoc\" style=\"display: none;\" onclick=\"requestProcess('WORKFORM_DELDOC');\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">폐기</strong></span></em></a></span>                        <!--HAE ORCREPORT-전결규정조회--><span id=\"btnOrcRptApprRules\" style=\"display: none;\" onclick=\"fn_CheckApprovalRules();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">ORA 전결규정</strong></span></em></a></span>                        <!-- 글로비스 - 게시판에 등록 --><span id=\"boardformadd\" style=\"display: none;\" onclick=\"boardform('insert'); (this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"></strong></span></em></a></span>                        <!-- 글로비스 - 재무 평가 입력 --><span id=\"PriorApproval\" style=\"display: none;\" onclick=\"PriorApproval_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">재무 평가 입력</strong></span></em></a></span>                        <!-- 비앤지스틸 - 포탈 인사발령 게시판에 등록 --><span id=\"boardformadd_bngsteel\" style=\"display: none;\" onclick=\"boardform_bngsteel('insert'); (this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">lbl_bngsteel_hr_board_regist.</strong></span></em></a></span>                        <!-- 대면결재 --><span id=\"btMeetApproval\" style=\"display: none;\" onclick=\"doButtonAction(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\"> lbl_meetapproval.</strong></span></em></a></span>                        <!-- 양식 도움말 --><span id=\"btDocPopup\" style=\"display: none;\" onclick=\"helpOpen('popupbtn');\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">양식도움말</strong></span></em></a></span>                        <!-- 업무선택 (통합신청) 181210 --><span id=\"btnJobSelection\" style=\"display: none;\" onclick=\"JobSelection_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">업무선택</strong></span></em></a></span>                        <!-- 발송명변경(대외공문) 181226 --><span id=\"changing_shipping_name\" style=\"display: none;\" onclick=\"Changing_shipping_name_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">lbl_changing_shipping_name.</strong></span></em></a></span>                        <!-- 사용안내(대외공문) 190104 --><span id=\"using_inform\" style=\"display: none;\" onclick=\"using_inform_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">lbl_useinformation.</strong></span></em></a></span>                                  <!-- 글로비스 - 현대카드 신청서 --><span id=\"htabcLink\" style=\"display: none;\" onclick=\"RequestLink_Click(strLinkName);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_hyundaicard_application.</strong></span></em></a></span>                        <!-- 글로비스 - 처리완료 --><span id=\"htabcComplete\" style=\"display: none;\" onclick=\"Complete_Click();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_complete_processing.</strong></span></em></a></span>                        <!-- 리스 수정 품의 작성 --><span id=\"btnLeaseEditForm\" style=\"display: none;\" onclick=\"fn_LeaseEditForm_Click();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">리스수정품의 작성</strong></span></em></a></span>                        <!-- 통합신청서-관리번호 코드 조회 --><span id=\"btnGommonRqstAes\" style=\"display: none;\" onclick=\"fn_CommonRQSTAES_Click('0');\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">btn_apv_chkmanageno.</strong></span></em></a></span>                        <!-- 기아해외출장품의 전결권안내 --><span id=\"btnApprovalRule\" style=\"display: none;\" onclick=\"fn_infoPop2();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">전결권 안내</strong></span></em></a></span>                        <!-- 글로비스법인인감 프로세스메뉴얼 --><span id=\"btnProcessRuleDown\" style=\"display: none;\" onclick=\"Download_Info();\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--emphasis\"><strong class=\"txt_btn_ws\">프로세스메뉴얼</strong></span></em></a></span>                      </span>                </li>             </ul>        </div>        <div class=\"l-grouping s-icon-button\" style=\"top: 0px; right: 0px; float: right;\">            <div class=\"l-grouping__item\" id=\"divbtTranslateRead\">                <a title=\"\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btTranslateRead\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-word_search\"></i></a><!--기계번역-->            </div>            <div class=\"l-grouping__item\" id=\"divbtTranslateWrite\" style=\"display: none;\">                <a title=\"\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btTranslateWrite\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-word_search\"></i></a><!--기계번역-->            </div>            <div class=\"l-grouping__item\" id=\"divbtUrl\">                <a title=\"링크복사\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btUrl\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-link_copy\"></i></a><!--링크복사-->            </div>            <div class=\"l-grouping__item\" id=\"divbtScheduleAdd\">                <a title=\"일정추가\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btScheduleAdd\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-calender--mail\"></i></a><!--일정추가-->            </div>            <div class=\"l-grouping__item\" id=\"divbtWorkAdd\">                <a title=\"할일추가\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btWorkAdd\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-to_do--LNB\"></i></a><!--할일추가-->            </div>            <div class=\"l-grouping__item\" id=\"divbtMailSend\">                <a title=\"우편함으로\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btMailSend\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-mail--alarm\"></i></a><!--우편함으로-->            </div>            <div class=\"l-grouping__item\" id=\"divbtPrint\">                <a title=\"인쇄\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btPrint\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Print\"><i class=\"i-print\"></i></a><!--인쇄-->            </div>            <div class=\"l-grouping__item\" id=\"divbtPrintView\" style=\"display: none;\">                <a title=\"인쇄미리보기\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btPrintView\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\"><i class=\"i-print\"></i></a><!--인쇄미리보기-->            </div>            <div class=\"l-grouping__item\" id=\"divbtPreView\" style=\"display: none;\">                <a title=\"인쇄\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btPreView\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\"><i class=\"i-print\"></i></a><!--인쇄미리보기-->            </div>            <div class=\"l-grouping__item\" id=\"divbtPcSave\">                <a title=\"PC저장\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btPcSave\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-desktop\"></i></a><!--PC저장-->            </div>            <div class=\"l-grouping__item\" id=\"divbtAddTemplate\" style=\"display: none;\">                <a title=\"템플릿 추가\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btAddTemplate\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-file_plus\"></i></a><!--템플릿 추가-->            </div>            <div class=\"l-grouping__item\" id=\"divbtRemoveTemplate\" style=\"display: none;\">                <a title=\"템플릿 해제\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btRemoveTemplate\" onclick=\"doButtonAction(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-file_minus\"></i></a><!--템플릿 해제-->            </div>            <div class=\"l-grouping__item\" id=\"divbtFormNewWindow\" style=\"display: none;\">                <a title=\"새창으로 열기\" class=\"c-button c-button--textless c-button--textless-border\" id=\"btFormNewWindow\" onclick=\"PopNewWindowForm(this);\" href=\"javascript:void(0);\" acesslogtype=\"Common\"><i class=\"i-new_tab\"></i></a><!--새창으로보기-->            </div>        </div>    </div></div>                    <!-- 임시메모 -->                    <div id=\"divTempMemo\" style=\"display: none;\">                        <textarea id=\"sTempMemo\" style=\"width: 98%; font-size: 11pt; -ms-overflow-y: auto;\" onfocus=\"dragApp();\" rows=\"4\" cols=\"10\"></textarea>                        <input id=\"hidExamination\" type=\"hidden\">                    </div>                    <!-- 양식 파일 시작 -->                    <div class=\"approval_form\" id=\"bodytable\" style=\"padding-top: 60px;\">                        <div style=\"padding: 0px;\">                            <table width=\"100%\" class=\"table_10\" id=\"formlogo\" cellspacing=\"0\" cellpadding=\"0\" summary=\"로고\">                                <colgroup>                                    <col style=\"width: 25%;\">                                    <col style=\"width: 50%;\">                                    <col style=\"width: 25%;\">                                </colgroup>                                <tbody><tr>                                    <th id=\"TIT_DOC_NO\">문서번호</th>                                    <td align=\"center\" style=\"border-top-color: currentColor; border-bottom-color: currentColor; border-top-width: medium; border-bottom-width: medium; border-top-style: hidden; border-bottom-style: hidden;\" rowspan=\"2\">                                        <div class=\"draft_tit\">                                            <h5><span id=\"sloganname\" style=\"color: blue; font-size: 12px;\">신뢰경영ㆍ현장경영ㆍ투명경영</span></h5>                                            <h5><span id=\"headname\" style=\"font-size: 24px;\">협조전</span></h5>                                        </div>                                    </td>                                    <th>업무전결 규정 및<br>지출승인 규정에 의거<br>전결권자 표시</th> <!-- GetDic(\"lbl_apv_header\") 20181127 박한 양식 header 문구 회사별 설정 -->                                </tr>                                <tr>                                    <td style=\"text-align: center; font-weight: bold;\">                                        <input id=\"DOC_NO\" style=\"border: 0px currentColor; border-image: none; width: 100%; text-align: center; font-weight: bold;\" type=\"text\" readonly=\"readonly\" value=\"AAA0-20200728-045958\" data-binding=\"pre\" data-model=\"DOC_NO\" data-type=\"dField\">                                    </td>                                    <td style=\"text-align: center; font-weight: bold;\"><span id=\"APV_OWNER\">팀장</span></td>                                </tr>                            </tbody></table>                        </div>                        <div class=\"draft_tit\" id=\"headnameDIV\" style=\"display: none;\">                            <h5><span id=\"headname01\" style=\"font-size: 24px;\"></span></h5>                        </div>                        <div class=\"draft_page\" style=\"padding-top: 5px;\">                            <div id=\"editor\">                                <div id=\"bodytable_content\">                                    <!-- 결재선이 들어 올 곳 -->                                    <span id=\"ApvLineTemp\" style=\"text-align: right; color: red; font-weight: bold; float: right;\"></span><div class=\"populate_inform\" style=\"margin-top: 10px;\">    <input id=\"ApvLinePlusMinus\" style=\"display: none; cursor: pointer;\" type=\"button\" value=\"-\">    <span id=\"spApvLineDiplayTitle\" style=\"cursor: pointer;\"></span></div><table width=\"100%\" class=\"class_AppLine\" style=\"padding-top: 5px; border-top-color: currentColor; border-top-width: 0px; border-top-style: none;\" cellspacing=\"0\" cellpadding=\"0\">    <!-- 결재선 정보 시작-->    <!-- 일반결재/합의 -->    <tbody><tr>        <td width=\"100%\" style=\"padding: 0px;\">            <table width=\"100%\" height=\"100%\" bordercolorlight=\"gray\" bordercolordark=\"white\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">                <tbody><tr>                    <td width=\"100%\" align=\"right\" id=\"AppLine\">                        <table width=\"100%\" height=\"100%\" id=\"ApvLineType_C\" bordercolorlight=\"gray\" bordercolordark=\"white\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">                            <tbody><tr>                                <!-- 발신처 결재란 -->                                <td width=\"100%\" align=\"right\" id=\"LApvLine\"><table class=\"table_1\" style=\"width: 100%;\" cellspacing=\"0\" cellpadding=\"0\" summary=\"서명\"><tbody><tr><th class=\"tit\">발신</th></tr><tr><th width=\"86\">팀장</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th></tr><tr><td align=\"center\" valign=\"middle\">부장</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td></tr><tr><td class=\"la\"><span>팀*삼</span></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td></tr><tr><td align=\"center\" valign=\"middle\">2020-07-28</td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td></tr></tbody></table></td>                            </tr>                            <tr>                                <!-- 수신처 결재란 -->                                <td align=\"right\" id=\"RApvLine\" style=\"width: 70%;\"><table class=\"table_1\" style=\"width: 100%;\" cellspacing=\"0\" cellpadding=\"0\" summary=\"서명\"><tbody><tr><th class=\"tit\">수신</th></tr><tr><th width=\"86\">팀장</th><th width=\"86\">검토</th><th width=\"86\">검토</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th><th width=\"86\">&nbsp;</th></tr><tr><td align=\"center\" valign=\"middle\">부장</td><td align=\"center\" valign=\"middle\">과장</td><td align=\"center\" valign=\"middle\"></td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\">&nbsp;</td></tr><tr><td class=\"la\"><span>팀*삼</span></td><td class=\"la\"><span>팀*이</span></td><td class=\"la\"><span>&nbsp;</span></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td><td class=\"la\"><p class=\"grv_ellipsis_none\"><span>&nbsp;</span></p></td></tr><tr><td align=\"center\" valign=\"middle\">2020-07-28</td><td align=\"center\" valign=\"middle\">2020-07-28</td><td align=\"center\" valign=\"middle\">&nbsp;</td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td><td align=\"center\" valign=\"middle\"><span>&nbsp;</span></td></tr></tbody></table></td>                            </tr>                        </tbody></table>                        <table width=\"100%\" height=\"100%\" id=\"ApvLineType_R\" bordercolorlight=\"gray\" bordercolordark=\"white\" style=\"display: none;\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">                            <tbody><tr>                                <!-- 발신처 결재란 -->                                <td align=\"left\" id=\"LApvLine_R\" style=\"width: 30%; padding-top: 5px;\"></td>                                <!-- 수신처 결재란 -->                                <td align=\"right\" style=\"width: 70%; padding-top: 5px;\">                                <table>                                    <tbody><tr id=\"RApvLine_R\"></tr>                                </tbody></table>                                </td>                            </tr>                        </tbody></table>                        <table width=\"100%\" height=\"100%\" id=\"ApvLineType_HDEC\" bordercolorlight=\"gray\" bordercolordark=\"white\" style=\"display: none;\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">                            <colgroup>                                <col style=\"width: 44.44%;\">                                <col style=\"width: 11.11%;\">                                <col style=\"width: 44.44%;\">                            </colgroup>                            <tbody><tr>                                <!-- 발신처 결재란 -->                                <td align=\"right\" id=\"LApvLine_L1_HDEC\" colspan=\"3\"></td>                            </tr>                            <tr>                                <!-- 협조 결재란 -->                                <td align=\"right\" id=\"CApvLine_L1_HDEC\" colspan=\"3\"></td>                            </tr>                            <tr>                                <!-- 처리부서 결재란 -->                                <td align=\"right\" id=\"RApvLine1_L1_HDEC\" colspan=\"3\"></td>                            </tr>                            <tr>                                <!-- 협조부서 결재란 -->                                <td align=\"right\" id=\"RApvLine2_L1_HDEC\" colspan=\"3\"></td>                            </tr>                            <tr>                                <!-- 처리부서 결재란 -->                                <td align=\"left\" id=\"RApvLine1_D1_HDEC\" style=\"padding-top: 5px;\"></td>                                <td style=\"border: hidden currentColor; border-image: none;\"></td>                                <!-- 협조부서 결재란 -->                                <td align=\"right\" style=\"padding-top: 5px;\">                                    <table style=\"width: 100%;\">                                        <tbody><tr id=\"RApvLine2_D1_HDEC\"></tr>                                    </tbody></table>                                </td>                            </tr>                            <tr>                                <!-- 처리부서 결재란 -->                                <td align=\"left\" id=\"RApvLine1_D2_HDEC\" style=\"padding-top: 3px;\"></td>                                <td style=\"border: hidden currentColor; border-image: none;\"></td>                                <!-- 협조 결재란 -->                                <td align=\"right\" style=\"padding-top: 5px;\">                                    <table style=\"width: 100%;\">                                        <tbody><tr id=\"CApvLine_D1_HDEC\"></tr>                                    </tbody></table>                                </td>                            </tr>                            <tr>                                <!-- 협조 결재란 -->                                <td align=\"right\" id=\"CApvLine_L2_HDEC\" colspan=\"3\"></td>                            </tr>                        </tbody></table>                        <table width=\"100%\" height=\"100%\" id=\"ApvLineType_HEC\" bordercolorlight=\"gray\" bordercolordark=\"white\" style=\"display: none;\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">                            <tbody><tr>                                <!-- 발신처 결재란 -->                                <td width=\"100%\" align=\"right\" id=\"LApvLine_L1_HEC\"></td>                            </tr>                            <tr>                                <!-- 협조 결재란 -->                                <td align=\"right\" id=\"CApvLine_L1_HEC\" style=\"width: 70%;\"></td>                            </tr>                            <tr>                                <!-- 수신부서(1차) 결재란 -->                                <td width=\"100%\" align=\"right\" id=\"RApvLine1_L1_HEC\"></td>                            </tr>                            <tr>                                <!-- 협조 결재란 -->                                <td align=\"right\" id=\"CApvLine_L2_HEC\" style=\"width: 70%;\"></td>                            </tr>                            <tr>                                <!-- 수신부서(2차) 결재란 -->                                <td width=\"100%\" align=\"right\" id=\"RApvLine2_L1_HEC\"></td>                            </tr>                            <tr>                                <!-- 협조 결재란 -->                                <td align=\"right\" id=\"CApvLine_L3_HEC\" style=\"width: 70%;\"></td>                            </tr>                        </tbody></table>                    </td>                </tr>                <tr>                    <!-- 리스트형 결재선 표시 -->                    <td width=\"100%\" align=\"left\" id=\"AppLineListType\"></td>                </tr>            </tbody></table>        </td>    </tr>    <tr>        <td align=\"right\" id=\"AssistLine\" style=\"width: 100%;\"></td>    </tr>    <!-- 결재선 정보 종료--></tbody></table>                                    <!-- common fields template 들어 올 곳 -->                                    <!-- Form.aspx 상단 부분 옮긴 것 formmenu --><div id=\"dvTmp\"></div><textarea id=\"APVLIST\" style=\"display: none;\" data-binding=\"pre\" data-type=\"field\">&lt;steps initiatorcode=\"TEST113\" initiatoroucode=\"AAA0\" status=\"active\"&gt;&lt;division name=\"발신\" divisiontype=\"send\" oucode=\"AAA0\" ouname=\"ko-KR;테스트팀;Test team\" parentapprovalorder=\"\" approvalgrouporder=\"0\"&gt;&lt;taskinfo kind=\"send\" result=\"pending\" status=\"pending\" datereceived=\"2020-07-28 04:59:58\" /&gt;&lt;step name=\"기안자\" unittype=\"person\" routetype=\"approve\" approvalorder=\"100\" language=\"ko-KR\" processinstanceid=\"521812\" approverat=\"N\" beforeapprovalat=\"\"&gt;&lt;ou code=\"AAA0\" name=\"ko-KR;테스트팀;Test team\" companycode=\"H101\" companyname=\"ko-KR;현대자동차;HMC\" originidccode=\"KRHQ001\"&gt;&lt;person code=\"TEST113\" name=\"ko-KR;팀*삼;T*ST113_20180518\" oucode=\"AAA0\" ouname=\"ko-KR;테스트팀;Test team\" position=\"22\" positionname=\"ko-KR;부장;General Manager\" dutycode=\"80\" dutyname=\"ko-KR;팀장;Team Manager\" batchAt=\"\" is_fixed=\"\" is_hidden=\"\" delegationAt=\"\" documentstepcode=\"\" title=\"\" level=\"\"&gt;&lt;taskinfo status=\"completed\" result=\"completed\" kind=\"charge\" datereceived=\"2020-07-28 04:59:58\" datecompleted=\"2020-07-28 04:59:58\" customattribute1=\"\" wiid=\"\" /&gt;&lt;/person&gt;&lt;/ou&gt;&lt;/step&gt;&lt;/division&gt;&lt;division name=\"수신\" divisiontype=\"receive\" oucode=\"AAA0\" ouname=\"ko-KR;테스트팀;Test team\" parentapprovalorder=\"\" approvalgrouporder=\"0\"&gt;&lt;taskinfo kind=\"receive\" result=\"pending\" status=\"pending\" datereceived=\"2020-07-28 04:59:59\" /&gt;&lt;step name=\"\" unittype=\"person\" routetype=\"assist\" approvalorder=\"100\" language=\"ko-KR\" processinstanceid=\"521813\" approverat=\"N\" beforeapprovalat=\"\"&gt;&lt;ou code=\"AAA0\" name=\"ko-KR;테스트팀;Test team\" companycode=\"H101\" companyname=\"ko-KR;현대자동차;HMC\" originidccode=\"KRHQ001\"&gt;&lt;person code=\"TEST113\" name=\"ko-KR;팀*삼;T*ST113_20180518\" oucode=\"AAA0\" ouname=\"ko-KR;테스트팀;Test team\" position=\"22\" positionname=\"ko-KR;부장;General Manager\" dutycode=\"80\" dutyname=\"ko-KR;팀장;Team Manager\" batchAt=\"N\" is_fixed=\"\" is_hidden=\"\" delegationAt=\"\" documentstepcode=\"COOPERATION_REQUEST\" title=\"\" level=\"\"&gt;&lt;taskinfo status=\"completed\" result=\"completed\" kind=\"charge\" datereceived=\"2020-07-28 04:59:59\" datecompleted=\"2020-07-28 05:00:46\" customattribute1=\"\" wiid=\"\"&gt;&lt;comment typecode=\"OPINION\" fileurl=\"\" datecommented=\"2020-07-28 05:00:46\"&gt;테스트 마니 필요합니다&lt;/comment&gt;&lt;/taskinfo&gt;&lt;/person&gt;&lt;/ou&gt;&lt;/step&gt;&lt;step name=\"normal\" unittype=\"person\" routetype=\"charge\" approvalorder=\"200\" language=\"ko-KR\" processinstanceid=\"521813\" approverat=\"N\" beforeapprovalat=\"\"&gt;&lt;ou code=\"AAA0\" name=\"ko-KR;테스트팀;Test team\" companycode=\"H101\" companyname=\"ko-KR;현대자동차;HMC\" originidccode=\"KRHQ001\"&gt;&lt;person code=\"TEST112\" name=\"ko-KR;팀*이;T*am One IL\" oucode=\"AAA0\" ouname=\"ko-KR;테스트팀;Test team\" position=\"26\" positionname=\"ko-KR;과장;Manager\" dutycode=\"26\" dutyname=\"ko-KR;;\" batchAt=\"\" is_fixed=\"\" is_hidden=\"\" delegationAt=\"\" documentstepcode=\"\" title=\"\" level=\"\"&gt;&lt;taskinfo status=\"completed\" result=\"completed\" kind=\"normal\" datereceived=\"2020-07-28 05:00:46\" datecompleted=\"2020-07-28 07:56:58\" customattribute1=\"\" wiid=\"\"&gt;&lt;comment typecode=\"OPINION\" fileurl=\"\" datecommented=\"2020-07-28 07:56:58\"&gt;ㅎ히&lt;/comment&gt;&lt;/taskinfo&gt;&lt;/person&gt;&lt;/ou&gt;&lt;/step&gt;&lt;step name=\"normal\" unittype=\"person\" routetype=\"charge\" approvalorder=\"300\" language=\"ko-KR\" processinstanceid=\"521813\" approverat=\"Y\" beforeapprovalat=\"\"&gt;&lt;ou code=\"AAA0\" name=\"ko-KR;테스트팀;Test team\" companycode=\"H101\" companyname=\"ko-KR;현대자동차;HMC\" originidccode=\"KRHQ001\"&gt;&lt;person code=\"TEST111\" name=\"ko-KR;팀*일;T*am One IL\" oucode=\"AAA0\" ouname=\"ko-KR;테스트팀;Test team\" position=\"28\" positionname=\"ko-KR;대리;Assistant Manager\" dutycode=\"\" dutyname=\"\" batchAt=\"\" is_fixed=\"\" is_hidden=\"\" delegationAt=\"\" documentstepcode=\"\" title=\"\" level=\"\"&gt;&lt;taskinfo status=\"pending\" result=\"pending\" kind=\"normal\" datereceived=\"2020-07-28 07:56:58\" datecompleted=\"\" customattribute1=\"\" wiid=\"\" /&gt;&lt;/person&gt;&lt;/ou&gt;&lt;/step&gt;&lt;/division&gt;&lt;/steps&gt;</textarea><input id=\"PASSWORD\" type=\"hidden\" value=\"\" data-type=\"field\"><input id=\"ACTIONINDEX\" type=\"hidden\" value=\"\" data-type=\"field\"><input id=\"ACTIONCOMMENT\" type=\"hidden\" value=\"\" data-type=\"field\"><input id=\"PARENTPROCESSINSTANCEID\" type=\"hidden\" value=\"\" data-type=\"field\">  <!--parent_process_id--><input id=\"APPROVALPARTICIPANTLIST\" type=\"hidden\" value=\"\" data-type=\"field\"> <!--현황받는사람--><input id=\"APPROVALINFO\" type=\"hidden\" value=\"\" data-type=\"field\">            <!--기안자;fmpf;subject;fiid--><input id=\"ALRAM_KIND\" type=\"hidden\" value=\"\" data-type=\"field\"><input id=\"ACTIONCOMMENT_FILE_INFO\" type=\"hidden\" value=\"\" data-type=\"field\"><input id=\"SIGNIMAGETYPE\" type=\"hidden\" value=\"\" data-type=\"field\"><textarea id=\"RecDeptList\" style=\"display: none;\"></textarea><input id=\"bLASTAPPROVER\" type=\"hidden\" value=\"false\" data-type=\"field\"><input id=\"CHARGEID\" type=\"hidden\" value=\"false\" data-type=\"field\"><!--담당자 지정관련--><input id=\"CHARGENAME\" type=\"hidden\" value=\"false\" data-type=\"field\"><!--담당자 지정관련--><input id=\"CHARGEOUID\" type=\"hidden\" value=\"false\" data-type=\"field\"><!--담당자 지정관련--><input id=\"CHANGEREVIEWXML\" type=\"hidden\" value=\"false\" data-type=\"field\"><!--담당자 지정관련--><textarea id=\"BodyString\" style=\"display: none;\"></textarea><div id=\"dellink\"></div><!-- COMMON FIELDS --><input id=\"INITIATOR_NAME\" type=\"hidden\" value=\"ko-KR;팀*삼;T*ST113_20180518\" data-binding=\"post\" data-model=\"INITIATOR_NAME\" data-type=\"dField\"><input id=\"INITIATOR_ID\" type=\"hidden\" value=\"TEST113\" data-binding=\"post\" data-model=\"INITIATOR_ID\" data-type=\"dField\"><input id=\"INITIATOR_OU_NAME\" type=\"hidden\" value=\"ko-KR;테스트팀;Test team\" data-binding=\"post\" data-model=\"INITIATOR_OU_NAME\" data-type=\"dField\"><input id=\"INITIATOR_OU_ID\" type=\"hidden\" value=\"AAA0\" data-binding=\"post\" data-model=\"INITIATOR_OU_ID\" data-type=\"dField\"><input id=\"LAST_MODIFIER_ID\" type=\"hidden\" data-binding=\"post\" data-type=\"cField\"><input id=\"attach\" type=\"hidden\" data-binding=\"post\" data-type=\"cField\"><input id=\"filelocation\" type=\"hidden\" value=\"/FrontStorage/Approval/\" data-binding=\"post\" data-model=\"fmfl\" data-type=\"cField\"><input id=\"ATTACH_FILE\" type=\"hidden\" value=\"\" data-binding=\"post\" data-type=\"cField\"><input id=\"ATTACH_FILE_INFO\" type=\"hidden\" value=\"\" data-binding=\"post\" data-model=\"ATTACH_FILE_INFO\" data-type=\"dField\"><input id=\"INITIATOR_INFO\" type=\"hidden\" value=\"ko-KR;팀*삼;T*ST113_20180518\" data-binding=\"post\" data-model=\"INITIATOR_INFO\" data-type=\"dField\"><input id=\"APPLIED\" type=\"hidden\" value=\"2020-07-28\" data-binding=\"post\" data-model=\"APPLIED\" data-type=\"dField\"><input id=\"ISPUBLIC\" type=\"hidden\" value=\"False\" data-binding=\"post\" data-model=\"ISPUBLIC\" data-type=\"dField\"><input id=\"APPLIED_TERM\" type=\"hidden\" value=\"\" data-binding=\"post\" data-model=\"APPLIED_TERM\" data-type=\"dField\"><!--<input type=\"hidden\" data-type=\"dField\" id=\"RECEIVE_NO\" data-model=\"RECEIVE_NO\" data-binding=\"post\" />--><!--<input type=\"hidden\" data-type=\"dField\" id=\"RECEIVE_NAMES\" data-model=\"RECEIVE_NAMES\" data-binding=\"post\" /><input type=\"hidden\" data-type=\"dField\" id=\"RECEIPT_LIST\" data-model=\"RECEIPT_LIST\" data-binding=\"post\" />--><input id=\"DOC_CLASS_ID\" type=\"hidden\" value=\"\" data-binding=\"post\" data-model=\"DOC_CLASS_ID\" data-type=\"dField\"><input id=\"ENT_CODE\" type=\"hidden\" value=\"H101\" data-binding=\"post\" data-model=\"ENT_CODE\" data-type=\"dField\"><input id=\"ENT_NAME\" type=\"hidden\" value=\"ko-KR;현대자동차;HMC\" data-binding=\"post\" data-model=\"ENT_NAME\" data-type=\"dField\"><input id=\"DOC_LEVEL_NAME\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><input id=\"INITIATOR_CODE_DP\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><input id=\"INITIATOR_DATE_INFO\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><!--<input type=\"hidden\" data-type=\"dField\" id=\"DOC_LEVEL\" value=\"00\" data-binding=\"pre\" /><input type=\"hidden\" data-type=\"dField\" id=\"SAVE_TERM\" value=\"00003\" data-binding=\"pre\" /><input type=\"hidden\" data-type=\"dField\" id=\"EXPIRE_DATE\" data-binding=\"pre\" value=\"2020-10-28\" /><input type=\"hidden\" data-type=\"dField\" id=\"BOOKING_APPROVAL_YN\" data-binding=\"post\" value=\" \" /><input type=\"hidden\" data-type=\"dField\" id=\"BOOKING_APPROVAL_DATE\" data-binding=\"post\" value=\"\" />--><input id=\"DOC_LEVEL\" type=\"hidden\" value=\"00\" data-binding=\"post\" data-model=\"DOC_LEVEL\" data-type=\"dField\"><input id=\"SAVE_TERM\" type=\"hidden\" value=\"00003\" data-binding=\"post\" data-model=\"SAVE_TERM\" data-type=\"dField\"><input class=\"date-convert\" id=\"EXPIRE_DATE\" type=\"hidden\" value=\"2020-10-28\" data-binding=\"post\" data-model=\"EXPIRE_DATE\" data-type=\"dField\"><input id=\"BOOKING_APPROVAL_YN\" type=\"hidden\" value=\" \" data-binding=\"post\" data-model=\"BOOKING_APPROVAL_YN\" data-type=\"dField\"><input id=\"BOOKING_APPROVAL_DATE\" type=\"hidden\" value=\"\" data-binding=\"post\" data-model=\"BOOKING_APPROVAL_DATE\" data-type=\"dField\"><!-- 협조처 --><input id=\"CONSULT_LIST\" type=\"hidden\" value=\"KRHQ001:H101:T:AAA0::43:N:ko-KR;테스트팀;Test team:ko-KR;현대기아차;HKMC:ko-KR;팀;|\" data-binding=\"post\" data-model=\"CONSULT_LIST\" data-type=\"dField\"><input id=\"CONSULT_DRM_YN\" type=\"hidden\" value=\"N\" data-binding=\"pre\" data-model=\"CONSULT_DRM_YN\" data-type=\"mField\"><!--기안시 협조처 개수(DRM 적용시 사용)--><!-- 예약결재 시 이용될 참조처  --><input id=\"REFERENCE_DISPLAY_INFO\" type=\"hidden\" value=\"\" data-binding=\"post\" data-model=\"REFERENCE_DISPLAY_INFO\" data-type=\"dField\"><!--2015.09.11 B.K. 기간계 연동 추가--><!--<input type=\"hidden\" data-type=\"mField\" id=\"mKey\" value=\"\" data-binding=\"pre\" /><input type=\"hidden\" data-type=\"mField\" id=\"mSubject\" value=\"\" data-binding=\"pre\" /><input type=\"hidden\" data-type=\"mField\" id=\"mLegacy_form\" value=\"\" data-binding=\"pre\" /><input type=\"hidden\" data-type=\"mField\" id=\"mAttachfile\" value=\"\" data-binding=\"pre\" />--><textarea id=\"DOC_SUMMARY\" style=\"display: none;\" data-binding=\"post\" data-model=\"DOC_SUMMARY\" data-type=\"dField\"></textarea><textarea id=\"dhtml_body\" style=\"display: none;\"></textarea><textarea id=\"xsl\" style=\"display: none;\" data-binding=\"post\" data-type=\"cField\"></textarea><input id=\"CONSULT_EXLIST\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><!--삭제되면 안되는 협조처 정보 바인딩--><!--결재방 명칭--><input id=\"SEND_TITLE\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><input id=\"RECEIVE_TITLE\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><input id=\"RECEIVE_TITLE2\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><input id=\"APPROVAL_TITLE_YN\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><!-- 문서link 2006.01 --><textarea id=\"DOCLINKS\" style=\"display: none;\" data-binding=\"post\" data-model=\"DOCLINKS\" data-type=\"dField\"></textarea><!-- 결재선 관리 UI 변경 2008.01 --><!-- 중복, 용도 불분명으로 일단 주석 처리 --><!--<textarea style=\"display:none;\" data-type=\"cField\" id=\"APVLIST\"></textarea>--><!-- 결재선 관리 UI 변경 끝 2008.01 --><!-- process 메뉴얼 추가 2008.01 --><!--<textarea data-type=\"mField\" id=\"PMLINKS\" value=\"\" data-binding=\"pre\" style=\"display:none\"></textarea>--><!-- process 메뉴얼 추가 2008.01 --><!-- 반송문서 추가 시작 2007.11--><!--<textarea data-type=\"mField\" id=\"REJECTDOCLINKS\" value=\"\" data-binding=\"pre\" style=\"display:none\"></textarea>--><!-- 반송문서 추가 끝 2007.11--><!-- 사업장 임시적용 시작 2007.11--><!--<textarea data-type=\"mField\" id=\"SEL_ENTPART\" value=\"\" data-binding=\"pre\" style=\"display:none\"></textarea>--><!-- 사업장 임시적용 끝 2007.11--><!--<input type=\"hidden\" id=\"hdnEditorContent\" /> HIW--><!--<input type=\"hidden\" id=\"hidRecDocFolderKind\" /> 기록물철 SAP양식여부 (2013-10-14 HIW)--><!--<input type=\"hidden\" id=\"hidRecDocFolderID\" /> 기록물철 분류폴더ID (2013-10-14 HIW)--><input id=\"hidChkReceiverAutomaticSendMail\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"> <!--수신처 전 직원 메일 발송--><!-- 20200629 hpark 자동결재라인,연동시스템 결재선 병합 --><input id=\"m_MergeApvline0\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><input id=\"m_MergeApvline1\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><input id=\"m_MergeApvline2\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><!-- 통합결재/레거시양식 유무(기본결재선 필수결재자 체크 및 병합조건에서 예외처리) --><input id=\"m_is_IWF_Legacy\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\">                                    <!-- 양식 상단 부분 들어 올 곳 -->                                    <div id=\"trHelpApproval\" style=\"display: none;\">    <table class=\"table_10\" cellspacing=\"0\" cellpadding=\"0\" summary=\"참고사항\">        <colgroup>            <col style=\"width: 100%;\">        </colgroup>        <tbody><tr>            <td class=\"table_5_td\" id=\"HelpApproval\"></td>        </tr>    </tbody></table></div><div class=\"populate_inform\" style=\"margin-top: 10px;\">    <input id=\"PlusMinus\" style=\"cursor: pointer;\" type=\"button\" value=\"+\">    <span id=\"spDiplayTitle\" style=\"cursor: pointer;\">문서정보 상세정보[발신: 테스트팀]</span></div><div id=\"divDiplayCooperation\" style=\"margin-top: 10px; display: none;\">    <table class=\"table_10\">        <colgroup>            <col style=\"width: 10%;\">            <col style=\"width: 40%;\">            <col style=\"width: 10%;\">            <col style=\"width: 40%;\">        </colgroup>        <tbody><tr>            <!--담당자(기안자)-->            <th>담당자</th>            <td style=\"text-align: left;\">                <span id=\"INITIATOR_DP\" style=\"border: 0px currentColor; border-image: none; width: 100%;\" readonly=\"readonly\" data-binding=\"pre\" data-type=\"mField\">팀*삼 부장</span>            </td>            <!--전화번호-->            <th>전화번호</th>            <td>                <span id=\"TELEPHONE\" style=\"width: 200px;\" data-binding=\"post\" data-model=\"TELEPHONE\" data-type=\"dField\">+82---</span>            </td>        </tr>        <tr>            <!-- 발신 -->            <th>발신</th>            <td style=\"text-align: left;\">                <span id=\"INITIATOR_OU_DP\" style=\"width: 200px;\" data-binding=\"pre\" data-type=\"mField\">테스트팀</span>            </td>            <!-- 발신일 -->            <th>발신일</th>            <td style=\"text-align: left;\">                <input class=\"date-convert\" id=\"Completed_DATE\" style=\"border: 0px currentColor; border-image: none; width: 100%;\" type=\"text\" readonly=\"readonly\" data-binding=\"pre\" data-type=\"mField\">            </td>        </tr>        <tr>            <!--보안등급-->            <th id=\"TIT_DOC_LEVEL\">보안등급</th>            <td style=\"text-align: left;\">                <span id=\"DOCLEVEL\">사내한</span>&nbsp;            </td>            <!--보존년한-->            <th id=\"TIT_SAVE_TERM\">보존연한</th>            <td style=\"text-align: left;\">                <span id=\"SAVETERM\">3개월</span>&nbsp;                <div class=\"div_apv_caltext\" id=\"divEXPIREDATE\" style=\"width: 200px; display: none;\">                    <input class=\"date-convert\" id=\"EXPIREDATE\" style=\"vertical-align: middle; display: none;\" type=\"text\" data-type=\"mField\" data-element-mode=\"modify\" displayday=\"false\" dateformat=\"\">                    <div class=\"img_apv_cal\">                        <img id=\"EXPIRE_DATE_IMG\" style=\"padding-left: 3px; display: none;\" onclick=\"CFN_ImgCalendarBtnClick('EXPIREDATE')\" alt=\"Cal\" src=\"/Images/Images/Controls/TextBox/ico_cal.gif\" data-element-mode=\"modify\" data-mode=\"writeOnly\">                    </div>                </div>            </td>        </tr>    </tbody></table>    <table class=\"table_10\" style=\"margin-top: 10px;\">        <colgroup>            <col style=\"width: 10%;\">            <col style=\"width: 30%;\">            <col style=\"width: 10%;\">            <col style=\"width: 20%;\">            <col style=\"width: 10%;\">            <col style=\"width: 20%;\">        </colgroup>        <tbody><tr>            <!-- 협조처 -->            <th>협조처</th>            <td style=\"vertical-align: middle;\">                협조처 참조                <button class=\"c-button c-button--little\" id=\"btReceiptView\" onclick=\"fn_ConsultView();\" type=\"button\">▶</button>                <!--<span id=\"btReceiptView\" name=\"cbBTN\" onclick=\"fn_ConsultView();\" style=\"vertical-align:middle;height:15px;\">                    <a href=\"javascript:void(0);\" id=\"li_btReceiptView\">                        <em class=\"btn_ws_l\" style=\"height:0px; margin:0px;\">                            <span class=\"btn_ws_r\" style=\"height:15px; line-height:10px;\">                                <strong class=\"txt_btn_ws\">▶</strong>                            </span>                        </em>                    </a>                </span>-->            </td>            <!-- 참조 -->            <th>참조처</th>            <td style=\"vertical-align: middle;\">                <!--<span id=\"SendCC\"></span>-->                참조처 참조                <button class=\"c-button c-button--little\" id=\"btCCInfoView\" onclick=\"fn_ReferenceView();\" type=\"button\">▶</button>                <!--<span id=\"btReceiptView\" name=\"cbBTN\" onclick=\"fn_ReferenceView();\" style=\"vertical-align:middle;height:15px;float:right;\">                    <a href=\"javascript:void(0);\" id=\"li_btReceiptView\">                        <em class=\"btn_ws_l\" style=\"height:0px; margin:0px;\">                            <span class=\"btn_ws_r\" style=\"height:15px; line-height:10px;\">                                <strong class=\"txt_btn_ws\">▶</strong>                            </span>                        </em>                    </a>                </span>-->            </td>            <!-- 수신일 -->            <th>수신일</th>            <td colspan=\"3\">                <input class=\"date-convert\" id=\"ReceiveDate\" style=\"border: 0px currentColor; border-image: none; width: 100%;\" type=\"text\" readonly=\"readonly\" data-type=\"mField\">            </td>        </tr>        <!--품의서류 협조처-->    </tbody></table></div><input class=\"date-convert\" id=\"INITIATED_DATE\" type=\"hidden\" value=\"2020-07-28\" data-binding=\"pre\" data-model=\"INITIATED_DATE\" data-type=\"dField\">                                    <!-- 양식 template 들어 올 곳 -->                                    <table class=\"table_10\" style=\"margin-top: 10px;\">    <colgroup>        <col style=\"width: 10%;\">        <col style=\"width: 90%;\">    </colgroup>    <tbody><tr id=\"tblFormSubject\">        <th id=\"TIT_SUBJECT\">제&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;목</th>        <td class=\"td_subject\"><span title=\"제&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;목\" id=\"SUBJECT\" style=\"width: 99%; height: 20px;\" data-binding=\"pre\" data-model=\"SUBJECT\" data-type=\"dField\" maxlength=\"400\" required=\"Required\">0728 마지막 _ 개발할게 많은데 크닐낫눼</span></td>    </tr></tbody></table><input id=\"ConferenceID\" type=\"hidden\" value=\"\" data-binding=\"pre\" data-type=\"mField\"><table style=\"width: 100%;\" cellspacing=\"0\" cellpadding=\"0\">    <colgroup style=\"width: 100%;\"></colgroup>    <tbody><tr>        <td class=\"td_ApvLineInfo\" style=\"float: right;\"><span id=\"ApvLinePulicObject\" style=\"margin: 5px 0px; text-align: right; color: blue; font-size: 14px; font-weight: bold; float: left;\"><span style=\"cursor: pointer;\" onclick=\"fn_PublicObjectType();\">&lt;공시 미대상&gt;</span></span>            <!--문서보안-->            <span id=\"ApvLineDOCLEVEL\" style=\"margin: 5px 0px; text-align: right; color: red; font-weight: bold; float: left;\"></span>            <!--별도보고-->            <span id=\"ApvLineTemp_special\" style=\"margin: 5px 0px; text-align: right; color: red; font-weight: bold; float: left;\"></span>            <!--일반의견-->            <span id=\"ApvLineTemp_comment\" style=\"margin: 5px 0px; text-align: right; color: red; font-weight: bold; float: left;\"></span>            <!--지시의견-->            <span id=\"ApvLineTemp_exa_comment\" style=\"margin: 5px 0px; text-align: right; color: red; font-weight: bold; float: left;\"><span style=\"color: red; font-weight: bold; cursor: pointer;\" onclick=\"btCommentOpinion(this);\">&lt;지시의견&gt;</span></span>            <!--첨부파일있음-->            <span id=\"ApvLineAttach\" style=\"margin: 5px 0px; text-align: right; color: red; font-weight: bold; float: left;\"></span>            <!--문서첨부-->            <span id=\"ApvLineDOCLINKS\" style=\"margin: 5px 0px; text-align: right; color: red; font-weight: bold; float: left;\"></span>            <!--예약결재 여부-->            <span id=\"ApvLineTemp_booking\" style=\"margin: 5px 0px; text-align: right; color: red; font-weight: bold; float: left;\"></span>        </td>    </tr></tbody></table><!-- 에디터 시작 --><div style=\"border: 1px solid rgb(221, 221, 221); border-image: none; vertical-align: text-top;\">    <table class=\"table_form_info_draft\" style=\"margin: 11px; border: hidden currentColor; border-image: none; width: 100%; table-layout: fixed; -ms-word-wrap: break-word; min-height: 150px;\" cellspacing=\"0\" cellpadding=\"0\" summary=\"내용\">    <tbody><tr>        <td width=\"100%\" height=\"100%\" id=\"tbContentElement\" valign=\"top\" style=\"padding: 0px 22px 0px 0px;\"><p style=\"line-height: 1.5; font-family: 현대산스 Text; font-size: 12pt; margin-top: 0px; margin-bottom: 0px;\">0728 마지막 _ 개발할게 많은데 크닐낫눼<br></p></td>    </tr></tbody></table></div><!-- 에디터 종료 -->                                </div>                            </div>                        </div>                        <!-- 첨부 부분이 들어 올 곳 -->                        <!-- 첨부파일 시작 작성페이지의 경우 첨부파일 Upload UX 조회페이지 다운로드UX 표시 -->    <div class=\"l-file\" id=\"DivFileAttachCtrl\" style=\"margin-top: 20px; display: none;\">        <div class=\"l-file__head\">            <div class=\"l-file__title\">첨부목록</div>            <div class=\"l-file__functions\">                <div class=\"btnattachadd l-file__function-item\" id=\"divAttachadd\" onclick=\"javascript:AddFile(); fileListChk();\">                    <a class=\"c-button c-button--small\"><i class=\"i-add_file\"></i> 추가</a>                </div>                <div class=\"btnattachdel l-file__function-item\" id=\"divAttachdel\" onclick=\"javascript:DeleteFile(); clearDeleteFront(); fileListChk();\">                    <a class=\"c-button c-button--small\"><i class=\"i-trash\"></i>삭제</a>                </div>                <div class=\"btnattachOpen l-file__function-item\" id=\"divAttachOpen\" style=\"display: none;\" onclick=\"javascript:OpenSelectedFile();\">                    <a class=\"c-button c-button--small\"><i class=\"i-open_file\"></i>열기</a>                </div>                <div class=\"btnattachdown l-file__function-item\" id=\"divAttachDown\" style=\"display: none;\" onclick=\"javascript:SelectFileDownLoad('', event);\">                    <a class=\"c-button c-button--small\"><i class=\"i-download\"></i>저장</a>                </div>                <!-- 로템 자료공유시스템 버튼 S 181227 beokim -->                <div class=\"btnattachadd l-file__function-item\" id=\"divShareAttachAdd\" style=\"display: none;\" onclick=\"javascript: AddFileRotem(); fileListChk();\">                    <a class=\"c-button c-button--small\"><i class=\"i-add_file\"></i>btn_add_sharefile.</a> <!-- 자료공유파일 추가 -->                </div>                <div class=\"btnattachdown l-file__function-item\" id=\"divShareAttachSave\" style=\"display: none;\" onclick=\"javascript: UploadFileRotem();\">                    <a class=\"c-button c-button--small\"><i class=\"i-download\"></i>btn_save_sharefile.</a> <!-- 자료공유파일 저장 -->                </div>                <!-- 로템 자료공유시스템 버튼 E 181227 beokim -->            </div>                <div class=\"l-file__caption\" id=\"f_ck_sp\"></div>                                             </div>        <div class=\"l-file__body\">            <!-- 컨트롤이 들어갈 영역 / img로 대체 -->            <!-- 파일 컨트롤 타입 설정 : 0.None, 1.DEXTUploadX, 2.CoviFileTrans, 3.CoviSilverlightTrans, 4.CoviUploadNSlvTrans, 5.HTML 5 -->            <div id=\"divFileControlContainer\"></div>        </div>    </div><!-- [2014-07-08 박한 add] 디자인팀 요청사항 --><div class=\"form_footer\" id=\"form_footer\"></div>                        <!-- 양식 하단 부분이 들어 올 곳 -->                        <table class=\"table_10\" id=\"tbLinkInfo\" style=\"margin-top: 10px; display: none;\" cellspacing=\"0\" cellpadding=\"0\" summary=\"참조\">    <tbody><tr id=\"trAttFileInfoAdd\" style=\"display: none;\">        <th class=\"table_5_th\">추가파일</th>        <td class=\"table_5_td\" id=\"AttFileInfoAdd\"></td>    </tr>    <tr id=\"trAttFileInfo\" style=\"display: none;\">        <!--코비전 컴포넌트 다운로드 파일 임시 none 2017.05.17, 양유빈-->        <th class=\"table_5_th\" id=\"TIT_ATTFILEINFO\" style=\"width: 88px;\">첨부파일</th>        <td class=\"table_5_td\" id=\"AttFileInfo\"></td>    </tr>    <tr id=\"trDocLinkInfo\" style=\"display: none;\">        <th class=\"table_5_th\" id=\"TIT_DOCLINKINFO\" style=\"width: 88px;\">결재문서<br>첨부목록</th>        <td class=\"table_5_td\" id=\"DocLinkInfo\" style=\"padding: 10px 5px; border: 0px currentColor; border-image: none;\"></td>    </tr>       <!--<tr id=\"trDOCNO\" style=\"display:none;\">        <th id=\"TIT_DOC_NO\"class=\"table_5_th\" style=\"width:88px;\">문서번호</th>        <td  class=\"table_5_td\" >            <input type=\"text\" data-type=\"dField\" id=\"DOC_NO\" value=\"AAA0-20200728-045958\" data-model=\"DOC_NO\" data-binding=\"pre\" style=\"width:100%; border:0px;\" readonly=\"readonly\" />        </td>    </tr>--></tbody></table>    <!--의견입력-->    <span id=\"CommentList\" data-mode=\"readOnly\"></span>    <!--의견입력끝-->    <!--write_의견입력-->    <table align=\"center\" style=\"width: 100%;\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">        <tbody>            <tr>                <td align=\"center\" id=\"tdCommentView\" style=\"width: 100%;\"></td>            </tr>        </tbody>    </table>    <!--write_ 의견입력끝 -->    <!--총괄부서검토의견-->    <div>        <div id=\"Comment_table_ctrldept\"></div>    </div>    <!--별도보고-->    <div>        <div id=\"Comment_table_spec\"></div>    </div>    <!--지시 의견-->    <div>        <div id=\"Comment_table_opinion\"><table class=\"table_10\" id=\"table\" style=\"margin-top: 20px;\"><tbody><tr><th style=\"text-align: center;\"><dt><strong>지시의견</strong></dt></th><tr><td style=\"padding: 0px;\"><div class=\"form__textbox\" style=\"width: 100%;\"><div style=\"padding-top: 5px; font-weight: 700;\">[2020-07-28 14:00:46 팀*삼 부장 테스트팀(현대자동차)]</div><div style=\"padding-top: 5px; padding-bottom: 5px; -ms-word-wrap: break-word;\">테스트 마니 필요합니다</div></div></td></tr><tr><td style=\"padding: 0px;\"><div class=\"form__textbox\" style=\"width: 100%;\"><div style=\"padding-top: 5px; font-weight: 700;\">[2020-07-28 16:56:58 팀*이 과장 테스트팀(현대자동차)]</div><div style=\"padding-top: 5px; padding-bottom: 5px; -ms-word-wrap: break-word;\">ㅎ히</div></div></td></tr></tbody></table></div>    </div>    <!--검토 의견-->    <div>        <div id=\"Comment_table_exa\"></div>    </div>    <!--발신 의견-->    <div>        <div id=\"Comment_table\"></div>    </div>    <!--수신 의견-->    <div>        <div id=\"Comment_table_REC\"></div>    </div>    <!--덧글 입력 창-->    <table align=\"center\" class=\"table_10\" id=\"CommentTable\" style=\"width: 100%; margin-top: 20px;\" border=\"0\">        <colgroup>            <col style=\"width: 95%;\">            <col style=\"width: 70px;\">        </colgroup>        <tbody>            <tr>                <th colspan=\"2\"> <span id=\"whichDeptReply\">수신 팀원 댓글</span></th>            </tr>            <tr>                <td id=\"tr_CommentTableMain\" style=\"-ms-word-break: break-all;\">                    <textarea class=\"shin_area05\" id=\"TDMStyle05\" placeholder=\"타 팀에 송신, 공유되지 않으며 본인 글은 수정, 삭제 가능합니다.\" rows=\"5\" data-type=\"mField\">타 팀에 송신, 공유되지 않으며 본인 글은 수정, 삭제 가능합니다.</textarea>                </td>                              <td id=\"tr_WF_COMMENT\" style=\"padding: 0px; -ms-word-break: break-all;\">                    <a style=\"width: 100%; height: 100%; display: block;\" href=\"javascript:Save_WF_COMMENT('C', '', '');\"><em class=\"btn_iws_l  reply-button\"><span class=\"btn_iws_r\"><strong class=\"txt_btn_ws\"><img class=\"ico_btn\" alt=\"\" src=\"/Images/Images/Board/img_plus02.gif\">저장</strong></span></em></a>                </td>            </tr>            <!--<tr id=\"tr_WF_COMMENT\"> 위치이동_최우석                <td colspan=\"2\" style=\"word-break:break-all;\">                    <a href=\"javascript:Save_WF_COMMENT('C', '', '');\"><em class=\"btn_iws_l\"><span class=\"btn_iws_r\"><strong class=\"txt_btn_ws\"><img src=\"/Images/Images/Board/img_plus02.gif\" alt=\"\" class=\"ico_btn\" />저장</strong></span></em></a>                </td>            </tr>-->        </tbody>    </table>    <!--발신 덧글-->    <div>        <div id=\"div_table\" style=\"display: none;\"></div>    </div>    <!--수신 덧글-->    <div>        <div id=\"div_table_REC\"></div>    </div>    <!--발신 수신 의견 끝-->    <table class=\"table_10\" id=\"tbCooperationInfo\" style=\"margin-top: 20px;\" cellspacing=\"0\" cellpadding=\"0\">        <tbody><tr>            <th class=\"table_5_th\" style=\"width: 88px;\">협조처<span id=\"CooperCount\">(1)</span>                <div class=\"populate_inform_footer\" style=\"display: block;\">                    <input id=\"PlusMinusCooperationInfo\" style=\"margin-top: 2px; display: none; cursor: pointer;\" type=\"button\" value=\"\">                </div>			</th>            <td class=\"table_5_td\" id=\"tdCooperationInfo\">                <div id=\"divCooperationInfo\" style=\"-ms-overflow-y: hidden;\">테스트팀</div>            </td>        </tr>    </tbody></table>    <table class=\"table_10\" id=\"CCLine\" style=\"margin-top: 10px; display: none;\" cellspacing=\"0\" cellpadding=\"0\" summary=\"참조\">        <tbody><tr>            <th class=\"table_5_th\" id=\"TIT_L_CCINFO\" style=\"width: 88px;\">참조처<span id=\"CCSendCount\"></span>                <div class=\"populate_inform_footer\" style=\"display: block;\">                    <input id=\"PlusMinusSendCC\" style=\"margin-top: 2px; display: none; cursor: pointer;\" type=\"button\" value=\"\">                </div>            </th>            <!--td class=\"table_5_td\">                <span id=\"SendCC\"></span>            </td-->            <td class=\"table_5_td\" id=\"tdSendCC\">                <div id=\"divSendCC\"></div>            </td>        </tr>        <tr style=\"display: none;\">            <th class=\"table_5_th\" id=\"TIT_R_CCINFO\" style=\"width: 88px;\">수신 참조자<span id=\"CCRecCount\"></span>                <div class=\"populate_inform_footer\" style=\"display: block;\">                    <input id=\"PlusMinusRecCC\" style=\"margin-top: 2px; display: none; cursor: pointer;\" type=\"button\" value=\"\">                </div>            </th>            <td class=\"table_5_td\">                <span id=\"RecCC\"></span>&nbsp;            </td>        </tr>    </tbody></table>	<!-- 20200427 hpark 참조자 추가 -->	<table class=\"table_10\" id=\"CCPersonLine\" style=\"margin-top: 10px; display: none;\" cellspacing=\"0\" cellpadding=\"0\" summary=\"참조자\">		<!-- CCLine -->		<tbody><tr>			<th class=\"table_5_th\" id=\"TIT_L_CCPERSONINFO\" style=\"width: 88px;\">				<!-- TIT_L_CCINFO -->				참조자<span id=\"CCPersonSendCount\"></span> <!-- CCSendCount -->				<div class=\"populate_inform_footer\" style=\"display: block;\">					<input id=\"PlusMinusSendCCPerson\" style=\"margin-top: 2px; display: none; cursor: pointer;\" type=\"button\" value=\"\"> <!-- PlusMinusSendCC -->				</div>			</th>			<td class=\"table_5_td\" id=\"tdSendCCPerson\">				<!-- tdSendCC -->				<div id=\"divSendCCPerson\"></div> <!-- divSendCC -->			</td>		</tr>		<tr style=\"display: none;\">			<th class=\"table_5_th\" id=\"TIT_R_CCPERSONINFO\" style=\"width: 88px;\">				<!-- TIT_R_CCINFO -->				수신 참조자<span id=\"CCPersonRecCount\"></span> <!-- CCRecCount -->				<div class=\"populate_inform_footer\" style=\"display: block;\">					<input id=\"PlusMinusRecCCPerson\" style=\"margin-top: 2px; display: none; cursor: pointer;\" type=\"button\" value=\"\"> <!-- PlusMinusRecCC -->				</div>			</th>			<td class=\"table_5_td\">				<span id=\"RecCCPerson\"></span>&nbsp; <!-- RecCC -->			</td>		</tr>	</tbody></table>    <table class=\"table_5\" style=\"display: none;\" cellspacing=\"0\" cellpadding=\"0\" summary=\"원문서\">        <tbody><tr>            <th class=\"table_5_th\" style=\"width: 13%;\">원문서</th>            <td class=\"table_5_td\" id=\"RejectDocLinkInfo\">-</td>        </tr>        <tr id=\"divforminfo\">            <th class=\"table_5_th\">문서설명</th>            <td class=\"table_5_td\" id=\"tdforminfo\"></td>        </tr>        <tr id=\"trPMLinkInfo\">            <th class=\"table_5_th\">관련<br> 프로세스<br> 메뉴얼</th>            <td class=\"table_5_td\" id=\"PMLinkInfo\"></td>        </tr>    </tbody></table>                        <!-- [2015-08-04 han modi] 공통 로고삽입으로 인해 삭제 -->                        <!-- 계열사별 양식 로고 들어 올 곳 -->                                                <!-- 첨부 쪽 처리 -->                        <input name=\"hidFrontPath\" id=\"hidFrontPath\" type=\"hidden\">                        <input name=\"hidFileSize\" id=\"hidFileSize\" type=\"hidden\">                        <input name=\"hidOldFile\" id=\"hidOldFile\" type=\"hidden\">                        <input name=\"hidDeleteFront\" id=\"hidDeleteFront\" type=\"hidden\">                        <input name=\"hidImageFile\" id=\"hidImageFile\" type=\"hidden\">                        <input name=\"hidDeleteFile\" id=\"hidDeleteFile\" type=\"hidden\">                        <input name=\"hidUseVideo\" id=\"hidUseVideo\" type=\"hidden\" value=\"N\">                        <input name=\"llegacy_form\" id=\"llegacy_form\" type=\"hidden\">                        <input name=\"lkey\" id=\"lkey\" type=\"hidden\">                        <input name=\"lsubject\" id=\"lsubject\" type=\"hidden\">                        <input name=\"lbodycontext\" id=\"lbodycontext\" type=\"hidden\">                        <input name=\"lempno\" id=\"lempno\" type=\"hidden\">                        <input name=\"lattachfile\" id=\"lattachfile\" type=\"hidden\">                        <!-- 로템 자료공유시스템 첨부파일 S -->                        <input name=\"hidRotemFilePath\" id=\"hidRotemFilePath\" type=\"hidden\">                        <input name=\"hidRotemFileName\" id=\"hidRotemFileName\" type=\"hidden\">                        <input name=\"hidRotemFileSize\" id=\"hidRotemFileSize\" type=\"hidden\">                        <input name=\"hidRotemFileIdx\" id=\"hidRotemFileIdx\" type=\"hidden\">                        <input name=\"hidRotemDomainIdx\" id=\"hidRotemDomainIdx\" type=\"hidden\">                        <input name=\"hidRotemDomainFolderType\" id=\"hidRotemDomainFolderType\" type=\"hidden\">                        <input name=\"hidRotemFileDeleteIdx\" id=\"hidRotemFileDeleteIdx\" type=\"hidden\">                        <!-- 로템 자료공유시스템 첨부파일 E -->                    </div>                </div>";
    //var contentHtml = "        <div class=\"con_in\">                     <!-- 메뉴가 들어 올 영역 -->                                        <!--[2014-07-08 박한 mod] class=\"app_formbox\" 추가 (디자인팀 요청사항) --><div class=\"app_formbox\" id=\"app_formboxHeader\" style=\"border: 0px currentColor; border-image: none; width: 93.5%; position: fixed; z-index: 99; box-sizing: border-box; background-color: white;\"><!-- [2014-10-14 박한 add] 에디터(태그프리)가 양식 상단 메뉴를 덮는 현상 수정 -->    <!--<div style=\"width: 100%; height: 73px; position:absolute;\"><iframe width=\"100%\" height=\"73\" frameborder=\"0\"></iframe></div>-->    <div class=\"approval_btop\" id=\"divMenu\" style=\"background: none;\">        <div>            <!--[2014-06-30 박한 add] 디자인팀 요청사항-->            <div class=\"logo\"></div>            <ul class=\"approval_btop_g_d\" style=\"height: 0px;\">                <li>                    <!----------------------------------------------------------파란색 강조 버튼 영역---------------------------------------------------------->            <!-- 기아해외출장품의 - 접수 --><span id=\"btn_receipt\" style=\"display: none;\" onclick=\"fn_Accept_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">접수</span></em></a></span>   <!-- 기아해외출장품의 - 완료처리 --><span id=\"btn_Complete_Process\" style=\"display: none;\" onclick=\"fn_ProcComplete_Click(this);\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">완료처리</span></em></a></span>                            <!-- 승인 --><span id=\"btApproved\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">결재</span></em></a></span>                  <!-- 승인 --><span id=\"btPostApproved\" style=\"display: none;\" onclick=\"doButtonAction(this);\" name=\"cbBTN\"><a href=\"javascript:void(0);\"><em class=\"btn_ws_l\"><span class=\"btn_ws_r c-button c-button--strong\">결재</span></em></a></span>";
    

    //실제적용 데이터
    //var contentHtml = document.getElementById("templateContainer").outerHTML;
    var contentHtml = document.getElementsByClassName("approval_form")[0].outerHTML;
    contentHtml = fn_ReplaceAll(contentHtml, "&nbsp;", " ");//&로 파라미터 구분되므로 & 들어가는 걸 없애야함.
    

    //구분자 파라미터도 DB에서 읽어오기
    var strURL = blankURL + "?transhtml=" + contentHtml + separator + "contentstype=cooperation";//post로 보낼 파라미터 추가( 1. transhtml - 번역대상 HTML,    2. contentstype - cooperation / mail (콘텐츠 구분: 결재 문서 / 메일))

    XFN_PopupMachineTranslation(strURL, blankURL);   //2020.08.11 기계번역 팝업 추가( Common.js 함수 호출 )
    return false;
}
//기계번역작성모드추가
doButtonCase['btTranslateWrite'] = function (oBtn, oVar) {
    /*
    if (getInfo('mode') == 'DRAFT') {
        // '작성한 문서를 저장 후 이용 가능합니다.
        Common.Warning(Common.GetDic("msg_Request_NeedSave"));
    }*/
    var strURL = Common.GetBaseConfig("MachineTranslationTextURL");
    XFN_PopupMachineTranslation(strURL,"");   //2020.08.11 기계번역 팝업 추가

    return false;
}
function OrgMap_CallBack(pStrItemInfo) {//최우석
    var oXmlOrgMap = $.parseXML("<?xml version='1.0' encoding='utf-8'?>" + pStrItemInfo);
    var sDeptInfo = "";
    var sDeptInfoCode = "";
    var DeptArr = new Array();

    if ($(oXmlOrgMap).find('item[type=group]').length <= 5) {
        $(oXmlOrgMap).find('item[type=group]').each(function () {
            //DN_Code, T, GR_Code
            ReSendDept += XFN_GetDicInfo($(this).find('DN_Code').eq(0).text()) + ',T,';
            ReSendDept += XFN_GetDicInfo($(this).find('GR_Code').eq(0).text()) + ';';
            //DeptArr.push(sDeptInfo);

        });

        //sUserInfo = sUserInfo.substring(0, sUserInfo.length - 1);
        //$("#Total_Sub_Span").text(sUserInfo);  이부분에서 뿌려준다.
        //alert('부서정보 :' + DeptArr + '');
        //ReSendDept = DeptArr;
    }
    requestProcess("RESENDREQUESTCONSULT");

}



doButtonCase['bt_receive_cc_circulation'] = function (oBtn, oVar) {//수신/참조/회람 
    oVar.sUrl = "/Approval/Circulation/CirculationMgr.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&openDo=Circulate&openType=0&pState=528";
    oVar.iWidth = 980; oVar.iHeight = 680 - 34; oVar.sSize = "fix";
}

//협조처 추가삭제
doButtonCase['btCooperAddDel'] = function (oBtn, oVar) {

    var pdef = getInfo("pdef");
    var process_instance_id = getInfo("PROCESS_INSTANCE_ID");
    var Subject = escape(getInfo("SUBJECT"));
    //var strURL = "/Approval/ApvProcess/CooperationAddDel.aspx"; //협조처 추가삭제
    var strURL = "/Approval/ApvProcess/CooperationAddDel.aspx?type=3" + "&user=5" + "&group=5" + "&Comment=5"; //의견추가 
    var Title = Common.GetDic("btn_ReceiptStatus");//계정검색
    parent.Common.ShowDialog("SetApvChargerAndPublicity", "SetApvChargerAndPublicity", "협조처 추가삭제", strURL + "&openID=" + CFN_GetQueryString("CFN_OpenLayerName"), "800px", "500px", "iframe-ifNoScroll");    // 레이블 수정 필요.
    return false;
}

//의견창 띄웠다가 취소 누르면 문제 발생함> 오류 조치.
var _transferCooperationInfo = "";
var _sCONSULT_LIST = "";
doButtonCase['btDraft'] = function (oBtn, oVar) {//기안하기
    //console.log("btDraft Start : " + new Date().getHours() + ":" + new Date().getMinutes() + ":" + new Date().getSeconds() + "." + new Date().getMilliseconds());
    _transferCooperationInfo = "";
    _sCONSULT_LIST = "";

    // 현대제철 보안문서해제요청서 첨부파일 체크 S. 20200114 beokim.
    var hsteel_sdr_fmpf = Common.GetBaseConfig("HSTEEL_SecurityRelease_FORMS"); // 보안문서해제요청서가 여러 개 존재함.
    if (_DN_Code == "H123" && (hsteel_sdr_fmpf.indexOf(getInfo("fmpf")) != -1) && fn_HSTEEL_SecurityDocumentRelease_FileSizeCheck()) {
        alert(Common.GetDic("lbl_HSTEEL_SEC_DOC_RELE_REQ_FILEMAX")); // 최대 100MB 까지 첨부 가능합니다.
        return false;
    }    
    // 현대제철 보안문서해제요청서 첨부파일 체크 E. 20200114 beokim.

    if (_BaseConfigApv.BLOCK_DOCUMENT_DRAFT != null && _BaseConfigApv.BLOCK_DOCUMENT_DRAFT.indexOf(_DN_Code) > -1) {
        Common.Warning(Common.GetDic("msg_BLOCK_DOCUMENT_DRAFT"));
        return false;
    }
    if (!FormAttachProcess("btDraft")) // 첨부파일 콜백대기와 협조처100개이상 체크 메세지가 겹쳐서 수정
        return false;

    if (getInfo("fmpf") == "WF_HDEC_BEGIN_CONSTRUCTION") $('#btDraft').attr('onclick', 'fn_msgConfirm(this);'); // 공사착공품의서 상신시 메세지 confirm
    
    // 수석부회장실 결재선에서 제거 STS HK.CHO
    var arrfmpf = "GWOK_PINVEST_W01|GWOK_PINVEST_W02|GWOK_PINVEST_W03|GWOK_INVEST_W01|GWOK_INVEST_W02|GWOK_INVEST_W03|GWOK_INVEST_W04|WF_HMC_OVER_BIZ_RPT_MF|GWOK_DINVEST_W01|WF_KMC_OVER_BIZ_TRIP_MF|WF_HMC_OVER_BIZ_TRIP_MF|WF_HPT_AW_SAP_PREFIX_WF500|WF_HPT_AW_PROJECT_INVESTMENT";

    if (arrfmpf.indexOf(getInfo("fmpf") < 0)) {
        if (!fn_ChkApvListVicePresident()) {
            alert(Common.GetDic("msg_Approval_DeleteUser"));//결재문서에서 수석부회장님의 결재정보는 결재선에서 자동 삭제 됩니다.<br>자세한 사항은 관리팀에 문의하세요
            return false;
        }
    }

    // 건설 계열사이고 신청서 프로세스일 경우 지정된 수신처/수신담당자 없는 경우 결재문서 상신 불가
    if (Common.GetBaseConfig("HEC_COMPANY") == "Y") {
        var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
        if (getInfo("pdef") == "REQUEST_PATTERN" && $(xmlApv).find("steps > division[divisiontype='receive']").length == 0) {
            alert(Common.GetDic("msg_apv_autoChkRec"));
            return false;
        }
    }

    // 20171124 hpark 공통 기안전처리
    //if (!fnCommonCheckForm()) return false;

    if (getInfo("autoChkAgree") == "Y") {
        if (getInfo("autoLineAgree") != "") {
            var oAutoLineAgree = $.parseXML(getInfo("autoLineAgree"));
            if ($(oAutoLineAgree).find("step").length > 0) {
                var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
                var oAppList = $(xmlApv).find("steps > division[divisiontype='send'] > step[routetype='assist'][unittype='person'], steps > division[divisiontype='send'] > step[routetype='consult'][unittype='person']");
                for (var i = 0; i < $(oAppList).length; i++) {
                    var oChkNode = $(oAutoLineAgree).find("step:has(ou > person[code='" + $($(oAppList)[i]).find("ou > person").attr("code") + "'])");
                    if (oChkNode.length > 0) {
                        $(oChkNode).remove();
                    }
                }
                if ($(oAutoLineAgree).find("step").length > 0) {
                    var sAlert = "[";
                    for (var i = 0; i < $(oAutoLineAgree).find("step").length; i++) {
                        if (i > 0) sAlert += ", ";
                        sAlert += getLngLabel($($(oAutoLineAgree).find("step")[i]).find("ou > person").attr("name"), false);
                        sAlert += " " + getLngLabel($($(oAutoLineAgree).find("step")[i]).find("ou > person").attr("position"), true);
                    }
                    sAlert += "]";
                    sAlert = Common.GetDic("msg_apv_autoChkAgree").replace("{0}", sAlert);
                    alert(sAlert);
                    return;
                }
            }
        }
    }
    //결재자 체크
    if (getInfo("autoChkApproval") == "Y") {
        if (getInfo("autoLineApproval") != "") {
            var oAutoLineApproval = $.parseXML(getInfo("autoLineApproval"));
            if ($(oAutoLineApproval).find("step").length > 0) {
                var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
                var oAppList = $(xmlApv).find("steps > division[divisiontype='send'] > step[name!='reference'][routetype='approve'][unittype='person']");
                for (var i = 0; i < $(oAppList).length; i++) {
                    var oChkNode = $(oAutoLineApproval).find("step:has(ou > person[code='" + $($(oAppList)[i]).find("ou > person").attr("code") + "'])");
                    if (oChkNode.length > 0) {
                        $(oChkNode).remove();
                    }
                }
                if ($(oAutoLineApproval).find("step").length > 0) {
                    var sAlert = "[";
                    for (var i = 0; i < $(oAutoLineApproval).find("step").length; i++) {
                        if (i > 0) sAlert += ", ";
                        sAlert += getLngLabel($($(oAutoLineApproval).find("step")[i]).find("ou > person").attr("name"), false);
                        sAlert += " " + getLngLabel($($(oAutoLineApproval).find("step")[i]).find("ou > person").attr("position"), true);
                    }
                    sAlert += "]";
                    sAlert = Common.GetDic("msg_apv_autoChkApproval").replace("{0}", sAlert);
                    alert(sAlert);
                    return;
                }
            }
        }
    }
    //참조자 체크
    if (getInfo("autoChkCC") == "Y") {
        if (getInfo("autoLineCC") != "") {
            var oAutoLineCC = $.parseXML(getInfo("autoLineCC"));
            if ($(oAutoLineCC).find("ccinfo").length > 0) {
                var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
                var oAppList = $(xmlApv).find("steps > ccinfo > ou > person");
                for (var i = 0; i < $(oAppList).length; i++) {
                    var oChkNode = $(oAutoLineCC).find("ccinfo:has(ou > person[code='" + $($(oAppList)[i]).attr("code") + "'])");
                    if (oChkNode.length > 0) {
                        $(oChkNode).remove();
                    }
                }
                oAppList = $(xmlApv).find("steps > ccinfo > ou:not(:has(person))");
                for (var i = 0; i < $(oAppList).length; i++) {
                    var oChkNode = $(oAutoLineCC).find("ccinfo:has(ou[code='" + $($(oAppList)[i]).attr("code") + "']):not(:has(person))");
                    if (oChkNode.length > 0) {
                        $(oChkNode).remove();
                    }
                }
                if ($(oAutoLineCC).find("ccinfo").length > 0) {
                    var sAlert = "[";
                    for (var i = 0; i < $(oAutoLineCC).find("ccinfo").length; i++) {
                        if (i > 0) sAlert += ", ";
                        if ($($(oAutoLineCC).find("ccinfo")[i]).find("ou > person").length == 0) {
                            sAlert += getLngLabel($($(oAutoLineCC).find("ccinfo")[i]).find("ou").attr("name"), false);
                        } else {
                            sAlert += getLngLabel($($(oAutoLineCC).find("ccinfo")[i]).find("ou > person").attr("name"), false);
                            sAlert += " " + getLngLabel($($(oAutoLineCC).find("ccinfo")[i]).find("ou > person").attr("position"), true);
                        }
                    }
                    sAlert += "]";
                    sAlert = Common.GetDic("msg_apv_autoChkCC").replace("{0}", sAlert);
                    alert(sAlert);
                    return;
                }
            }
        }
    }
    //참조자 체크(사전)
    if (getInfo("autoChkCCBefore") == "Y") {
        if (getInfo("autoLineCCBefore") != "") {
            var oAutoLineCC = $.parseXML(getInfo("autoLineCCBefore"));
            if ($(oAutoLineCC).find("ccinfo").length > 0) {
                var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
                var oAppList = $(xmlApv).find("steps > ccinfo > ou > person");
                for (var i = 0; i < $(oAppList).length; i++) {
                    var oChkNode = $(oAutoLineCC).find("ccinfo:has(ou > person[code='" + $($(oAppList)[i]).attr("code") + "'])");
                    if (oChkNode.length > 0) {
                        $(oChkNode).remove();
                    }
                }
                oAppList = $(xmlApv).find("steps > ccinfo > ou:not(:has(person))");
                for (var i = 0; i < $(oAppList).length; i++) {
                    var oChkNode = $(oAutoLineCC).find("ccinfo:has(ou[code='" + $($(oAppList)[i]).attr("code") + "']):not(:has(person))");
                    if (oChkNode.length > 0) {
                        $(oChkNode).remove();
                    }
                }
                if ($(oAutoLineCC).find("ccinfo").length > 0) {
                    var sAlert = "[";
                    for (var i = 0; i < $(oAutoLineCC).find("ccinfo").length; i++) {
                        if (i > 0) sAlert += ", ";
                        if ($($(oAutoLineCC).find("ccinfo")[i]).find("ou > person").length == 0) {
                            sAlert += getLngLabel($($(oAutoLineCC).find("ccinfo")[i]).find("ou").attr("name"), false);
                        } else {
                            sAlert += getLngLabel($($(oAutoLineCC).find("ccinfo")[i]).find("ou > person").attr("name"), false);
                            sAlert += " " + getLngLabel($($(oAutoLineCC).find("ccinfo")[i]).find("ou > person").attr("position"), true);
                        }
                    }
                    sAlert += "]";
                    sAlert = Common.GetDic("msg_apv_autoChkCC").replace("{0}", sAlert);
                    alert(sAlert);
                    return;
                }
            }
        }
    }
    if ((getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") && getInfo("scFRMAPVLINE") == "1") {


        chkApplyAPVLine();
    }

    m_sReqMode = "DRAFT";
    if (evaluateForm()) {

        //if (getInfo("fmpf") != "GWOK_PINVEST_W01" || getInfo("fmpf") != "GWOK_PINVEST_W02" || getInfo("fmpf") != "GWOK_PINVEST_W03" || getInfo("fmpf") != "GWOK_INVEST_W01" ||
        //           getInfo("fmpf") != "WF_HMC_OVER_BIZ_TRIP_MF" || getInfo("fmpf") != "WF_KMC_OVER_BIZ_TRIP_MF") {

        //    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); // 결재선을 가져온다.
        //    $(m_oApvList).find("steps > division[divisiontype='send'] >").each(function (idx, item) {
        //        if ($(item).find("step > ou[code='1E__']").length > 0 || $(item).find("step > ou > person[code='9971268']").length > 0) {
        //            //delapprovalorder = $(item).find("step").attr("approvalorder");
        //            $(item).find("step > ou > person[code='9971268']").parent().parent().remove();
        //            $("#APVLIST").val(CFN_XmlToString(m_oApvList));
        //            initApvList();
        //            alert("결재문서에서 수석부회장님 결재정보는 결재선에서 자동 삭제 됩니다.");
        //            return false;
        //        }

        //    });
        //}

        /* 공시여부 체크  */
        if (getInfo("chkPulicObjectYN") == "Y") {
            var sURL = "/Approval/Controls/ApprovalWebservice.asmx";
            var oResult = CFN_CallAjaxJson(sURL + "/GetPublicObjectList", "{DN_Code:'" + Common.GetSession("DN_Code") + "', FORM_INST_ID:'" + getInfo("fiid") + "', MODE:'VIEW'}", false, null);
            var oRsltJSON = $.parseJSON(oResult);
            var xmlReturn = JSON.parse(oRsltJSON.d);

            Table1 = xmlReturn.NewDataSet.Table;
            if (Table1 == null && Table1 == undefined && $(Table1).length == 0) {
                if ($("#hidPublic").length == "0") {
                    alert(Common.GetDic("msg_public_AvailabilityMessage"));  //공시여부를 체크해주세요.
                    return false;
                }
            }
        }
        /* 공시여부 체크 */

        //협조처 발송 체크
        var HasConsult = false;
        var HasMustSend = true;
        var transferCooperationInfo = "";
        var sCONSULT_LIST = "";

        //기안시 협조처 개수를 CONSULT_ADD_COUNT에 등록(파일 업로드시 협조처가 200개 이상인 경우 사전 암호화 수행).2017.09.08 양유빈
        SetConsultAddCount();

        //if (getInfo("usismanager") == "Y" && (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN" || getInfo("pdef") == "ABROAD_PATTERN")) {
        if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN" || getInfo("pdef") == "ABROAD_PATTERN") {

        	// KMM 경상,PR은 일반품의류지만 통제단계가 있고 해당위치에서만 협조처 발송함
        	if ((getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMM" || getInfo("fmpf") == "WF_KMM_FI_PURCHASE")) {
        		//통제단계가 기안자의 직책과 동일한경우 협조요청 수행
        		if ($('#CONSULT_LIST').val().indexOf(":N:") > -1 && $("#CTRL_STEP").val() != "" && ($("#CTRL_STEP").val() == getInfo("ustc"))) {
        			Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
        				if (result) {
        					var arrReturn = setSendConsultCheck();
        					HasConsult = arrReturn[0];
        					HasMustSend = arrReturn[1];
        					sCONSULT_LIST = arrReturn[2];
        					transferCooperationInfo = arrReturn[3];
        					_transferCooperationInfo = transferCooperationInfo;
        					_sCONSULT_LIST = sCONSULT_LIST;
        					setInfo("transferCooperationInfo", transferCooperationInfo);
        					$("#CONSULT_LIST").val(sCONSULT_LIST);
        					requestProcess("DRAFT");
        				}
        			});
        			return false;
        		}
        		else {
        			HasConsult = false;
        		}
        	}
            else if (getInfo("ResidentAuthorityYN") == "Y") {//**주재원 작업**
                if (getInfo("usismanager") == "Y" || getInfo("usisresident") == "Y") {
                    if (fnCheckResidentAuthorityYN()) {
                        var arrReturn = setSendConsultCheck();
                        HasConsult = arrReturn[0];
                        HasMustSend = arrReturn[1];
                        sCONSULT_LIST = arrReturn[2];
                        transferCooperationInfo = arrReturn[3];
                    }
                }
            } else if (getInfo("usismanager") == "Y") {
                var arrReturn = setSendConsultCheck();
                HasConsult = arrReturn[0];
                HasMustSend = arrReturn[1];
                sCONSULT_LIST = arrReturn[2];
                transferCooperationInfo = arrReturn[3];
            }
        } else {

            // HAOS / HMMC 투자품의
            // 해외투자프로세스(INVEST_PROCESS_TYPE=A) 와 동일하지만 협조처발송 시점만 다른경우(INVEST_PROCESS_SUBTYPE=PRE_CTRL)222
            if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN" && Common.GetBaseConfig("INVEST_PROCESS_SUBTYPE") == "PRE_CTRL") {
                if (getInfo("usismanager") == "Y") {
                    var arrReturn = setSendConsultCheck();
                    HasConsult = arrReturn[0];
                    HasMustSend = arrReturn[1];
                    sCONSULT_LIST = arrReturn[2];
                    transferCooperationInfo = arrReturn[3];
                }
            }
        	// HMB 투자품의
        	// 해외투자프로세스(INVEST_PROCESS_TYPE=A) 와 동일하지만 협조처발송 시점만 다른경우(INVEST_PROCESS_SUBTYPE=MUST)
        	else if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN" && Common.GetBaseConfig("INVEST_PROCESS_SUBTYPE") == "MUST") {
        		if (getInfo("usismanager") == "Y") {
        			var arrReturn = setSendConsultCheck();
        			HasConsult = arrReturn[0];
        			HasMustSend = true;
        			sCONSULT_LIST = arrReturn[2];
        			transferCooperationInfo = arrReturn[3];
        		} else {
        			HasConsult = false;
        		}
        	}
            //TO-DO : 해외투자프로세스의 경우 양식에서 선택한 통제 단계에서 협조요청을 진행해야 한다.
            //2019-09-16 BY YJYOO
            //1. HMI와 HMMR의 해외투자품의일 경우에만 적용
            else if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN") {
                //2. 통제단계가 기안자의 직책과 동일한경우 협조요청 수행
                if ($('#CONSULT_LIST').val().indexOf(":N:") > -1 && $("#CTRL_STEP").val() != "" && ($("#CTRL_STEP").val() == getInfo("ustc"))) {
                    Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
                        if (result) {
                            var arrReturn = setSendConsultCheck();
                            HasConsult = arrReturn[0];
                            HasMustSend = arrReturn[1];
                            sCONSULT_LIST = arrReturn[2];
                            transferCooperationInfo = arrReturn[3];
                            _transferCooperationInfo = transferCooperationInfo;
                            _sCONSULT_LIST = sCONSULT_LIST;
                            setInfo("transferCooperationInfo", transferCooperationInfo);
                            $("#CONSULT_LIST").val(sCONSULT_LIST);
                            requestProcess("DRAFT");
                        }
                    });
                    return false;
                }
                else {
                    HasConsult = false;
                }
            }
            else {
                HasConsult = false;
            }
            //HasConsult = false;
        }
        if (HasConsult) { // 품의류 프로세스이면서 협조처가 존재하면서 팀장이거나 실장이면
            if (BPMBeforeApproval == "N") {
                ////협조요청 메세지 확인 수정 <
                //setInfo("transferCooperationInfo", transferCooperationInfo);
                //$("#CONSULT_LIST").val(sCONSULT_LIST);
                //oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=DRAFT";
                //if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                if (getInfo("Request_ConfirmMsg") == "Y")//협조요청 메세지 확인 
                {
                    if (HasMustSend) {//무조건 보냄
                        Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
                            if (result) {
                                _transferCooperationInfo = transferCooperationInfo;
                                _sCONSULT_LIST = sCONSULT_LIST;
                                oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=DRAFT";
                                if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                                doButtonPostProcess(oVar);
                            }
                        });
                        return false;
                    } else {
                        Common.Confirm(Common.GetDic("msg_apv_form_001").replace(/\\n/g, "\n") + "<div style='width:300px;'>&nbsp;</div>" + Common.GetDic("msg_cooper_up_approval"), $("#btapproved").text(), function (result) {
                            if (result == "other") {
                                _transferCooperationInfo = transferCooperationInfo;
                                _sCONSULT_LIST = sCONSULT_LIST;
                                oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=DRAFT";
                            }
                            else if (result == true) {
                                oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=DRAFT";
                            }
                            if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                            doButtonPostProcess(oVar);
                        });
                        setTimeout(function () {
                            $("#popup_other").show();
                            $("#popup_other").html(Common.GetDic("btn_apv_RequestConsult")); //협조요청
                            $("#popup_ok").html(Common.GetDic("btn_apv_Approved"));//결재
                        }, 400);
                        return false;
                    }
                } else {
                    _transferCooperationInfo = transferCooperationInfo;
                    _sCONSULT_LIST = sCONSULT_LIST;
                    oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=DRAFT";
                    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                    doButtonPostProcess(oVar);
                    return false;
                }
                ////협조요청 메세지 확인 수정 >
            } else if (HasMustSend) //무조건 보냄
            {
                //if (confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"))) {

                //    setInfo("transferCooperationInfo", transferCooperationInfo);
                //    $("#CONSULT_LIST").val(sCONSULT_LIST);
                //    requestProcess("DRAFT");
                //    return false;
                //} else {
                //    return false;
                //}
                Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btDraft").text(), function (result) {
                    if (result) {
                        setInfo("transferCooperationInfo", transferCooperationInfo);
                        $("#CONSULT_LIST").val(sCONSULT_LIST);
                        requestProcess("DRAFT");
                    }
                });
                return false;
            } else {
                //if (confirm(Common.GetDic("msg_apv_form_001").replace(/\\n/g, "\n"))) {

                //    setInfo("transferCooperationInfo", transferCooperationInfo);
                //    $("#CONSULT_LIST").val(sCONSULT_LIST);
                //    requestProcess("DRAFT");
                //    return false;
                //}
                Common.Confirm(Common.GetDic("msg_apv_form_001").replace(/\\n/g, "\n") + "<div style='width:300px;'>&nbsp;</div>" + Common.GetDic("msg_cooper_up_approval"), $("#btDraft").text(), function (result) {
                    if (result == "other") {
                        /* 기아해출품 구매의뢰서 청구번호 생성 */
                        if (m_oFormMenu.getInfo("fmpf") == "WF_KMC_OVER_BIZ_TRIP_MF") {
                            var strAccountType = m_oFormMenu.document.getElementById("ACCOUNT_TYPE").value;
                            var strAccountCode = m_oFormMenu.document.getElementById("ACCOUNT_CODE").value;
                            if ((strAccountCode == "51021030" || strAccountCode == "51021040") && (strAccountType != "InvestAccount" && strAccountType != "AccountReceivables")) {
                                if (m_oFormMenu.fn_OtherBudgetFMDOC_KMC("A", "A") != true) {
                                    Common.Inform("해당 예산의 SAP 연동에 실패 하였습니다.", "Info", function () {  // 저장 되었습니다.
                                        if (m_oFormMenu != null) CloseThisLayer();
                                    });
                                    return false;
                                }
                            }
                        }
                        /* 기아해출품 구매의뢰서 청구번호 생성 */

                        setInfo("transferCooperationInfo", transferCooperationInfo);
                        $("#CONSULT_LIST").val(sCONSULT_LIST);
                        requestProcess("DRAFT");
                    }
                    else if (result == true) {
                        oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                        oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=DRAFT";
                        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                        sWindowName = "winAction"; oVar.sSize = 'resize';
                        doButtonPostProcess(oVar);
                    }
                });
                setTimeout(function () {
                    $("#popup_other").show();
                    $("#popup_other").html(Common.GetDic("btn_apv_RequestConsult")); //협조요청
                    $("#popup_ok").html(Common.GetDic("btn_apv_Approved"));//결재
                }, 400);
                return false;
            }
        }
        //TO-DO : 예약 결재시 참조처 정보 셋팅
        if ($("#BOOKING_APPROVAL_YN").val() == "Y") {
            setBookingApprovalReferenceList();
        }
        if (openApvActBasic()) {
            ////3단계류 이면서 고객만족 처리전일때 협조처 정보 바인딩
            //if (getInfo("pdef") == "STEP3_PATTERN" && getInfo("fmpf") == "KWEK_CUST_SATIS_W01") {
            //    if ($("#ChargerApproval").is(':checked')) {
            //        var HasConsult = false;
            //        var HasMustSend = true;
            //        var transferCooperationInfo = "";
            //        var sCONSULT_LIST = "";
            //        var arrReturn = EditSendConsultCheck();
            //        transferCooperationInfo = arrReturn[3];
            //        sCONSULT_LIST = arrReturn[2];
            //        setInfo("transferCooperationInfo", transferCooperationInfo);
            //        $("#CONSULT_LIST").val(sCONSULT_LIST);
            //    }
            //}

            oVar.iWidth = 700;//첨부파일 없을 경우  550//oVar.iHeight = 450; 
            oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=DRAFT";
            if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
            //oVar.iHeight = 800; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=DRAFT"; //원본
            sWindowName = "winAction"; oVar.sSize = "resize";
        } else {
            var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
            var eml = $(xmlApv).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo[kind='charge']");
            if (document.getElementById("ACTIONCOMMENT").value != "") {
                //결재선에 <comment> 추가 후 의견 저장
                var oComment = $.parseXML("<root><comment><![CDATA[" + document.getElementById("ACTIONCOMMENT").value + "]]></comment></root>");
                var oCommentNode = $(oComment).find("root > comment");
                if (eml.length > 0) {
                    var emlComment = $(eml).find("comment");
                    if ($(emlComment).length > 0) {
                        var delemlComment = eml[0].removeChild(emlComment[0]);
                    }
                    $(eml).append($(oCommentNode));
                }
                document.getElementById("APVLIST").value = CFN_XmlToString($(xmlApv)[0]);
            }
            if (sSingimg != "") {
                $(eml).attr("customattribute1", sSingimg);
                document.getElementById("APVLIST").value = CFN_XmlToString($(xmlApv)[0]);
            }
            requestProcess("DRAFT");
        }
    }
    //console.log("btDraft END : " +new Date().getHours() + ":" +new Date().getMinutes() + ":" +new Date().getSeconds() + "." +new Date().getMilliseconds());
}

doButtonCase['btChgApv'] = function (oBtn, oVar) {//결재선변경
    changeApvList();
}

doButtonCase['btLine'] = function (oBtn, oVar) {//결재선관리
    // 동시결재자 결재선변경 방지 [2015-11-24]
    var oApproveStep;
    if (getInfo("mode") == "APPROVAL") {
        var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
        oApproveStep = $(xmlApv).find("steps > division:has(taskinfo[status='pending']) > step:has(ou>person[code='" + getInfo("usid") + "']):has(ou>person>taskinfo[status='pending'])");
    }

    if ((getInfo("loct") == "MONITOR") || (getInfo("loct") == "PREAPPROVAL") || (getInfo("loct") == "PROCESS") || (getInfo("loct") == "REVIEW") || (getInfo("loct") == "COMPLETE") || (getInfo("loct") == "REJECT") || (getInfo("mode") == "REJECT") || (getInfo("mode") == "JOBDUTY") || (getInfo("mode") == "PCONSULT") || getInfo("pfsk") == "T019" || getInfo("pfsk") == "T005") { //20110318확인결재추가-확인결재자 결재선변경권한없음
        oVar.iHeight = 310; oVar.iWidth = 700;
        oVar.sUrl = "/Approval/ApvInfo/ApvInfo.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&scid=" + getInfo("scid") + "&fmpf=" + getInfo("fmpf") + "&fmrv=" + getInfo("fmrv")
    } else if (oApproveStep && oApproveStep.attr("routetype") == "approve" && oApproveStep.attr("allottype") == "parallel") {		// 동시결재자 결재선변경 방지 [2015-11-24]
        oVar.iHeight = 310; oVar.iWidth = 700;
        oVar.sUrl = "/Approval/ApvInfo/ApvInfo.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&scid=" + getInfo("scid") + "&fmpf=" + getInfo("fmpf") + "&fmrv=" + getInfo("fmrv")
    } else {
        if ((getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") && getInfo("scFRMAPVLINE") == "1") {
            chkApplyAPVLine();
        }

        oVar.sUrl = "/Approval/ApvlineMgr/ApvlineMgr.aspx?AllCompany=Y&Group=Y&Type=D9";
        oVar.sUrl = oVar.sUrl + "&ApvType=" + getInfo('selscSaganApproval');

        if (getInfo("editmode") == "M" || getInfo("editmode") == "Y")
            if (getInfo("CONSULT_LIST") && getInfo("CONSULT_LIST").indexOf(":Y:") > -1)
                oVar.sUrl = oVar.sUrl + "&bEditMode=true";
        if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "INVEST_PATTERN" || getInfo("pdef") == "ABROAD_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") {
            if (Common.GetBaseConfig("ConsultListCountLimit") != "") {
                oVar.sUrl = oVar.sUrl + "&LimitCooperCount=" + Common.GetBaseConfig("ConsultListCountLimit");
            }
        }
        if (g_IS_TabUI == "Y")
            oVar.IS_Tab = "Y";
    }
}

doButtonCase['btn_SetCoDept'] = function (oBtn, oVar) {//협조처지정
    // 동시결재자 결재선변경 방지 [2015-11-24]
    var oApproveStep;
    if (getInfo("mode") == "APPROVAL") {
        var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
        oApproveStep = $(xmlApv).find("steps > division:has(taskinfo[status='pending']) > step:has(ou>person[code='" + getInfo("usid") + "']):has(ou>person>taskinfo[status='pending'])");
    }

    if ((getInfo("loct") == "MONITOR") || (getInfo("loct") == "PREAPPROVAL") || (getInfo("loct") == "PROCESS") || (getInfo("loct") == "REVIEW") || (getInfo("loct") == "COMPLETE") || (getInfo("loct") == "REJECT") || (getInfo("mode") == "REJECT") || (getInfo("mode") == "JOBDUTY") || (getInfo("mode") == "PCONSULT") || getInfo("pfsk") == "T019" || getInfo("pfsk") == "T005") { //20110318확인결재추가-확인결재자 결재선변경권한없음
        oVar.iHeight = 310; oVar.iWidth = 700;
        oVar.sUrl = "/Approval/ApvInfo/ApvInfo.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&scid=" + getInfo("scid") + "&fmpf=" + getInfo("fmpf") + "&fmrv=" + getInfo("fmrv")
    } else if (oApproveStep && oApproveStep.attr("routetype") == "approve" && oApproveStep.attr("allottype") == "parallel") {		// 동시결재자 결재선변경 방지 [2015-11-24]
        oVar.iHeight = 310; oVar.iWidth = 700;
        oVar.sUrl = "/Approval/ApvInfo/ApvInfo.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&scid=" + getInfo("scid") + "&fmpf=" + getInfo("fmpf") + "&fmrv=" + getInfo("fmrv")
    } else {
        if ((getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") && getInfo("scFRMAPVLINE") == "1") {
            chkApplyAPVLine();
        }

        oVar.sUrl = "/Approval/ApvlineMgr/ApvlineMgr.aspx?AllCompany=Y&Group=Y&Type=D9&TabType=cooper";
        oVar.sUrl = oVar.sUrl + "&ApvType=" + getInfo('selscSaganApproval');
    }
    if (g_IS_TabUI == "Y")
        oVar.IS_Tab = "Y";
}

doButtonCase['btRecDept'] = function (oBtn, oVar) {//결재선관리
    oVar.sUrl = "/Approval/ApvlineMgr/ApvDeployMgr.aspx?AllCompany=Y";
}

//doButtonCase['btAction'] = function (oBtn, oVar) {//결재하기
//    oVar.iHeight = 280; oVar.iWidth = 630; oVar.sSize = "resize";
//    oVar.sUrl = "/Approval/ApvProcess/Apvprocess.aspx";
//}

doButtonCase['btDeptDraft'] = function (oBtn, oVar) {//재기안 2007.07 기안과 UI 통일	requestProcess("RECREATE");break;
    if (!FormAttachProcess("btDeptDraft"))
        return false;
    m_sReqMode = "DEPTDRAFT";
    if (evaluateForm()) {
        document.getElementById("ACTIONINDEX").value = "approve";
        oVar.iHeight = 550; oVar.iWidth = 500; oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=RECREATE"; sWindowName = "winAction"; // oVar.sUrl = "../ApvProcess/ApvprocessDraft.aspx?type=RECREATE";
        if (g_IS_TabUI == "Y")
            oVar.IS_Tab = "Y";
    }
}

doButtonCase['btCharge'] = function (oBtn, oVar) {//재기안담당자 지정
    m_sAddList = 'charge'; Open_Forward(m_sAddList);
}

doButtonCase['btDeptLine'] = function (oBtn, oVar) {//재기안결재선관리
    oVar.sUrl = "/Approval/ApvlineMgr/ApvlineMgr.aspx";
    if (g_IS_TabUI == "Y")
        oVar.IS_Tab = "Y";
}
doButtonCase['btDeptLineW'] = function (oBtn, oVar) {//재기안결재선관리
    oVar.sUrl = "/Approval/ApvlineMgr/ApvlineMgr.aspx";
    if (g_IS_TabUI == "Y")
        oVar.IS_Tab = "Y";
}

doButtonCase['btInvestPrint'] = function (oBtn, oVar) {//인쇄
    if (_ie) {
        $("[name=WF_COMMENT_modifyRow]").each(function (i) {
            $(this).css("display", 'none');
        });
        $("[name=WF_COMMENT_deleteRow]").each(function (i) {
            $(this).css("display", 'none');
        });

        if (getInfo('loct') == 'PROCESS') {
            //SetFileAttaching();
        }

        document.getElementById("CommentList").style.display = "none";

        printDiv = "<html><body>" + getBodyHTML("INVEST") + "</body></html>";

        m_CmtBln = false;
        if (getInfo("readtype") == "preview") { //작성 -> 미리보기 -> 인쇄미리보기 일경우
            opener.m_oFormEditor.bPresenceView = false;
        } else {
            m_oFormEditor.bPresenceView = false;
        }
        //displayApvList(oVar.m_evalXML);
        oVar.iWidth = 790;
        //가로양식
        if (IsWideOpenFormCheck(getInfo("fmpf"))) {
            oVar.iWidth = 1070;
        }
        oVar.iHeight = window.screen.height - 82;

        //oVar.iWidth = 800; oVar.iHeight = 700;
        gPrintType = "0";
        if (gPrintType == "0") {
            oVar.sUrl = "/Approval/Forms/PrintForm.aspx?processInstanceId=" + getInfo("piid") + "&parentProcessInstanceId=" + getInfo("piid_parent");
        } else if (gPrintType == "1") {
            m_oFormReader.print_part('editor');
        }
        m_CmtBln = true;
        if (getInfo("readtype") == "preview") { //작성 -> 미리보기 -> 인쇄미리보기 일경우
            opener.m_oFormEditor.bPresenceView = true;
        } else {
            m_oFormEditor.bPresenceView = true;
        }

        //for (var i = 0; i < $("[name=WF_COMMENT_modifyRow]").length; i++) ;
        $("[name=WF_COMMENT_modifyRow]").each(function (i) {
            $(this).css("display", '');
        });
        $("[name=WF_COMMENT_deleteRow]").each(function (i) {
            $(this).css("display", '');
        });
        setInlineApvList(oVar.m_evalXML);
    } else {
        m_CmtBln = false;
        bPresenceView = false;
        //$("#trAttFileInfo").css("display", "none");
        SetFileAttaching();
        //displayApvList(oVar.m_evalXML);
        printDiv = "<html><body>" + getBodyHTML('print') + "</body></html>";
        //if (!_ie) {
        //    oVar.iWidth = 1000; oVar.iHeight = 700;
        //} else {
        //    oVar.iWidth = 100; oVar.iHeight = 100;
        //}
        //  oVar.iWidth = 800; oVar.iHeight = 700;
        oVar.iWidth = 790;
        //가로양식
        if (IsWideOpenFormCheck(getInfo("fmpf"))) {
            oVar.iWidth = 1070;
        }
        oVar.iHeight = window.screen.height - 82;
        //차기 제품 하드코딩 start- hichang
        gPrintType = "0";
        //차기 제품 하드코딩 end- hichang

        if (gPrintType == "0") {
            if ((getInfo("readtype") == "preview")) {
                //window.print();//_최우석
                oVar.sUrl = "/Approval/Forms/Print.aspx";
            } else {
                oVar.sUrl = "/Approval/Forms/Print.aspx";

            }
        } else if (gPrintType == "1") {
            m_oFormReader.print_part('editor');
        }

        m_CmtBln = true;
        bPresenceView = true;
        setInlineApvList(oVar.m_evalXML);
    }

}

doButtonCase['btAttach'] = function (oBtn, oVar) {//첨부파일	
    if (window.ActiveXObject === undefined) {//CB
        attFile3(); oVar.iWidth = 280; oVar.iHeight = 150;
    } else {
        if (gFileAttachType == "1") { //시스템 사용 첨부파일 컴포턴트 0 : CoviFileTrans, 1:DEXTUploadX					
            attFile(); oVar.iWidth = 480; oVar.iHeight = 326;
        } else {
            attFile2(); oVar.iWidth = 480; oVar.iHeight = 326;
        }
    }
}

doButtonCase['menu2'] = function (oBtn, oVar) {//첨부..
    if (gFileAttachType == "1") { //시스템 사용 첨부파일 컴포턴트 0 : CoviFileTrans, 1:DEXTUploadX					
        attFile(); oVar.iWidth = 480; oVar.iHeight = 326;
    } else {
        attFile2(); oVar.iWidth = 480; oVar.iHeight = 326;
    }
}

doButtonCase['btPreView'] = function (oBtn, oVar) {//미리보기
    (window.navigator.userAgent.toLowerCase().indexOf('firefox') > -1) ? oVar.sSize = "scroll" : oVar.sSize = "fix";

    oVar.iWidth = 790;

    //가로양식
    if (IsWideOpenFormCheck(getInfo("fmpf"))) {
        oVar.iWidth = 1070;
    }
    else if (getInfo("chkHorizontalFormYN") != undefined) {
        if (getInfo("chkHorizontalFormYN") == "Y") {
            oVar.iWidth = 1070;
        }
    }
    oVar.iHeight = window.screen.height - 82;
    oVar.sUrl = String(document.location.href);
    oVar.sUrl = oVar.sUrl.replace("FormWrite", "Form"); //바닥 작성창에서 Open할 경우
    if (oVar.sUrl.lastIndexOf("#") == (oVar.sUrl.length - 1)) { oVar.sUrl = oVar.sUrl.substring(0, oVar.sUrl.lastIndexOf("#")); } //url에 #이 포함되어 있음 제거처리
    oVar.sUrl = oVar.sUrl + "&Readtype=preview";
    //신세계 Layer 수정 적용
    //2016-06-08
    //YJYOO
    if (CFN_GetQueryString("openID") != "undefined") {
        oVar.sUrl = oVar.sUrl.split('&');
        oVar.sUrl = oVar.sUrl[0] + oVar.sUrl[1] + oVar.sUrl[2] + oVar.sUrl[3];
    }

}

doButtonCase['btPrint'] = function (oBtn, oVar) {//인쇄
    //파워텍 경상예산집행품의 만 예외 처리
    if (getInfo("fmpf") == "WF_HPT_SAP_PREFIX_001") {
        fn_callPrint(1);
    }
    //if (oVar.elmComment.length == 0) {
    //    try { document.getElementById("CommentList").style.display = "none"; } catch (e) { }
    //} else {
    //    // (2016-05-31 leesm) AS-IS 에서 WF_FORM_DRAFT_EB0_003 양식은 출력 시 의견리스트가 무조건 보이게 처리되어 있으므로 추가함.
    //    if (getInfo("fmpf") == "WF_FORM_DRAFT_EB0_003") {
    //        try { document.getElementById("CommentList").style.display = ""; } catch (e) { }
    //    }
    //    else if (confirm(gMessage288.replace(/\\n/g, '\n'))) {//"의견을 포함하여 인쇄하시겠습니까?\n [확인]->[의견포함],\n [닫기]->[의견미포함]"
    //        try { document.getElementById("CommentList").style.display = ""; } catch (e) { }
    //    } else {
    //        try { document.getElementById("CommentList").style.display = "none"; } catch (e) { }
    //    }
    //}
    //if (_ie) {

        if (!_ie && (getInfo("fmpf") == "OFFICAL_DOCUMENT_02" || getInfo("fmpf") == "OFFICAL_DOCUMENT_01")) {
            alert("[대외공문]인쇄는 IE 에서만 지원 가능합니다.");
        } else {
            //for (var i = 0; i < $("[name=WF_COMMENT_modifyRow]").length; i++) ;
            $("[name=WF_COMMENT_modifyRow]").each(function (i) {
                $(this).css("display", 'none');
            });
            $("[name=WF_COMMENT_deleteRow]").each(function (i) {
                $(this).css("display", 'none');
            });

            if (getInfo('loct') == 'PROCESS') {
                //SetFileAttaching();
            }

            if (getInfo("scOPub") == "1") {
                try {
                    if (document.getElementById("rowcnt_doc").value != "0") {
                        document.getElementById("ADD_rowCnt_Doc").style.height = (document.getElementById("rowcnt_doc").value * 50) + "px";
                    }
                } catch (e) { }
                try {
                    document.getElementById("CommentList").style.display = "none";
                    //document.getElementById("CCLine").style.display = "none";
                } catch (e) { }

                printDiv = "<html><body>" + getBodyHTML() + "</body></html>";
            }
            else {
                if (oVar.elmComment.length == 0) {
                    try { document.getElementById("CommentList").style.display = "none"; } catch (e) { }
                } else {
                    try { document.getElementById("CommentList").style.display = "none"; } catch (e) { }
                    //// (2016-05-31 leesm) AS-IS 에서 WF_FORM_DRAFT_EB0_003 양식은 출력 시 의견리스트가 무조건 보이게 처리되어 있으므로 추가함.
                    //if (getInfo("fmpf") == "WF_FORM_DRAFT_EB0_003") {
                    //    try { document.getElementById("CommentList").style.display = ""; } catch (e) { }
                    //}
                    //else if (confirm(gMessage288.replace(/\\n/g, '\n'))) {//"의견을 포함하여 인쇄하시겠습니까?\n [확인]->[의견포함],\n [닫기]->[의견미포함]"
                    //    try { document.getElementById("CommentList").style.display = ""; } catch (e) { }
                    //} else {
                    //    try { document.getElementById("CommentList").style.display = "none"; } catch (e) { }
                    //}
                }
                printDiv = "<html><body>" + getBodyHTML() + "</body></html>";
            }

            m_CmtBln = false;
            if (getInfo("readtype") == "preview") { //작성 -> 미리보기 -> 인쇄미리보기 일경우
                opener.m_oFormEditor.bPresenceView = false;
            } else {
                m_oFormEditor.bPresenceView = false;
            }
            //displayApvList(oVar.m_evalXML);
            oVar.iWidth = 790;
            //가로양식
            if (IsWideOpenFormCheck(getInfo("fmpf"))) {
                oVar.iWidth = 1070;
            }
            else if (getInfo("chkHorizontalFormYN") != undefined)
            {
                if (getInfo("chkHorizontalFormYN") == "Y") {
                    oVar.iWidth = 1070;
                }
            }
            oVar.iHeight = window.screen.height - 82;

            //oVar.iWidth = 800; oVar.iHeight = 700;
            gPrintType = "0";
            if (gPrintType == "0") {
                oVar.sUrl = "/Approval/Forms/PrintForm.aspx?processInstanceId=" + getInfo("piid") + "&parentProcessInstanceId=" + getInfo("piid_parent");
            } else if (gPrintType == "1") {
                m_oFormReader.print_part('editor');
            }
            m_CmtBln = true;
            if (getInfo("readtype") == "preview") { //작성 -> 미리보기 -> 인쇄미리보기 일경우
                opener.m_oFormEditor.bPresenceView = true;
            } else {
                m_oFormEditor.bPresenceView = true;
            }

            //for (var i = 0; i < $("[name=WF_COMMENT_modifyRow]").length; i++) ;
            $("[name=WF_COMMENT_modifyRow]").each(function (i) {
                $(this).css("display", '');
            });
            $("[name=WF_COMMENT_deleteRow]").each(function (i) {
                $(this).css("display", '');
            });
            setInlineApvList(oVar.m_evalXML);
        }

    /*
    } else {
        m_CmtBln = false;
        bPresenceView = false;
        //$("#trAttFileInfo").css("display", "none");
        SetFileAttaching();
        //displayApvList(oVar.m_evalXML);
        printDiv = "<html><body>" + getBodyHTML('print') + "</body></html>";
        //if (!_ie) {
        //    oVar.iWidth = 1000; oVar.iHeight = 700;
        //} else {
        //    oVar.iWidth = 100; oVar.iHeight = 100;
        //}
        //  oVar.iWidth = 800; oVar.iHeight = 700;
        oVar.iWidth = 790;
        //가로양식
        if (IsWideOpenFormCheck(getInfo("fmpf"))) {
            oVar.iWidth = 1070;
        }
        else if (getInfo("chkHorizontalFormYN") != undefined) {
            if (getInfo("chkHorizontalFormYN") == "Y") {
                oVar.iWidth = 1070;
            }
        }
        oVar.iHeight = window.screen.height - 82;
        //차기 제품 하드코딩 start- hichang
        gPrintType = "0";
        //차기 제품 하드코딩 end- hichang

        if (gPrintType == "0") {
            if ((getInfo("readtype") == "preview")) {
                //window.print();//_최우석
                oVar.sUrl = "/Approval/Forms/Print.aspx";
            } else {
                oVar.sUrl = "/Approval/Forms/Print.aspx";

            }
        } else if (gPrintType == "1") {
            m_oFormReader.print_part('editor');
        }

        m_CmtBln = true;
        bPresenceView = true;
        setInlineApvList(oVar.m_evalXML);
    }
    */

    //파워텍 경상예산집행품의 만 예외 처리
    if (getInfo("fmpf") == "WF_HPT_SAP_PREFIX_001") {
        fn_callPrint(2);
    }
}

// 인쇄 미리보기 기능
function SetFileAttaching() {
    var szAttFileInfo = "";
    var List;
    if ($('#ATTACH_FILE_INFO').val() == "") return;

    if (CFN_GetQueryString("Readtype") == "preview")
        List = GetOpenerApprovalUpLoadFileList();
    else
        List = GetApprovalUpLoadFileList();
    //  console.dir(List);

    szAttFileInfo = "<div style='padding:2pt 0 2pt 0;'>";
    $.each(List, function () {
        var Name = this.FileName;
        var Size = this.FileSize;

        if (Size >= 1024) {
            Size = Size / 1024;
            Size = parseFloat(Size).toFixed(3);
            szAttFileInfo += "<p><img src='/images/images/Approval/ico_attach.gif' border='0'>" + "&nbsp;" + Name;

            + " (" + Size + "MB)" + "</p>";
        }
        else {
            szAttFileInfo += "<p><img src='/images/images/Approval/ico_attach.gif' border='0'>" + "&nbsp;" + Name;

            if (Size > 0) {
                szAttFileInfo += " (" + parseFloat(Size).toFixed(3) + "KB)";
            }
            szAttFileInfo += "</p>"
        }
    });
    szAttFileInfo += "</div>";

    $("#AttFileInfo").html(szAttFileInfo);

}
doButtonCase['btPrintView'] = function (oBtn, oVar) {//인쇄미리보기
    if (!_ie && (getInfo("fmpf") == "OFFICAL_DOCUMENT_02" || getInfo("fmpf") == "OFFICAL_DOCUMENT_01")) {
        alert("[대외공문]인쇄는 IE 에서만 지원 가능합니다.");
    } else {

        SetFileAttaching();
        //for (var i = 0; i < $("[name=WF_COMMENT_modifyRow]").length; i++) ;
        $("[name=WF_COMMENT_modifyRow]").each(function (i) {
            $(this).css("display", 'none');
        });
        $("[name=WF_COMMENT_deleteRow]").each(function (i) {
            $(this).css("display", 'none');
        });

        if (getInfo("scOPub") == "1") {
            try {
                if (document.getElementById("rowcnt_doc").value != "0") {
                    document.getElementById("ADD_rowCnt_Doc").style.height = (document.getElementById("rowcnt_doc").value * 50) + "px";
                }
            } catch (e) { }
            try {
                document.getElementById("CommentList").style.display = "none";
                //document.getElementById("CCLine").style.display = "none";
            } catch (e) { }

            printDiv = "<html><body>" + getBodyHTML() + "</body></html>";

        }
        else {
            if (oVar.elmComment.length == 0) {
                try { document.getElementById("CommentList").style.display = "none"; } catch (e) { }
            } else {
                // (2016-05-31 leesm) AS-IS 에서 WF_FORM_DRAFT_EB0_003 양식은 출력 시 의견리스트가 무조건 보이게 처리되어 있으므로 추가함.
                if (getInfo("fmpf") == "WF_FORM_DRAFT_EB0_003") {
                    try { document.getElementById("CommentList").style.display = ""; } catch (e) { }
                }
                else if (confirm(gMessage288.replace(/\\n/g, '\n'))) {//"의견을 포함하여 인쇄하시겠습니까?\n [확인]->[의견포함],\n [닫기]->[의견미포함]"
                    try { document.getElementById("CommentList").style.display = ""; } catch (e) { }
                } else {
                    try { document.getElementById("CommentList").style.display = "none"; } catch (e) { }
                }
            }

            printDiv = "<html><body>" + getBodyHTML() + "</body></html>";
        }

        m_CmtBln = false;
        if (getInfo("readtype") == "preview") { //작성 -> 미리보기 -> 인쇄미리보기 일경우
            opener.m_oFormEditor.bPresenceView = false;
        } else {
            m_oFormEditor.bPresenceView = false;
        }

        //displayApvList(oVar.m_evalXML);
        oVar.iWidth = 800; oVar.iHeight = 700;
        gPrintType = "0";
        if (gPrintType == "0") {
            oVar.sUrl = "/Approval/Forms/PrintForm.aspx?processInstanceId=" + CFN_GetQueryString("processInstanceId");
        } else if (gPrintType == "1") {
            m_oFormReader.print_part('editor');
        }
        m_CmtBln = true;
        if (getInfo("readtype") == "preview") { //작성 -> 미리보기 -> 인쇄미리보기 일경우
            opener.m_oFormEditor.bPresenceView = true;
        } else {
            m_oFormEditor.bPresenceView = true;
        }

        $("[name=WF_COMMENT_modifyRow]").each(function (i) {
            $(this).css("display", '');
        });
        $("[name=WF_COMMENT_deleteRow]").each(function (i) {
            $(this).css("display", '');
        });

        setInlineApvList(oVar.m_evalXML);
    }

}

doButtonCase['btHistory'] = function (oBtn, oVar) {//히스토리				
    //2013-06-10 YHM 히스트리 창 크기 조정
    var vwidth = 790;
    //가로양식
    if (IsWideOpenFormCheck(getInfo("fmpf"))) {
        vwidth = 1070;
    }

    oVar.iWidth = vwidth;
    var vheight = (window.screen.height - 82);
    oVar.iHeight = vheight;

    if (openID != null && openMode == "L") {
        oVar.sUrl = "/Approval/Forms/HistoryList.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&fmpf=" + getInfo("fmpf") + "&fmrv=" + getInfo("fmrv");
    } else {
        oVar.sUrl = "/Approval/Forms/HistoryList.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&fmpf=" + getInfo("fmpf") + "&fmrv=" + getInfo("fmrv");
    }
}

doButtonCase['btDocBodyHistory'] = function (oBtn, oVar) { //YHM 본문비교
    oVar.iWidth = 800;
    oVar.iHeight = 700;
    oVar.sUrl = "DocBodyHistory.aspx?piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&fmpf=" + getInfo("fmpf") + "&fmrv=" + getInfo("fmrv");
}

doButtonCase['btBBS'] = function (oBtn, oVar) {
    var rtnBBS = GetFolderSelect(); // 게시판 선택 SiteRefence/js/Utilty.js 

    if (rtnBBS == undefined) { return; }
    if (rtnBBS != null & rtnBBS[0] != "") {
        rtnBBS = "<BBS><ID_FOLDER>" + rtnBBS[0] + "</ID_FOLDER>" + "<NAME_FORDER>" + rtnBBS[1] + "</NAME_FORDER>" + "<SUBJECT>" + getInfo("SUBJECT") + "</SUBJECT><HTML_BODY><![CDATA[" + document.getElementById("bodytable").innerHTML + "]]></HTML_BODY></BBS>";
        CFN_CallAjax("SendBBS.aspx", rtnBBS, function (data) {
            receiveBBSHTTP(data);
        }, false, "xml");
    }
}

doButtonCase['btSave'] = function (oBtn, oVar) {//임시저장
    if (document.getElementById("SUBJECT").value.trim() == "") {
        //var subject = getInfo("fmnm");
        var subject = Common.GetDic("FormName_" + getInfo("etid") + "_" + getInfo("fmpf"));
        document.getElementById("SUBJECT").value = subject;
        m_TempSaveInfo = true;
        m_TempSave = true;
    }
    if ((getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") && getInfo("scFRMAPVLINE") == "1") {
        chkApplyAPVLine();
    }
    if (!FormAttachProcess("btSave"))
        return false;
    m_sReqMode = "TEMPSAVE";
    //   if (Common.GetBaseConfig('FileAttachType') != '6') {
    requestProcess("TEMPSAVE");
    // }
}

doButtonCase['btSaveInfo'] = function (oBtn, oVar) { //2012-10-25 WR 임시보관함열기
    var x = 840;
    var y = 870;

    oVar.iWidth = window.screen.width / 2 - x / 2 + 570;
    oVar.iHeight = window.screen.height / 2 - y / 2 + 700;

    if (oVar.iHeight < 0) {
        oVar.iHeight = 0;
    }

    oVar.sUrl = "TempList.aspx?&fmpf=" + getInfo("fmpf") + "&fmrv=" + getInfo("fmrv") + "&fmid=" + getInfo("fmid");
}

doButtonCase['btComFormInfo'] = function (oBtn, oVar) { //2012-10-31 우람 본문가져오기
    var x = 840;
    var y = 870;

    oVar.iWidth = window.screen.width / 2 - x / 2 + 570;
    oVar.iHeight = window.screen.height / 2 - y / 2 + 700;

    if (oVar.iHeight < 0) {
        oVar.iHeight = 0;
    }
    oVar.sSize = "fix";

    oVar.sUrl = "GetFormInfo.aspx";
}

doButtonCase['btMail'] = function (oBtn, oVar) {//전자메일발송
    CFN_OpenWindow("PostMail.aspx", "MAIL", "800", "600", "resize");
}

//doButtonCase['btDoc'] = function (oBtn, oVar) {//문서요약정보
//    viewSummary();
//}

//doButtonCase['btInfo'] = function (oBtn, oVar) {  //정보버튼 2012-10-22 고우람
//    oVar.iHeight = 140; oVar.iWidth = 300; oVar.sSize = "fix";
//    oVar.sUrl = "../Popup/SearchFormInfo.aspx";
//}

doButtonCase['btPost'] = function (oBtn, oVar) {//게시판등록
    formPost();
}

doButtonCase['btModify'] = function (oBtn, oVar) {//수정

    // 건설계열사일 경우에만 새창으로 띄운 경우
    if (Common.GetBaseConfig("HEC_COMPANY") == "Y") {
        if (CFN_GetQueryString("CFN_OpenWindowName") != 'undefined' && location.href.indexOf("CFN_OpenWindowName") > -1) {
            if (!IsWideOpenFormCheckReal(getInfo("fmpf"), Common.GetSession("DN_Code"))) {
                var wWidth = parseInt(Common.GetBaseConfig("TallOpenFormWidth")) + parseInt(20)
                window.resizeTo(wWidth, window.outerHeight);
            }
        }
    }
    
    var submitForm = document.createElement("FORM");
    document.body.appendChild(submitForm);
    submitForm.method = "POST";
    submitForm.name = "DocModify";

    if (getInfo("ChkReceiptManagement") != "Y") {
        var newElement = document.createElement("TEXTAREA");
        submitForm.appendChild(newElement);
        newElement.id = 'DocModifyApvLine';
        newElement.name = 'DocModifyApvLine';
        newElement.value = encodeURIComponent(document.getElementById("APVLIST").value);
        newElement.style.display = 'none';
    }

    submitForm.target = "_self";
    submitForm.action = window.location.href.replace("#", "").replace("&editMode=N", "").replace("&reuse=", "") + "&editMode=Y&reuse=";
    submitForm.submit();
}


doButtonCase['btModifyE'] = function (oBtn, oVar) {//수정

    // 건설계열사일 경우에만 새창으로 띄운 경우
    if (Common.GetBaseConfig("HEC_COMPANY") == "Y") {
        if (CFN_GetQueryString("CFN_OpenWindowName") != 'undefined' && location.href.indexOf("CFN_OpenWindowName") > -1) {
            if (!IsWideOpenFormCheckReal(getInfo("fmpf"), Common.GetSession("DN_Code"))) {
                var wWidth = parseInt(Common.GetBaseConfig("TallOpenFormWidth")) + parseInt(20)
                window.resizeTo(wWidth, window.outerHeight);
            }
        }
    }

    var submitForm = document.createElement("FORM");
    document.body.appendChild(submitForm);
    submitForm.method = "POST";
    submitForm.name = "DocModify";

    if (getInfo("ChkReceiptManagement") != "Y") {
        var newElement = document.createElement("TEXTAREA");
        submitForm.appendChild(newElement);
        newElement.id = 'DocModifyApvLine';
        newElement.name = 'DocModifyApvLine';
        newElement.value = encodeURIComponent(document.getElementById("APVLIST").value);
        newElement.style.display = 'none';
    }

    submitForm.target = "_self";
    submitForm.action = window.location.href.replace("#", "").replace("&editMode=N", "").replace("&reuse=", "") + "&editMode=M&reuse=";
    submitForm.submit();
}

doButtonCase['btModifyComplete'] = function (oBtn, oVar) {//고객만족 처리전 완료된 문서 편집버튼
    // 건설계열사일 경우에만 새창으로 띄운 경우
    if (Common.GetBaseConfig("HEC_COMPANY") == "Y") {
        if (CFN_GetQueryString("CFN_OpenWindowName") != 'undefined' && location.href.indexOf("CFN_OpenWindowName") > -1) {
            if (!IsWideOpenFormCheckReal(getInfo("fmpf"), Common.GetSession("DN_Code"))) {
                var wWidth = parseInt(Common.GetBaseConfig("TallOpenFormWidth")) + parseInt(20)
                window.resizeTo(wWidth, window.outerHeight);
            }
        }
    }

    var submitForm = document.createElement("FORM");
    document.body.appendChild(submitForm);
    submitForm.method = "POST";
    submitForm.name = "DocModify";
    var newElement = document.createElement("TEXTAREA");
    submitForm.appendChild(newElement);
    newElement.id = 'DocModifyApvLine';
    newElement.name = 'DocModifyApvLine';
    newElement.value = encodeURIComponent(document.getElementById("APVLIST").value);
    newElement.style.display = 'none';
    submitForm.target = "_self";
    submitForm.action = window.location.href.replace("#", "").replace("&editMode=N", "").replace("&reuse=", "") + "&editMode=Y&reuse=";
    submitForm.submit();
}

doButtonCase['btModifyITG'] = function (oBtn, oVar) { //현대건설, 엔지니어링 통합결재시스템 수정페이지 오픈 버튼
	mf_OpenIntegratedWindow();
}

function mf_OpenIntegratedWindow() {
    if (typeof formJson.oFormData != "undefined") {
        if (typeof formJson.oFormData.LGY_SYSTEM_ID != 'undefined') {
            if (formJson.BODY_CONTEXT.LGY_SYSTEM_ID.toUpperCase() != "IWF") {
                return;
            }
        }
    }

    //시간정보확인    
    if (getInfo("mode").toUpperCase() != "DRAFT" && getInfo("mode").toUpperCase() != "TEMPSAVE") {
        var getInfo_LastModifyDateTime = getInfo("LAST_MODIFIED_DATE");
        var if_LastModifyDateTime = "";

        var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/GetDocLastModifiedDate";
        var Param = String.format("{ piid:'{0}' }", (typeof getInfo("piid_parent") != "undefined" && getInfo("piid_parent") != "") ? getInfo("piid_parent") : getInfo("piid"));
        CFN_CallAjaxJson(szURL, Param, false, function (pObjData) {
            if_LastModifyDateTime = String($.parseJSON(pObjData).d);
            if (getInfo_LastModifyDateTime != if_LastModifyDateTime)
            {
                Common.Warning(Common.GetDic("HDEC_LBL_ITG_EDIT_ERROR"));
                return;
            }
            else {
                Common.Confirm(Common.GetDic("msg_HDEC_Content_Edit"), "Confirmation Dialog", function (result) {
                    if(result) {
                        //[GreatJSK][20200813]
                        if (getInfo("mode") == "TEMPSAVE") {
                            TempApprovalStateSave();
                        } else {
                            //저장버튼 클릭
                            //$("#btchangeSave").trigger("click");
                            ////통합결재 편집이동
                            //EditIntegratedApproval();
                            changeFormDataFromIntegratedForm();
                        }
                    }
                    else {
                        return;
                    }
                });
            }
        });
    }
    else {
        Common.Confirm(Common.GetDic("msg_HDEC_Content_Edit"), "Confirmation Dialog", function (result)
        {
            if(result) {
                //[GreatJSK][20200813]
                if (getInfo("mode") == "TEMPSAVE") {
                    TempApprovalStateSave();
                } else {
                    ////저장버튼 클릭
                    //$("#btchangeSave").trigger("click");
                    ////통합결재 편집이동
                    //EditIntegratedApproval();
                    changeFormDataFromIntegratedForm();
                }
            }
            else {
                return;
            }
        });
    }
}


doButtonCase['btchangeSave'] = function (oBtn, oVar) {//수정저장
    //TO-DO : 결재문서 수정내역 관리를 위하여 수정일자 관리적용(전체 그룹사 공통 적용 : 현대엔지니어링-> 수신복수 담당자(MULTIUSER), 그외 그룹사 : 수신담당자(ROLE))
    //2020-09-17 BY YJYOO
    var iscontinue = false;
    try{
        var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
        var current_user_type = "";
        var current_taskinfo = $(m_oApvList).find("person > taskinfo[status='pending']");
        if (current_taskinfo.length > 0 && $(current_taskinfo[0]).parent().parent()[0].nodeName.toUpperCase() == "ROLE") {
            current_user_type = "ROLE";
        }
        if (current_taskinfo.length > 0 && $(current_taskinfo[0]).parent().parent().parent()[0].nodeName.toUpperCase() == "STEP" && $(current_taskinfo[0]).parent().parent().parent().attr("routetype") == "multi_charge")
        {
            current_user_type = "MULTI_CHARGE";
        }
        if (current_taskinfo.length > 0 && $(current_taskinfo[0]).parent().parent().parent()[0].nodeName.toUpperCase() == "STEP" && $(current_taskinfo[0]).parent().parent().parent().attr("routetype") == "receive_dept") {
            current_user_type = "RECEIVE_DEPT";
        }
        if (current_user_type != "") {
            var getInfo_LastModifyDateTime = getInfo("LAST_MODIFIED_DATE");
            var if_LastModifyDateTime = "";
            var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/GetDocLastModifiedDate";
            var Param = String.format("{ piid:'{0}' }", (typeof getInfo("piid_parent") != "undefined" && getInfo("piid_parent") != "") ? getInfo("piid_parent") : getInfo("piid"));
            CFN_CallAjaxJson(szURL, Param, false, function (pObjData) {
                if_LastModifyDateTime = String($.parseJSON(pObjData).d);

                if (getInfo_LastModifyDateTime != if_LastModifyDateTime) {
                    Common.Warning(Common.GetDic("HDEC_LBL_ITG_EDIT_ERROR"));
                    return;
                }
                else {
                    iscontinue = true;
                }
            });

        }
        else {
            iscontinue = true;
        }
    }
    catch(e){
        iscontinue = true;
    }

    if(iscontinue){
        if (getInfo("editmode") == "M") {
            changeFormdata();
        } else {
            if (checkForm(false))
                changeFormdata();
        }
    }
}

doButtonCase['btchangeSave_CUSTOMERSAT'] = function (oBtn, oVar) {//고객만족 처리전 완료된 문서 편집버튼
    //if (getInfo("editmode") == "M") {
    //    changeFormdata();
    //}
    //else {
    if (checkForm(false))
        changeFormdata_CUSTOMERSAT();
    //}
}

doButtonCase['btECNMail'] = function (oBtn, oVar) {//ECN 전자메일변환
    sendECNMail();
}

doButtonCase['btExit'] = function (oBtn, oVar) {
    try { parent.parent.Form_Close(); } catch (e) {
        //[Hybrid]
        try {
            if (navigator.userAgent.toString().indexOf("COVI_HYBRID", 0) > -1) {
                if (_android) {
                    window.HybridApp.CloseApproval();
                }
                else if (_ipad || _iphone) {
                    window.location = "closeapproval://"
                }
            }
        }
        catch (e) {
        }
        //[Hybrid]
    }
    if (parent.close() == undefined) {
        try { if (m_bTabForm) { parent.parent.closeFormbyForm(); } else { parent.parent.parent.close(); } } catch (e) { }
    }
}

doButtonCase['btTrans'] = function (oBtn, oVar) {//내부결재선관리
    if (getInfo("scIPub") == '1') {
        Common.Confirm(gMessage100, "Confirmation Dialog", function (result) { //"의견을 포함하여 인쇄하시겠습니까?\n [확인]->[의견포함],\n [닫기]->[의견미포함]"
            if (result) {
                m_oFormEditor.initEnforceForm();
            } else {
                m_oFormEditor.initEnforceForm();
            }

        });
    } else { m_oFormEditor.initEnforceForm(); }
}

doButtonCase['btITrans'] = function (oBtn, oVar) {//시행문변환
    requestProcess("ITRANS");
}

doButtonCase['btOTrans'] = function (oBtn, oVar) {//대외공문변환
    var appLastUser = "";

    if (getInfo("DOC_SUMMARY") == "M" && formJson.BODY_CONTEXT.OFFICIAL_SENDER_ID != null) {
        appLastUser = "H110000" + formJson.BODY_CONTEXT.OFFICIAL_SENDER_ID.replace("Q03", "");
    } else {
        appLastUser = ($("#signImage").val() == "") ? $("#last_user").val() : $("#signImage").val();
    }
    if (IsOfficePrintFormCheck(getInfo("fmpf"))) {
        if (getInfo("fmpf") == "WF_HEC_EXT_LETTER") { // 현대엔지니어링 대외공문
            oVar.sSize = "scroll";
            oVar.iWidth = 790;
            oVar.iHeight = window.screen.height - 82; //oVar.sUrl="PreView.aspx";
            oVar.sUrl = String("/Approval/Forms/Templates/popup/HEC/PreView_HEC_EXT_LETTER.aspx?");
            oVar.sUrl = oVar.sUrl.replace("FormWrite", "Form"); //바닥 작성창에서 Open할 경우
            if (oVar.sUrl.lastIndexOf("#") == (oVar.sUrl.length - 1)) { oVar.sUrl = oVar.sUrl.substring(0, oVar.sUrl.lastIndexOf("#")); } //url에 #이 포함되어 있음 제거처리
            //oVar.sUrl = oVar.sUrl + "&ReadType=Print&editMode=P";
            oVar.sUrl = oVar.sUrl + "&appLastUser=" + appLastUser + "&ReadType=Print&editMode=P";
            m_CmtBln = true;
            bPresenceView = true;
            printDiv = "<html><body>" + getBodyHTML("PUB") + "</body></html>";
        }
        else if (getInfo("fmpf") == "WF_HDEC_EXT_LETTER") { // 현대건설 대외공문
            oVar.sSize = "scroll";
            oVar.iWidth = 790;
            oVar.iHeight = window.screen.height - 82; //oVar.sUrl="PreView.aspx";
            oVar.sUrl = String("/Approval/Forms/Templates/popup/HDEC/PreView_HDEC_EXT_LETTER.aspx?");
            oVar.sUrl = oVar.sUrl.replace("FormWrite", "Form"); //바닥 작성창에서 Open할 경우
            if (oVar.sUrl.lastIndexOf("#") == (oVar.sUrl.length - 1)) { oVar.sUrl = oVar.sUrl.substring(0, oVar.sUrl.lastIndexOf("#")); } //url에 #이 포함되어 있음 제거처리
            //oVar.sUrl = oVar.sUrl + "&ReadType=Print&editMode=P";
            oVar.sUrl = oVar.sUrl + "&appLastUser=" + appLastUser + "&ReadType=Print&editMode=P";
            m_CmtBln = true;
            bPresenceView = true;
            printDiv = "<html><body>" + getBodyHTML("PUB") + "</body></html>";
        }
        else if (getInfo("fmpf") == "WF_HESI_EXTERNAL_OFFICIAL") {  // 현대스틸산업 대외공문
            oVar.sSize = "scroll";
            oVar.iWidth = 790;
            oVar.iHeight = window.screen.height - 82; //oVar.sUrl="PreView.aspx";
            oVar.sUrl = String("/Approval/Forms/Templates/popup/HESI/PreView_HESI_EXTERNAL_OFFICIAL.aspx?");
            oVar.sUrl = oVar.sUrl.replace("FormWrite", "Form"); //바닥 작성창에서 Open할 경우
            if (oVar.sUrl.lastIndexOf("#") == (oVar.sUrl.length - 1)) { oVar.sUrl = oVar.sUrl.substring(0, oVar.sUrl.lastIndexOf("#")); } //url에 #이 포함되어 있음 제거처리
            //oVar.sUrl = oVar.sUrl + "&ReadType=Print&editMode=P";
            oVar.sUrl = oVar.sUrl + "&appLastUser=" + appLastUser + "&ReadType=Print&editMode=P";
            m_CmtBln = true;
            bPresenceView = true;
            printDiv = "<html><body>" + getBodyHTML("PUB") + "</body></html>";
        }
        else if (getInfo("fmpf") == "WF_HSTEEL_EXT_LETTER_SENT") { // 현대제철 사외공문발송
            oVar.sSize = "scroll"; 
            oVar.iWidth = 790;
            oVar.iHeight = window.screen.height - 82; //oVar.sUrl="PreView.aspx";
            oVar.sUrl = String("/Approval/Forms/Templates/popup/HSTEEL/PreView_HSTEEL_EXT_LETTER_SENT.aspx?");
            oVar.sUrl = oVar.sUrl.replace("FormWrite", "Form"); //바닥 작성창에서 Open할 경우
            if (oVar.sUrl.lastIndexOf("#") == (oVar.sUrl.length - 1)) { oVar.sUrl = oVar.sUrl.substring(0, oVar.sUrl.lastIndexOf("#")); } //url에 #이 포함되어 있음 제거처리
            //oVar.sUrl = oVar.sUrl + "&ReadType=Print&editMode=P";
            oVar.sUrl = oVar.sUrl + "&appLastUser=" + appLastUser + "&ReadType=Print&editMode=P";
            m_CmtBln = true;
            bPresenceView = true;
            printDiv = "<html><body>" + getBodyHTML("PUB") + "</body></html>";
        } 
        else if (getInfo("fmpf") == "HWFP_GLOVIS_OFFICIAL_W01") { //현대글로비스 사외공문 발송 미리보기 
            oVar.sSize = "scroll";
            oVar.iWidth = 790;
            oVar.iHeight = window.screen.height - 82; //oVar.sUrl="PreView.aspx";
            oVar.sUrl = String("/Approval/Forms/Templates/popup/GLOVIS/PreviewOfficialDocuments.aspx?");
            oVar.sUrl = oVar.sUrl.replace("FormWrite", "Form"); //바닥 작성창에서 Open할 경우
            if (oVar.sUrl.lastIndexOf("#") == (oVar.sUrl.length - 1)) { oVar.sUrl = oVar.sUrl.substring(0, oVar.sUrl.lastIndexOf("#")); } //url에 #이 포함되어 있음 제거처리
            //oVar.sUrl = oVar.sUrl + "&ReadType=Print&editMode=P";
            oVar.sUrl = oVar.sUrl + "&appLastUser=" + appLastUser + "&ReadType=Print&editMode=P";
            m_CmtBln = true;
            bPresenceView = true;
            printDiv = "<html><body>" + getBodyHTML("PUB") + "</body></html>";
        } else {
            oVar.sSize = "scroll";
            oVar.iWidth = 790;
            oVar.iHeight = window.screen.height - 82; //oVar.sUrl="PreView.aspx";
            oVar.sUrl = String("/Approval/Forms/PreView.aspx?");
            oVar.sUrl = oVar.sUrl.replace("FormWrite", "Form"); //바닥 작성창에서 Open할 경우
            if (oVar.sUrl.lastIndexOf("#") == (oVar.sUrl.length - 1)) { oVar.sUrl = oVar.sUrl.substring(0, oVar.sUrl.lastIndexOf("#")); } //url에 #이 포함되어 있음 제거처리
            //oVar.sUrl = oVar.sUrl + "&ReadType=Print&editMode=P";
            oVar.sUrl = oVar.sUrl + "&appLastUser=" + appLastUser + "&ReadType=Print&editMode=P";
            m_CmtBln = true;
            bPresenceView = true;
            printDiv = "<html><body>" + getBodyHTML("PUB") + "</body></html>";
        }
    }
    else {
        if (!_ie && (getInfo("fmpf") == "OFFICAL_DOCUMENT_02" || getInfo("fmpf") == "OFFICAL_DOCUMENT_01")) {
            alert("[대외공문]인쇄는 IE 에서만 지원 가능합니다.");
        }
        try {
            if (document.getElementById("rowcnt_doc").value != "0") {
                document.getElementById("ADD_rowCnt_Doc").style.height = (document.getElementById("rowcnt_doc").value * 50) + "px";
            }
        } catch (e) { }
        try { document.getElementById("CommentList").style.display = "none"; document.getElementById("CCLine").style.display = "none"; } catch (e) { }

        printDiv = "<html><body>" + getBodyHTML("PUB") + "</body></html>";

        m_CmtBln = false;
        bPresenceView = false;
        if (CFN_GetQueryString("menukind") != "notelist") displayApvList(oVar.m_evalXML);

        oVar.sSize = "scroll";
        //oVar.iWidth = 790;
        oVar.iWidth = 810;
        oVar.iHeight = window.screen.height - 82

        //차기 제품 하드코딩 start- hichang
        gPrintType = "0";
        //차기 제품 하드코딩 end- hichang

        if (gPrintType == "0") {
            oVar.sUrl = "PrintForm.aspx";
        } else if (gPrintType == "1") {
            m_oFormReader.print_part('editor');
        }
        m_CmtBln = true;
        bPresenceView = true;
        if (CFN_GetQueryString("menukind") != "notelist") displayApvList(oVar.m_evalXML);
    }
}

doButtonCase['btSign'] = function (oBtn, oVar) {//직인
    m_oFormEditor.PutSignImage(); requestProcess("SIGN");
}

doButtonCase['btAdd'] = function (oBtn, oVar) {//일괄기안 안건추가
    m_oFormEditor.AddBody();
}

doButtonCase['btDelete'] = function (oBtn, oVar) {//일괄기안 안건삭제
    m_oFormEditor.DeleteBody();
}

doButtonCase['btWithdraw'] = function (oBtn, oVar) {//회수
    Common.Confirm(Common.GetDic("msg_apv_391"), "Confirmation Dialog", function (result) {
        if (result) {
            requestProcess("WITHDRAW");
        }
        else {
            return;
        }
    });
}

//doButtonCase['btConSultWithdraw'] = function (oBtn, oVar) {//협조회수_최우석
//    if (confirm("삭제하시겠습니까 ?")) {
//        //    if (result) {

//        //       
//        //    }
//        //    else {
//        //        return;
//        oVar.iHeight = 450; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=DRAFT";
//        sWindowName = "winAction"; oVar.sSize = "resize";
//        //requestProcess("CONSULTWITHDRAW");

//    } else { return false; }
//    //});
//}
doButtonCase['btAbort'] = function (oBtn, oVar) {//취소
    oVar.iHeight = 500; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvprocessDraft.aspx?type=ABORT"; sWindowName = "winAction"; oVar.sSize = "fix";
}

doButtonCase['btApproveCancel'] = function (oBtn, oVar) {//승인취소
    Common.Confirm(Common.GetDic("msg_apv_390"), "Confirmation Dialog", function (result) {
        if (result) {
            document.getElementById("ACTIONINDEX").value = "approve";
            requestProcess('APPROVECANCEL');
        }
        else {
            return;
        }
    });
}
doButtonCase['btMonitor'] = function (oBtn, oVar) {//현황
    requestProcess("MONITOR");
}

doButtonCase['btRecRE'] = function (oBtn, oVar) {
    setInfo("scRec", "1");
    setInfo("pfsk", "RE");
    requestProcess("RECREATE");
}

doButtonCase['btRec'] = function (oBtn, oVar) {//접수
    document.getElementById("ACTIONINDEX").value = "approve";
    requestProcess("RECREATE");
}

//재사용
doButtonCase['btReUse'] = function (oBtn, oVar) {

    // 건설계열사일 경우에만 새창으로 띄운 경우
    if (Common.GetBaseConfig("HEC_COMPANY") == "Y") {
        if (CFN_GetQueryString("CFN_OpenWindowName") != 'undefined' && location.href.indexOf("CFN_OpenWindowName") > -1) {
            if (!IsWideOpenFormCheckReal(getInfo("fmpf"), Common.GetSession("DN_Code"))) {
                var wWidth = parseInt(Common.GetBaseConfig("TallOpenFormWidth")) + parseInt(20)
                window.resizeTo(wWidth, window.outerHeight);
            }
        }
    }

    //frameset제거작업으로 재사용방식 변경 2011-10-06
    if (window.location.href.substr(-1) === "#") {
        // script 실행후 url뒤에 붙어있는 #제거 
        window.location.href = window.location.href.substring(0, window.location.href.length - 1) + "&editMode=Y&reuse=R";
    } else {
        window.location.href = window.location.href + "&editMode=Y&reuse=R";
    }
    return false;
}

// 메일로 보내기 (2019.04.19 crom 추가)
doButtonCase['btn_CopyToMail'] = function (oBtn, oVar) {
    // 팝업 열기
    var sCommand = "NEW";
    var sPopupId = "MailWrite";
    //var sSystem = CFN_GetCtrlById("hidBusinessCardListSystem").value;
    var sSystem = "Mail";
    //var sQueryString = "&cmd=CONTACT"; // CONTACT 가 들어가면 쓰기 페이지가 로딩되지 않는다.
    var sQueryString = "&cmd=MAIL"; // 일단 비워놓자
    //var piid = formJson.oFormData.PROCESS_INSTANCE_ID;
    var fiid = formJson.oFormData.FORM_INST_ID;
    //sQueryString += "&containerid=hidMailSendInfoXML";
    sQueryString += "&fiid=" + fiid;
    PopupMailWrite_01(sPopupId, sSystem, sQueryString);
}

// 메일로 전달 (2020.05.28)
doButtonCase['btn_ForwardMail'] = function (oBtn, oVar) {
    // 팝업 열기
    var sCommand = "NEW";
    var sPopupId = "MailWrite2";
    //var sSystem = CFN_GetCtrlById("hidBusinessCardListSystem").value;
    var sSystem = "Mail";
    //var sQueryString = "&cmd=CONTACT"; // CONTACT 가 들어가면 쓰기 페이지가 로딩되지 않는다.
    var sQueryString = "&cmd=MAIL"; // 일단 비워놓자
    //var piid = formJson.oFormData.PROCESS_INSTANCE_ID;
    var fiid = formJson.oFormData.FORM_INST_ID;
    //sQueryString += "&containerid=hidMailSendInfoXML";
    sQueryString += "&fiid=" + fiid;
    sQueryString += "&cururl=" + encodeURIComponent(location.href); // &cmd=MAIL&fiid=D2711E8E-6307-41D9-843E-750B489D3BF8&cururl=URL
    PopupMailWrite_01(sPopupId, sSystem, sQueryString);
}


// 메일 쓰기 팝업
// pStrPopupType: 팝업의 종류를 결정함 (WINDOW - 윈도우 open 팝업 / LAYER - 레이어 팝업)
// pStrPopupId: 쓰기 팝업창 ID
// pStrSystem: System
// pStarIframeName: 부모 iframe 이름
// pStrQueryString: 추가 파라미터 정보(Command(REPLY/FORWARD/...)메일ID|메일ChangeKey|수신자명|수신자메일주소|내게쓰기여부|이전MenuID|이전페이지(LIST/READ/...)|리스트/보기의AddParms)
function PopupMailWrite_01(pStrPopupId, pStrSystem, pStrQueryString) {
    try {
        pStrPopupId = pStrPopupId + "_" + (Math.random() * (1 << 30)).toString(16).replace('.', ''); // GUID 생성하여 새로운 창으로 연다

        var nWindowPopWidth = 1300;
        //var nWindowPopHeight = $(window).height();
        var nWindowPopHeight = 950;

        var sURL = location.protocol + "//" + Common.GetBaseConfig("MailWebServerDomain") + "/WebMail/Mail/Write.aspx";
        sURL += "?system=" + pStrSystem;
        sURL += "&mode=WINDOW";
        sURL += pStrQueryString;

        CFN_OpenWindow(sURL, pStrPopupId, nWindowPopWidth, nWindowPopHeight, "both");
    } catch (e) {
        alert(e.stack);
    }
}

//[파워텍] 재사용 기능 완료된 문서. Migration 양식 [협조전(구),보고서(구),품의서(구)] KBW20180321
//양식에서 재사용 버튼 활성화. TO-BE 적용할 양식에 경우 재사용 기능. KBW20180321
doButtonCase['btReApproval'] = function (oBtn, oVar) {//재사용

    var form;
    switch (getInfo("fmpf")) {
        case "WF_HPT_COORDINATION":
            form = "GWOE_COOPER_CL_W01";
            break;
        case "WF_HPT_REPORT":
            form = "WF_HPT_AW_REPORT";
            break;
        case "WF_HPT_DRAFT":
            form = "GWOK_GENERAL";
            break;
    }
    //var strURL = _HostFullName+"/Approval/Forms/Form.aspx?fmpf='" + form + "&mode=DRAFT";_HostFullName + "/Approval/Forms/
    var strURL = String.format("{0}/Approval/Forms/Form.aspx?fmpf={1}&mode=DRAFT&processInstanceId={2}&MIGRATION=Y", _HostFullName, form, formJson.oFormData.PROCESS_INSTANCE_ID);
    if (g_IS_TabUI == "Y") { strURL = strURL + "&IS_Tab=Y"; }
    //window.location.href = strURL
    //window.open(strURL, "VacForm", "fix");
    if (!_ie)
        //var vwidth = 850;
        var vwidth = window.screen.width;
    else
        //var vwidth = 790; //레이어 사용 
        var vwidth = window.screen.width;
    //가로양식
    //if (IsWideOpenFormCheck(fmpt)) {
    //    vwidth = window.screen.width;
    //}
    var width = vwidth //레이어 사용
    //var vheight = (window.screen.height - 100);
    //var vheight = (window.screen.height - 82);
    //var height = vheight + "px"; //레이어 사용
    var height = (window.screen.height - 82);
    var sx = window.screen.width / 2 - vwidth / 2; //레이어 사용


    CFN_OpenWindow(strURL, "MIGRATION", width, height, 'resize');
}

//복사 - 2017.12.04
doButtonCase['btCopy'] = function (oBtn, oVar) {
    // 건설계열사일 경우에만 새창으로 띄운 경우
    if (Common.GetBaseConfig("HEC_COMPANY") == "Y") {
        if (CFN_GetQueryString("CFN_OpenWindowName") != 'undefined' && location.href.indexOf("CFN_OpenWindowName") > -1) {
            if (!IsWideOpenFormCheckReal(getInfo("fmpf"), Common.GetSession("DN_Code"))) {
                var wWidth = parseInt(Common.GetBaseConfig("TallOpenFormWidth")) + parseInt(20)
                window.resizeTo(wWidth, window.outerHeight);
            }
        }
    }

    //frameset제거작업으로 재사용방식 변경 2011-10-06
    if (window.location.href.substr(-1) === "#") {
        // script 실행후 url뒤에 붙어있는 #제거 
        Common.Progress("<span id='spanProgress'>" + Common.GetDic("msg_Processing") + "<br /></span>");
        window.location.href = window.location.href.substring(0, window.location.href.length - 1) + "&editMode=Y&reuse=C";
    } else {
        Common.Progress("<span id='spanProgress'>" + Common.GetDic("msg_Processing") + "<br /></span>");
        window.location.href = window.location.href + "&editMode=Y&reuse=C";
    }
    return false;
}
//서식등록 신청서 개정
doButtonCase['btnFixFormRevision'] = function (oBtn, oVar) {
    //frameset제거작업으로 재사용방식 변경 2011-10-06
    if (window.location.href.substr(-1) === "#") {
        // script 실행후 url뒤에 붙어있는 #제거 
        window.location.href = window.location.href.substring(0, window.location.href.length - 1) + "&editMode=Y&reuse=Y";
    } else {
        window.location.href = window.location.href + "&editMode=Y&reuse=Y&Revision=Y";
    }
    return false;
}
//예약결재
doButtonCase['btn_Booking_Approval'] = function (oBtn, oVar) {//예약결재
    var url = "/Approval/Forms/Templates/popup/BookingApproval_Poup.aspx";
    if (g_IS_TabUI == "Y") { url = url + "?IS_Tab=Y"; }
    var Title = Common.GetDic("btn_Booking_Approval");//계정검색
    var v_width = (_Language == "ko-KR") ? "260px;" : "300px";
    Common.Show("BookingApproval_Poup", "1", Title, url, "600px", v_width, "iframe");
    return false;
}


doButtonCase['btReUseR'] = function (oBtn, oVar) {//수신부서 재사용
    // 건설계열사일 경우에만 새창으로 띄운 경우
    if (Common.GetBaseConfig("HEC_COMPANY") == "Y") {
        if (CFN_GetQueryString("CFN_OpenWindowName") != 'undefined' && location.href.indexOf("CFN_OpenWindowName") > -1) {
            if (!IsWideOpenFormCheckReal(getInfo("fmpf"), Common.GetSession("DN_Code"))) {
                var wWidth = parseInt(Common.GetBaseConfig("TallOpenFormWidth")) + parseInt(20)
                window.resizeTo(wWidth, window.outerHeight);
            }
        }
    }

    document.getElementById("btReUseR").style.display = "none";
    document.getElementById("btDeleteDoc").style.display = "none";
    document.getElementById("btPrint").style.display = "none";
    document.getElementById("btLine").style.display = "none";
    document.getElementById("btDeptRejectDraft").style.display = "";
    document.getElementById("btDeptLine").style.display = "";
    document.getElementById("APVLIST").value = getApvListReUse();
    initApvList();
    setInfo("mode", "REDRAFT");
    setInfo("gloct", "DEPART");
    setInfo("loct", "REDRAFT");
    return;
}

doButtonCase['btBizrip'] = function (oBtn, oVar) {//재사용
    // 건설계열사일 경우에만 새창으로 띄운 경우
    if (Common.GetBaseConfig("HEC_COMPANY") == "Y") {
        if (CFN_GetQueryString("CFN_OpenWindowName") != 'undefined' && location.href.indexOf("CFN_OpenWindowName") > -1) {
            if (!IsWideOpenFormCheckReal(getInfo("fmpf"), Common.GetSession("DN_Code"))) {
                var wWidth = parseInt(Common.GetBaseConfig("TallOpenFormWidth")) + parseInt(20)
                window.resizeTo(wWidth, window.outerHeight);
            }
        }
    }

    window.location.href = "Form.aspx?fmpf=WF_FROM_BIZTRIP_REPORT&amp;mode=DRAFT&REQUEST_FIID=" + getInfo("fiid");
}
//대외문으로. 2017.04.17. 양유빈
doButtonCase['btOTDocTrans'] = function (oBtn, oVar) {
    var url = String.format("Form.aspx?fmpf=GWOJ_VENDOR_W01&mode=DRAFT&processInstanceId={0}&OTDOCTRANS=Y", formJson.oFormData.PROCESS_INSTANCE_ID);
    if (g_IS_TabUI == "Y") { url = url + "&IS_TabUI=Y"; }
    window.location.href = url;
}

doButtonCase['btVacationCancle'] = function (oBtn, oVar) {//휴가취소신청서

    var VacationCancelForm = Common.GetBaseConfig("VacationForm").toString().split("^")[0];

    var strURL = _HostFullName + "/Approval/Forms/Form.aspx?fmpf=" + VacationCancelForm + "&mode=DRAFT&REQUEST_FIID=" + getInfo("fiid");

    var iWidth = 790;
    var iHeight = window.screen.height - 82;

    CFN_OpenWindow(strURL, "VacForm", iWidth, iHeight, "fix");
}

//doButtonCase['btReceiptView'] = function (oBtn, oVar) {//수신현황조회
//    if (getInfo("REPLY") == "1") {
//        oVar.iHeight = 400; oVar.iWidth = 920;
//    }
//    else {
//        oVar.iHeight = 311 - 34; oVar.iWidth = 700;
//    }
//    oVar.sSize = "scrollbars=no";
//    var getInfoValue = getInfo("INITIATOR_OU_ID") + ";" + getInfo("dpid_apv"); //추가
//    oVar.sUrl = "/Approval/DocList/ReceiptList.aspx?ppiid=" + getInfo("PROCESS_ID") + "&piid=" + getInfo("piid") + "&fiid=" + getInfo("fiid") + "&getInfoValue=" + getInfoValue; //+"&reply="+getInfo("REPLY");     
//}

doButtonCase['btForward'] = function (oBtn, oVar) {//문서전달
    //window.open의 경우 예외 처리 
    if (openMode == "L" || openMode == "P") {
        Common.Confirm(gMessage197, "Confirmation Dialog", function (result) {
            if (result) {
                if ((getInfo("loct") == "REDRAFT") && (getInfo("mode") == "REDRAFT" || getInfo("mode") == "SUBREDRAFT")) { m_sAddList = 'chargegroup'; } else { m_sAddList = 'charge'; } addList(m_sAddList);
            }
            else {

            }
        });
    } else {
        Common.Confirm(gMessage197, "Confirmation Dialog", function (result) {
            if (result) {
                if ((getInfo("loct") == "REDRAFT") && (getInfo("mode") == "REDRAFT" || getInfo("mode") == "SUBREDRAFT")) { m_sAddList = 'chargegroup'; } else { m_sAddList = 'charge'; }
                Open_Forward(m_sAddList);
            }
            else {

            }
        });
    }
}

doButtonCase['btApproved'] = function (oBtn, oVar) {//승인

    if (!FormAttachProcess("btApproved"))
        return false;
    // 수석부회장실 결재선에서 제거 STS HK.CHO
    var arrfmpf = "GWOK_PINVEST_W01|GWOK_PINVEST_W02|GWOK_PINVEST_W03|GWOK_INVEST_W01|GWOK_INVEST_W02|GWOK_INVEST_W03|GWOK_INVEST_W04|WF_HMC_OVER_BIZ_RPT_MF|GWOK_DINVEST_W01|WF_KMC_OVER_BIZ_TRIP_MF|WF_HMC_OVER_BIZ_TRIP_MF|WF_HPT_AW_SAP_PREFIX_WF500|WF_HPT_AW_PROJECT_INVESTMENT";

    if (arrfmpf.indexOf(getInfo("fmpf") < 0)) {
        if (!fn_ChkApvListVicePresident()) {
            alert(Common.GetDic("msg_Approval_DeleteUser"));//결재문서에서 수석부회장님의 결재정보는 결재선에서 자동 삭제 됩니다.<br>자세한 사항은 관리팀에 문의하세요
            return false;
        }
    }
    m_sReqMode = "APPROVE";
    _transferCooperationInfo = "";
    _sCONSULT_LIST = "";
    if (evaluateForm()) {
        if (openApvActBasic()) {

            //TO-DO : 예약 결재시 참조처 정보 셋팅
            if ($("#BOOKING_APPROVAL_YN").val() == "Y" && (getInfo("editmode") == "Y" || getInfo("editmode") == "M")) {
                setBookingApprovalReferenceList();
            }
            if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "ABROAD_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") { //품의류 프로세스 경우
                //협조처 발송 체크
                var HasConsult = false;
                var HasMustSend = true;
                var transferCooperationInfo = "";
                var sCONSULT_LIST = "";

            	// KMM 경상,PR은 일반품의류지만 통제단계가 있고 해당위치에서만 협조처 발송함
                if ((getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMM" || getInfo("fmpf") == "WF_KMM_FI_PURCHASE")) {
                	//통제 단계가 현결재자 직책과 동일하며 미발송 협조처가 있는경우
                	var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본
                	var CurApvPerson = $(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > person:has(taskinfo[status='pending'])");
                	//if (formJson.BODY_CONTEXT.CTRL_STEP != "" && $('#CONSULT_LIST').val().indexOf(":N:") > -1 && (formJson.BODY_CONTEXT.CTRL_STEP == getInfo("ustc"))) {
                	if (formJson.BODY_CONTEXT.CTRL_STEP != "" && CurApvPerson != null && $('#CONSULT_LIST').val().indexOf(":N:") > -1 && (formJson.BODY_CONTEXT.CTRL_STEP == $(CurApvPerson).attr("dutycode") && getInfo("usid") == $(CurApvPerson).attr("code"))) {
                		Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
                			if (result) {
                				var arrReturn = setSendConsultCheck();
                				transferCooperationInfo = arrReturn[3];
                				sCONSULT_LIST = arrReturn[2];
                				_transferCooperationInfo = transferCooperationInfo;
                				_sCONSULT_LIST = sCONSULT_LIST;
                				setInfo("transferCooperationInfo", transferCooperationInfo);
                				$("#CONSULT_LIST").val(sCONSULT_LIST);
                				requestProcess("REQUESTCONSULT");
                			}
                		});
                		return false;
                	}
                	else {
                		HasConsult = false;
                	}
                }
                //if (Common.GetSession("UR_IsManager") == "True") {
                else if (getInfo("ResidentAuthorityYN") == "Y") {//**주재원 작업**
                    if (getInfo("usismanager") == "Y" || getInfo("usisresident") == "Y") {
                        if (fnCheckResidentAuthorityYN()) {
                            var arrReturn = setSendConsultCheck();
                            HasConsult = arrReturn[0];
                            HasMustSend = arrReturn[1];
                            //transferCooperationInfo = arrReturn[2];
                            //sCONSULT_LIST = arrReturn[3];
                            sCONSULT_LIST = arrReturn[2];
                            transferCooperationInfo = arrReturn[3];

                            //편집하여 추가로 배포 한 협조한 부서가 있는지 확인.
                            if (fnCheckConsultPending()) {
                                return;
                            }
                        }
                    }
                } else if (getInfo("usismanager") == "Y") {
                    var arrReturn = setSendConsultCheck();
                    HasConsult = arrReturn[0];
                    HasMustSend = arrReturn[1];
                    //transferCooperationInfo = arrReturn[2];
                    //sCONSULT_LIST = arrReturn[3];
                    sCONSULT_LIST = arrReturn[2];
                    transferCooperationInfo = arrReturn[3];

                    //편집하여 추가로 배포 한 협조한 부서가 있는지 확인.
                    if (fnCheckConsultPending()) {
                        return;
                    }
                } else {
                    HasConsult = false;
                }

                if (HasConsult) { // 품의류 프로세스이면서 협조처가 존재하면서 팀장이거나 실장이면
                    if (BPMBeforeApproval == "N") {
                        ////협조요청 메세지 확인 수정 <
                        //setInfo("transferCooperationInfo", transferCooperationInfo);
                        //$("#CONSULT_LIST").val(sCONSULT_LIST);
                        //document.getElementById("ACTIONINDEX").value = "REQUESTCONSULT";
                        //oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                        //oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                        //if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                        if (getInfo("Request_ConfirmMsg") == "Y")//협조요청 메세지 확인 
                        {
                            if (HasMustSend) {//무조건 보냄
                                //TO-DO : 로템의 최종결재자가 협조요청시 선결재 아닌 후결재 처리
                                if (Common.GetBaseConfig("RotemConsultFormList").indexOf(";" + getInfo("fmpf") + ";") > -1) {
                                    Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
                                        if (result) {
                                            setInfo("transferCooperationInfo", transferCooperationInfo);
                                            $("#CONSULT_LIST").val(sCONSULT_LIST);
                                            requestProcess("REQUESTCONSULT");
                                        }
                                    });
                                    return false;
                                }

                                Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
                                    if (result) {
                                        //setInfo("transferCooperationInfo", transferCooperationInfo);
                                        //$("#CONSULT_LIST").val(sCONSULT_LIST);
                                        _transferCooperationInfo = transferCooperationInfo;
                                        _sCONSULT_LIST = sCONSULT_LIST;
                                        document.getElementById("ACTIONINDEX").value = "REQUESTCONSULT";
                                        oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                                        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                                        doButtonPostProcess(oVar);
                                    }
                                });
                                return false;
                            } else {
                                Common.Confirm(Common.GetDic("msg_apv_form_001").replace(/\\n/g, "\n") + "<div style='width:300px;'>&nbsp;</div>" + Common.GetDic("msg_cooper_up_approval"), $("#btapproved").text(), function (result) {
                                    if (result == "other") {
                                        //setInfo("transferCooperationInfo", transferCooperationInfo);
                                        //$("#CONSULT_LIST").val(sCONSULT_LIST);
                                        _transferCooperationInfo = transferCooperationInfo;
                                        _sCONSULT_LIST = sCONSULT_LIST;
                                        document.getElementById("ACTIONINDEX").value = "REQUESTCONSULT";
                                        oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                                        oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                                        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                                        doButtonPostProcess(oVar);
                                    }
                                    else if (result == true) {
                                        document.getElementById("ACTIONINDEX").value = "approve";
                                        oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                                        oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                                        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                                        doButtonPostProcess(oVar);
                                    }
                                });
                                setTimeout(function () {
                                    $("#popup_other").show();
                                    $("#popup_other").html(Common.GetDic("btn_apv_RequestConsult")); //협조요청
                                    $("#popup_ok").html(Common.GetDic("btn_apv_Approved"));//결재
                                }, 400);
                                return false;
                            }
                        } else {
                            //TO-DO : 로템의 최종결재자가 협조요청시 선결재 아닌 후결재 처리
                            if (HasMustSend && Common.GetBaseConfig("RotemConsultFormList").indexOf(";" + getInfo("fmpf") + ";") > -1) {
                                Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
                                    if (result) {
                                        setInfo("transferCooperationInfo", transferCooperationInfo);
                                        $("#CONSULT_LIST").val(sCONSULT_LIST);
                                        requestProcess("REQUESTCONSULT");
                                    }
                                });
                                return false;
                            }
                            else {
                                //setInfo("transferCooperationInfo", transferCooperationInfo);
                                //$("#CONSULT_LIST").val(sCONSULT_LIST);
                                _transferCooperationInfo = transferCooperationInfo;
                                _sCONSULT_LIST = sCONSULT_LIST;
                                document.getElementById("ACTIONINDEX").value = "REQUESTCONSULT";
                                oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                                oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                                if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                            }
                        }
                        ////협조요청 메세지 확인 수정 >
                    } else {
                        if (HasMustSend) //무조건 보냄
                        {
                            Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
                                if (result) {
                                    setInfo("transferCooperationInfo", transferCooperationInfo);
                                    $("#CONSULT_LIST").val(sCONSULT_LIST);
                                    requestProcess("REQUESTCONSULT");
                                }
                            });
                            return false;
                        }
                        else {

                            // 글로비스통합품의서 결재선 수정 2019.05.16 STS HK.CHO **품의형식이 투자 이고, 팀장위의 상위 결재자가 존재하면 팀장은 결재만 가능하도록(협조요청 X) *** 추가함.
                            if (getInfo("fmpf") == "GWOK_FAIRTRADE") {
                                if ($("#tbl_Read_herder01").find("span[id='SpanCooper']").text().indexOf(Common.GetDic("lbl_form_Invest")) > -1) {
                                    var tmpApvListXml = $.parseXML(document.getElementById("APVLIST").value); // 결재선을 가져온다.

                                    var strManagerDutyCode = $(tmpApvListXml).find("steps > division[divisiontype='send'] > step[approverat='Y'] > ou > person").attr("dutycode");// 현결재자의 dutycode를 가져온다.
                                    var strCurrentapprovalorder = $(tmpApvListXml).find("steps > division[divisiontype='send'] > step[approverat='Y']").attr("approvalorder");
                                    if ($(tmpApvListXml).find("steps > division[divisiontype='send']> step > ou > person").length >= 2 && strManagerDutyCode == "14" && (strCurrentapprovalorder == "100" || strCurrentapprovalorder == "200")) {
                                        document.getElementById("ACTIONINDEX").value = "approve";
                                        oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                                        oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                                        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                                        doButtonPostProcess(oVar);
                                    }
                                    else {
                                        Common.Confirm(Common.GetDic("msg_apv_form_001").replace(/\\n/g, "\n") + "<div style='width:300px;'>&nbsp;</div>" + Common.GetDic("msg_cooper_up_approval"), $("#btapproved").text(), function (result) {
                                            if (result == "other") {
                                                setInfo("transferCooperationInfo", transferCooperationInfo);
                                                $("#CONSULT_LIST").val(sCONSULT_LIST);
                                                requestProcess("REQUESTCONSULT");
                                            }
                                            else if (result == true) {
                                                document.getElementById("ACTIONINDEX").value = "approve";
                                                oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                                                
                                                
                                                oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                                                if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                                                doButtonPostProcess(oVar);
                                            }
                                        });
                                        setTimeout(function () {
                                            $("#popup_other").show();
                                            $("#popup_other").html(Common.GetDic("btn_apv_RequestConsult")); //협조요청
                                            $("#popup_ok").html(Common.GetDic("btn_apv_Approved"));//결재
                                        }, 400);
                                        return false;
                                    }
                                }
                                else {
                                    // 품의 형식이 비용이나 일반일 경우엔..
                                    Common.Confirm(Common.GetDic("msg_apv_form_001").replace(/\\n/g, "\n") + "<div style='width:300px;'>&nbsp;</div>" + Common.GetDic("msg_cooper_up_approval"), $("#btapproved").text(), function (result) {
                                        if (result == "other") {
                                            setInfo("transferCooperationInfo", transferCooperationInfo);
                                            $("#CONSULT_LIST").val(sCONSULT_LIST);
                                            requestProcess("REQUESTCONSULT");
                                        }
                                        else if (result == true) {
                                            document.getElementById("ACTIONINDEX").value = "approve";
                                            oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                                            oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                                            if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                                            doButtonPostProcess(oVar);
                                        }
                                    });
                                    setTimeout(function () {
                                        $("#popup_other").show();
                                        $("#popup_other").html(Common.GetDic("btn_apv_RequestConsult")); //협조요청
                                        $("#popup_ok").html(Common.GetDic("btn_apv_Approved"));//결재
                                    }, 400);
                                    return false;
                                }

                            }
                            else {
                                // 원래소스
                                Common.Confirm(Common.GetDic("msg_apv_form_001").replace(/\\n/g, "\n") + "<div style='width:300px;'>&nbsp;</div>" + Common.GetDic("msg_cooper_up_approval"), $("#btapproved").text(), function (result) {
                                    if (result == "other") {
                                        setInfo("transferCooperationInfo", transferCooperationInfo);
                                        $("#CONSULT_LIST").val(sCONSULT_LIST);
                                        requestProcess("REQUESTCONSULT");
                                    }
                                    else if (result == true) {
                                        document.getElementById("ACTIONINDEX").value = "approve";
                                        oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                                        oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                                        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                                        doButtonPostProcess(oVar);
                                    }
                                });
                                setTimeout(function () {
                                    $("#popup_other").show();
                                    $("#popup_other").html(Common.GetDic("btn_apv_RequestConsult")); //협조요청
                                    $("#popup_ok").html(Common.GetDic("btn_apv_Approved"));//결재
                                }, 400);
                                return false;
                            }
                        }
                    }
                }
                else {
                    //통합신청서류 예외처리
                    if (getInfo("pdef") == "UNITY_REQST_PATTERN") {
                        var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본
                        var ReceivePlace = $(m_oApvList).find("division[divisiontype='send'] > step:has(ou > role > person > taskinfo[status='pending'],ou > role > person > taskinfo[status='completed'])");
                        if (ReceivePlace.length > 0) {
                            document.getElementById("ACTIONINDEX").value = "approve";
                            oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 400; 
                            oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=UNITY_RECIEVE_APPROVAL";
                            if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }

                            if ($(m_oApvList).find("division[divisiontype='send'] > step:has(ou > person > taskinfo[status='inactive'])").length > 0) {
                                oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                            }
                        }
                        else {
                            document.getElementById("ACTIONINDEX").value = "approve";
                            oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                            oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                            if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                        }
                    }
                    else {
                        document.getElementById("ACTIONINDEX").value = "approve";
                        oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                        oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                    }
                }
            }
            else if ((getInfo("pdef") == "COOPERATION_PATTERN" || getInfo("pdef") == "COMPUTATION_PATTERN" || getInfo("pdef") == "STEP3_PATTERN" || getInfo("pdef") == "STEP4_PATTERN") && getInfo("mode_unit") != "APPROVAL") { // 협조전류, 전산사용권한류, 3단계류 수신처 결재 분류
                document.getElementById("ACTIONINDEX").value = "approve";
                var cooperationType = "";
                oVar.iHeight = 400; oVar.iWidth = 700;//첨부파일 없을 경우 

                oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=" + getInfo("mode_unit");
                if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
            } else if (getInfo("pdef") == "INVEST_PATTERN") { //투자품의서 프로세스 경우 ( 현대해외출장완료보고 같음 패턴 적용)
                //협조처 발송 체크
                var HasConsult = false;
                var HasMustSend = true;
                var transferCooperationInfo = "";
                var sCONSULT_LIST = "";

                // HAOS / HMMC 투자품의
                // 해외투자프로세스(INVEST_PROCESS_TYPE=A) 와 동일하지만 협조처발송 시점만 다른경우(INVEST_PROCESS_SUBTYPE=PRE_CTRL)1111
                if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN" && Common.GetBaseConfig("INVEST_PROCESS_SUBTYPE") == "PRE_CTRL") {
                    if (getInfo("usismanager") == "Y") {
                        var arrReturn = setSendConsultCheck();
                        HasConsult = arrReturn[0];
                        HasMustSend = arrReturn[1];
                        //transferCooperationInfo = arrReturn[2];
                        //sCONSULT_LIST = arrReturn[3];
                        sCONSULT_LIST = arrReturn[2];
                        transferCooperationInfo = arrReturn[3];

                        //편집하여 추가로 배포 한 협조한 부서가 있는지 확인.
                        if (fnCheckConsultPending()) {
                            return;
                        }
                    } else {
                        HasConsult = false;
                    }
                }
            	// HMB 투자품의
            	// 해외투자프로세스(INVEST_PROCESS_TYPE=A) 와 동일하지만 협조처발송 시점만 다른경우(INVEST_PROCESS_SUBTYPE=MUST)
                else if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN" && Common.GetBaseConfig("INVEST_PROCESS_SUBTYPE") == "MUST") {
                	if (getInfo("usismanager") == "Y") {
                		var arrReturn = setSendConsultCheck();
                		HasConsult = arrReturn[0];
                		HasMustSend = true;
                		sCONSULT_LIST = arrReturn[2];
                		transferCooperationInfo = arrReturn[3];

                		//편집하여 추가로 배포 한 협조한 부서가 있는지 확인.
                		if (fnCheckConsultPending()) {
                			return;
                		}
                	} else {
                		HasConsult = false;
                	}
                }
                //TO-DO : 해외투자프로세스의 경우 양식에서 선택한 통제 단계에서 협조요청을 진행해야 한다.
                //2019-09-16 BY YJYOO
                //1. HMI와 HMMR의 해외투자품의일 경우에만 적용
                else if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN") {
                    //2. 통제 단계가 현결재자 직책과 동일하며 미발송 협조처가 있는경우
                    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본
                    var CurApvPerson = $(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > person:has(taskinfo[status='pending'])");
                    //if (formJson.BODY_CONTEXT.CTRL_STEP != "" && $('#CONSULT_LIST').val().indexOf(":N:") > -1 && (formJson.BODY_CONTEXT.CTRL_STEP == getInfo("ustc"))) {
                    if (formJson.BODY_CONTEXT.CTRL_STEP != "" && CurApvPerson != null && $('#CONSULT_LIST').val().indexOf(":N:") > -1 && (formJson.BODY_CONTEXT.CTRL_STEP == $(CurApvPerson).attr("dutycode") && getInfo("usid") == $(CurApvPerson).attr("code"))) {
                        Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
                            if (result) {
                                var arrReturn = setSendConsultCheck();
                                transferCooperationInfo = arrReturn[3];
                                sCONSULT_LIST = arrReturn[2];
                                _transferCooperationInfo = transferCooperationInfo;
                                _sCONSULT_LIST = sCONSULT_LIST;
                                setInfo("transferCooperationInfo", transferCooperationInfo);
                                $("#CONSULT_LIST").val(sCONSULT_LIST);
                                requestProcess("REQUESTCONSULT");
                            }
                        });
                        return false;
                    }
                    else {
                        HasConsult = false;
                    }
                }
                else {
                    // 총괄부서 협조처발송 체크(Role)
                    if (SendConsultCheckInvest(Common.GetSession("ROLE_CODE_LIST"))) {
                        var arrReturn = setSendConsultCheck();
                        HasConsult = arrReturn[0];
                        // 프로젝트 투자품의는 총괄부서에서 협조처 무조건 발송 , 현대 해외출장보고 추가
                        if (getInfo("fmpf").indexOf("GWOK_INVEST") > -1 || getInfo("fmpf").indexOf("GWOK_PINVEST") > -1
                            || getInfo("fmpf") == "GWOK_EDUCATION_W01" || getInfo("fmpf") == "GWOK_FIXED_W01" || getInfo("fmpf") == "GWOK_ACQURPT_W01"
                            || getInfo("fmpf") == "WF_HMC_OVER_BIZ_RPT_MF" || getInfo("fmpf").indexOf("WF_HKMC_CORPORATE_SEAL") > -1 || getInfo("fmpf").indexOf("GWOK_OVERSEA_INVST") > -1) {
                            HasMustSend = true;
                        } else {
                            HasMustSend = arrReturn[1];
                        }
                        sCONSULT_LIST = arrReturn[2];
                        transferCooperationInfo = arrReturn[3];
                    } else {
                        HasConsult = false;
                    }
                }

                if (HasConsult) {
                    if (HasMustSend) //무조건 보냄
                    {
                        Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
                            if (result) {
                                setInfo("transferCooperationInfo", transferCooperationInfo);
                                $("#CONSULT_LIST").val(sCONSULT_LIST);
                                requestProcess("REQUESTCONSULT");
                            }
                        });
                        return false;
                    }
                    else {
                        Common.Confirm(Common.GetDic("msg_apv_form_001").replace(/\\n/g, "\n") + "<div style='width:300px;'>&nbsp;</div>", $("#btapproved").text(), function (result) {
                            if (result == "other") {
                                setInfo("transferCooperationInfo", transferCooperationInfo);
                                $("#CONSULT_LIST").val(sCONSULT_LIST);
                                requestProcess("REQUESTCONSULT");
                            } else if (result == true) {
                                document.getElementById("ACTIONINDEX").value = "approve";
                                oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 


                                oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                                if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                                doButtonPostProcess(oVar);
                            }
                        });
                        setTimeout(function () {
                            $("#popup_other").show();
                            $("#popup_other").html(Common.GetDic("btn_apv_RequestConsult")); //협조요청
                            $("#popup_ok").html(Common.GetDic("btn_apv_Approved"));//결재
                        }, 400);
                        return false;
                    }
                }
                else {
                    document.getElementById("ACTIONINDEX").value = "approve";
                    oVar.iWidth = 700; oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";//oVar.iHeight = 450; 
                    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                }
            }
            else if ((getInfo("pdef") == "REQST_CRRF_PATTERN" && getInfo("openerDivisionType") == "RECEIVE") && getInfo("mode_unit") == "RECEIVE_APPROVAL") { // 공문 협조전류 협조처 조직장

                document.getElementById("ACTIONINDEX").value = "approve";
                var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본
                if ($(m_oApvList).find("steps > division[divisiontype='receive'] > step").length == 1) {
                    var cooperationType = "";
                    oVar.iHeight = 400; oVar.iWidth = 700;//첨부파일 없을 경우 

                    oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=" + getInfo("mode_unit");
                    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                }
                else {
                    oVar.iWidth = 700; oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";//oVar.iHeight = 450; 
                    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
                }
            }
            else {
                //3단계류 이면서 고객만족 처리전일때 협조처 정보 바인딩
                if (getInfo("pdef") == "STEP3_PATTERN" && getInfo("fmpf") == "KWEK_CUST_SATIS_W01") {
                    var HasConsult = false;
                    var HasMustSend = true;
                    var transferCooperationInfo = "";
                    var sCONSULT_LIST = "";
                    var arrReturn = EditSendConsultCheck();
                    transferCooperationInfo = arrReturn[3];
                    sCONSULT_LIST = arrReturn[2];
                    setInfo("transferCooperationInfo", transferCooperationInfo);
                    $("#CONSULT_LIST").val(sCONSULT_LIST);
                }

                document.getElementById("ACTIONINDEX").value = "approve";
                var bICommentAttach = (Common.GetBaseConfig("UseActCmtAttach") == 'Y') ? true : false;
                oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
                oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
                if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
            }
        } else {
            document.getElementById("ACTIONINDEX").value = "approve";
            document.getElementById("SIGNIMAGETYPE").value = sSingimg;
            requestProcess("APPROVE");
        }
    }
}

doButtonCase['btHold'] = function (oBtn, oVar) {//보류	
    //if (!FormAttachProcess("btHold"))
    //    return false;
    //m_sReqMode = "APPROVE";
    //document.getElementById("ACTIONINDEX").value = "reserve";
    //if (evaluateForm()) {
    //    oVar.iHeight = 550; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx";
    //    if (g_IS_TabUI == "Y")
    //        oVar.IS_Tab = "Y";
    //} else {
    //    document.getElementById("ACTIONINDEX").value = "";
    //}
    Common.Confirm(Common.GetDic("lbl_msg_hold"), "Confirmation Dialog", function (result) {
        if (result) {
            requestProcess("HOLD");
        } else {
            return;
        }
    });
    
}

doButtonCase['btRejectedto'] = function (oBtn, oVar) {//지정반송
    if (!FormAttachProcess("btRejectedto"))
        return false;
    m_sReqMode = "APPROVE";
    document.getElementById("ACTIONINDEX").value = "rejectedto";
    //지정반송가능여부 체크	if (fn_checkrejectedtoA())
    if (evaluateForm()) {
        oVar.iHeight = 550; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx";
        if (g_IS_TabUI == "Y")
            oVar.IS_Tab = "Y";
    } else {
        document.getElementById("ACTIONINDEX").value = "";
    }
}

doButtonCase['btRejectedtoDept'] = function (oBtn, oVar) {//부서 내 반송(수신함으로)
    if (!FormAttachProcess("btRejectedtoDept"))
        return false;
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        document.getElementById("ACTIONINDEX").value = "rejectedtodept";
        oVar.iHeight = 230; oVar.iWidth = 600; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx";
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    }
}

doButtonCase['btCommentApvLine'] = function (oBtn, oVar) {//의견 DB 저장 안하는 의견 입력창
    oVar.iHeight = 180; oVar.iWidth = 500;
    //추가 의견 안내 메일 발송으로 인한 수정 2006.09 sunny
    oVar.sUrl = "/Approval/Comment/comment_save.aspx";
}

doButtonCase['btCommentAdd'] = function (oBtn, oVar) {//의견 추가버튼
    //requestProcess("CANCELAPPROVE");
    var pTYPE = getInfo('piid_parent');

    if (pTYPE == '') {
        pTYPE = 'S';
    } else {
        pTYPE = 'R';
    }
    oVar.iHeight = 290; oVar.iWidth = 500;//첨부파일 없을 경우 
    oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=COMMENTADD&commentType=" + pTYPE;
    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    $('#ACTIONINDEX').val('COMMENTADD');
}


doButtonCase['btComment'] = function (oBtn, oVar) {//의견
    var sKind = "";
    if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") {
        sKind = "initiator";
    } else if (
        (getInfo("mode") == "APPROVAL" ||
         getInfo("mode") == "PCONSULT" ||
         getInfo("mode") == "SUBAPPROVAL" ||
         getInfo("mode") == "RECAPPROVAL" ||
         getInfo("mode") == "REDRAFT") &&
        (getInfo("loct") == "APPROVAL")
    ) {
        oVar.m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
        var elmRoot = $(oVar.m_evalXML).find("steps");
        var oPendingSteps = $(elmRoot).find("division > step:has(taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='pending']), division > step:has(taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='reserved'])");
        var oinActiveSteps = $(elmRoot).find("division > step:has(taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='inactive'])[routetype!='receive']");

        if ((oPendingSteps.length == 1) && (oinActiveSteps.length == 0)) {
            sKind = "lastapprove";
        }
        else {
            sKind = "approve";
        }
        if (getInfo("mode") == "REDRAFT") {
            sKind = "initiator";
        }

    } else if (getInfo("pfsk") == "T009") {
        sKind = "agreed";
    } else if (getInfo("pfsk") == "T015") {
        sKind = "receive";
    } else if (getInfo("mode") == "COMPLETE") {
        sKind = "lastapprove";
    }
    oVar.iHeight = 180; oVar.iWidth = 500;
    //추가 의견 안내 메일 발송으로 인한 수정 2006.09 sunny
    oVar.sUrl = "/Approval/Comment/comment_add.aspx?piid=" + getInfo("piid") + "&form_inst_id=" + getInfo("fiid") + "&user_id=" + getInfo("usid") + "&kind=" + sKind + "&mode=" + getInfo("mode") + "&user_name=" + escape(getInfo("usdn")) + "&keepyear=" + getInfo("APPLIED") + "&catname=" + escape(getInfo("DOC_CLASS_NAME")) + "&docsec=" + getInfo("DOC_LEVEL");
}

doButtonCase['btCommentView'] = function (oBtn, oVar) {
    //commentType 검토의견일 경우 Comment
    oVar.iHeight = 290;
    oVar.iWidth = 530;
    oVar.sUrl = "/Approval/Comment/comment_view.aspx?piid=" + getInfo("piid") + "&form_inst_id=" + getInfo("fiid") + "&commentType=Comment";
    oVar.df_btnType = "btCommentView"; // 20171127 hpark 결재의견 명칭정리
    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    //feedback추가2010.12
    if (getInfo("feedback") == "1") {
        oVar.sUrl += "&feedback=" + getInfo("feedback");
    }
}

doButtonCase['btCirculate_View'] = function (oBtn, oVar) {
    oVar.iHeight = 500; oVar.iWidth = 800;
    oVar.sUrl = "/Approval/Circulation/Circulation_Read_View.aspx?form_inst_id=" + getInfo("fiid");
}

doButtonCase['btBypass'] = function (oBtn, oVar) {
    oVar.m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
    var elmRoot = $(oVar.m_evalXML).find("steps");
    var elmPerson = $(elmRoot).find("division > step > ou > person:having(taskinfo[status='pending'][result='pending'])");
    if (elmPerson != null) {
        m_wfid = elmPerson.getAttribute("code");
        requestProcess("BYPASS");
    }
}

doButtonCase['btArchives'] = function (oBtn, oVar) {
    m_oFormEditor.Archives();
}

doButtonCase['btDocMove'] = function (oBtn, oVar) {
    foldermove_OnClick("user");

}

doButtonCase['btPcSave'] = function (oBtn, oVar) {//PC저장
    return PcSave(false);
}

doButtonCase['btExt'] = function (oBtn, oVar) {//확장기능 - 개별 양식에서 확장 기능 사용 시 
    try { m_oFormEditor.LegacyProcess(); } catch (e) { }
}

doButtonCase['btAdminAbort'] = function (oBtn, oVar) {//관리자 강제기안취소200808
    requestProcess("WITHDRAW");
}

doButtonCase['btAPVLINEModify'] = function (oBtn, oVar) {//결재선변경200808//changeApvList();
    oVar.sUrl = "/Approval/ApvlineMgr/ApvlineMgr.aspx?admintype=ADMIN";
    oVar.sUrl = oVar.sUrl + "&ApvType=" + getInfo('selscSaganApproval');
    if (g_IS_TabUI == "Y")
        oVar.IS_Tab = "Y";
}

doButtonCase['btDeleteDoc'] = function (oBtn, oVar) {//문서삭제200808

    document.getElementById("ACTIONINDEX").value = "REMOVEREASON";
    //결재선정보가져오기
    var vapvlist = $.parseXML($("#APVLIST").val())
    var items = $(vapvlist).find("step[name='결재'] > ou > person ");
    var pApvUserList = "";
    for (var i = 0; i < items.length; i++) {
        if (i == 0) {
            pApvUserList = $(items[i]).attr('code');
        }
        else {
            pApvUserList += "|" + $(items[i]).attr('code');
        }
    }

    // 20171116 hpark 협조처 가져오기 로직 서버로이동
    //협조처 리스트 가져오기
    //getInfo("CONSULT_LIST")       
    //var pConsultDeptList = "";
    //var sConsultList = getInfo("CONSULT_LIST");
    //var arrConsultList = sConsultList.split('|');

    //for (var i = 0; i < arrConsultList.length - 1; i++) {
    //    var arrConsultInfo = arrConsultList[i].split(':');
    //    if (i == 0) {
    //        pConsultDeptList += arrConsultInfo[0] + "_" + arrConsultInfo[2];
    //    }
    //    else {
    //        pConsultDeptList += "|" + arrConsultInfo[0] + "_" + arrConsultInfo[2];
    //    }
    //}

    ////참조처 리스트 가져오기
    //var ccinfoitems = $(vapvlist).find("ccinfo > ou");
    //if (ccinfoitems.length > 0) {
    //    var pApvccinfoList = "";
    //    for (var i = 0; i < ccinfoitems.length; i++) {
    //        if (i == 0) {
    //            pApvccinfoList = $(ccinfoitems[i]).attr('companycode') + "_" + $(ccinfoitems[i]).attr('code');
    //        }
    //        else {
    //            pApvccinfoList += "|" + $(ccinfoitems[i]).attr('companycode') + "_" + $(ccinfoitems[i]).attr('code');
    //        }
    //    }
    //}

    //수신 정보
    var Receiveritems = $(vapvlist).find(" division[name='수신'] > step > ou > person ");
    var pReceiverList = "";
    for (var i = 0; i < Receiveritems.length; i++) {
        if (i == 0) {
            pReceiverList = $(Receiveritems[i]).attr('code');
        }
        else {
            pReceiverList += "|" + $(Receiveritems[i]).attr('code');
        }
    }


    //CFN_PageMethodJSON("GetConsultManagerList", "{pEnt_Code:'" + DnCode + "'}", false, function GetFormList(pResult, pContext) {
    //    try {
    //        if (pResult != "") {

    //            if (pResult.d == "ERROR") {
    //                alert(Common.GetDic('msg_OccurError'));  //에러가 발생했습니다
    //                return;
    //            }

    //            var l_TotalCnt;

    //            var oJson = eval('(' + pResult.d + ')');



    //            l_TotalCnt = oJson.Table.length;
    //            $("#ddlFormName option").remove();
    //            $("#ddlFormName").append("<option value=" + '-1' + ">" + '선택하세요' + "</option>");
    //            if (l_TotalCnt > 0) {

    //                for (var i = 0; oJson.Table.length > i; i++) {
    //                    $("#ddlFormName").append("<option value=" + oJson.Table[i].FORM_PREFIX + ">" + oJson.Table[i].FORM_NAME + "</option>");
    //                }
    //            }
    //        }
    //    } catch (e) {
    //        alert("Error: " + e.description + "\r\nError number: " + e.number);
    //        return;
    //    }
    //}, null, "");


    var pProcessCode = CFN_GetQueryString("processCode");
    var pProcessInstanceId = CFN_GetQueryString("processInstanceId");
    var pSubJect = getInfo("SUBJECT");

    var pDocPath = location.href.replace('?', '!@!').replace(/&/gi, "@#@").replace(/=/gi, "#$#");

    // 20171116 hpark 협조처 가져오기 로직 서버로이동
    //var params = "&processCode=" + pProcessCode + "&processInstanceId=" + pProcessInstanceId + "&subJect" + pSubJect + "&ConsultDeptList=" + pConsultDeptList + "&apvUserList=" + pApvUserList + "&receiverList=" + pReceiverList;// + "&docPaht=" + pDocPath;
    //var params = "&processCode=" + pProcessCode + "&processInstanceId=" + pProcessInstanceId + "&subJect" + pSubJect + "&apvUserList=" + pApvUserList + "&receiverList=" + pReceiverList;// + "&docPaht=" + pDocPath;
    var params = "&processCode=" + pProcessCode + "&processInstanceId=" + pProcessInstanceId + "&apvUserList=" + pApvUserList + "&receiverList=" + pReceiverList;// + "&docPaht=" + pDocPath;

    oVar.iHeight = 160; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=REMOVEREASON" + params;
    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }

}

doButtonCase['btForcedConsent'] = function (oBtn, oVar) {//강제합의200808
    Common.Confirm(gMessage77, "Confirmation Dialog", function (result) {
        if (result) {
            forcedConsent();
        } else {
            return;
        }
    });
}

doButtonCase['btCSR'] = function (oBtn, oVar) {	 //우리투자증권 CSR요청서 검토의견입력 버튼 : 2008.09.26 백승찬 대리
    document.getElementById("bodycontext_review").style.display = "";
}


doButtonCase['btDCooRemove'] = function (oBtn, oVar) {//합의부서 삭제 200811
    oVar.iHeight = 275 - 34; oVar.iWidth = 294;
    oVar.sUrl = "/Approval/ApvProcess/selectOUs.aspx";
}

doButtonCase['btOTransPV'] = function (oBtn, oVar) {
    //대외공문 미리 보기 
    oVar.sSize = "fix";
    oVar.iWidth = 790;
    //가로양식
    if (IsWideOpenFormCheck(getInfo("fmpf"))) {
        oVar.iWidth = 1070;
    }
    oVar.iHeight = window.screen.height - 82; //oVar.sUrl="PreView.aspx";
    oVar.sUrl = String(document.location.href);
    oVar.sUrl = oVar.sUrl.replace("FormWrite", "Form"); //바닥 작성창에서 Open할 경우
    if (oVar.sUrl.lastIndexOf("#") == (oVar.sUrl.length - 1)) { oVar.sUrl = oVar.sUrl.substring(0, oVar.sUrl.lastIndexOf("#")); } //url에 #이 포함되어 있음 제거처리
    if (IsOfficePrintFormCheck(getInfo("fmpf"))) {
        oVar.sUrl = oVar.sUrl + "&ReadType=Print&editMode=P";
        m_CmtBln = true;
        bPresenceView = true;
    }
    else {
        oVar.sUrl = oVar.sUrl + "&Readtype=Pubpreview";
    }
}

doButtonCase['btOTransMail'] = function (oBtn, oVar) {
    //다음다이렉트 특수기능 대외공문 완료시 메일 발송 --> 일반메일 보내기로 변경 대외공문 포맷으로 변경작업 필요
    oVar.m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
    m_oFormEditor.bFileView = false;
    m_oFormEditor.bPresenceView = false;
    m_oFormEditor.sCommentHtml = "";
    m_oFormEditor.bCommentViewFirst = true;
    displayApvList(oVar.m_evalXML);
    //첨부파일 경로 넣어주기 Igate 양식 첨부파일 display 살리기
    var beforeStyle = "";
    var eTR = document.getElementById("DocLinkInfo").parentElement;
    while (eTR.tagName != "TABLE") {
        eTR = eTR.parentElement;
    }

    G_displaySpnAttInfo_Mail();
    G_displaySpnDocLinkInfo_Mail();
    var beforeStyle = eTR.style.display;
    eTR.style.display = "none";
    document.getElementById("AppLine").parentElement.parentElement.style.display = "none";
    document.getElementById("tdforminfo").parentElement.parentElement.style.display = "none";

    sMailBody = "<style>";
    try { for (var i = 0; i < document.styleSheets.length; i++) { sMailBody += getStyle(document.styleSheets[i].href); } } catch (e) { }
    sMailBody += "</style>";
    sMailBody += "<P>&nbsp;</P><P>&nbsp;</P><BR/>" + document.getElementById("bodytable").innerHTML;
    eTR.style.display = beforeStyle;
    m_oFormEditor.bPresenceView = false; //true;
    m_oFormEditor.bFileView = true;
    m_oFormEditor.sCommentHtml = "";
    m_oFormEditor.bCommentViewFirst = true;
    displayApvList(oVar.m_evalXML);
    m_oFormEditor.G_displaySpnAttInfo(false);
    m_oFormEditor.G_displaySpnDocLinkInfo();
    document.getElementById("AppLine").parentElement.parentElement.style.display = "";
    document.getElementById("tdforminfo").parentElement.parentElement.style.display = "";
    sendMail();
}

doButtonCase['btMailSend'] = function (oBtn, oVar) {
    if (getInfo('mode') == 'DRAFT') {
        // '작성한 문서를 먼저 저장해야 우편함으로 보낼수 있습니다.'
        Common.Warning(Common.GetDic("msg_Request_For_Mail"));
        return;
    } else {
        SendMailInBody();   //2013.12.26 메일보내기 추가
    }
}



doButtonCase['btUrl'] = function (oBtn, oVar) {//URL 넣기
    if (getInfo('mode') == 'DRAFT') {
        // '작성한 문서를 먼저 저장해야 링크복사가 가능합니다.
        Common.Warning(Common.GetDic("msg_Request_For_URL"));
    }
    else {
        try {
            var bReturn = false;
            var sLINKUrl = "";
            if (getInfo('mode') == 'TEMPSAVE') {
                sLINKUrl = "http://" + _WebServerDomain + "/Approval/Forms/Form.aspx?";
                sLINKUrl += "mode=" + getInfo('mode');
                sLINKUrl += "&fmid=" + getInfo('fmid');
                sLINKUrl += "&fiid=" + getInfo('fiid');
                sLINKUrl += "&ftid=" + getInfo('ftid');

                window.clipboardData.clearData("Text");
                bReturn = window.clipboardData.setData("Text", sLINKUrl);
            }
            else {
                var currentIframe;
                //if (getInfo('use_tab') == 'Y' && parent.g_IS_NewWindow != "Y") {
                if (g_IS_TabUI == "Y") {
                    var currentTabID = parent.document.getElementById("hidMasterCurrentTab").value;
                    currentIframe = parent.document.getElementById("ifrTabContent_" + currentTabID).contentWindow;
                }
                else {
                    currentIframe = parent;
                }
                sLINKUrl = currentIframe.window.location.href.replace("&IS_TabUI=Y", "");;
                window.clipboardData.clearData("Text");
                bReturn = window.clipboardData.setData("Text", sLINKUrl);
            }


            if (true == bReturn) {
                alert(gMessage289);//"문서URL이 클립보드에 복사되었습니다."
            }
        } catch (e) {
            alert(Common.GetDic("msg_apv_328")); // 지원하지 않는 브라우져 입니다.
        }
    }
}

//추가 의견 안내 메일 발송으로 인한 수정 2006.09 sunny
doButtonCase['btCommentFeedback'] = function (oBtn, oVar) {//Feedback의견
    var sKind = "feedback";

    oVar.iHeight = 260; oVar.iWidth = 600;
    oVar.sUrl = "/Approval/Comment/comment_feedback.aspx?piid=" + getInfo("piid") + "&form_inst_id=" + getInfo("fiid") + "&user_id=" + getInfo("usid") + "&kind=" + sKind + "&mode=" + getInfo("mode") + "&user_name=" + escape(getInfo("usdn"));
}


doButtonCase['btInkWrite'] = function (oBtn, oVar) {   //잉크쓰기 버튼 Event
    fnShowInkWriter();
}

doButtonCase['btInkView'] = function (oBtn, oVar) {  //잉크보기 버튼 Event
    m_inkClicked = "1";
    $("#btInkView").attr("class", "");
    fnShowInkViewer();
}

//doButtonCase['btShared'] = function (oBtn, oVar) {  //참조 확인 버튼 Event
//    //fnShared();
//}

/* 직인관련 버튼 액션 추가 */
/* 인하대 소스를 참조하였습니다. 2013. 5. 10 박은선 */
//	        doButtonCase['btDeptAdd'] = function (oBtn, oVar) {// 대외 수신처  필요없을듯 하여 일단 주석처리합니다. 
//	            oVar.iWidth = 900; oVar.iHeight = 620;
//	            oVar.sUrl = "/COVINet/COVIFlowNetGov/GovAddress/ApvRdptListMgr.htm";
//	            break;
doButtonCase['btStampSelect'] = function (oBtn, oVar) {//직인선택
    var strSelectedStampInfo = "";

    strSelectedStampInfo = popupGovStampSelectList();
    strSelectedStampInfo = strSelectedStampInfo.split(";");

    document.getElementById("StampID").value = strSelectedStampInfo[0]; //StampID
}

doButtonCase['btStampInsert'] = function (oBtn, oVar) {//직인삽입
    ////debugger;
    var iGovStampCount = parseInt(getInfo("GovStampCount"));
    var strStampSrc = getInfo("GovStampSrc");

    if (iGovStampCount == 0) {  //직인이 없으면 알림
        alert("직인이 등록되지 않았습니다.");
    } else {
        if (confirm("직인을 포함하시겠습니까?")) {
            if (strStampSrc != undefined && strStampSrc != "") {    //직인이 있으면 본문에 이미지 삽입
                m_oFormEditor.document.getElementById("seal").src = "/COVINet/BackStorage/Stamp/" + strStampSrc;
                m_oFormEditor.document.getElementById("seal").style.display = "";
                document.getElementById("btStampRemoved").style.display = "";
            }
        } else {
            m_oFormEditor.document.getElementById("seal").src = "";
            m_oFormEditor.document.getElementById("seal").style.display = "none";
            document.getElementById("btStampRemoved").style.display = "none";
        }
    }
    if (getInfo("GovReceiver") != "") { //전자문서 수신처가 있을때만 전자문서 발송버튼 보이기
        document.getElementById("btGovSend").style.display = "";
    }
    document.getElementById("btPrint").style.display = "";  //인쇄 버튼 활성화
}

doButtonCase['btStampRemove'] = function (oBtn, oVar) {//직인삭제
    m_oFormEditor.document.getElementById("seal").src = "";
    m_oFormEditor.document.getElementById("seal").style.display = "none";
    document.getElementById("btGovSend").style.display = "none";
    document.getElementById("btPrint").style.display = "none";  //인쇄 버튼 비활성화
    document.getElementById("btGovStampRemove").style.display = "none";
}

doButtonCase['btApproverChangeReview'] = function (oBtn, oVar) {//2013.07 메리츠 yu2mi btApproverChangeReview
    m_sAddList = 'ChangeReview';
    Open_Forward(m_sAddList);
}

doButtonCase['btApproverChangeDeputy'] = function (oBtn, oVar) {//2013.07 메리츠 yu2mi btApproverChangeDeputy
    oVar.iHeight = 300; oVar.iWidth = 400;
    oVar.sUrl = "/Approval/Custom/ChangeList.aspx?piid=" + getInfo("piid") + "&form_inst_id=" + getInfo("fiid");
}

doButtonCase['btSapRetunt'] = function (oBtn, oVar) {//"SAP 재연동"
    sMsgTitle = gLabel__Doc_back;
    sTargetURL = "/ZAdmin/OperSystem/Approval/CfAdmin/AdminLegacyResend.aspx";
    sAddage = makeNode("usid") + makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
        + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
        + makeNode("type", "sap") + makeNode("IsMobile", (getInfo("scMobile") == "1" ? 'true' : 'false')) + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + makeNode("TargetLegacy", (getInfo("scTargetLegacy") == '1' ? getInfo("scTargetLegacyV") : "")) + getInfoBodyContext();
}

doButtonCase['btEproRetunt'] = function (oBtn, oVar) {//"EPRO 재연동"
    sMsgTitle = gLabel__Doc_cancel;
    sTargetURL = "/ZAdmin/OperSystem/Approval/CfAdmin/AdminLegacyResend.aspx";
    sAddage = makeNode("usid") + makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
        + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
        + makeNode("type", "epro") + makeNode("IsMobile", (getInfo("scMobile") == "1" ? 'true' : 'false')) + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + makeNode("TargetLegacy", (getInfo("scTargetLegacy") == '1' ? getInfo("scTargetLegacyV") : "")) + getInfoBodyContext();
}

doButtonCase['btSrmRetunt'] = function (oBtn, oVar) {//"SRM 재연동"
    sMsgTitle = gLabel__Doc_back;
    sTargetURL = "/ZAdmin/OperSystem/Approval/CfAdmin/AdminLegacyResend.aspx";
    sAddage = makeNode("usid") + makeNode("actcmt", document.getElementById("ACTIONCOMMENT").value, null, true)
        + makeNode("attachmentFileUrl", document.getElementById("ACTIONCOMMENT_FILE_INFO").value, null, false)
        + makeNode("type", "srm") + makeNode("IsMobile", (getInfo("scMobile") == "1" ? 'true' : 'false')) + makeNode("IsLegacy", (getInfo("scLegacy") == "1" ? getInfo("scLegacyV") : 'false')) + makeNode("TargetLegacy", (getInfo("scTargetLegacy") == '1' ? getInfo("scTargetLegacyV") : "")) + getInfoBodyContext();
}

doButtonCase['btPreList'] = function (oBtn, oVar) {
    fnGoPreNextList('btPreList');
}

doButtonCase['btNextList'] = function (oBtn, oVar) {
    fnGoPreNextList('btNextList');
}

doButtonCase['btDocListSave'] = function (oBtn, oVar) {//문서대장 저장
    if (document.getElementById("SUBJECT").value.trim() == "") {
        var subject = XFN_GetDicInfo(getInfo("usdn")) + " - " + getInfo("fmnm");
        document.getElementById("SUBJECT").value = subject;
    }

    if (!FormAttachProcess("btDocListSave"))
        return false;

    fnUploadCompletedCallBackMethod = undefined;
    m_sReqMode = "DOCLISTSAVE";
    requestProcess("DOCLISTSAVE");
}

//[2014-12-09] 보존년한 변경
doButtonCase['btPreserveDateUpdate'] = function (oBtn, oVar) {
    var iHeight = 250;
    var iWidth = 50;
    var sSize = 'noresize';
    var sUrl = "/Approval/Forms/PreserveDateUpdate.aspx";

    CFN_OpenWindow(sUrl, "PreserveDate", iWidth, iHeight, sSize);
}
//신세계 Layer 수정 적용
//2016-06-08
//YJYOO
doButtonCase['btExitPreView'] = function (oBtn, oVar) {  // 기존 미리보기 창의 top.colose 에서 레이어 팝업 or 윈도우 팝업을 구분 하여 닫기 
    if (CFN_GetQueryString("openID") == getInfo("fmid") || (CFN_GetQueryString("editMode") == 'Y') && CFN_GetQueryString("CFN_OpenWindowName") == 'undefined') {
        var openName = CFN_GetQueryString("openID");
        parent.Common.Close("DivPop_" + openName);
    } else {
        window.close();
    }
}
//TO-DO : 신세계 Customizing 담당자와 톡하기
//2016-07-27 BY YJYOO
doButtonCase['btChargeTalk'] = function (oBtn, oVar) {  //
    if (getInfo("ChargeTalkId") != "") {
        ChargeTalk(getInfo("ChargeTalkId"));
    }
}
//<!--BPM엔진 테스트 용도의 임시 버튼 영역 시작-->
doButtonCase['btDeny'] = function (oBtn, oVar) {//기각
    //기각
    document.getElementById("ACTIONINDEX").value = "DENY";

    var bICommentAttach = (Common.GetBaseConfig("UseActCmtAttach") == 'Y') ? true : false;
    oVar.iHeight = 290; oVar.iWidth = 500;//첨부파일 없을 경우 

    oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=DENY";
    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    //document.getElementById("ACTIONINDEX").value = "";

    //requestProcess("DENY");
}
//기각사유버튼
doButtonCase['btDeny_Reason'] = function (oBtn, oVar) {//기각사유
    document.getElementById("ACTIONINDEX").value = "DENYREASON";
    oVar.iHeight = 310; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=DENYREASON";
    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
}
//반송사유버튼
doButtonCase['btRejectRequest_Reason'] = function (oBtn, oVar) {//반송사유
    // 협조거부시 기각 의견표시
    if (getInfo("pdef") == "GENERAL_PATTERN" && getInfo("cooperDenyDeptInfo") && getInfo("cooperDenyDeptInfo").split("||").length > 4) { // getInfo("scCooperDenyReject") == "1"
        document.getElementById("ACTIONINDEX").value = "RejectRequest_Reason";
        oVar.iHeight = 310; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=DENYREQUESTREASON";
    } else {
        document.getElementById("ACTIONINDEX").value = "RejectRequest_Reason";
        oVar.iHeight = 310; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=REJECTREQUESTREASON";
    }
    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
}
doButtonCase['btReject'] = function (oBtn, oVar) {//반송
    if (!FormAttachProcess("btReject"))
        return false;
    //requestProcess("DENY");
    var type = "";
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        if (getInfo("openerDivisionType") == "SEND") {
            type = "reject";
        }
        else if (getInfo("openerDivisionType") == "RECEIVE" && getInfo("pdef") == "COOPERATION_PATTERN") { // 협조전류의 수신처 일경우
            //if (getInfo("openerDutyCode") == "80") { // 팀장
            if (getInfo("mode_unit") == "COOPERATION_APPROVAL") { //현결재자가 협조처 팀장의 경우
                type = "MANAGER_REJECT";
            }
                //else if (getInfo("openerDutyCode") == "70") { // 상위결재자
            else if (getInfo("mode_unit") == "PARENT_DRAFT") { //상위 결재자
                type = "PARENT_REJECT"; // 상위결재자 반송
            }
                //else if (getInfo("openerDutyCode") == "") { // 담당자
            else if (getInfo("mode_unit") == "CHARGE_APPROVAL") {
                type = "RETURN_REQUEST"; // 코드 없음
            }
            else {
                type = "reject";
            }
        }
        else if (getInfo("openerDivisionType") == "RECEIVE") { //신청서
            if (getInfo("mode_unit") == "RECEIVE_APPROVAL") { //팀장의 경우
                type = "MANAGER_REJECT";
            }
            else if (getInfo("mode_unit") == "CHARGE_APPROVAL") {
                type = "CHARGE_REJECT"; // 담당자 반송
            }
            else {
                type = "reject";
            }
        }
        else {
            type = "reject";
        }

        document.getElementById("ACTIONINDEX").value = "reject";
        //oVar.iHeight = 450; oVar.iWidth = 500;
        oVar.iWidth = 500;//첨부파일 없을 경우 oVar.iHeight = 290; 

        oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=" + type;
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    }
}
doButtonCase['btRejectRequest'] = function (oBtn, oVar) {//반송요청
    if (!FormAttachProcess("btRejectRequest"))
        return false;
    //requestProcess("DENY");
    var type = "";
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        document.getElementById("ACTIONINDEX").value = "reject";

        //oVar.iHeight = 450; oVar.iWidth = 500;
        oVar.iWidth = 500;//첨부파일 없을 경우 oVar.iHeight = 290; 
        oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=RETURN_REQUEST";
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    }
}
doButtonCase['btCancelApprove'] = function (oBtn, oVar) {//결재 취소
    //requestProcess("CANCELAPPROVE");
    if (!FormAttachProcess("btCancelApprove"))
        return false;
    var type = "";
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        //일반 품의류 협조 취소
        if (getInfo("openerDocumentStepCode") == "COOPERATION_REQUEST" && getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1) {
            setSendConsultCancel();
        }
            // 롤결재자가 협조 취소했을 경우
        else {
            var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
            //var currPendingStep = $(m_oApvList).find("division > step:has(ou > role > person > taskinfo[status='pending']),division > step:has(ou > person > taskinfo[status='pending'])");
            //if (currPendingStep != null && $(currPendingStep).length > 0 && $(currPendingStep).attr("approverat") == "P" && $(currPendingStep).attr("approvalorder") == "100") {
            //    setSendConsultCancel();
            //}
            //if (currPendingStep != null && $(currPendingStep).length > 0 && $(currPendingStep).attr("approverat") == "P" && (getInfo("fmpf").indexOf("GWOK_INVEST") > -1 || getInfo("fmpf").indexOf("GWOK_PINVEST") > -1)) {
            //	setSendConsultCancel();
            //}
            var currPendingStep = $(m_oApvList).find("division > step:has(ou > role > person > taskinfo[status='pending']),division > step:has(ou > person > taskinfo[status='pending'])");
            var currPendingStep_role = $(m_oApvList).find("division > step:has(ou > role > person > taskinfo[status='pending'])");
            var currPendingStep_person = $(m_oApvList).find("division[divisiontype='send'] > step:has(ou > person > taskinfo[status='pending'])");
            // 상신이면서 협조요청일경우, role결재이후 협조요청일경우, 특정양식의 경우
            if ((currPendingStep_person != null && $(currPendingStep_person).length > 0 && $(currPendingStep_person).attr("approverat") == "P" && $(currPendingStep_person).attr("approvalorder") == "100" && $(currPendingStep_person).attr("code") == getInfo("usid"))
				|| (currPendingStep_role != null && $(currPendingStep_role).length > 0 && $(currPendingStep_role).attr("approverat") == "P")
				|| (currPendingStep != null && $(currPendingStep).length > 0 && $(currPendingStep).attr("approverat") == "P" && (getInfo("fmpf").indexOf("GWOK_INVEST") > -1 || getInfo("fmpf").indexOf("GWOK_PINVEST") > -1))) {
                setSendConsultCancel();
            }
        }

        //협조전의 협조처 결재취소의 경우 APPROVAL_CANCEL로 호출한다.
        if (
            (getInfo("pdef") == "COOPERATION_PATTERN" && (getInfo("mode_unit") == "COOPERATION_APPROVAL" || getInfo("mode_unit") == "CHARGE_APPROVAL" || getInfo("mode_unit") == "PARENT_DRAFT")) ||
            //(getInfo("pdef") == "COOPERATION_PATTERN" && getInfo("openerDocumentStepCode") == "COOPERATION_REQUEST" && getInfo("mode_unit") == "COOPERATION_APPROVAL") ||
            //(getInfo("pdef") == "COOPERATION_PATTERN" && getInfo("openerDocumentStepCode") == "" && getInfo("mode_unit") == "PARENT_DRAFT") ||
            ((getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN" || getInfo("pdef") == "INVEST_PATTERN") && (getInfo("mode_unit") == "COOPERATION_APPROVAL" || getInfo("mode_unit") == "EXAMINATION_APPROVAL")) ||
            (getInfo("pdef") == "ABROAD_PATTERN" && (getInfo("mode_unit") == "COOPERATION_APPROVAL" || getInfo("mode_unit") == "EXAMINATION_APPROVAL")) ||
            (getInfo("pdef") == "COMPUTATION_PATTERN" && getInfo("mode_unit") == "RECEIVE_APPROVAL")
            || (getInfo("pdef") == "STEP3_PATTERN" && (getInfo("mode_unit") == "RECEIVE_APPROVAL" || getInfo("mode_unit") == "CHARGE_APPROVAL" || getInfo("mode_unit") == "COOPERATION_APPROVAL" || getInfo("mode_unit") == "PARENT_DRAFT"))
            || (getInfo("pdef") == "STEP4_PATTERN" && getInfo("mode_unit") == "RECEIVE_APPROVAL")

        ) {
            type = "APPROVAL_CANCEL";
        }
        else if (getInfo("pdef") == "REQST_CRRF_PATTERN" && getInfo("openerDivisionType") == "RECEIVE") // 공문협조 수신부서에서 결재취소의 경우 CANCELAPPROVE_RECEIVE 호출한다.
        {
            type = "CANCELAPPROVE_RECEIVE";
        }
        else if (getInfo("pdef") == "REQUEST_PATTERN" && getInfo("openerDivisionType") == "RECEIVE") { // 신청서 수신부서에서 결재취소인 경우 CANCELAPPROVE_RECEIVE로 호출한다.
            type = "CANCELAPPROVE_RECEIVE";
        }
        else {
            type = "CANCELAPPROVE";
        }
        //document.getElementById("ACTIONINDEX").value = type;
        //oVar.iWidth = 500;//첨부파일 없을 경우 oVar.iHeight = 290; 
        //oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=" + type;

        Common.Confirm(Common.GetDic("lbl_apv_draftcomment_03"), $("#btCancelApprove").text(), function (result) {
            if (result) {
                requestProcess(type);
            }
        })
    }
}
doButtonCase['btCancelReceipt'] = function (oBtn, oVar) {//접수 취소
    //requestProcess("CANCELAPPROVE");
    if (!FormAttachProcess("btCancelReceipt"))
        return false;
    var type = "";
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        //신규 신청서 프로세스 
        if (getInfo("pdef") == "REQUEST_PATTERN" && getInfo("openerDivisionType") == "RECEIVE") {
            type = "CANCELRECEIPT";
        } //공문 프로세스 접수 취소 사용 시
        else if (getInfo("pdef") == "REQST_CRRF_PATTERN" && getInfo("openerDivisionType") == "RECEIVE") {
            type = "CANCELRECEIPT";
        }

        if (type.length == 0) { return;}


        Common.Confirm(Common.GetDic("lbl_apv_draftcomment_05"), $("#btCancelReceipt").text(), function (result) {
            if (result) {
                requestProcess(type);
            }
        })
    }
}

doButtonCase['btCompleteCancelReceipt'] = function (oBtn, oVar) {//접수 취소 (수신처 팀장이 완료된 문서 접수 취소) - 문서 삭제 후 재송
    //requestProcess("CANCELAPPROVE");
    if (!FormAttachProcess("btCompleteCancelReceipt"))
        return false;
    var type = "";
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {

        //공문 프로세스 접수 취소 사용 시
        if (getInfo("pdef") == "REQST_CRRF_PATTERN" && getInfo("openerDivisionType") == "RECEIVE") {
            type = "CANCELRECEIPT_RESEND";

            if (typeof $('#CONSULT_DATE').val() == "undefined") {
                $('body').append("<input id=\"CONSULT_DATE\" type=\"hidden\"  data-type=\"dField\" />"); // 협조처 기한 추가
            }
            CooperationConsultDateSetting(); // 협조기한 설정
        }

        if (type.length == 0) { return; }


        Common.Confirm(Common.GetDic("lbl_apv_draftcomment_05"), $("#btCancelReceipt").text(), function (result) {
            if (result) {
                requestProcess(type);
            }
        })
    }
}

//doButtonCase['btRequestConsult'] = function (oBtn, oVar) {//협조 요청
//    //requestProcess("REQUESTCONSULT");
//    m_sReqMode = "APPROVE";
//    if (evaluateForm()) {
//        document.getElementById("ACTIONINDEX").value = "REQUESTCONSULT";
//        oVar.iHeight = 230; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=REQUESTCONSULT";
//    }
//}
doButtonCase['btRejectConsult'] = function (oBtn, oVar) {//협조 거부
    //requestProcess("REJECTCONSULT");
    if (!FormAttachProcess("btRejectConsult"))
        return false;
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        document.getElementById("ACTIONINDEX").value = "REJECTCONSULT";
        oVar.iWidth = 500;//첨부파일 없을 경우 oVar.iHeight = 290; 
        oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=REJECTCONSULT";
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    }
}
doButtonCase['btCompleteConsult'] = function (oBtn, oVar) {//협조 완료
  
    //requestProcess("COMPLETECONSULT");
    if (!FormAttachProcess("btCompleteConsult"))
        return false;
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        document.getElementById("ACTIONINDEX").value = "COMPLETECONSULT";
        oVar.iHeight = 230; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=COMPLETECONSULT";
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    }
}
doButtonCase['btAssignExamination'] = function (oBtn, oVar) {//해외투자품의 총괄부서 검토자지정
    DeptLineConsultOK("EXAMINATION");
}

doButtonCase['btAssignReviewer'] = function (oBtn, oVar) {//협조결재
    //sWindowName = "winAction"; oVar.sSize = "resize";
    //oVar.iHeight = 220; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ConsultBasic.aspx?type=DRAFT&openMode=L";


    //재기안자 의견 가져오기 - 검토 의견으로 씀
    //var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
    


    //협조결재시 표시
    var consultApv_exa = getInfo('strConsultJson');
    consultApv_exa = $.parseXML(consultApv_exa);
    //var consultApvRoot_exa = $(consultApv_exa).find("steps > division[divisiontype = 'COOPERATION_PLACE']");
    //if ($(consultApvRoot_exa).find("step > ou > person > taskinfo[visible!='n'] > comment").length >= 1) {
    //    $(consultApvRoot_exa).find("step").each(function (div, elmdiv) {

    //        if ($(elmdiv).find("ou > person >  taskinfo[visible!='n'] > comment").attr('typecode') == 'OPINION' && ($(consultApvRoot_exa).find("step[routetype='examine'] > ou > person >  taskinfo[result='pending']").length >= 1)) {//검토자지정 의견
    //            ConsulteComment = $(this).text().replace(/\n/g, "<br />")
    //        }
    //        else if ($(elmdiv).find("ou > person >  taskinfo[visible!='n'] > comment").attr('typecode') == 'EXAMINATION' && ($(consultApvRoot_exa).find("step[routetype='assist'] > ou > person >  taskinfo[result='pending']").length >= 1)) {
    //            ConsulteComment = $(this).text().replace(/\n/g, "<br />")

    //        }

    //    });


    //}

    var consultApvRoot_exa = $(consultApv_exa).find("steps > division[divisiontype = 'COOPERATION_PLACE']");
    $(consultApvRoot_exa).find("step[processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo > comment").each(function (i, elmdiv) {
        if ($(elmdiv).attr('typecode') == 'OPINION' && ($(consultApvRoot_exa).find("step[routetype='examine'] > ou[code='" + getInfo("dpid") + "'] > person >  taskinfo[result='pending']").length > 0)) {//검토자지정 의견
            ConsulteComment = $(this).text().replace(/\n/g, "<br />")
        }
        else if ($(elmdiv).attr('typecode') == 'EXAMINATION' && ($(consultApvRoot_exa).find("step[routetype='assist'] > ou[code='" + getInfo("dpid") + "'] > person >  taskinfo[result='pending']").length > 0)) {
            ConsulteComment = $(this).text().replace(/\n/g, "<br />")
        }
    });


    document.getElementById("ACTIONINDEX").value = "ASSIGNREVIEWER";


    oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 380; 

    oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=ASSIGNREVIEWER";
    if (g_IS_TabUI == "Y") 
        oVar.IS_Tab = "Y";       
    doButtonPostProcess(oVar);
}
doButtonCase['btCancelReview'] = function (oBtn, oVar) {//검토자 검토 취소
    //requestProcess("CANCELREVIEW");
    if (!FormAttachProcess("btCancelReview"))
        return false;
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        document.getElementById("ACTIONINDEX").value = "CANCELREVIEW";
        oVar.iHeight = 230; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=CANCELREVIEW";
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    }
}

doButtonCase['btCompleteReview'] = function (oBtn, oVar) {//검토 완료
    if (!FormAttachProcess("btCompleteReview"))
        return false;
    //var m_oApvList = $.parseXML(getInfo("strConsultJson")); //원본
    //var m_oSubReStep = $(m_oApvList).find("division[divisiontype='COOPERATION_PLACE']>step[routetype='assist']"); //검토 지정한 협조처 팀장 STEP

    //var oStep = m_oApvList.createElement("step"); //검토 완료후 협조처 팀장 STEP 추가
    //var oOU = m_oApvList.createElement("ou");
    //var oPerson = m_oApvList.createElement("person");
    //var oTaskinto = m_oApvList.createElement("taskinfo");

    //$(m_oSubReStep).parent().append(oStep);
    //$(oStep).append(oOU);
    //$(oOU).append(oPerson);
    //$(oPerson).append(oTaskinto);

    //$(oStep).attr("unittype", "ou");
    //$(oStep).attr("routetype", "assist");
    //$(oStep).attr("name", "");

    /////원본
    //$(oOU).attr("code", $(m_oSubReStep).find("ou").attr("code"));
    //$(oOU).attr("name", $(m_oSubReStep).find("ou").attr("name"));
    //$(oPerson).attr("code", $(m_oSubReStep).find("ou > person").attr("code"));
    //$(oPerson).attr("name", $(m_oSubReStep).find("ou > person").attr("name"));
    ////$(oPerson).attr("position", JobPositionCode);
    //$(oPerson).attr("position", $(m_oSubReStep).find("ou > person").attr("position"));
    ////$(oPerson).attr("title", JobTitleCode);
    //$(oPerson).attr("title", $(m_oSubReStep).find("ou > person").attr("title"));
    //$(oPerson).attr("level", "");
    //$(oPerson).attr("ouname", $(m_oSubReStep).find("ou > person").attr("ouname"));
    //$(oPerson).attr("oucode", $(m_oSubReStep).find("ou > person").attr("oucode"));
    //$(oTaskinto).attr("kind", "normal");
    //$(oTaskinto).attr("status", "inactive");
    //$(oTaskinto).attr("result", "inactive");

    //$(m_oApvList).find("division[divisiontype='COOPERATION_PLACE']>step:has(ou > person > taskinfo[status='completed'][kind='normal'])").remove();//검토 지정한 협조처 팀장 STEP 삭제

    ////document.getElementById("APVLIST").value = CFN_XmlToString(m_oApvList);
    //document.getElementById("APVLIST").value = CFN_XmlToString(m_oApvList);

    //requestProcess("COMPLETEREVIEW");
    //협조결재시 표시
    var consultApv_exa = getInfo('strConsultJson');
    consultApv_exa = $.parseXML(consultApv_exa);
    //var consultApvRoot_exa = $(consultApv_exa).find("steps > division[divisiontype = 'COOPERATION_PLACE']");
    //if ($(consultApvRoot_exa).find("step > ou > person > taskinfo[visible!='n'] > comment").length >= 1) {
    //    $(consultApvRoot_exa).find("step").each(function (div, elmdiv) {

    //        if ($(elmdiv).find("ou > person >  taskinfo[visible!='n'] > comment").attr('typecode') == 'OPINION' && ($(consultApvRoot_exa).find("step[routetype='examine'] > ou > person >  taskinfo[result='pending']").length >= 1)) {//검토자지정 의견
    //            ConsulteComment = $(this).text().replace(/\n/g, "<br />")
    //        }
    //        else if ($(elmdiv).find("ou > person >  taskinfo[visible!='n'] > comment").attr('typecode') == 'EXAMINATION' && ($(consultApvRoot_exa).find("step[routetype='assist'] > ou > person >  taskinfo[result='pending']").length >= 1)) {
    //            ConsulteComment = $(this).text().replace(/\n/g, "<br />")

    //        }

    //    });


    //}
    elmdiv = $(consultApv_exa).find("steps > division[divisiontype = 'COOPERATION_PLACE'] > step[processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo[status='completed']:last");
    ConsulteComment = $(elmdiv).find("comment").text().replace(/\n/g, "<br />");


    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        document.getElementById("ACTIONINDEX").value = "COMPLETEREVIEW";
        oVar.iHeight = 380; oVar.iWidth = 700; oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=COMPLETEREVIEW";
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    }

    //if (evaluateForm()) {
    //    document.getElementById("ACTIONINDEX").value = "COMPLETEREVIEW";
    //    oVar.iHeight = 500; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=COMPLETEREVIEW";
    //}
}

doButtonCase['btCtrlExamination_Complete'] = function (oBtn, oVar) {//총괄부서 검토자 검토 완료
    //if (!FormAttachProcess("btCompleteReview"))
    //    return false;

    //m_sReqMode = "APPROVE";
    //if (evaluateForm()) {
    //    document.getElementById("ACTIONINDEX").value = "CTRL_DEPT_COMPT_EXMNT";
    //    oVar.iHeight = 380; oVar.iWidth = 700; oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=CTRL_DEPT_COMPT_EXMNT";
    //    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    //}
    //트랜시스 투자품의서류 통제처 검토자 검토완료시 이전 통제결재자 추가 200131 홍성빈
    if (_DN_Code == "H104" && getInfo("fmpf").indexOf("WF_HPT_AW_SAP_PREFIX_WF50") > -1) {
        var currentApprovalOrder = $(m_oApvList).find("steps > division[divisiontype='send'] > step:has(ou > person > taskinfo[status='pending'])").attr("approvalorder");
        var prevApprovalOrder = currentApprovalOrder - 100;
        var URCD = $(m_oApvList).find("steps > division[divisiontype='send'] > step[approvalorder='" +prevApprovalOrder+ "'] > ou > person:has(taskinfo)").attr("code");
        //var URCD = $(m_oApvList).find("steps > division[divisiontype='send'] > step[name='롤결재'] > ou > person:has(taskinfo)").attr("code");
        //$(m_oApvList).find("steps > division[divisiontype='send'] > step[approvalorder="+currentApprovalOrder -100 +"] > ou > person:has(taskinfo)").attr("code");
        var prevCTRLApproval = makeStep(m_oApvList, URCD, "approve", "normal", currentApprovalOrder, "롤결재", "N");
        $(m_oApvList).find("steps > division > step").each(function (i, element) {
            if ($(element).attr("name") == "EXAMINATION_RECEIVE" && ($(element).attr("approverat") == "Y" || $(element).find("ou > person > taskinfo").attr('status') == "pending")) {
                $(element).after(prevCTRLApproval);    //총괄부서 삽입
            }
        });
        document.getElementById("APVLIST").value = CFN_XmlToString(m_oApvList);
    }
    document.getElementById("ACTIONINDEX").value = "CTRL_DEPT_COMPT_EXMNT";

        var bICommentAttach = (Common.GetBaseConfig("UseActCmtAttach") == 'Y') ? true : false;
        oVar.iHeight = 290; oVar.iWidth = 500;//첨부파일 없을 경우 

        oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=CTRL_DEPT_COMPT_EXMNT";
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
}
//<!--BPM엔진 테스트 용도의 임시 버튼 영역 시작-->
//TO-DO : 현대기아자동차 양식 템플릿 추가 / 해제 버튼 생성
//2017-04-03 YJYOO    
doButtonCase['btAddTemplate'] = function (oBtn, oVar) {//템플릿 추가
    requestProcess("ADDTEMPLATE");
}
//TO-DO : 현대기아자동차 양식 템플릿 저장 / 해제 버튼 생성
//2017-04-03 YJYOO    
doButtonCase['btRemoveTemplate'] = function (oBtn, oVar) {//템플릿 해제
    requestProcess("REMOVETEMPLATE");
}
doButtonCase['btSpecialReport'] = function (oBtn, oVar) {//별도보고
    if (!FormAttachProcess("btSpecialReport"))
        return false;
    //requestProcess("CANCELREVIEW");

    // 20171127 hpark 결재의견 명칭정리 ApvActBasic.aspx에서 이미결재한사람이면 view만 하도록 하는것을 통일성을 위해 comment_view를 호출하도록 수정
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        document.getElementById("ACTIONINDEX").value = "SPECIALREPORT";
        oVar.iHeight = 310; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=SPECIALREPORT";
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    }

    ////결재를 완료한 사람은 disalbed 처리 되어짐
    //var bSR_Comment_Auth = true;
    //var tmp_oApvList = $.parseXML(document.getElementById("APVLIST").value);
    //if ($(tmp_oApvList).find("steps > division > step > ou > person > taskinfo[result='completed']").length > 0) {
    //	$(tmp_oApvList).find("steps > division > step > ou > person > taskinfo[result='completed']").each(function (i, elm) {
    //		if ($(this).parent().attr("code") == Common.GetSession("UR_Code") || getInfo('loct') == 'PROCESS') {
    //			bSR_Comment_Auth = false;
    //		}
    //	});
    //}
    //else {
    //	bSR_Comment_Auth = false;
    //}
    //if (bSR_Comment_Auth) {
    //	m_sReqMode = "APPROVE";
    //	if (evaluateForm()) {
    //	    document.getElementById("ACTIONINDEX").value = "SPECIALREPORT";
    //	    oVar.iHeight = 310; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic.aspx?type=SPECIALREPORT";
    //	    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    //	}
    //} else {
    //	btCommentSpecial();
    //}
}

doButtonCase['btChargeAdd'] = function (oBtn, oVar) {//수신담당자

    var user_code = _UR_Code;
    //var gr_code = Common.GetSession("GR_Code");
    var gr_code = getInfo("CurrentApprovalParicipant_approverDepartmentCode") == "" ? _DeptCode : getInfo("CurrentApprovalParicipant_approverDepartmentCode");
    var company_code = getInfo("CurrentApprovalParicipant_approverCompanyCode") == "" ? _DN_Code : getInfo("CurrentApprovalParicipant_approverCompanyCode");
    var processcode = getInfo("pdef");
    var fmpf = getInfo("fmpf");
    var processinstanceid = getInfo("piid");

    oVar.iHeight = 500; oVar.iWidth = 550; oVar.sUrl = "/Approval/ApvProcess/SetApvCharger_Pop.aspx?type=CHARGEADD&user=" + user_code + "&group=" + gr_code + "&company=" + company_code + "&processcode=" + processcode + "&processinstanceid=" + processinstanceid + "&fmpf=" + fmpf;

    // 2018-11-12 관리자화면 공람자추가팝업 개발
    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    sWindowName = "winAction"; oVar.sSize = 'resize';
    //doButtonPostProcess(oVar);
}
doButtonCase['btGongRam'] = function (oBtn, oVar) {//공람자 지정
    //document.getElementById("APVLIST").value = CFN_XmlToString(m_oApvList);
    //XFN_OrgMapShow_WindowOpen("btDeptLineConsult", "divMenu", "hidConsultList", "", "DeptLineConsult_CallBack", "B1", "Y", "Y", "U", "APPROVAL", "", "");
    //var sWidth = "500";
    //var sHeight = "600";
    var user_code = _UR_Code;
    //var gr_code = Common.GetSession("GR_Code");
    var gr_code = getInfo("CurrentApprovalParicipant_approverDepartmentCode") == "" ? _DeptCode : getInfo("CurrentApprovalParicipant_approverDepartmentCode");
    var company_code = getInfo("CurrentApprovalParicipant_approverCompanyCode") == "" ? _DN_Code : getInfo("CurrentApprovalParicipant_approverCompanyCode");
    var processcode = getInfo("pdef");
    var fmpf = getInfo("fmpf");
    var processinstanceid = getInfo("piid");

    //var strURL = "/Approval/ApvProcess/GongRamBasic_PopUp.aspx?user=" + user_code + "&group=" + gr_code + "&Comment=" + Comment; //의견도 ... 
    //window.open(strURL, "", "width=800,height=600,scrollbars=yes", false);
    //CFN_OpenWindow(strURL, "", sWidth, sHeight, "scroll");

    //var strURL = "/Approval/ApvProcess/SetApvChargerAndPublicity_Pop.aspx?type=REFERENCEDISPLAY&user=" + user_code + "&group=" + gr_code; //의견추가     
    //var Title = Common.GetDic("btn_apv_Circulate");//계정검색
    //Common.Show("SetApvChargerAndPublicity", "1", Title, strURL, sWidth, sHeight, "iframe");

    // 20171212 hpark 공람자팝업 UI변경
    //oVar.iHeight = 750; oVar.iWidth = 1000; oVar.sUrl = "/Approval/ApvProcess/SetApvChargerAndPublicity_Pop.aspx?type=REFERENCEDISPLAY&user=" + user_code + "&group=" + gr_code + "&processcode=" + processcode + "&processinstanceid=" + processinstanceid;
    //oVar.iHeight = 800; oVar.iWidth = 550; oVar.sUrl = "/Approval/ApvProcess/SetApvChargerAndPublicity_Pop.aspx?type=REFERENCEDISPLAY&user=" + user_code + "&group=" + gr_code + "&company=" + company_code + "&processcode=" + processcode + "&processinstanceid=" + processinstanceid + "&fmpf=" + fmpf;
    // 2018-11-12 관리자화면 공람자추가팝업 개발
    if (getInfo("loct") == "ADMIN") {
        oVar.iHeight = 800; oVar.iWidth = 550; oVar.sUrl = "/Approval/ApvProcess/SetApvChargerAndPublicity_Pop_Admin.aspx?type=REFERENCEDISPLAY&user=" + user_code + "&group=" + gr_code + "&company=" + company_code + "&processcode=" + processcode + "&processinstanceid=" + processinstanceid + "&fmpf=" + fmpf;
    } else {
        oVar.iHeight = 800; oVar.iWidth = 550; oVar.sUrl = "/Approval/ApvProcess/SetApvChargerAndPublicity_Pop.aspx?type=REFERENCEDISPLAY&user=" + user_code + "&group=" + gr_code + "&company=" + company_code + "&processcode=" + processcode + "&processinstanceid=" + processinstanceid + "&fmpf=" + fmpf;
    }
    if (getInfo("loct") == "ARCHIVE") oVar.sUrl = String.format("/Approval/ApvProcess/SetApvChargerAndPublicity_Pop_Archive.aspx?type=REFERENCEDISPLAY&user={0}&group={1}&processcode={2}&processinstanceid={3}", user_code, gr_code, processcode, processinstanceid);
    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    sWindowName = "winAction"; oVar.sSize = 'resize';
    //doButtonPostProcess(oVar);
}

doButtonCase['btGongRamList'] = function (oBtn, oVar) {//공람자 확인

    var processCode = CFN_GetQueryString("processCode");
    var processInstanceId = getInfo("piid");
    var strURL = String.format("/Approval/ApvProcess/GongRamListBasic_PopUp.aspx?Type=popup&processCode={0}&processInstanceId={1}", processCode, processInstanceId);
    var Title = Common.GetDic("lbl_apv_setschema_scReview");
    Common.Show("GongRamList", "1", Title, strURL, "500px", "560px", "iframe");
    return false;
}

doButtonCase['btCompleteReDraftList'] = function (oBtn, oVar) {// 

}
//협조접수처확인 2017.05.18. 양유빈
doButtonCase['btnReceiptStatus'] = function (oBtn, oVar) {

    var pdef = getInfo("pdef");
    var process_instance_id = getInfo("PROCESS_INSTANCE_ID");
    var Subject = escape(escape(getInfo("SUBJECT")).replace(/\+/g, "%2B"));
    var strURL = String.format("/Approval/Forms/Templates/popup/ReceiptStatus_Popup.aspx?pdef={0}&process_instance_id={1}&Subject={2}", pdef, process_instance_id, Subject);
    if (getInfo("loct") == "ARCHIVE") strURL = String.format("/Approval/Forms/Templates/popup/ReceiptStatus_Popup_Archive.aspx?pdef={0}&process_instance_id={1}&Subject={2}&FORM_INST_ID={3}", pdef, process_instance_id, Subject, getInfo("FORM_INST_ID"));
    var Title = Common.GetDic("btn_ReceiptStatus");//계정검색
    Common.Show("WorkingBudget", "1", Title, strURL, "800px", "560px", "iframe");
    return false;
}
//협조처 추가삭제 2017.06.21 양유빈
doButtonCase['btnReceiptAddDel'] = function (oBtn, oVar) {
    var pdef = getInfo("pdef");
    var approvalOrder = getInfo("approvalOrder");
    var process_instance_id = getInfo("PROCESS_INSTANCE_ID");
    var fmpf = getInfo("fmpf");
    var approverAt = getInfo("currentApproverAt") // 협조결재완료여부

    var strURL = String.format("/Approval/Forms/Templates/popup/ReceiptStatusAddDel_Popup.aspx?pdef={0}&process_instance_id={1}&approvalorder={2}&formPrefix={3}&approverAt={4}", pdef, process_instance_id, approvalOrder, fmpf, approverAt);
    var Title = Common.GetDic("btn_ReceiptAddDel");

    if (getInfo("editmode") == "M" || getInfo("editmode") == "Y") {
        if (getInfo("loct") == "APPROVAL" && getInfo("mode") == "APPROVAL")
            strURL += "&bCallBack=true";
        else if (getInfo("loct") == "JOBFUNCTION" && getInfo("mode") == "APPROVAL")
            strURL += "&bCallBack=true";
    }
    //parent.Common.Show("WorkingBudget", "ReceiptStatusAddDel", Title, strURL, "500px", "600px", "iframe-ifNoScroll");
    Common.ShowDialog("WorkingBudget", "ReceiptStatusAddDel", Title, strURL, "600px", "600px", "iframe-ifNoScroll");    // 레이블 수정 필요.
    //parent.Common.ShowDialog("WorkingBudget", "ReceiptStatusAddDel", Title, strURL + "&openID=" + CFN_GetQueryString("CFN_OpenLayerName"), "500px", "600px", "iframe-ifNoScroll");    // 레이블 수정 필요.
    return false;
}


doButtonCase['btIncreaseCooperation'] = function (oBtn, oVar) {//협조기한 연장
    var sWidth = 300;
    var sHeight = 250;
    var strURL = "/Approval/Forms/Templates/popup/Increase_Consult_Popup.aspx?processinstanceid=" + getInfo("piid") + "&parentprocessinstanceid=" + getInfo("piid_parent") + "&processcode=" + getInfo("fmpf"); //의견추가 
    if (g_IS_TabUI == "Y") { strURL = strURL + "&IS_Tab=Y"; }
    sWindowName = "winAction"; //oVar.sSize = 'resize';
    var nLeft = (screen.width - sWidth) / 4;
    var nTop = (screen.height - sHeight) / 4;
    var sWidth = sWidth.toString() + "px";
    var sHeight = sHeight.toString() + "px";
    parent.Common.ShowDialog("Increase_Consult_Popup", "Increase_Consult_Popup", Common.GetDic("btn_apv_IncreaseCooperation"), strURL + "&openID=" + CFN_GetQueryString("CFN_OpenWindowName"), sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
}
doButtonCase['btSetProtectInfo'] = function (oBtn, oVar) {//정보보호 설정
    //alert("개발중");
    Common.Confirm(Common.GetDic("msg_SetProtectInfo"), "Confirmation Dialog", function (result) {
        if (result) {
            requestProcess("SETPROTECT");
        }
        else {
            return;
        }
    });
}
doButtonCase['btResetProtectInfo'] = function (oBtn, oVar) {//정보보호 해제
    //alert("개발중");
    Common.Confirm(Common.GetDic("msg_ResetProtectInfo"), "Confirmation Dialog", function (result) {
        if (result) {
            requestProcess("RESETPROTECT");
        }
        else {
            return;
        }
    });
}

doButtonCase['btWorkFormRevision'] = function (oBtn, oVar) {//정보보호 해제

    RevisionTempSave();
    // alert(getInfo("fiid"));
    // setInfo("fiid", fiid);
    //  alert(getInfo("fiid"));
}

doButtonCase['btShare'] = function (oBtn, oVar) {//회람
    //alert("회람");
    try {
        var pSubject = getInfo("SUBJECT").replace(/'/gi, "$%$");
        var pDocPath = location.href.replace('?', '!@!').replace(/&/gi, "@#@").replace(/=/gi, "#$#");
        pDocPath += "&openPage=REFERENCE_PERSON".replace(/&/gi, "@#@").replace(/=/gi, "#$#");
        var szURL = Common.GetPgModule("Approval.WebService");

        // 20171017 hpark
        var pApvId = getInfo("piid");
        var pCreatorId = getInfo("usid");
        //var pCreated = getInfo("FULL_INITIATED_DATE");
        //CFN_CallAjaxJson(szURL + "/SendCircular", "{pSubject : '" + pSubject + "', pDocPath : '" + pDocPath + "'}", true, function (data) {
        CFN_CallAjaxJson(szURL + "/SendCircular", "{pSubject : '" + pSubject + "', pDocPath : '" + pDocPath + "', pApvId : '" + pApvId + "', pCreatorId : '" + pCreatorId + "'}", true, function (data) {

            //receiveHTTP(data);
            var vReturnData = data.d.replace(/"/gi, '\"');

            vReturnData = eval("(" + vReturnData + ")");

            // 20171017 hpark
            //Common.Inform(vReturnData.statusMessage);

            var vReturnData = $.parseJSON(vReturnData);

            var msg = "";
            if (vReturnData.ResultCode == 1000) {
                msg = Common.GetDic("msg_teamloom_move_complete");
            } else {
                msg = vReturnData.ResultMessage;
            }
            Common.Inform(msg);

        });
    } catch (e) {
        Common.Error(e.message);
    }
}

//기각사유버튼
doButtonCase['btn_PaymentLine'] = function (oBtn, oVar) {//현황판
    var sUrl = "/Approval/ApvInfo/PaymentLine.aspx?";

    sUrl += "mode=" + getInfo("mode");
    sUrl += "&processInstanceId=" + getInfo("piid");
    sUrl += "&parentProcessInstanceId=" + getInfo("piid_parent");
    sUrl += "&processCode=" + getInfo("pdef");
    sUrl += "&documentStateCode=" + CFN_GetQueryString("documentStateCode");
    sUrl += "&documentViewStateCode=" + getInfo("documentViewStateCode");
    sUrl += "&approvalOrder=" + getInfo("approvalOrder");
    sUrl += "&documentCode=" + getInfo("fmpf");

    oVar.iHeight = 600; oVar.iWidth = 900; oVar.sUrl = sUrl;
}

doButtonCase['spanFocusFile'] = function (oBtn, oVar) {//양식내부 파일첨부있음 클릭
    var topHeight = document.getElementById("DivFileAttachCtrl").offsetTop - 70;
    $("html, body").animate({ scrollTop: topHeight }, 500);
    return;
}

doButtonCase['spanFocusDocAttach'] = function (oBtn, oVar) {//양식내부 문서첨부있음 클릭
    var topHeight = document.getElementById("tbLinkInfo").offsetTop - 70;
    $("html, body").animate({ scrollTop: topHeight }, 500);
    return;
}

//결재선 조회(파워텍 구문서) 2018.03.21
doButtonCase['btArchiveBoxApvLine'] = function (oBtn, oVar) {
    var Subject = escape(escape(getInfo("SUBJECT")).replace(/\+/g, "%2B"));
    var strURL = String.format("/Approval/Forms/Templates/popup/ArchiveApvLine_Popup.aspx?Subject={0}", Subject);
    var Title = Common.GetDic("btn_Archive_ApvLine_Search"); //결재선 조회
    Common.Show("ArchiveApvLine", "1", Title, strURL, "800px", "460px", "iframe");
    return false;
}


doButtonCase['btPostApproved'] = function (oBtn, oVar) {//승인
    m_sReqMode = "POST_APPROVE";
    document.getElementById("ACTIONINDEX").value = "post_approve";
    oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
    oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
    if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
}

var _g_isconfirm_preapprove = false; // 예결함에서 선결 confirm 추가
doButtonCase['btPrecdngApproval'] = function (oBtn, oVar) {//예결함에서 선결재 // 20200610 hpark 예결함에서 선결

	if (!_g_isconfirm_preapprove) { // 예결함에서 선결 confirm 추가
		Common.Confirm(Common.GetDic("msg_confirm_PrecdngApproval"), "Confirmation Dialog", function (result) { 
			if (result) {
				_g_isconfirm_preapprove = true;
				$("#btPrecdngApproval").trigger("click");
				return;
			}
		});
	} else {
		m_sReqMode = "PREAPPROVE"; //"APPROVE";

		// 양식 공통 Read모드에서 Validation - checkFormForRead (필요한 양식에 정의해서 사용)
		if (getInfo("templatemode") == "Read") {
			if (typeof checkFormForRead == "function" || typeof checkFormForRead == "object") {
				if (!checkFormForRead()) return false;
			}
		}
		// 프로세스 설정 읽기모드에서 checkform 체크
		if (getInfo("scCheckApproval") == "1") {
			if (!checkForm((m_sReqMode == "TEMPSAVE" ? true : false))) return false;
		}

		_transferCooperationInfo = "";
		_sCONSULT_LIST = "";

		document.getElementById("ACTIONINDEX").value = "preapprove"; //"approve";
		oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 450; 
		oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx";
		if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }

		_g_isconfirm_preapprove = false;
	}

	
}

doButtonCase['btLinePreapproval'] = function (oBtn, oVar) {//승인

	setInfo("scInformationAppV", "100");
	setInfo("scInformationApp_ref_person", "0"); // 20200427 hpark 참조자 추가
	setInfo("scInformationApp_coop_only", "0"); // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
    oVar.sUrl = "/Approval/ApvlineMgr/ApvlineMgr.aspx?AllCompany=Y&Group=Y&Type=D9";
    oVar.sUrl = oVar.sUrl + "&ApvType=" + getInfo('selscSaganApproval');
    oVar.sUrl = oVar.sUrl + "&CallPage=PREAPPROVAL";

    if (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "INVEST_PATTERN" || getInfo("pdef") == "ABROAD_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") {
        if (Common.GetBaseConfig("ConsultListCountLimit") != "") {
            oVar.sUrl = oVar.sUrl + "&LimitCooperCount=" + Common.GetBaseConfig("ConsultListCountLimit");
        }
    }
    if (g_IS_TabUI == "Y")
        oVar.IS_Tab = "Y";
}

doButtonCase['btMeetApproval'] = function (oBtn, oVar) {//대면결재
    if (!FormAttachProcess("btApproved")) {
        return false;
    }
    m_sReqMode = "APPROVE";
    if (evaluateForm()) {
        document.getElementById("ACTIONINDEX").value = "meetapprove";
        oVar.iWidth = 700;//첨부파일 없을 경우 oVar.iHeight = 400; 
        oVar.sSize = 'resize'; oVar.sUrl = "/Approval/ApvProcess/ApvActBasic_Send.aspx?type=MEETAPPROVAL";
        if (g_IS_TabUI == "Y") { oVar.IS_Tab = "Y"; }
    }
}

function fn_PublicObjectType() {//공시여부

    var iHeight = 700; iWidth = 800;
    var sUrl = "/Approval/Forms/Templates/popup/PublicObject_Popup.aspx";

    if (g_IS_TabUI == "Y") {
        sUrl = sUrl + "?IS_Tab=Y";
    }

    if (openMode == "L" || openMode == "P" || openMode == "B") {
        var nLeft = (screen.width - iWidth) / 2;
        var nTop = (screen.height - iHeight) / 2;
        var sWidth = iWidth.toString() + "px";
        var sHeight = iHeight.toString() + "px";
        if (sUrl.indexOf('\?') > -1) {
            parent.Common.ShowDialog("", "DivPop_" + openID, Common.GetDic("lbl_public_object_check"), sUrl + "&openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
        }
        else {
            parent.Common.ShowDialog("", "DivPop_" + openID, Common.GetDic("lbl_public_object_check"), sUrl + "?openID=" + openID, sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
        }
    }
}

function PopNewWindowForm() {//새창으로 열기
    var UserCheck = true;
    var vwidth = window.screen.width;
    var width = vwidth + "px";
    var vheight = (window.screen.height - 82);
    var height = (window.screen.height - 220) + "px";
    var sx = window.screen.width / 2 - vwidth / 2;
    //var strURL = document.location.href + "&IS_NewWindow=Y"
    var strURL = document.location.href.replace("&IS_TabUI=Y", "");
    var currentTabID;
    //가로양식
    if (IsWideOpenFormCheck(getInfo("fmpf"))) {
        vwidth = 1070;
    }
    //parent.CFN_OpenWindow(strURL, "FORMS_" + getInfo("fiid"), vwidth, vheight, "both");
    //currentTabID = parent.document.getElementById("hidMasterCurrentTab").value;
    //parent.Master_TabClose_OnClick(currentTabID);
    if (getInfo("templatemode") == "Write") {
        Common.Confirm(Common.GetDic("msg_apv_resetform"), Common.GetDic("lbl_InformTitle"), function (result) {
            if (result) {
                //TO-DO : 현대건설 사특화 통합결재 및 레거시 양식 닫을때 안내메세지 표시여부
                //2020-08-07 BY YJYOO
                if (getInfo("fmpf").indexOf("FORM_UNIFIED") > -1 && typeof isShowCloseMessage != "undefined") {
                    isShowCloseMessage = false;
                }
                parent.CFN_OpenWindow(strURL, "FORMS_" + getInfo("fiid"), vwidth, vheight, "both");
                currentTabID = parent.document.getElementById("hidMasterCurrentTab").value;
                parent.Master_TabClose_OnClick_ByFunction(currentTabID);
            }
        });
    }
    else {
        parent.CFN_OpenWindow(strURL, "FORMS_" + getInfo("fiid"), vwidth, vheight, "both");
        currentTabID = parent.document.getElementById("hidMasterCurrentTab").value;
        parent.Master_TabClose_OnClick(currentTabID);
    }
}
/*-----------------------------------------------------------
 분기 함수 <끝> : KJW : 2014.04.23 : XFORM PRJ.
-------------------------------------------------------------*/

//TO-DO : 신세계 Customizing 담당자와 톡하기
//2016-07-27 BY YJYOO
function ChargeTalk(key) {
    if (typeof opener.createChat != 'undefined') {
        opener.createChat(key);
    }
}

function Open_Forward(sMode) {
    var sCallType = "B1"; //B1:사용자 선택(3열-1명만),C1:그룹 선택(3열-1개만)
    var sTarget = "U"; //U:사용자,D:부서
    switch (sMode) {
        case "charge": sCallType = "B1"; break;
        case "chargegroup": sCallType = "C1"; sTarget = "D"; break;
        case "ChangeReview": sCallType = "B1"; break;

        default: break;
    }
    //신세계 Layer 수정 적용
    //2016-06-08
    //YJYOO
    //XFN_OrgMapShow_WindowOpen("btn_PAdtForm", "DivLayerForm", "txtItem", "div_setwfschema", "OrgMap_CallBack_Form", sCallType, "Y", "Y", sTarget, "Approval", "", "");
    if (openMode == "L") {
        parent.XFN_OrgMapShow("btn_PAdtForm", "DivLayerForm", "txtItem", openID, "OrgMap_CallBack_Form", sCallType, "Y", "Y", sTarget, "Approval", "", "");
    } else {
        XFN_OrgMapShow_WindowOpen("btn_PAdtForm", "DivLayerForm", "txtItem", "div_setwfschema", "OrgMap_CallBack_Form", sCallType, "Y", "Y", sTarget, "Approval", "", "");
    }
}
/*
    CoviWindow(fileName,windowName,theWidth,theHeight,etcParam)
    moved to form.refactor.deleted.js
    by KJW : 2014.04.22 :  : XFORM PRJ.
*/

//결재선변경
function changeApvList() {
    try {
        requestProcess("CHANGEAPV");
    } catch (e) {
        alert("Error number: " + e.number);
    }
}
//강제합의
function forcedConsent() {
    try {
        requestProcess("FORCEDCONSENT");
    } catch (e) {
        alert("Error number: " + e.number);
    }
}
function changeFormdata(msg) {
    //첨부파일 처리
    if (!FormAttachProcess(function () { changeFormdata(msg); }))
        return;
    XFN_FileSave();
    fnFormAttachUpload();

    //TO-DO : 예약 결재시 참조처 정보 셋팅
    if ($("#BOOKING_APPROVAL_YN").val() == "Y" && (getInfo("editmode") == "Y" || getInfo("editmode") == "M")) {
        setBookingApprovalReferenceList();
    }

    var sFormXml = getChangeFormXML();
    var sXML = "";

    //admin과 일반 사용자 구분, 양유빈, 2017.04.19
    if (admintype == "ADMIN") {
        sXML = "<request>" + getEnableProcessStep("1:1:1:0:0") + "<admintype>ADMIN</admintype>" + getDefaultXML() + sFormXml + "<type>MODIFY</type>" + makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) + "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata></request>";//(양식정보 저장 실행:첨부파일 저장 실행:BPM프로세스 실행:연동 실행여부:알람발송 실행) // 20171219 hpark 편집>저장시 참조처 중복추가되는현상 : referenceDisplayInfoBPMInfo 추가함
    }
    else {
        sXML = "<request>" + getEnableProcessStep("1:1:1:0:0") + "<admintype></admintype>" + getDefaultXML() + sFormXml + "<type>MODIFY</type>" + makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) + "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata></request>"; // 20171219 hpark 편집>저장시 참조처 중복추가되는현상 : referenceDisplayInfoBPMInfo 추가함
    }

    var msgVal = Common.GetDic("msg_37");
    if (typeof msg != "undefined") {
        msgVal = msg;
    }
    try {
        CFN_CallAjax("submitForm.aspx", sXML, function (data) {

            Common.Inform(msgVal, Common.GetDic("lbl_Alram"), function (result) {
                var submitForm = document.createElement("FORM");
                document.body.appendChild(submitForm);
                submitForm.method = "POST";
                submitForm.name = "DocModify";
                var newElement = document.createElement("TEXTAREA");
                submitForm.appendChild(newElement);
                newElement.id = 'DocModifyApvLine';
                newElement.name = 'DocModifyApvLine';
                //	 newElement.value = document.getElementsByName("APVLIST")[0].value;
                newElement.style.display = "none";
                newElement.value = encodeURIComponent(document.getElementById("APVLIST").value);
                submitForm.target = "_self";
                submitForm.action = window.location.href.replace("#", "").replace("&editMode=Y", "").replace("&editMode=M", "") + "&editMode=N";
                submitForm.submit();
            });
        }, true, "xml");
    } catch (e) {
        Common.Error(e.message);
    }
}



function changeApvdata(msg) {
    var sFormXml = getChangeFormXML();
    var sXML = "";

    sXML = "<request>" + getEnableProcessStep("1:1:1:0:0") + "<admintype></admintype>" + getDefaultXML() + sFormXml + "<type>MODIFYAPV</type>" + makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) + "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata></request>"; // 20171219 hpark 편집>저장시 참조처 중복추가되는현상 : referenceDisplayInfoBPMInfo 추가함


    var msgVal = Common.GetDic("msg_37");
    if (typeof msg != "undefined") {
        msgVal = msg;
    }
    try {
        ToggleLoadingImage();
        CFN_CallAjax("submitForm.aspx", sXML, function (data) {
            receiveProcessHTTP(data);
            //Common.Inform(msgVal, Common.GetDic("lbl_Alram"), function (result) {
            //    var submitForm = document.createElement("FORM");
            //    document.body.appendChild(submitForm);
            //    submitForm.method = "POST";
            //    submitForm.name = "DocModify";
            //    var newElement = document.createElement("TEXTAREA");
            //    submitForm.appendChild(newElement);
            //    newElement.id = 'DocModifyApvLine';
            //    newElement.name = 'DocModifyApvLine';
            //    //	 newElement.value = document.getElementsByName("APVLIST")[0].value;
            //    newElement.style.display = "none";
            //    newElement.value = encodeURIComponent(document.getElementById("APVLIST").value);
            //    submitForm.target = "_self";
            //    submitForm.action = window.location.href.replace("#", "").replace("&editMode=Y", "").replace("&editMode=M", "") + "&editMode=N";
            //    submitForm.submit();
            //});
        }, true, "xml");
    } catch (e) {
        Common.Error(e.message);
    }
}

function changeFormdata_CUSTOMERSAT(msg) {
    var sFormXml = getChangeFormXML();
    //admin과 일반 사용자 구분, 양유빈, 2017.04.19

    var sXML = "<request>" + getEnableProcessStep("1:0:0:0:0") + "<admintype></admintype>" + getDefaultXML() + sFormXml + "<type>MODIFY</type>" + makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) + "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata></request>";//(양식정보 저장 실행:첨부파일 저장 실행:BPM프로세스 실행:연동 실행여부:알람발송 실행) // 20171219 hpark 편집>저장시 참조처 중복추가되는현상 : referenceDisplayInfoBPMInfo 추가함
    var msgVal = Common.GetDic("msg_37");
    if (typeof msg != "undefined") {
        msgVal = msg;
    }
    try {
        CFN_CallAjax("submitForm.aspx", sXML, function (data) {

            Common.Inform(msgVal, Common.GetDic("lbl_Alram"), function (result) {
                var submitForm = document.createElement("FORM");
                document.body.appendChild(submitForm);
                submitForm.method = "POST";
                submitForm.name = "DocModify";
                var newElement = document.createElement("TEXTAREA");
                submitForm.appendChild(newElement);
                newElement.id = 'DocModifyApvLine';
                newElement.name = 'DocModifyApvLine';
                newElement.value = encodeURIComponent(document.getElementById("APVLIST").value);
                newElement.style.display = 'none';
                submitForm.target = "_self";
                submitForm.action = window.location.href.replace("#", "").replace("&editMode=N", "").replace("&reuse=", "") + "&editMode=Y&reuse=";
                submitForm.submit();
            });
        }, true, "xml");
    } catch (e) {
        Common.Error(e.message);
    }
}

function makeNode(sName, vVal, sKey, bCData) {
    var oNode = m_cvtXML.createElement("cvtnode");
    if (vVal == null) { $(oNode).text(getInfo((sKey != null ? sKey : sName))) } else { $(oNode).text(vVal); }
    //return "<" + sName + ">" + (bCData ? "<![CDATA[" : "") + (bCData ? $(oNode).text() + "]]>" : (new XMLSerializer()).serializeToString(oNode).replace("<cvtnode>","").replace("</cvtnode>","").replace("<cvtnode />","")) + "</" + sName + ">";
    return "<" + sName + ">" + (bCData ? "<![CDATA[" : "") + (bCData ? $(oNode).text() + "]]>" : CFN_XmlToString(oNode).replace("<cvtnode>", "").replace("</cvtnode>", "").replace("<cvtnode />", "").replace("<cvtnode/>", "")) + "</" + sName + ">";
}

function addList(sMode) {
    var sCallType = "B1";
    switch (sMode) {
        case "charge": sCallType = "B1"; break;
        case "chargegroup": sCallType = "C1"; break;
        default: sCallType = "C1"; break;
    }

    //신세계 Layer 수정 적용
    //2016-06-08
    //YJYOO
    //공통 조직도로 변경 XFN_OrgMapShowApproval(PORTAL) => XFN_OrgMapShow(APPROVAL)
    //XFN_OrgMapShow_WindowOpen("btn_PAdtForm", "DivLayerForm", "txtItem", "div_setwfschema", "OrgMap_CallBack_Form", sCallType, "Y", "Y", "U", "Approval", "", "");
    if (openID != "") {
        parent.XFN_OrgMapShow("btn_PAdtForm", "DivLayerForm", "txtItem", openID, "OrgMap_CallBack_Form", sCallType, "Y", "Y", "U", "Approval", "", "");
    } else {
        XFN_OrgMapShow_WindowOpen("btn_PAdtForm", "DivLayerForm", "txtItem", "div_setwfschema", "OrgMap_CallBack_Form", sCallType, "Y", "Y", "U", "Approval", "", "");
    }
}

function OrgMap_CallBack_Form(pStrItemInfo) {
    var oXML = $.parseXML(pStrItemInfo);
    insertToList(oXML);
}

function insertToList(oList) {
    if (m_sAddList == 'receive') {
        //var aRecDept = document.getElementById("RecDeptList").value.split("@");
        //aRecDept[document.getElementById("iBody").selectedIndex] = CFN_XmlToString(oList); //(new XMLSerializer()).serializeToString(oList);
        //var sRecDept = "";
        //for (var i = 0; i < aRecDept.length; i++) { sRecDept += '@' + aRecDept[i]; }
        //if (sRecDept.length > 1) sRecDept = sRecDept.substring(1);
        //document.getElementById("RecDeptList").value = sRecDept;
        //document.getElementById("RECEIVE_NAMES").value = document.getElementById("RecDeptList").value;
        //var m_oRecList = $.parseXML(aRecDept[document.getElementById("iBody").selectedIndex]);
        //setInlineRecList(m_oRecList);

        //document.getElementById("RECEIPT_LIST").value = m_oFormEditor.DeCodeRecList(document.getElementById("RecDeptList").value);
        m_bFrmExtDirty = true;
    } else if (m_sAddList == 'charge' || m_sAddList == 'chargegroup') {
        var m_oChargeList = oList;
        var elmRoot = $(m_oChargeList).find("items");
        var elmlist = $(elmRoot).find("item");
        if (elmlist.length == 0) {
            alert(gMessage54); //'담당자를 지정하십시요.'
            return false;
        } else if (elmlist.length > 1) {
            alert(gMessage55); //"담당업무는 1개만 지정 가능 합니다. \n담당업무를 다시 지정해 주십시요."
            return false;
        } else {
            try { document.getElementById("CHARGEID").value = $(elmRoot).find("item > AN").text(); } catch (e) { }
            try { document.getElementById("CHARGENAME").value = $(elmRoot).find("item > DN").text(); } catch (e) { }
            try { document.getElementById("CHARGEOUID").value = $(elmRoot).find("item > RG").text(); } catch (e) { }

            setForwardApvList(elmRoot);

            var confirmMessage = XFN_GetDicInfo(document.getElementById("CHARGENAME").value) + " " + Common.GetDic("msg_apv_ChargeConfirm"); // " 담당자로 지정 하시겠습니까?"; //
            Common.Confirm(confirmMessage, "Confirmation Dialog", function (result) {
                if (result) {
                    requestProcess('CHARGE');
                }
            });
        }
    } else if (m_sAddList == 'ChangeReview') {
        var elmRoot = $(oList).find("items");
        var elmlist = $(elmRoot).find("item");
        if (elmlist.length == 0) {
            alert(Common.GetDic("msg_apv_changereview_01")); //'선택한 사람이 없습니다.'
            return false;
        } else {
            try { document.getElementById("CHANGEREVIEWXML").value = CFN_XmlToString(elmRoot[0]) } catch (e) { }

            setForwardApvList(elmRoot);

            var confirmMessage = Common.GetDic("msg_apv_changereview_02"); // "원 결재자를 후결로 추가 하시겠습니까?"; //
            Common.Confirm(confirmMessage, "Confirmation Dialog", function (result) {
                m_bTempFlag = result;
                requestProcess('CHANGEREVIEW');
            });
        }
    } else if (m_sAddList == 'request' || m_sAddList == 'study') {
        var m_oRequestList = oList;
        var elmRoot = $(m_oRequestList).find("items");
        var elmlist = $(elmRoot).find("item");
        if (elmlist.length == 0) {
            alert(gMessage54); //'담당자를 지정하십시요.'
            return false;
        } else if (elmlist.length > 1) {
            alert(gMessage55); //"담당업무는 1개만 지정 가능 합니다. \n담당업무를 다시 지정해 주십시요."
            return false;
        } else { setRequestPersonInfo(elmRoot, false, m_sAddList); }
    }
}

function setFormInfoDictionary(elmList) {
    var elmnode;
    for (var i = 0; i < elmList.length; i++) {
        elmnode = elmList.nextNode();
        setInfo(elmnode.nodeName, elmnode.text);
    }
}
function getIsIssueDocNo() {
    var sRtn = "";
    switch (getInfo("mode")) {
        case 'PCONSULT':
            if ((document.getElementById("bLASTAPPROVER").value == 'true') && (getInfo("scDNumLegacy") == '1')) sRtn = "true";
            break;
        case 'APPROVAL':
            if ((document.getElementById("bLASTAPPROVER").value == 'true') && (document.getElementById("ACTIONINDEX").value == 'approve') && (getInfo("scDNumLegacy") == '1')) sRtn = "true";
            break;
        case 'RECAPPROVAL':
            if ((getInfo("scIPub") == "0") && (document.getElementById("bLASTAPPROVER").value == 'true') && (document.getElementById("ACTIONINDEX").value == 'approve') && (getInfo("scDNumLegacy") == '1')) sRtn = "true";
            break;
        case 'SUBAPPROVAL':
            if ((document.getElementById("bLASTAPPROVER").value == 'true') && (getInfo("scDNumLegacy") == '1')) sRtn = "true";
            break;
        case 'REDRAFT':	//1. 부서장 접수 후 수신대장에도 보관, 신청서-담당업무확정에 대해서는 수신대장 보관하지 않음			
            if ((getInfo("scIPub") == "0") && (document.getElementById("bLASTAPPROVER").value == 'true') && (document.getElementById("ACTIONINDEX").value == 'approve') && (getInfo("scDNumLegacy") == '1')) sRtn = "true";
            break;
        case 'SUBREDRAFT': sRtn = getHasReceiveno();
            break;
        default: sRtn = "false";
    }
    return sRtn;
}
function getHasReceiveno() {
    var sRtn = "false";
    //신청서-담당업무확정에 대해서는 수신대장 보관하지 않음
    if (getInfo("scChgr") == "1") { sRtn = "false"; } else { sRtn = "true"; }
    return sRtn;
}
var szformgubun = "";
//현대건설, 현대엔지니어링 레거시 및 통합결재 기본 결재선 사용우무
var tmpIWFLegacy = "";

function setDomainData() {

    if (getInfo("reuse") == "Y" || getInfo("reuse") == "C") {
        //문서재사용일때 별도 분기 탐
        var data = $.parseXML("<?xml version='1.0' encoding='utf-8'?><response><item><id>reservedapvline</id><signlistname>reservedapvline</signlistname><abstract></abstract><dscr></dscr></item></response>");
        receiveApvHTTP(data);
        return;
    }

    if (getInfo("mode") == "DRAFT"
            || getInfo("mode") == "TEMPSAVE"
            || getInfo("mode") == "REDRAFT"
            || (getInfo("loct") == "REDRAFT" && getInfo("mode") == "SUBREDRAFT" && getInfo("scRecAssist") == "1")
        ) {
        var szURL = "setDomainData.aspx?usid=" + getInfo("usid") + "&fmid=" + getInfo("fmid") + "&dppathid=" + getInfo("dppathid") + "&dppathdn=" + escape(getInfo("dppathdn")) + "&pdefid=" + getInfo("pdef");
        szURL = szURL + "&mode=" + getInfo("mode") + "&scChgr=" + getInfo("scChgr") + "&scChgrV=" + getInfo("scChgrV") + "&bsid=" + getInfo("bsid") + "&ftid=" + getInfo("ftid"); // 2006.09.20 김현태 임시저장시 결재선 저장 추가 +"&ftid="+getInfo("ftid")
        szURL = szURL + "&scCDTApvLine=" + getInfo("scCDTApvLine") + "&scCDTApvLineV=" + getInfo("scCDTApvLineV") + "&scRCDTApvLine=" + getInfo("scRCDTApvLine") + "&scRCDTApvLineV=" + getInfo("scRCDTApvLineV") + "&usapprover=" + getInfo("usapprover");
        szURL = szURL + "&dpid=" + getInfo("dpid") + "&scStep=" + getInfo("scStep") + "&scStepV=" + getInfo("scStepV") + "&fmpf=" + getInfo("fmpf");
        //2011.07 구분별 결재선
        szformgubun = getInfo("dppathid").split("\\")[2];
        szURL = szURL + "&scMODEApvLine=" + getInfo("scMODEApvLine") + "&scMODEApvLineV=" + getInfo("scid") + szformgubun;

        var tmpIsMerge0 = "";
        var tmpIsMerge1 = "";
        var tmpIsMerge2 = "";
        var tmpIWFLegacy = "";
        if (formJson != undefined && formJson.BODY_CONTEXT != undefined) {
            tmpIsMerge0 = (formJson.BODY_CONTEXT.m_MergeApvline0 != undefined) ? formJson.BODY_CONTEXT.m_MergeApvline0 : "";
            tmpIsMerge1 = (formJson.BODY_CONTEXT.m_MergeApvline1 != undefined) ? formJson.BODY_CONTEXT.m_MergeApvline1 : "";
            tmpIsMerge2 = (formJson.BODY_CONTEXT.m_MergeApvline2 != undefined) ? formJson.BODY_CONTEXT.m_MergeApvline2 : "";
            tmpIWFLegacy = (formJson.BODY_CONTEXT.m_is_IWF_Legacy != undefined) ? formJson.BODY_CONTEXT.m_is_IWF_Legacy : "";
        }

		//템블릿 저장인 경우
        if (getInfo("USE_BASIC_APPROVAL_LINE") == "Y" && getInfo("reuse") == "P" && tmpIWFLegacy == "") {
            tmpIsMerge0 = "Y";
        }

        szURL = szURL + "&IsMerge0=" + tmpIsMerge0;
        szURL = szURL + "&IsMerge1=" + tmpIsMerge1;
        szURL = szURL + "&IsMerge2=" + tmpIsMerge2;
        szURL = szURL + "&BasicApvLine=" + ((getInfo("USE_BASIC_APPROVAL_LINE") != undefined) ? getInfo("USE_BASIC_APPROVAL_LINE") : "");
        szURL = szURL + "&CurrentDivisionIdx=" + ((getInfo("CurrentDivisionIdx") != undefined) ? getInfo("CurrentDivisionIdx") : "");
        
        CFN_CallAjax(szURL, "", function (data) {
            receiveApvHTTP(data);
        }, false, "xml");
    } else {
        m_bApvDirty = true;
    }
}
function receiveApvHTTP(responseXMLdata) {
    if ($(responseXMLdata) != null) {
        var errorNode = $(responseXMLdata).find("response > error");
        if ($(errorNode).length > 0) {
            alert("Desc: " + errorNode.text());
        } else {
            var elmList = $(responseXMLdata).find("response > item");
            if (getInfo("mode") == 'DRAFT' || getInfo("mode") == "TEMPSAVE" || getInfo("mode") == "REDRAFT" || (getInfo("mode") == "SUBREDRAFT" && getInfo("scRecAssist") == "1")) {
                var oApvList = $.parseXML(document.getElementById("APVLIST").value);
                if (oApvList == null) {
                    alert(gMessage75); //"결재선 지정 오류"
                } else {
                    m_bApvDirty = true;
                    var oGetApvList;

                    var tmpIWFLegacy = "";
                    if (formJson != undefined && formJson.BODY_CONTEXT != undefined) {
                        tmpIWFLegacy = (formJson.BODY_CONTEXT.m_is_IWF_Legacy != undefined) ? formJson.BODY_CONTEXT.m_is_IWF_Legacy : "";
                    }
                    if ($(responseXMLdata).find("response > item > signinform").length > 0) {
                        // 2016.01.06 leesm 결재선 내 & 문자열로 인해 오류 발생으로 수정함
                        //if ($(responseXMLdata).find("response > item > signinform").text().indexOf('&amp;') > -1)
                        //	oGetApvList = $.parseXML($(responseXMLdata).find("response > item > signinform").text());
                        //else
                        //	oGetApvList = $.parseXML($(responseXMLdata).find("response > item > signinform").text().replace(/&/gi, '&amp;'));
                        oGetApvList = $.parseXML($(responseXMLdata).find("response > item > signinform").text().replace(/&(?!amp;)/g, '&amp;'));
                    }
                    var oCurrentOUNode;
                    var oApvListRoot = $(oApvList).find("steps");

                    //인사정보가 맞지 않는 사용자 체크 유무 메세지 유무 확인 필요
                    var isAbsent = false;

                    if (getInfo("mode") == "REDRAFT" && getInfo("USE_BASIC_APPROVAL_LINE") == "Y" && getInfo("pdef") == "REQUEST_PATTERN") { // 신청프로세스 수신부서 이후 결재선 셋팅 // 20200629 hpark 자동결재라인,연동시스템 결재선 병합
                    	var division_idx = getInfo("CurrentDivisionIdx");
                    	division_idx = (division_idx * 1) - 1;
                    	if (division_idx >= 0) {
                    		var nodesAllItems_RA = $(oGetApvList).find("steps > division[divisiontype='receive']").eq(division_idx).find("step");
                    		var oCheckSteps_RA = true;
                    		if (nodesAllItems_RA.length > 0 && $(oApvListRoot).find("steps > division[divisiontype='receive']").eq(division_idx).find("step[routetype!='receive_dept']").length == 0) {
                    			if (!chkAbsent($(oGetApvList).find("steps > division[divisiontype='receive']").eq(division_idx))) oCheckSteps_RA = false;
                    			
                    			if (oCheckSteps_RA) {
                    				$(oGetApvList).find("steps > division[divisiontype='receive']").eq(division_idx).find("step").each(function (i, enodeItem) {
                    					if ($(enodeItem).attr("routetype") != "receive_dept") $(oApvListRoot).find("steps > division[divisiontype='receive']").eq(division_idx).append(enodeItem);
                    				});
                    			}
                    		}
                    	}
                    } else if (getInfo("mode") == "REDRAFT") {
                        //담당부서 - 담당부서 및 담당업무 결재선 삭제할것 그 후로 기안자 결재선 입력할것
                        oCurrentOUNode = $(oApvList).find("steps > division:has(>taskinfo[status='pending'])[divisiontype='receive']");
                        if (oCurrentOUNode == null) {
                            var oDiv = oApvList.createElement("division");
                            var oDivTaskinfo = oApvList.createElement("taskinfo");
                            $(oDiv).append(oDivTaskinfo);
                            $(oApvList).find("steps").append(oDiv);
                            $(oDiv).attr("divisiontype", "receive");
                            $(oDiv).attr("name", gLabel__ChargeDept);
                            $(oDiv).attr("oucode", getInfo("dpid_apv"));
                            $(oDiv).attr("ouname", getInfo("dpdn_apv"));
                            $(oDivTaskinfo).attr("status", "pending");
                            $(oDivTaskinfo).attr("result", "pending");
                            $(oDivTaskinfo).attr("kind", "receive");
                            $(oDivTaskinfo).attr("datereceived", getInfo("svdt"));
                            oCurrentOUNode = $(oApvList).find("steps > division:has(>taskinfo[status='pending'])[divisiontype='receive']");
                        }
                        var oRecOUNode = $(oCurrentOUNode).find("step:has(ou >taskinfo[status='pending'])");
                        if (oRecOUNode.length != 0) oCurrentOUNode[0].removeChild(oRecOUNode[0]);
                        var oChargeNode = $(oCurrentOUNode).find("step:has(ou > person > taskinfo[status='pending'])");

                        //[2015-04-28 kh] 담당 수신자 대결
                        var isChkDeputy = false;

                        if (oChargeNode.length != 0) {
                            //[2015-04-28 kh] 담당 수신자 대결 S ----------------------------------------
                            var objDeputyOU = $(oApvList).find("steps > division[divisiontype='receive'] > step > ou");
                            var chkObjNode = $(objDeputyOU).find("person[code='" + getInfo("ptid") + "'][code!='" + getInfo("usid") + "' ] > taskinfo[status='pending'], role:has(person[code='" + getInfo("ptid") + "'][code!='" + getInfo("usid") + "'])");

                            if (0 < chkObjNode.length) {
                                isChkDeputy = true;
                            }
                            //[2015-04-28 kh] 담당 수신자 대결 E -----------------------------------------

                            var oRecApprovalNode = $(oCurrentOUNode).find("step > ou > person > taskinfo[status='inactive']");
                            if (oRecApprovalNode.length != 0) {
                                $(oRecApprovalNode).each(function (i, RecApprovalNode) {
                                    oCurrentOUNode[0].removeChild(RecApprovalNode.parentNode.parentNode.parentNode);
                                });
                            }

                            //person의 takinfo가 inactive가 있는 경우 routetype을 변경함
                            var nodesInactives = $(oCurrentOUNode).find("step:has(ou > person > taskinfo[status='inactive'])[routetype='receive']");

                            $(nodesInactives).each(function (i, nodesInactive) {
                                $(nodesInactive).attr("unittype", "person");
                                $(nodesInactive).attr("routetype", "approve");
                                $(nodesInactive).attr("name", gLabel__ChargeDept);
                            });

                            oCurrentOUNode[0].removeChild(oChargeNode[0]);
                        }
                        var oJFNode = $(oCurrentOUNode).find("step:has(ou > role > taskinfo[status='pending']),step:has(ou > role > taskinfo[status='reserved'])"); //201108
                        var bHold = false; //201108 보류여부
                        var oComment = null;
                        if (oJFNode.length != 0) {
                            var oHoldTaskinfo = $(oJFNode).find("ou > role > taskinfo[status='reserved']");
                            if (oHoldTaskinfo.length != 0) {
                                bHold = true;
                                oComment = $(oHoldTaskinfo).find("comment").clone();
                            }
                            oCurrentOUNode[0].removeChild(oJFNode[0]);
                        }

                        $(oCurrentOUNode).attr("oucode", getInfo("dpid_apv"));
                        $(oCurrentOUNode).attr("ouname", getInfo("dpdn_apv"));
                        var oDivTaskinfo = $(oCurrentOUNode).find("taskinfo");
                        $(oDivTaskinfo).attr("status", "pending");
                        $(oDivTaskinfo).attr("result", "pending");

                        var oStep = oApvList.createElement("step");
                        var oOU = oApvList.createElement("ou");
                        var oPerson = oApvList.createElement("person");
                        var oTaskinfo = oApvList.createElement("taskinfo");

                        $(oStep).attr("unittype", "person");
                        $(oStep).attr("routetype", "approve");
                        $(oStep).attr("name", gLabel__ChargeDept);
                        $(oOU).attr("code", getInfo("dpid_apv"));
                        $(oOU).attr("name", getInfo("dpdn_apv"));
                        $(oCurrentOUNode).append(oStep);
                        $(oStep).append(oOU);
                        $(oOU).append(oPerson);
                        $(oPerson).append(oTaskinfo)

                        $(oPerson).attr("code", getInfo("usid"));
                        $(oPerson).attr("name", getInfo("usdn"));
                        $(oPerson).attr("position", getInfo("uspc") + ";" + getInfo("uspn"));
                        $(oPerson).attr("title", getInfo("ustc") + ";" + getInfo("ustn"));
                        $(oPerson).attr("level", getInfo("uslc") + ";" + getInfo("usln"));
                        $(oPerson).attr("oucode", getInfo("dpid"));
                        $(oPerson).attr("ouname", getInfo("dpdn"));
                        $(oPerson).attr("sipaddress", getInfo("ussip"));
                        $(oTaskinfo).attr("status", (bHold == true ? "reserved" : "pending")); //201108
                        $(oTaskinfo).attr("result", (bHold == true ? "reserved" : "pending")); //201108
                        $(oTaskinfo).attr("kind", "charge");
                        $(oTaskinfo).attr("datereceived", getInfo("svdt"));
                        if (bHold) $(oTaskinfo).append(oComment); //201108

                        elmList = $(oCurrentOUNode).find("step"); //reverse
                        jQuery.fn.reverse = [].reverse;
                        $(elmList).reverse().each(function (i, elmStep) {//foreach거꾸로하기
                            if ($(elmStep).find("ou> person > taskinfo").attr("kind") == "charge") {
                                var currNode3 = oCurrentOUNode[0].insertBefore(elmStep, elmList[elmList.length - 1 - i]);
                            }
                        });

                        //[2015-04-28 kh] 담당 수신자 대결 S ---------------------------------------------
                        if (isChkDeputy) {

                            // [2015-05-28 modi] 현재 대결인 division에만 추가하도록
                            //objDeputyOU = $(oApvList).find("steps > division[divisiontype='receive'] > step > ou");
                            objDeputyOU = $(oApvList).find("steps > division:has(>taskinfo[status='pending']) > step > ou");

                            var objOriginalApprover = $(oChargeNode[0]).find('ou > person');
                            $(objOriginalApprover).attr('title', $(objOriginalApprover).attr('title').replace(/&/g, ';'));
                            $(objOriginalApprover).attr('level', $(objOriginalApprover).attr('level').replace(/&/g, ';'));
                            $(objOriginalApprover).attr('position', $(objOriginalApprover).attr('position').replace(/&/g, ';'));

                            $(objOriginalApprover).find('taskinfo').removeAttr('datereceived');
                            $(objOriginalApprover).find('taskinfo').attr('kind', 'bypass');
                            $(objOriginalApprover).find('taskinfo').attr('result', 'inactive');
                            $(objOriginalApprover).find('taskinfo').attr('status', 'inactive');

                            $(objDeputyOU).append($(objOriginalApprover));
                        }
                        //[2015-04-28 kh] 담당 수신자 대결 E ----------------------------------------------

                        //2006.04.25 by wolf 퇴직자 및 인사정보 최신 적용을 위해 추가 예외사항생기더라도 기안/재기안자 결재선 디스플레이
                        document.getElementById("APVLIST").value = CFN_XmlToString(oApvList);

                        var nodesAllItems;
                        nodesAllItems = $(oGetApvList).find("steps > division:has(>taskinfo[status='pending'])[divisiontype='receive'] > step");

                        //2006.04.25 by wolf 퇴직자 체크 및 인사정보 체크
                        if ((getInfo("mode") == "REDRAFT") && getInfo("scPRecA") == "1" && getInfo("scPRecAV") != "" && getInfo("templatemode") == "Read") {//재기안시 수신결재자 자동 지정
                            var sChgrPersonXml = getInfo("scPRecAV");
                            var oCharPerson = $.parseXML(sChgrPersonXml);

                            var oStepR;
                            var oOUR;
                            var oPersonR;
                            var oTaskinfoR;

                            $(oCharPerson).find("scPRecA > autoApv").each(function (apvIdx, apvItem) {
                                oStepR = oApvList.createElement("step");
                                oOUR = oApvList.createElement("ou");
                                oPersonR = oApvList.createElement("person");
                                oTaskinfoR = oApvList.createElement("taskinfo");

                                $(oApvList).find("steps > division:has(>taskinfo[status='pending'])[divisiontype='receive']").append(oStepR);
                                $(oStepR).append(oOUR);
                                $(oOUR).append(oPersonR);
                                $(oPersonR).append(oTaskinfoR);
                                $(oStepR).attr("unittype", "person");
                                $(oStepR).attr("routetype", "approve");
                                $(oStepR).attr("name", "Normal");
                                $(oOUR).attr("code", $($(apvItem).find("items>item>RG")[0]).text());
                                $(oOUR).attr("name", $($(apvItem).find("items>item>RGNM")[0]).text());
                                $(oPersonR).attr("code", $($(apvItem).find("items>item>AN")[0]).text());
                                $(oPersonR).attr("name", $($(apvItem).find("items>item>DN")[0]).text());
                                $(oPersonR).attr("position", $($(apvItem).find("items>item")[0]).attr("po"));
                                $(oPersonR).attr("title", $($(apvItem).find("items>item")[0]).attr("tl"));
                                $(oPersonR).attr("level", $($(apvItem).find("items>item")[0]).attr("lv"));
                                $(oPersonR).attr("oucode", $($(apvItem).find("items>item>RG")[0]).text());
                                $(oPersonR).attr("ouname", $($(apvItem).find("items>item>RGNM")[0]).text());
                                $(oPersonR).attr("sipaddress", $($(apvItem).find("items>item>MSN_SipAddress")[0]).text());
                                $(oTaskinfoR).attr("status", "inactive");
                                $(oTaskinfoR).attr("result", "inactive");
                                $(oTaskinfoR).attr("kind", $(apvItem).attr("type"));
                            });



                        } else if ((getInfo("mode") == "REDRAFT") && getInfo("scRCDTApvLine") == "1" && getInfo("scRCDTApvLineV") != "") {//재기안에서 문서를 열면서 담당부서자동결재선 적용여부 확인
                            m_FixApvLineData = $(responseXMLdata).find("response > item > signinform")[0];
                            oApvList = $.parseXML(setFixApvLineREDRAFT(oApvList, oCurrentOUNode));
                        } else {
                            if (nodesAllItems.length > 0) {
                                var oSteps = $(oGetApvList).find("steps");
                                var oCheckSteps = chkAbsent($(oSteps).find("division"));

                                if (oCheckSteps) {
                                    //[2015-04-28 kh] 담당 대결자 체크 필요 
                                    //1. 중복으로 들어가는 문제 검토 필요 (주석 처리)
                                    //2. chkAbsent(oSteps) 함수에서 퇴직자 정보 체크 한다 - 아래 appendChild 확인 필요
                                    //3. 담당수신자 지정 후 담당수신자를 대결 지정시 아래 로직을 거치면 중복으로 결재자가 들어간다

                                    $(oSteps).find("division:has(>taskinfo[status='pending'])[divisiontype='receive'] > step[unittype='person']:has(ou>person>taskinfo[kind!='charge'])").each(function (i, enodeItem) {
                                        //$(oCurrentOUNode).find("division").append(enodeItem);
                                        $(oCurrentOUNode)[0].appendChild(enodeItem);
                                    });
                                }
                            }
                            if (nodesAllItems.length > 0) {
                                document.getElementById("btDeptDraft").style.display = "inline";
                            }
                        }
                    } else if (getInfo("mode") == "SUBREDRAFT") {
                        oCurrentOUNode = $(oApvList).find("steps > division:has(>taskinfo[status='pending'])");
                        var oOU = $(oCurrentOUNode).find("step > ou[code='" + getInfo("dpid") + "']:has(taskinfo[status='pending'])");

                        var oPerson = oApvList.createElement("person");
                        var oTaskinfo = oApvList.createElement("taskinfo");

                        $(oOU).append(oPerson);
                        $(oPerson).append(oTaskinfo)

                        $(oPerson).attr("code", getInfo("usid"));
                        $(oPerson).attr("name", getInfo("usdn"));
                        $(oPerson).attr("position", getInfo("uspc") + ";" + getInfo("uspn"));
                        $(oPerson).attr("title", getInfo("ustc") + ";" + getInfo("ustn"));
                        $(oPerson).attr("level", getInfo("uslc") + ";" + getInfo("usln"));
                        $(oPerson).attr("oucode", getInfo("dpid"));
                        $(oPerson).attr("ouname", getInfo("dpdn"));
                        $(oPerson).attr("sipaddress", getInfo("ussip"));
                        $(oTaskinfo).attr("status", "inactive"); //201108
                        $(oTaskinfo).attr("result", "inactive"); //201108
                        $(oTaskinfo).attr("kind", "charge");
                        $(oTaskinfo).attr("datereceived", getInfo("svdt"));
                    } else {
                        //TO-DO : 결재문서 재사용 기능 수정
                        //1. 본문만 재사용시 결재선 초기화
                        //2. 결재선도 재사용하지만 기안자가 내가 아닐때는 결재선 초기화
                        //2017-06-21 BY YJYOO
                        var checkISInitiator = $(oApvList).find("division[divisiontype='send'] > step > ou > person[code='" + getInfo("usid") + "'] > taskinfo[kind='charge']").length;
                        if ((getInfo("reuse") != "Y" && getInfo("reuse") != "C") || (getInfo("reuse") == "Y" && checkISInitiator == 0)) {
                            //if ((getInfo("reuse") != "Y" && getInfo("reuse") != "C" && getInfo("reuse") != "P") || ((getInfo("reuse") == "Y" || getInfo("reuse") == "P") && checkISInitiator == 0)) {
                            if (getInfo("dpid") != getInfo("dpid_apv")) $(oApvList).find("steps").attr("initiatoroucode", getInfo("dpid_apv"));
                            //SetDomainData 를 통해서 조회된 결재선 정보 없을시만 기안자 정보 생성
                            //if ($(oGetApvList).find("steps > division[divisiontype='send'] > step").length == 0) {
                            var oCCInfo;
                            if (getInfo("reuse") == "P") {
                                oCCInfo = $(oApvList).find("ccinfo");
                                $(oCCInfo).attr("datereceived", "");
                            }

                            $(oApvList).find("division").remove();

                            var oDiv = oApvList.createElement("division");
                            var oDivTaskinfo = oApvList.createElement("taskinfo");
                            var oStep = oApvList.createElement("step");
                            var oOU = oApvList.createElement("ou");
                            var oPerson = oApvList.createElement("person");
                            var oTaskinfo = oApvList.createElement("taskinfo");
                            oDiv.appendChild(oDivTaskinfo);
                            oApvList.documentElement.appendChild(oDiv).appendChild(oStep).appendChild(oOU).appendChild(oPerson).appendChild(oTaskinfo);
                            oDiv.setAttribute("divisiontype", "send");
                            oDiv.setAttribute("name", gLabel__circulation_sent);
                            oDiv.setAttribute("oucode", getInfo("dpid_apv"));
                            oDiv.setAttribute("ouname", getInfo("dpdn_apv"));
                            oDiv.setAttribute("parentapprovalorder", "");
                            oDiv.setAttribute("approvalgrouporder", "0");
                            oDivTaskinfo.setAttribute("status", "inactive");
                            oDivTaskinfo.setAttribute("result", "inactive");
                            oDivTaskinfo.setAttribute("kind", "send");
                            oDivTaskinfo.setAttribute("datereceived", getInfo("svdt"));
                            $(oStep).attr("unittype", "person");
                            $(oStep).attr("routetype", "approve");
                            $(oStep).attr("name", gLabel__writer);
                            //$(oStep).attr("language", Common.GetSession("LanguageCode"));
                            $(oStep).attr("approvalorder", "100");
                            $(oStep).attr("processinstanceid", getInfo("piid"));
                            $(oOU).attr("code", getInfo("dpid_apv"));
                            $(oOU).attr("name", getInfo("dpdn_apv"));
                            //$(oOU).attr("companycode", Common.GetSession("DN_Code"));
                            //$(oOU).attr("companyname", Common.GetSession("DN_ExName"));
                            $(oOU).attr("farmcode", getInfo("farmCode"));
                            $(oOU).attr("companycode", _DN_Code);
                            $(oOU).attr("companyname", _DN_ExName);
                            // $(oOU).attr("farmcode", _FarmCode);
                            $(oPerson).attr("code", getInfo("usid"));
                            $(oPerson).attr("name", getInfo("usdn"));
                            $(oPerson).attr("position", getInfo("uspc"));
                            $(oPerson).attr("positionname", getInfo("uspn"));
                            $(oPerson).attr("title", "");
                            $(oPerson).attr("level", "");
                            $(oPerson).attr("oucode", getInfo("dpid"));
                            $(oPerson).attr("ouname", getInfo("dpdn"));
                            $(oPerson).attr("sipaddress", getInfo("ussip"));
                            $(oPerson).attr("dutycode", getInfo("ustc"));
                            if (getInfo("Form_Deputy_YN") == "Y" && getInfo("usismanager") == "N" && _UR_IsManager == "True") {
                                $(oPerson).attr("dutyname", "");
                            } else {
                                $(oPerson).attr("dutyname", getInfo("ustn"));
                            }
                            if (getInfo("Form_Deputy_YN") == "Y" && getInfo("usismanager") == "Y" && _UR_IsManager == "False") {
                                var tbUR = Common.GetObjectInfo("UR", Common.GetSession("ManagerCode")).Table[0];
                                if (tbUR != null && tbUR.ExJobPositionName != null) {
                                    //$(oPerson).attr("positionname", tbUR.ExJobPositionName);
                                    $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
                                    $(oPerson).attr("dutycode", tbUR.JobTitleCode);
                                    $(oPerson).attr("delegationAt", "I");
                                } else {
                                    $(oPerson).attr("delegationAt", "");
                                }
                            } else {
                                $(oPerson).attr("delegationAt", "");

                            }
                            $(oPerson).attr("batchAt", "");
                            $(oPerson).attr("farmcode", _FarmCode);
                            $(oTaskinfo).attr("status", "inactive");
                            $(oTaskinfo).attr("result", "inactive");
                            $(oTaskinfo).attr("kind", "charge");
                            $(oTaskinfo).attr("datereceived", getInfo("svdt"));
                            //}

                            if (getInfo("reuse") == "P") {
                                //oCCInfo = $(oApvList).find("ccinfo");
                                $(oApvList).find("steps").append(oCCInfo);
                            }

                            //템블릿 저장인 경우 AUTOWAY 시작양식만 참조자 및 협조처 지우기
                            if (getInfo("USE_BASIC_APPROVAL_LINE") == "Y" && getInfo("reuse") == "P" && tmpIWFLegacy =="") {
                                fn_SetApvRemove(oApvList);
                            }

                            $("#APVLIST").val(CFN_XmlToString(oApvList));
                            setInfo("apst", CFN_XmlToString(oApvList));
                        }

                       
                        //복사인 경우 AUTOWAY 시작양식만 참조자 및 협조처 지우기
                        if (getInfo("USE_BASIC_APPROVAL_LINE") == "Y" && (getInfo("reuse") == "C" && getInfo("reuseinfo") == "C") && tmpIWFLegacy == "" &&
                            $(oApvList).find("division[divisiontype='send'] > step:not(:first)").length == 0) {
                            fn_SetApvRemove(oApvList);
                        }

                        oCurrentOUNode = $(oApvList).find("steps > division:has(taskinfo[status='inactive'])")[0];

                        //지정결재선을 사용하는 경우 결재선 생성을 달리함
                        if (getInfo("scCDTApvLine") == "1" && getInfo("scCDTApvLineV") != "") {
                            m_FixApvLineData = $(responseXMLdata).find("response > item > signinform")[0];
                            oApvList = $.parseXML(setFixApvLine(oApvList, oCurrentOUNode));
                        } else {
                            // 합의를 사용하지 않는 기안에는 합의가 없음
                            // 개인결재선 -> 기본결재선(*) 정보
                            var sPath = "", sPathOU = "";
                            if (getInfo("scPCoo") == "1" || getInfo("scPCooPL") == "1") { sPath = "or @routetype='assist'"; }
                            if (getInfo("scPAgr") == "1" || getInfo("scPAgrSEQ") == "1") { sPath = sPath + " or @routetype='consult'"; }
                            if (getInfo("scPAdt") == "1") { sPath = sPath + " or @routetype='audit'"; } //개인감사 추가
                            if (getInfo("scDAdt") == "1") { sPathOU = sPathOU + " @routetype='audit'"; } //부서감사 추가
                            if (getInfo("scDCoo") == "1") { sPathOU += ((sPathOU != "") ? " or " : "") + " @routetype='assist'"; } //부서협조 추가
                            if (getInfo("scDAgr") == "1") { sPathOU += ((sPathOU != "") ? " or " : "") + " @routetype='consult'"; } //부서합의 추가

                            var tmp_chkCAR = false;
                            if (_WebServerDomain == "autowaywf.hmc.co.kr" || _WebServerDomain == "autowaywf.kia.co.kr") {
                                tmp_chkCAR = true;
                            }

                            var nodesAllItems = $(oGetApvList).find("steps > division[divisiontype='send'] > step");
                            var oCheckSteps = "";
                            if (nodesAllItems.length > 0) {
                                var oSteps = $(oGetApvList).find("steps > division[divisiontype='send']");
                                oCheckSteps = chkAbsent(oSteps);
                                if (tmp_chkCAR) {
                                    if (oCheckSteps) {
                                        $(oSteps).find("step[unittype='person']").each(function (i, enodeItem) {
                                            $(oApvListRoot).find("division[divisiontype='send']").append(enodeItem);
                                        });
                                    }
                                } else {
                                    if (oCheckSteps) {
                                        $(oSteps).find("step[unittype='person'],step[unittype='role']").each(function (i, enodeItem) {
                                            $(oApvListRoot).find("division[divisiontype='send']").append(enodeItem);
                                        });
                                    }
                                }
                            }

                            isAbsent = oCheckSteps;

                            //다시 확인
                            var nodesAllItems2 = $(oGetApvList).find("steps > division[divisiontype='send'] > step");
                            if (nodesAllItems2.length > 0) {
                                if (!oCheckSteps || tmp_chkCAR) {
                                    var oSteps = $(oGetApvList).find("steps")[0];
                                    $(oSteps).find("division[divisiontype='send'] > step[unittype='role']").each(function (i, enodeItem) {
                                        $(oApvListRoot).find("division[divisiontype='send']").append(enodeItem);
                                    });
                                }
                            }

                            //부서장결재단계사용
                            var nodesAllItems3 = $(oGetApvList).find("steps > step[unittype='role']");
                            if (nodesAllItems3.length > 0) {
                                var oSteps = $(oGetApvList).find("steps")[0];
                                nodesAllItems3.each(function (i, enodeItem) {
                                    $(oApvListRoot).find("division[divisiontype='send']").append(enodeItem);
                                });
                            }

                        	// 20200529 hpark 임시저장시 수신처 결재선 유지 // 20200629 hpark 자동결재라인,연동시스템 결재선 병합
                            if (getInfo("pdef") == "REQUEST_PATTERN" && getInfo("CurrentDivisionIdx") == "0") {
                            	var nodesAllItems_R = $(oGetApvList).find("steps > division[divisiontype='receive'] > step");
                            	var oCheckSteps_R = true;
                            	if (nodesAllItems_R.length > 0) {
                            		$(oGetApvList).find("steps > division[divisiontype='receive']").each(function (idx, item) {
                            			if (!chkAbsent(item)) oCheckSteps_R = false;
                            		});
                            		if (oCheckSteps_R) {
                            			$(oGetApvList).find("steps > division[divisiontype='receive']").each(function (i, enodeItem) {
                            				$(enodeItem).find("comment").remove();
                            				$(enodeItem).find("person[batchAt]").attr("batchAt", "");
                            				$(enodeItem).find("person[delegationAt]").attr("delegationAt", "");
                            				$(enodeItem).find("taskinfo").attr("result", "inactive");
                            				$(enodeItem).find("taskinfo").attr("status", "inactive");
                            				$(enodeItem).find("taskinfo[datereceived]").attr("datereceived", ""); // $(enodeItem).find("step > taskinfo").removeAttr("datereceived");
                            				$(enodeItem).find("taskinfo[wiid]").attr("wiid", "");
                            				$(enodeItem).find("taskinfo[customattribute1]").attr("customattribute1", "");
                            				$(enodeItem).find("taskinfo[datecompleted]").attr("datecompleted", "");

                            				if ($(enodeItem).find("step").length > 0) $(oApvListRoot).append(enodeItem);
                            			});
                            		}
                            	}
                            }

                            //양식 결재선에 수신처.
                            if (getInfo("scDRec") == 1 || getInfo("scPRec") == 1) {
                                if (getInfo("scPRecV") != "") {
                                    var aScPRecV = getInfo("scPRecV").split("@@");
                                    var sChgrPersonXml = "";
                                    if (aScPRecV.length > 2) {
                                        sChgrPersonXml = aScPRecV[2];
                                    }
                                    var oCharPerson = $.parseXML(sChgrPersonXml);
                                    var oDivR = oApvList.createElement("division");
                                    var oDivTaskinfoR = oApvList.createElement("taskinfo");
                                    var oStepR = oApvList.createElement("step");
                                    var oOUR = oApvList.createElement("ou");
                                    var oPersonR = oApvList.createElement("person");
                                    var oTaskinfoR = oApvList.createElement("taskinfo");
                                    $(oDivR).append(oDivTaskinfoR);
                                    $(oApvListRoot).append(oDivR);
                                    $(oDivR).append(oStepR);
                                    $(oStepR).append(oOUR);
                                    $(oOUR).append(oPersonR);
                                    $(oPersonR).append(oTaskinfoR);
                                    oDivR.setAttribute("divisiontype", "receive");
                                    oDivR.setAttribute("name", "담당결재");
                                    oDivR.setAttribute("oucode", $($(oCharPerson).find("item>RG")[0]).text());
                                    oDivR.setAttribute("ouname", $($(oCharPerson).find("item>RGNM")[0]).text());
                                    oDivTaskinfoR.setAttribute("status", "inactive");
                                    oDivTaskinfoR.setAttribute("result", "inactive");
                                    oDivTaskinfoR.setAttribute("kind", "receive");
                                    $(oStepR).attr("unittype", "person");
                                    $(oStepR).attr("routetype", "receive");
                                    $(oStepR).attr("name", "담당결재");
                                    $(oOUR).attr("code", $($(oCharPerson).find("item>RG")[0]).text());
                                    $(oOUR).attr("name", $($(oCharPerson).find("item>RGNM")[0]).text());
                                    $(oPersonR).attr("code", $($(oCharPerson).find("item>AN")[0]).text());
                                    $(oPersonR).attr("name", $($(oCharPerson).find("item>DN")[0]).text());
                                    $(oPersonR).attr("position", $($(oCharPerson).find("item")[0]).attr("po"));
                                    $(oPersonR).attr("title", $($(oCharPerson).find("item")[0]).attr("tl"));
                                    $(oPersonR).attr("level", $($(oCharPerson).find("item")[0]).attr("lv"));
                                    $(oPersonR).attr("oucode", $($(oCharPerson).find("item>RG")[0]).text());
                                    $(oPersonR).attr("ouname", $($(oCharPerson).find("item>RGNM")[0]).text());
                                    $(oPersonR).attr("sipaddress", $($(oCharPerson).find("item>MSN_SipAddress")[0]).text());
                                    $(oTaskinfoR).attr("status", "inactive");
                                    $(oTaskinfoR).attr("result", "inactive");
                                    $(oTaskinfoR).attr("kind", "normal");
                                }
                                else {
                                    $(oGetApvList).find("steps > division[divisiontype='receive']:has(step[routetype='receive']):has(step[unittype='ou'],[unittype='person'])").each(function (i, enodeItem) {
                                        $(enodeItem).find("person > taskinfo").attr("result", "inactive");
                                        $(enodeItem).find("person > taskinfo").attr("status", "inactive");
                                        $(enodeItem).find("person > taskinfo").removeAttr("datereceived");
                                        $(enodeItem.childNodes[0]).attr("result", "inactive");
                                        $(enodeItem.childNodes[0]).attr("status", "inactive");
                                        $(enodeItem.childNodes[0]).removeAttr("datereceived");
                                        $(oApvListRoot).append(enodeItem);
                                    });
                                }
                            }
                            //참조자 출력
                            $(oGetApvList).find("steps > ccinfo").each(function (i, enodeItem) {
                                $(oApvListRoot).append(enodeItem);
                            });

                        	// 20200629 hpark 자동결재라인,연동시스템 결재선 병합
                            if (getInfo("USE_BASIC_APPROVAL_LINE") == "Y" && getInfo("CurrentDivisionIdx") == "0") {
                            	//if ($(responseXMLdata).find("response > item > ismerge0").length > 0) {
                            	//	$("#m_MergeApvline0").val($(responseXMLdata).find("response > item > ismerge0").text());
                            	//	//if (formJson != undefined && formJson.BODY_CONTEXT != undefined) {
                            	//	//	if (formJson.BODY_CONTEXT.m_MergeApvline0 != undefined) formJson.BODY_CONTEXT.m_MergeApvline0 = $(responseXMLdata).find("response > item > ismerge0").text();
                            	//	//}
                            	//}
                            	if (getInfo("mode") == 'DRAFT') $("#m_MergeApvline0").val("Y");
                            	if (getInfo("pdef") != "REQUEST_PATTERN") {
                            		if ($(responseXMLdata).find("response > item > consultlist").length > 0) {
                            			$("#CONSULT_LIST").val($(responseXMLdata).find("response > item > consultlist").text());
                            		}
                            		if ($(responseXMLdata).find("response > item > consultexlist").length > 0) {
                            			$("#CONSULT_EXLIST").val($(responseXMLdata).find("response > item > consultexlist").text());
                            		}
                            	}
                            }
                            
                        }
                    }

                    if (fn_ApvLineBasicYN(oApvList))
                    {
                        fn_SetApvBasic(oApvList, (isAbsent == "" || isAbsent == undefined) ? true : isAbsent);
                    }

                    document.getElementById("APVLIST").value = CFN_XmlToString(oApvList);


                    if (getInfo("mode") == "DRAFT" && getInfo("reuse") != "Y") {
                        if (typeof (setApvlistCallback) == 'function' || typeof (setApvlistCallback) == 'object') {
                            setApvlistCallback();
                        }
                    }
                    else {
                        if (getInfo("reuse") == "Y" && CFN_GetQueryString("Revision") == "Y") {
                            if (typeof (setApvlistCallback) == 'function' || typeof (setApvlistCallback) == 'object') {
                                setApvlistCallback();
                            }
                        } else {
                            if (getInfo("mode") == "TEMPSAVE" && (getInfo("fmpf").indexOf("GOJP_WORKFORM") > -1 || getInfo("fmpf").indexOf("GWOK_INVEST") > -1 || getInfo("fmpf").indexOf("GWOK_PINVEST") > -1)) {
                                if (typeof (setApvlistCallback) == 'function' || typeof (setApvlistCallback) == 'object') {
                                    setApvlistCallback();
                                }
                            } else {
                                document.getElementById("APVLIST").value = CFN_XmlToString(oApvList);
                            }
                        }
                    }
                    initApvList();
                }
            }
        }
    }
}

//긴급결재
function chk_urgent_onclick() {
    document.getElementById("chk_urgent").value = (document.getElementById("chk_urgent").checked == true) ? "1" : "0";
}
//기밀문서
function chk_secrecy_onclick() {
    document.getElementById("chk_secrecy").value = (document.getElementById("chk_secrecy").checked == true) ? "1" : "0";
    //양식 필드 값
    document.getElementById("DOCSECURITY").value = document.getElementById("chk_secrecy").value;
}

//우측 메뉴 KBW20180417
function chk_secrecy_menu() {
    if (document.getElementById("chk_secrecy").value == 1) {
        fn_SetSecurityDoc(true);
        //$("#divbtUrl").hide();
        ////4. 우편함으로 
        //$("#btMailSend").hide();
        //$("#divbtUrl").show();
        //$("#divbtMailSend").show();//4. 우편함으로 
        //$("#btMailSend").show();
    }
    else {
        fn_SetSecurityDoc(false);
        $("#divbtMailSend").show();//4. 우편함으로 
        $("#btMailSend").show();
    }
}
//문서이관
function chk_edmschk_onclick() {
    $("#chk_edmschk").val((document.getElementById("chk_edmschk").checked == true) ? "1" : "0");
}
//예약발송,배포
function chk_reserved_onclick() {
    $("#chk_reserved").val((document.getElementById("chk_reserved").checked == true) ? "1" : "0");
    if (document.getElementById("chk_reserved").checked == true) {
        $("#reservedchk").css({ "display": "" });
        var sDics = "lbl_apv_setschema_scReserved:lbl_apv_setschema_scDistribute";
        var sDic = sDics.split(":");
        if (getInfo("scReserved") == "1" && getInfo("scDistribute") == "1") {
            for (var i = 0; i < 2; i++) {
                makeOption(sDic[i]);
            }
        } else {
            if (getInfo("scReserved") == "1") {
                makeOption(sDic[0]);
            } else {
                makeOption(sDic[1]);
            }
        }
    } else {
        $("#reservedchk").css({ "display": "none" });
        makeOption("del");
    }
}
//예약발송,배포 옵션 생성
function makeOption(str) {
    var oSelect = document.getElementById("select_reserved");
    if (str == "del") {
        oSelect.length = 0;
    } else {
        var oOption = document.createElement("OPTION");
        oSelect.add(oOption);
        oOption.text = Common.GetDic(str);
        oOption.value = Common.GetDic(str);
    }
    return;
}

////회신 (추가 : 2008.08.05 백승찬 대리)
//function chk_reform_onclick() {
//    document.getElementById("chk_reform").value = (document.getElementById("chk_reform").checked == true) ? "1" : "0";
//    document.getElementsByName("REPLY")[0].value = document.getElementById("chk_reform").value;
//}
function receiveGeneralQuery(dataresponseXML) {
    var errorNode = $(dataresponseXML).find("response > error");
    if (errorNode.length > 0) {
        alert("Desc: " + $(errorNode).text());
    }
}

/*
    toUTF8(szInput)
    moved to form.refactor.deleted.js
    by KJW : 2014.04.22 :  : XFORM PRJ.
*/

/*메일 작성창 open */
var rg_Mailbox;
var szApvBodyCtx = "";
function sendMail() { OpenNewMsg("sendmail"); }
function OpenNewMsg(code) {
    mailform.action = g_szBaseURL + "/Approval/Popup/EmailWrite.aspx";

    var szwidth = 800;
    var szheight = 690;
    calcWindowLocation(szwidth, szheight);
    var windowName = new String(Math.round(Math.random() * 100000));

    CFN_OpenWindow("", windowName, szwidth, szheight, "");

    //문서 키값 넘기기
    mailform.PIID.value = getInfo("piid");
    mailform.FIID.value = getInfo("fiid");
    //제목 넘기기
    mailform.Subject.value = getInfo("SUBJECT");
    //본문 넘기기
    mailform.HTMLBody.value = encode(sMailBody);

    //2011-03-07 본문 넘기기 전 sMailBody base64로 인코딩 hichang 끝
    //첨부파일 처리
    //    데이터포멧 : 파일경로1|파일명1|파일사이즈1?파일경로2|파일명2|파일사이즈2?  - 파일사이즈 단위(byte)
    //    예) \GWStorage\BOARD\1155\AttachFile\200907\1649_소프트웨어사용인증서.ppt|소프트웨어사용인증서.ppt|313856?
    var szAttFileInfo = "";
    if (getInfo("ATTACH_FILE_INFO") != "") {
        var r, res;
        var s = getInfo("ATTACH_FILE_INFO");
        res = /^^^/i;
        attFiles = s.replace(res, "");
        var fState;
        var m_oFileList;
        if (attFiles.indexOf("</fileinfos>") < 0) {
            m_oFileList = $.parseXML("<fileinfos>" + attFiles + "</fileinfos>");
        } else {
            m_oFileList = $.parseXML(attFiles);
        }
        var elmRoot, elmList, elm, elmTaskInfo;
        elmRoot = $(m_oFileList).find("fileinfos");
        var fmurl = getInfo("fmurl").replace("EDMS", "") + "ATTACH/";
        var attpath = getInfo("attpath");
        if (elmRoot != null) {
            szAttFileInfo = "";
            $(elmRoot).find("fileinfo > file").each(function (i, elm) {
                var filename = $(elm).attr("name");
                var filesize = $(elm).attr("size");
                var fileurl = $(elm).attr("location");
                var filepath = fileurl.replace(fmurl, attpath).replace("/", "\\");
                filepath = filepath.substring(filepath.indexOf("\\\\") + 1, filepath.length);
                filepath = filepath.substring(filepath.indexOf("\\") + 1, filepath.length);
                filepath = filepath.substring(filepath.indexOf("\\"), filepath.length);

                szAttFileInfo += filepath + "|" + filename + "|" + filesize;
                if (i < $(elmRoot).find("fileinfo > file").length - 1)
                    szAttFileInfo += "?";
            });
        }
    }
    document.mailform.attachfiles.value = encode(szAttFileInfo);

    mailform.target = windowName;
    mailform.submit();
}
//2011-03-07 본문 넘기기 전 sMailBody base64로 인코딩 hichang 시작
var base64s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
function encode(decStr) {
    decStr = escape(decStr);
    var bits, dual, i = 0, encOut = '';
    while (decStr.length >= i + 3) {
        bits =
            (decStr.charCodeAt(i++) & 0xff) << 16 |
            (decStr.charCodeAt(i++) & 0xff) << 8 |
            decStr.charCodeAt(i++) & 0xff;
        encOut +=
            base64s.charAt((bits & 0x00fc0000) >> 18) +
            base64s.charAt((bits & 0x0003f000) >> 12) +
            base64s.charAt((bits & 0x00000fc0) >> 6) +
            base64s.charAt((bits & 0x0000003f));
    }
    if (decStr.length - i > 0 && decStr.length - i < 3) {
        dual = Boolean(decStr.length - i - 1);
        bits =
            ((decStr.charCodeAt(i++) & 0xff) << 16) |
            (dual ? (decStr.charCodeAt(i) & 0xff) << 8 : 0);
        encOut +=
            base64s.charAt((bits & 0x00fc0000) >> 18) +
            base64s.charAt((bits & 0x0003f000) >> 12) +
            (dual ? base64s.charAt((bits & 0x00000fc0) >> 6) : '=') + '=';
    }
    return encOut;
}
//2011-03-07 본문 넘기기 전 sMailBody base64로 인코딩 hichang 끝

//2011-03-07 본문 넘기기 전 sMailBody base64로 디코딩 hichang 시작
function decode(encStr) {
    var bits, decOut = '', i = 0;
    for (; i < encStr.length; i += 4) {
        bits =
            (base64s.indexOf(encStr.charAt(i)) & 0xff) << 18 |
            (base64s.indexOf(encStr.charAt(i + 1)) & 0xff) << 12 |
            (base64s.indexOf(encStr.charAt(i + 2)) & 0xff) << 6 |
            base64s.indexOf(encStr.charAt(i + 3)) & 0xff;
        decOut += String.fromCharCode(
            (bits & 0xff0000) >> 16, (bits & 0xff00) >> 8, bits & 0xff);
    }
    if (encStr.charCodeAt(i - 2) == 61)
        undecOut = decOut.substring(0, decOut.length - 2);
    else if (encStr.charCodeAt(i - 1) == 61)
        undecOut = decOut.substring(0, decOut.length - 1);
    else undecOut = decOut;
    return unescape(undecOut);
}
//2011-03-07 본문 넘기기 전 sMailBody base64로 디코딩 hichang 끝
var theLeft;
var theTop;
function calcWindowLocation(theWidth, theHeight) {
    var objNewWin;

    var x = theWidth;
    var y = theHeight;

    theLeft = window.screen.width / 2 - x / 2;
    theTop = window.screen.height / 2 - y / 2 - 20;
}

function requestTempSaveProcess(sReqMode) {
    m_sReqMode = sReqMode;
    try {
        disableBtns(true);
        if (evaluateForm()) {
            var sTargetURL = "/Approval/Forms/submitForm.aspx";
            var sMsgTitle;
            var sAddage;
            switch (sReqMode) {
                case "TEMPSAVE":
                    sMsgTitle = gLabel__personalSave; //"개인 저장함"

                    var sFiid = getInfo("fiid"); setInfo("fiid", getInfo("fiid_spare")); setInfo("fiid_spare", sFiid);//setInfo("mode","REJECT");
                    setInfo("mode", "DRAFT"); setInfo("loct", "DRAFT");
                    sTargetURL = "/Approval/TempSave/saveForm.aspx";
                    var sFormXml = getFormXML();
                    if (sFormXml.indexOf("<BODY_CONTEXT>") == -1) {
                        sFormXml = sFormXml.replace("</formdata>", "");
                        sFormXml += makeNode("BODY_CONTEXT", getInfo("BODY_CONTEXT"));
                        sFormXml += "</formdata>";
                    }
                    sAddage = sFormXml;
                    m_bFrmExtDirty = true;
                    break;
            }
            try {

                //관리자에 의한 강제취소 처리시작 - 임시저장 보정 2010.12
                var szusidback = "";
                if (admintype == "ADMIN") {
                    szusidback = getInfo("usid");
                    setInfo("usid", getInfo("INITIATOR_ID"));
                }

                var sText = "<request>" + getDefaultXML() + sAddage + makeNode("fiid_spare") + "</request>";
                CFN_CallAjax(sTargetURL, sText, function (data) {
                    receiveGeneralQuery(data);
                }, false, "xml");

                if (admintype == "ADMIN" && szusidback != "") {
                    setInfo("usid", szusidback);
                }
                //관리자에 의한 강제취소 처리 끝 - 임시저장 보정 2010.12
            } catch (e) {
                disableBtns(false);
                Common.Error(gMessage73 + "\nDesc:" + e.description + "\nError number: " + e.number); //"저장하지 못했습니다."
            }
        } else {
            disableBtns(false);
        }
    } catch (e) { alert(e.description); }
}

//퇴직자 및 인사정보 최신 적용을 위해 추가
function chkAbsent(oSteps) {
    var elmUsers;
    var sUsers = "";
    $(oSteps).find("step > ou > person").each(function (i, elmUsers) {
        if (sUsers.length > 0) {
            var szcmpUsers = ";" + sUsers + ";";
            if (szcmpUsers.indexOf(";" + $(elmUsers).attr("code") + ";") == -1) { sUsers += ";" + $(elmUsers).attr("code"); }
        } else {
            sUsers += $(elmUsers).attr("code");
        }
    });
    var pXML = "CHECK_ABSENT_MEMBER_R";
    var aXML = "<param><name>USER_ID</name><type>VarChar</type><length>2000</length><value><![CDATA[" + sUsers + "]]></value></param>";
    var sXML = "<Items><connectionname>Common</connectionname><xslpath>org_chkabsent.xsl</xslpath><sql><![CDATA[" + pXML + "]]></sql><type>sp</type>" + aXML + "</Items>";
    var szURL = "/Approval/Address/getXMLQuery.aspx?Type=searchMember";
    var bReturn = false;

	// 수신부서인 경우 person없이 부서만 있으므로 person이 없다면 체크하지 않음
    if (sUsers == "") { return true; }

    CFN_CallAjax(szURL, sXML, function (dataXML) {
        var errorNode = $(dataXML).find("response > error");
        if (errorNode.length > 0) {
            return false;
        } else {
            //Active 한 사용자들 모두 조회, 부서, 직위, 직급, 직책 비고
            var oUser;
            var sAbsentResult = "";
            var sResult = "";
            var oChkAbsentNode;
            var kk = 0;
            $(oSteps).find("division > step> ou > person").each(function (i, oUser) {
                //sAbsentResult += $(oUser).attr("name") + ",";
                sAbsentResult += m_oFormMenu.getLngLabel($(oUser).attr("name"), false) + ",";
                sResult += m_oFormMenu.getLngLabel($(oUser).attr("name"), false) + ",";
                $(dataXML).find("response > addresslist > item").each(function (ii, oChkAbsentNode) {
                    if ($(oChkAbsentNode).find("AN").text() == $(oUser).attr("code")) {
                        //TO-DO : 재사용 결재자 부서명, 부서코드, 직책코드, 직급코드 체크하여 변경사항있을경우 재사용대상에서 제외한다.
                        if ($(oUser).find("taskinfo").attr("kind") == "charge" && getInfo("Form_Deputy_YN") == "Y" && getInfo("usismanager") == "Y" && _UR_IsManager == "False"
                            && $(oChkAbsentNode).find("RG").text() == $(oUser).attr("oucode") && $(oChkAbsentNode).find("DP").text().toUpperCase() == $(oUser).attr("ouname").replace(/&amp;/gi, '&').toUpperCase() && $(oChkAbsentNode).attr("po") == $(oUser).attr("position")) {
                            $(oUser).attr("position", $(oChkAbsentNode).attr("po"));
                            $(oUser).attr("title", $(oChkAbsentNode).attr("tl"));
                            $(oUser).attr("level", $(oChkAbsentNode).attr("lv"));
                            sResult = sResult.replace(m_oFormMenu.getLngLabel($(oUser).attr("name"), false) + ",", "");
                        } else if ($(oChkAbsentNode).find("RG").text() == $(oUser).attr("oucode") && $(oChkAbsentNode).find("DP").text().toUpperCase() == $(oUser).attr("ouname").replace(/&amp;/gi, '&').toUpperCase() && $(oChkAbsentNode).attr("tl") == $(oUser).attr("dutycode") && $(oChkAbsentNode).attr("po") == $(oUser).attr("position")) {
                            $(oUser).attr("position", $(oChkAbsentNode).attr("po"));
                            $(oUser).attr("title", $(oChkAbsentNode).attr("tl"));
                            $(oUser).attr("level", $(oChkAbsentNode).attr("lv"));
                            sResult = sResult.replace(m_oFormMenu.getLngLabel($(oUser).attr("name"), false) + ",", "");
                        }
                        else { }
                        sAbsentResult = sAbsentResult.replace(m_oFormMenu.getLngLabel($(oUser).attr("name"), false) + ",", "");
                    } else {//퇴직자
                    }
                });
            });

            if (sAbsentResult != "") {
                //Common.Warning(formJson.oLang.msg_apv_360 + '\n\n' + formJson.oLang.msg_apv_359 + " : " + sAbsentResult.substring(0, sAbsentResult.length - 1)); //저장된 결재선에 퇴직자가 포함되어 적용이 되지 않습니다.\n\n퇴직자 : 슈퍼관리자
                Common.Warning(Common.GetDic("msg_apv_ApprovalLineSetFail2"));
                bReturn = false;
            } else {
                if (sResult != "" && getInfo("reuse") != "P") {
                    if (getInfo("reuse") != "P") { // 템플릿재사용 중 [본문]일 경우(Reuse == "P")는 메세지 표출 안함
                        //alert(formJson.oLang.msg_apv_357 + '\n\n' + formJson.oLang.msg_apv_358 + " : " + sResult.substring(0, sResult.length - 1)); //저장된 결재선의 부서/인사정보가 최신정보와 일치하지 않아 제외됩니다.\n\n제외 대상자 : 슈퍼관리자
                        Common.Warning(Common.GetDic("msg_apv_ApprovalLineSetFail2"));
                    }
                    bReturn = false;
                } else {
                    bReturn = true;
                }
            }
        }
    }, false, "xml");
    return bReturn;
}

//후결여부 체크
function fn_GetReview() {
    var m_apvXML = $.parseXML(document.getElementById("APVLIST").value);
    var oReviewNode = $(m_apvXML).find("steps > division > step > ou > person:has(taskinfo[kind='review'][status='pending'])");
    if (oReviewNode.length != 0) {
        if (getInfo("usid") == $(oReviewNode).attr("code")) {
            return true
        }
    }
    return false;
}
//후결여부 체크
//최종결재여부 체크
function getIsLast() {
    var sRtn = "";
    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);

    var oPendingSteps = $(m_oApvList).find("steps > division > step > ou > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='pending'],steps > division > step > ou > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='reserved'],steps > division > step > ou > role > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='pending']");
    var oinActiveSteps = $(m_oApvList).find("steps > division > step > ou > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='inactive'],steps > division > step > ou > role > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='inactive']");
    if ((oPendingSteps.length == 1) && (oinActiveSteps.length == 0)) {
        sRtn = "true";
    } else {
        sRtn = "false";
    }
    if (sRtn == "false") {
        switch (getInfo("mode")) {
            case "PCONSULT":
                if (getInfo("mode") == "PCONSULT" && getInfo("pfsk") == "T004" && document.getElementById("ACTIONINDEX").value == 'reject') { //합의 반려 가능
                    sRtn = "true";
                }
                break;
            default:
                if (document.getElementById("ACTIONINDEX").value == 'reject') { //결재 반려 가능
                    sRtn = "true";
                }
                break;
        }
    }
    return sRtn;
}
//양식 내역 보내기
function getInfoBodyContext() {
    var sFormXml = getFormXML();
    if (sFormXml.indexOf("<BODY_CONTEXT>") == -1) {
        sFormXml = sFormXml.replace("</formdata>", "");
        sFormXml += makeNode("BODY_CONTEXT", getInfo("BODY_CONTEXT"));
        sFormXml += "</formdata>";
    }
    return sFormXml;
}

function receiveBBSHTTP(responseXMLdata) {
    var xmlReturn = responseXMLdata;

    var errorNode = $(xmlReturn).find("response> error");
    if (errorNode.length > 0) {
        throw new Error(-1, $(errorNode).text());
    } else {
        alert(gMessage170); //"완료되었습니다."       
    }
}

//지정결재선 셋팅 시작
var m_oXSLProcessor;
function setFixApvLine(oApvList, oCurrentOUNode, indexCondition, indexCTCondition) {
    //m_FixApvLineData ; requester 지정 결재선 정보
    //<NewDataSet>
    //Table : 지정결재선
    //Table1 : controller
    //Table2~: 금액 관련 결재선
    //지정결재선 추가
    var array1 = getInfo("scCDTApvLineV").split("|");
    m_oXSLProcessor = makeProcessor("../ApvLineMgr/ApvlineGen.xsl");

    if (m_FixApvLineData != null) {
        var m_objXMLMember = $.parseXML(m_FixApvLineData);


        //기존에 추가된 사용자 지우기
        if ($(m_FixApvLineData).find("Table2").length != 0) {
            var m_objXMLETC;
            var m_XMLDOMETC;
            var szXML = "";
            for (var ii = 2; ii < array1.length ; ii++) {
                try { szXML += CFN_XmlToString((m_FixApvLineData).find("Table" + ii)); } catch (e) { }
            }
            m_objXMLETC = $.parseXML("<signinform><NewDataSet>" + szXML + "</NewDataSet></signinform>");
            var m_oMemberXSLProcessorETC = makeProcessor("../Address/org_memberqueryfixapvline.xsl");
            m_oMemberXSLProcessorETC.addParameter("type", "etc");
            m_oMemberXSLProcessorETC.input = m_objXMLETC;
            m_oMemberXSLProcessorETC.transform();
            m_objXMLETC = $.parseXML(m_oMemberXSLProcessorETC.output);
            m_XMLDOMETC = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
            var m_oParentETC = $(m_XMLDOMETC).find("selected > user");
            var elmListETC = $(m_objXMLETC).find("response > addresslist > item");
            $(elmListETC).each(function (i, elm) {
                var oStepUser = $(oCurrentOUNode).find("step > ou > person:has(taskinfo[kind != 'charge'][@status='inactive'])[code = '" + $(elm).find("AN").text() + "']");
                if (oStepUser.length != 0) {
                    if ($(m_FixApvLineData).find("Table[PERSON_CODE ='" + $(elm).find("AN").text() + "']").length == 0) $(oCurrentOUNode).removeChild($(oStepUser).parent().parent());
                }
            });
        }


        var m_objXMLMember = $.parseXML(CFN_XmlToString(m_FixApvLineData));

        var m_objXML;
        var m_oMemberXSLProcessor = makeProcessor("../Address/org_memberqueryfixapvline.xsl");
        m_oMemberXSLProcessor.addParameter("type", "fix");
        m_oMemberXSLProcessor.input = m_objXMLMember;
        m_oMemberXSLProcessor.transform();
        m_objXML = $.parseXML(m_oMemberXSLProcessor.output);

        var m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");

        var m_oParent = $(m_XMLDOM).find("selected > user");
        var elmList = $(m_objXML).find("response > addresslist > item");
        $(elmList).each(function (i, elm) {
            $(m_oParent).append($(elm).clone());
        });

        m_objXML = $.parseXML(CFN_XmlToString(m_oParent));

        insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);

        //controller 추가
        //전체 혹은 brand별 controller 있을 경우 default 추가
        //금액 조건까지는 여기에서 처리
        //특이조건은 양식에서 처리
        if ($(m_FixApvLineData).find("Table1 > CONTOLLER").length == 0) {
            var szCTList = "";
            var usdv = getInfo("dpid").substring(0, 4);
            var barndid = getInfo("dpid").substring(4, 11);

            if (getInfo("dpid").length < 10) {
                usdv = '1100';
                barndid = getInfo("dpid");
            }

            var bManager = gManagerYN;

            var oChargePerson = $(oApvList).find("steps > division:having(taskinfo[status='inactive'])[divisiontype='send'] > step > ou > person:has(taskinfo[kind='charge'])");
            //대리작성
            try {
                if (ProxyYN.value == "Y" && parent.menu.chk_proxy.checked) {
                    usdv = ProxyDeptCode.value.substring(0, 4);
                    barndid = ProxyDeptCode.value.substring(4, 11);
                    if (ProxyDeptCode.value.length < 10) {
                        usdv = '1100';
                        barndid = getInfo("dpid");
                    }

                    //대결자 manager 여부
                    //if (usdv == "1300" || usdv == "1400") {
                    //    bManager = chkManager(ProxySabun.value, ProxyDeptCode.value);
                    //}
                }
            } catch (e) { }

            if (array1[1] == "T") {//CT설정일 경우에만 수행
                m_oMemberXSLProcessor = makeProcessor("../Address/org_memberqueryfixapvline.xsl");
                m_oMemberXSLProcessor.addParameter("type", "controller");
                var m_objXMLMember2;

                if (m_FixApvLineCTData.documentElement.getAttribute("ALL" + usdv) == "1") {//전brand 공통 controller 있을 경우
                    m_oMemberXSLProcessor.input = m_objXMLMember;
                    m_oMemberXSLProcessor.transform();
                    m_objXML = $.parseXML(m_oMemberXSLProcessor.output);

                    m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
                    m_oParent = $(m_XMLDOM).find("selected > user")
                    elmList = $(m_objXML).find("response > addresslist > item");
                    $(elmList).each(function (i, elm) {
                        $(m_oParent).append($(elm).clone());
                    });

                    m_objXML = $.parseXML(CFN_XmlToString(m_oParent));
                    insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);

                } else {
                    //brand별 controller
                    var temp = $(m_FixApvLineCTData).find("CT" + barndid).text();
                    if (temp != "") {
                        m_oMemberXSLProcessor.input = m_objXMLMember;
                        m_oMemberXSLProcessor.transform();
                        m_objXML = $.parseXML(m_oMemberXSLProcessor.output);

                        m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
                        m_oParent = $(m_XMLDOM).find("selected > user")
                        elmList = $(m_objXML).find("response > addresslist > item");
                        $(elmList).each(function (i, elm) {
                            $(m_oParent).append($(elm).clone());
                        });

                        //m_objXML = $.parseXML((new XMLSerializer()).serializeToString(m_oParent));  
                        m_objXML = $.parseXML(CFN_XmlToString(m_oParent));
                        insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);
                    }

                    var oCheckUser = null;
                    oStepUser = $(oCurrentOUNode).find("step > ou > person[code = '" + $(m_FixApvLineCTData).find("AM1CT" + barndid).text() + "'] > taskinfo[kind != 'charge'][status='inactive']");
                    oCheckUser = $(m_FixApvLineData).find("Table:having(PERSON_CODE ='" + $(m_FixApvLineCTData).find("AM1CT" + barndid).text() + "')");

                    if (oStepUser.length != 0 && oCheckUser.length == 0) $(oCurrentOUNode).removeChild($(oStepUser).parent().parent());
                    oStepUser = $(oCurrentOUNode).find("step > ou > person[code = '" + $(m_FixApvLineCTData).find("AM2CT" + barndid).text() + "'] > taskinfo[kind != 'charge' ][status='inactive']");
                    oCheckUser = $(m_FixApvLineData).find("Table:having(PERSON_CODE ='" + $(m_FixApvLineCTData).find("AM2CT" + barndid).text() + "')");

                    if (oStepUser.length != 0 && oCheckUser.length == 0) $(oCurrentOUNode).removeChild($(oStepUser).parent().parent());

                    oStepUser = $(oCurrentOUNode).find("step > ou > person[code = '" + $(m_FixApvLineCTData).find("ETC1CT" + usdv).text() + "'] > taskinfo[kind != 'charge'][status='inactive']");
                    oCheckUser = $(m_FixApvLineData).find("Table:having(PERSON_CODE ='" + $(m_FixApvLineCTData).find("ETC1CT" + usdv).text() + "')");

                    if (oStepUser.length != 0 && oCheckUser.length == 0) $(oCurrentOUNode).removeChild($(oStepUser).parent().parent());
                    oStepUser = $(oCurrentOUNode).find("step > ou > person[code = '" + $(m_FixApvLineCTData).find("ETC2CT" + usdv).text() + "'] > taskinfo[kind != 'charge'][status='inactive']");
                    oCheckUser = $(m_FixApvLineData).find("Table:having(PERSON_CODE ='" + $(m_FixApvLineCTData).find("ETC2CT" + usdv).text() + "')");
                    if (oStepUser.length != 0 && oCheckUser.length == 0) $(oCurrentOUNode).removeChild($(oStepUser).parent().parent());

                    if (indexCTCondition == null) {
                        temp = $(m_FixApvLineCTData).find("AM1" + barndid).text();

                        if (temp == "0") {
                            if (szCTList != "") {
                                szCTList += "or " + "PERSON_CODE = '" + $(m_FixApvLineCTData).find("AM1CT" + barndid).text() + "'";
                            } else {
                                szCTList = "PERSON_CODE = '" + $(m_FixApvLineCTData).find("AM1CT" + barndid).text() + "'";
                            }

                            m_objXMLMember2 = $.parseXML("<signinform><NewDataSet>" + CFN_XmlToString($(m_objXMLMember).find("Table1[" + szCTList + "]")) + "</NewDataSet></signinform>");
                            m_oMemberXSLProcessor.input = m_objXMLMember2;
                            m_oMemberXSLProcessor.transform();
                            m_objXML = $.parseXML(m_oMemberXSLProcessor.output);

                            m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
                            m_oParent = $(m_XMLDOM).find("selected > user");
                            elmList = $(m_objXML).find("response > addresslist > item");
                            $(elmList).each(function (i, elm) {
                                $(m_oParent).append($(elm).clone());
                            });

                            m_objXML = $.parseXML(CFN_XmlToString(m_oParent));
                            insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);
                        }
                    } else {
                        if (indexCTCondition == "1") {
                            temp = $(m_FixApvLineCTData).find("AM1" + barndid).text();
                            if (temp == "0") {
                                szCTList = "PERSON_CODE = '" + $(m_FixApvLineCTData).find("AM1CT" + barndid).text() + "'";
                                m_objXMLMember2 = $.parseXML("<signinform><NewDataSet>" + CFN_XmlToString($(m_objXMLMember).find("Table1[" + szCTList + "]")) + "</NewDataSet></signinform>");
                                m_oMemberXSLProcessor.input = m_objXMLMember2;
                                m_oMemberXSLProcessor.transform();
                                m_objXML = $.parseXML(m_oMemberXSLProcessor.output);

                                m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
                                m_oParent = $(m_XMLDOM).find("selected > user")
                                elmList = $(m_objXML).find("response> addresslist > item");
                                $(elmList).each(function (i, elm) {
                                    $(m_oParent).append($(elm).clone());
                                });

                                m_objXML = $.parseXML(CFN_XmlToString(m_oParent));
                                insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);
                            }
                        }
                        if (indexCTCondition == "2") {
                            temp = $(m_FixApvLineCTData).find("AM2" + barndid).text();
                            if (temp != "0") {
                                szCTList = "PERSON_CODE = '" + $(m_FixApvLineCTData).find("AM2CT" + barndid).text() + "'";

                                m_objXMLMember2 = $.parseXML("<signinform><NewDataSet>" + $(m_objXMLMember).find("Table1:has(" + szCTList + ")").xml + "</NewDataSet></signinform>");
                                m_oMemberXSLProcessor.input = m_objXMLMember2;
                                m_oMemberXSLProcessor.transform();
                                m_objXML = $.parseXMLL(m_oMemberXSLProcessor.output);

                                m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
                                m_oParent = $(m_XMLDOM).find("selected > user")
                                elmList = $(m_objXML).find("response> addresslist > item");
                                $(elmList).each(function (i, elm) {
                                    $(m_oParent).append($(elm).clone());
                                });

                                m_objXML = $.parseXML(CFN_XmlToString(m_oParent));
                                insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);

                            }
                        }
                    }
                    //TER CPD, PPD를 위한 금액 특이 조건 check
                    if ((getInfo("fmpf") == "WF_LOREAL_FORM20" && (usdv == "1300" || usdv == "1400")) && ($(m_FixApvLineCTData).find("ETC1CT" + usdv).text() != "" || $(m_FixApvLineCTData).find("ETC2CT" + usdv).text() != "")) {
                        //1조건 외화 혹은 부서장이면  특정인
                        if (SEL_GL1 != null) {
                            //이후창 수정 
                            //TER SEL_GL1재사용일 경우 SEL_GL1 이 SPAN이라 안되는 경우 있음
                            var nSEL_GL1 = "";
                            if (SEL_GL1.tagName == "SPAN") {
                                nSEL_GL1 = SEL_GL1.innerHTML;
                            }
                            else {
                                nSEL_GL1 = SEL_GL1.options[SEL_GL1.selectedIndex].text;
                            }
                            if (nSEL_GL1 == "") {
                                nSEL_GL1 = "KRW";
                            }

                            if (nSEL_GL1 != "KRW" || bManager == "Y") {
                                szCTList = "PERSON_CODE = '" + $(m_FixApvLineCTData).find("ETC1CT" + usdv).text() + "'";
                                m_objXMLMember2 = $.parseXML("<signinform><NewDataSet>" + CFN_XmlToString($(m_objXMLMember).find("Table1[" + szCTList + "]")) + "</NewDataSet></signinform>");
                                m_oMemberXSLProcessor.input = m_objXMLMember2;
                                m_oMemberXSLProcessor.transform();
                                m_objXML = $.parseXML(m_oMemberXSLProcessor.output);

                                m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
                                m_oParent = $(m_XMLDOM).find("selected > user")
                                elmList = $(m_objXML).find("response> addresslist > item");
                                $(elmList).each(function (i, elm) {
                                    $(m_oParent).append($(elm).clone());
                                });

                                m_objXML = $.parseXML(CFN_XmlToString(m_oParent));
                                insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);
                            }

                        }
                        //2조건 krw이거나 부서장이 아니면 특정인
                        if (SEL_GL1 != null) {
                            //이후창 수정 
                            //TER SEL_GL1재사용일 경우 SEL_GL1 이 SPAN이라 안되는 경우 있음
                            var nSEL_GL1 = "";
                            if (SEL_GL1.tagName == "SPAN") {
                                nSEL_GL1 = SEL_GL1.innerHTML;
                            }
                            else {
                                nSEL_GL1 = SEL_GL1.options[SEL_GL1.selectedIndex].text;
                            }

                            if (nSEL_GL1 == "") {
                                nSEL_GL1 = "KRW";
                            }

                            if (nSEL_GL1 == "KRW" || bManager == "N") {
                                szCTList = "PERSON_CODE = '" + $(m_FixApvLineCTData).find("ETC2CT" + usdv).text() + "'";
                                m_objXMLMember = $.parseXML("<signinform><NewDataSet>" + CFN_XmlToString($(m_objXMLMember).find("Table1[" + szCTList + "]")) + "</NewDataSet></signinform>");
                                m_oMemberXSLProcessor.input = m_objXMLMember2;
                                m_oMemberXSLProcessor.transform();
                                m_objXML = $.parseXML(m_oMemberXSLProcessor.output);

                                m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
                                m_oParent = $(m_XMLDOM).find("selected > user")
                                elmList = $(m_objXML).find("response> addresslist > item");
                                $(elmList).each(function (i, elm) {
                                    $(m_oParent).append($(elm).clone());
                                });

                                m_objXML = $.parseXML(CFN_XmlToString(m_oParent));
                                insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);
                            }
                        } else {
                            if (bManager == "Y") {
                                szCTList = "PERSON_CODE = '" + $(m_FixApvLineCTData).find("ETC1CT" + usdv).text() + "'";
                            }
                            else {
                                szCTList = "PERSON_CODE = '" + $(m_FixApvLineCTData).find("ETC2CT" + usdv).text() + "'";
                            }

                            m_objXMLMember2 = $.parseXML("<signinform><NewDataSet>" + CFN_XmlToString($(m_objXMLMember).find("Table1[" + szCTList + "]")) + "</NewDataSet></signinform>");
                            m_oMemberXSLProcessor.input = m_objXMLMember2;
                            m_oMemberXSLProcessor.transform();
                            m_objXML = $.parseXML(m_oMemberXSLProcessor.output);

                            m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
                            m_oParent = $(m_XMLDOM).find("selected > user")
                            elmList = $(m_objXML).find("response> addresslist > item");
                            $(elmList).each(function (i, elm) {
                                $(m_oParent).append($(elm).clone());
                            });

                            m_objXML = $.parseXML(CFN_XmlToString(m_oParent));
                            insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);

                        }
                    }

                }
            }
        }
        //특정 금액
        if (indexCondition != null) {
            if (indexCondition >= 2) {
                if ($(_FixApvLineData).find("Table2").length != null) {
                    var m_objXMLETC;
                    var szXML = "";
                    for (var ii = 2; ii <= indexCondition ; ii++) {
                        try { szXML += CFN_XmlToString((m_FixApvLineData).find("Table" + ii)); } catch (e) { }
                    }
                    m_objXMLETC = $.parseXML("<signinform><NewDataSet>" + szXML + "</NewDataSet></signinform>");

                    //추가(by chlee)
                    m_oMemberXSLProcessor = makeProcessor("../Address/org_memberqueryfixapvline.xsl");
                    m_oMemberXSLProcessor.addParameter("type", "etc");
                    m_oMemberXSLProcessor.input = m_objXMLETC;
                    m_oMemberXSLProcessor.transform();
                    m_objXML = $.parseXML(m_oMemberXSLProcessor.output);
                    m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");
                    m_oParent = $(m_XMLDOM).find("selected > user")
                    elmList = $(m_objXML).find("response > addresslist > item");
                    $(elmList).each(function (i, elm) {
                        if ($(m_oParent).find("item:has(AN = '" + $(elm).find("AN").text() + "')").length == 0) {
                            $(m_oParent).append(elm);
                            //특수조건으로 들어오는 경우 기존의 N+1인 경우 삭제되고 CONTROLLER 다음으로 들어간다.
                            var oStepUser = $(oCurrentOUNode).find("step > ou > person[code = '" + $(elm).find("AN").text() + "'] > taskinfo[kind != 'charge'][status='inactive']");
                            if (oStepUser.length != null) {
                                $(oCurrentOUNode).removeChild($($(oStepUser).parent().parent.parent()).clone());
                            }

                        }
                    });

                    m_objXML = $.parseXML(CFN_XmlToString(m_oParent));

                    insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);
                }
            }
        }
    }

    return CFN_XmlToString(oApvList);
}

function insertToList4ApvLine(oApvList, oCurrentOUNode, oSrcDoc) {
    m_oXSLProcessor.input = chkDuplicateApprover(oSrcDoc, oApvList);
    m_oXSLProcessor.addParameter("steptype", "division");
    m_oXSLProcessor.addParameter("divisiontype", "send");

    m_oXSLProcessor.addParameter("unittype", "person");
    m_oXSLProcessor.addParameter("routetype", "approve");
    m_oXSLProcessor.addParameter("allottype", "serial");
    m_oXSLProcessor.addParameter("referencename", gLabel_approve);
    m_oXSLProcessor.addParameter("childvisible", "");
    m_oXSLProcessor.transform();
    var oTargetDoc = $.parseXML(m_oXSLProcessor.output);

    var oChildren = $(oTargetDoc).find("steps > division > step");
    var xpathCur;
    var oSelectedElm;
    $(oTargetDoc).find("steps > division > step").each(function (x, elm) {
        $(oCurrentOUNode).append($(elm))

    });
}

function chkDuplicateApprover(oSrcDoc, m_oApvList) {
    var oSrcDocList = $(oSrcDoc).find("item");
    var bDelete = false;
    $(oSrcDocList).each(function (i, item) {
        var xPathDelete1 = '';
        var xPathDelete2 = '';
        var xPathDelete3 = '';
        var xPathDelete4 = '';
        xPathDelete1 = "steps > division:has(taskinfo[status='inactive'] > step> ou > person";
        xPathDelete2 = "steps > division:has(taskinfo[status='pending'] > step> ou > person";
        xPathDelete3 = "steps > division:has(taskinfo[status='inactive'] > step> ou > role";
        xPathDelete4 = "steps > division:has(taskinfo[status='pending'] > step> ou > role";
        xPathDelete1 += "[code='" + $(item).find("AN").text() + "'][name='" + $(item).find("DN").text() + "' ]";
        xPathDelete2 += "[code='" + $(item).find("AN").text() + "'][name='" + $(item).find("DN").text() + "' ]";
        xPathDelete3 += "[code='" + $(item).find("AN").text() + "'][name='" + $(item).find("DN").text() + "' ]";
        xPathDelete4 += "[code='" + $(item).find("AN").text() + "'][name='" + $(item).find("DN").text() + "' ]";
        if ($(m_oApvList).find(xPathDelete1, xPathDelete2, xPathDelete3, xPathDelete4).length != 0) {
            $(oSrcDoc).find("items").removeChild(item);
            bDelete = true;
        }
    });
    return oSrcDoc;
}

//담당업무함 지정결재선 셋팅
function setFixApvLineREDRAFT(oApvList, oCurrentOUNode) {
    //m_FixApvLineData ; requester 지정 결재선 정보
    //<NewDataSet>
    //Table : 지정결재선
    //Table1 : controller
    //지정결재선 추가

    m_oXSLProcessor = makeProcessor("../ApvLineMgr/ApvlineGen.xsl");

    var m_objXMLMember = $.parseXML(m_FixApvLineData.xml);

    var m_objXML;
    var m_oMemberXSLProcessor = makeProcessor("../Address/org_memberqueryfixapvline.xsl");
    m_oMemberXSLProcessor.addParameter("type", "fix");
    m_oMemberXSLProcessor.input = m_objXMLMember;
    m_oMemberXSLProcessor.transform();
    m_objXML = $.parseXML(m_oMemberXSLProcessor.output);

    var m_XMLDOM = $.parseXML("<selected><to></to><cc></cc><bcc></bcc><user></user><group></group><role></role></selected>");

    var m_oParent = $(m_XMLDOM).find("selected > user");
    var elmList = $(m_objXML).find("response > addresslist > item");
    $(elmList).each(function (i, elm) {
        $(m_oParent).append(elm);
    });

    m_objXML = $.parseXML(CFN_XmlToString(m_oParent));
    insertToList4ApvLine(oApvList, oCurrentOUNode, m_objXML);

    return CFN_XmlToString(oApvList);
}

//지정결재선 셋팅 끝

//결재문서 PC저장
function PcSave(bmail) {
    // PC저장시 PDF 또는 MHT 선택 (2015-03-06 LJS) 추가
    var FileExt = "pdf";
    if (!bmail) { //메일에서 본문만 넘기기로함 
        var retValue = confirm(Common.GetDic("lbl_apv_fileFormat"));
        if (retValue) FileExt = "pdf";
            //else FileExt = "mht";
        else return false;
    }

    //양식 특정함수 포함된 내역 빼기
    bDisplayOnly = true; SetFileAttaching
    bPresenceView = false;
    initApvList();
    G_displaySpnAttInfo("display");

    //$(".populate_inform").css("display", "none");
    //$(".populate_inform_footer").css("display", "none");
    $("#trAttFileInfo").css("display", "");
    $("#DivFileAttachCtrl").css("display", "none"); // 첨부 파일 영역 보이지 않게
    $("#CommentTable").css("display", "none"); // 덧글 안보이게 
    $(".i-download").hide();

    //for (var i = 0; i < $("[name=WF_COMMENT_modifyRow]").length; i++) ;
    $("[name=WF_COMMENT_modifyRow]").each(function (i) {
        $(this).css("display", 'none');
    });
    $("[name=WF_COMMENT_deleteRow]").each(function (i) {
        $(this).css("display", 'none');
    });

    //$("#divDiplayCooperation").show();
    //if ($("#PlusMinus").val() == "+") {
    //    $('#PlusMinus').trigger("click");
    //}

    //if ($("#PlusMinusCooperationInfo").val() == "+") {
    //	$('#PlusMinusCooperationInfo').trigger("click");
    //}
    //if ($("#PlusMinusSendCC").val() == "+") {
    //	$('#PlusMinusSendCC').trigger("click");
    //}

    if (CFN_GetQueryString("mobileyn") != "Y") {
        SetFileAttaching();
    } 
    else if (CFN_GetQueryString("showattach") == "Y" || CFN_GetQueryString("isDirect") == "Y") {
        SetFileAttaching();
    } 
    
    //  //debugger;
    var sBodyHTML = getBodyHTML();
    if (CFN_GetQueryString("mobileyn") == "Y" && CFN_GetQueryString("showattach") != "Y") {
        return false;
    }
    //$(".populate_inform").css("display", "");
    //$(".populate_inform_footer").css("display", "block");
    $("#trAttFileInfo").css("display", "none");
    if ($('#ATTACH_FILE_INFO').val() != "") $("#DivFileAttachCtrl").css("display", ""); // 첨부파일 보이게
    if (getInfo('Dept_comment') == 'Y')  $("#CommentTable").css("display", ""); // 덧글 보이게 // 덧글옵션 사용할경우에만 보이도록
    $(".i-download").show();

    $("[name=WF_COMMENT_modifyRow]").each(function (i) {
        $(this).css("display", '');
    });
    $("[name=WF_COMMENT_deleteRow]").each(function (i) {
        $(this).css("display", '');
    });



    var sz = "<request><context_body><![CDATA[" + sBodyHTML + "]]></context_body><comment><![CDATA[" + "" + "]]></comment><filename><![CDATA[" + getInfo("DOC_NO") + "]]></filename><fiid>" + getInfo("fiid") + "</fiid><url><![CDATA[" + document.location.protocol + "//" + window.location.host + "]]></url><fmnm><![CDATA[" + getInfo("fmnm") + "]]></fmnm></request>";

    // PC저장시 PDF또는 MHT 선택(2015-03-06 추가 LJS) 추가 - FileExt 파라미터 추가
    document.frPCSAVE.action = "../FileAttach/PCSaveToMHT.aspx?bmail=" + bmail + "&FileExt=" + FileExt; //"../Portal/PCSaveToMHT.aspx";	
    document.frPCSAVE.target = "frAttachFiles";
    document.frPCSAVE.txtHTML.value = sz;
    document.frPCSAVE.submit();
    //다시 올려주기
    bDisplayOnly = false;
    bPresenceView = true;
    G_displaySpnAttInfo(false);
    initApvList();

	// pdf 저장 후 덧글 다시 삭제
    if (getInfo('Dept_comment') == 'Y') $('#CommentTable').show(); else $('#CommentTable').hide();
    
    return false;
}

function getBodyHTML(mode) {

    var sBodyHTML = "<html><head><meta http-equiv='Content-Type' content='text/html; charset=EUC-KR'><style>";
    try {
        var strBodyTable = document.getElementById("bodytable").cloneNode(true);

        // 상단 문서정보, 하단 협조처/참조처 정보 +버튼으로 숨긴 부분 표시 및 버튼 숨기기
        //$(strBodyTable).find('#divCooperationInfo').css('height', "");
        //$(strBodyTable).find('#divSendCC').css('height', "");
        $(strBodyTable).find('#divDiplayCooperation').css('display', "block");
        $(strBodyTable).find(".populate_inform").css("display", "none");
        //$(strBodyTable).find(".populate_inform_footer").css("display", "none");

        // span으로 바뀌지 않은 mField value 처리
        $(strBodyTable).find("input[data-type='mField']").each(function (idx, item) {
            $(item).attr("value", $(item).val());
        });

        if (mode != null && mode == "PUB") {
            //대외공문출력양식 
            $(strBodyTable).html("<div class='draft_page'><span id='editor'>" + $("#bodytable_content").html() + "</span></div>");
            $(strBodyTable).find("#logoTB").attr("style", "display:"); //상단 회사명
            $(strBodyTable).find("#TableBlowCompanyInformation").attr("style", "display:"); //하단 직인란
        } else if (mode == "Print") {

            $(strBodyTable).find("a").each(function () {
                $(this).removeAttr("onclick").removeAttr("href");
            });
            //tr_WF_COMMENT, .btnattachdown .btnattachdel .btnattachadd
            $(strBodyTable).find("#tr_WF_COMMENT").remove();

            $(strBodyTable).find("#btnCooperationView").remove();// 협조처 상세조회
            $(strBodyTable).find("#trAttFileInfoAdd").css('display', "none"); // 추가파일
            $(strBodyTable).find("#btReceiptView").css('display', "none"); // 협조처 참조 ▶ 버튼
            $(strBodyTable).find("#btCCInfoView").css('display', "none"); // 참조처 참조 ▶ 버튼
            $(strBodyTable).find(".btnattachdown, .btnattachdel, .btnattachadd").remove();
            $(strBodyTable).html($("#printdoc").html());
            $(strBodyTable).find("#CommentTable").css('display', "none"); // 양식하단-의견입력
            //$(strBodyTable).find("#Comment_table").css('display', "none");// 양식하단-검토의견
            //$(strBodyTable).find("#Comment_table_exa").css('display', "none");// 양식하단-검토의견
            //$(strBodyTable).find("#div_table").css('display', "none");// 양식하단-발신댓글
            //$(strBodyTable).find("#div_table_REC").css('display', "none");// 양식하단-수신댓글
            $(strBodyTable).find("#DivFileAttachCtrl").css('display', "none");// 
            //TO-DO : 인쇄때 첨부파일 컨트롤 필요하지 않음
            //2019-03-22 BY YJYOO
            $(strBodyTable).find("#divFileControlContainer").remove();
        } else if (mode == "INVEST") {
            $(strBodyTable).find("a").each(function () {
                $(this).removeAttr("onclick").removeAttr("href");
            });
            //tr_WF_COMMENT, .btnattachdown .btnattachdel .btnattachadd
            $(strBodyTable).find("#tr_WF_COMMENT").remove();
            $(strBodyTable).find(".btnattachdown, .btnattachdel, .btnattachadd").remove();
            $(strBodyTable).find("#trAttFileInfo").css('display', "none");  //파일첨부 안보이도록

            $(strBodyTable).find("#btnCooperationView").remove();// 협조처 상세조회
            $(strBodyTable).find("#trAttFileInfoAdd").css('display', "none"); // 추가파일
            $(strBodyTable).find("#btReceiptView").css('display', "none"); // 협조처 참조 ▶ 버튼
            $(strBodyTable).find("#btCCInfoView").css('display', "none"); // 참조처 참조 ▶ 버튼
            $(strBodyTable).find("#CommentTable").css('display', "none"); // 양식하단-의견입력

            $(strBodyTable).find("> div > span").html($("#bodytable_content").html());
            $(strBodyTable).find("#DivFileAttachCtrl").css('display', "none");// 

            try {
                //$(strBodyTable).find("#PlusMinusCooperationInfo").css('display', "none"); // 협조처(+,-버튼 삭제)
                //$(strBodyTable).find("#PlusMinusSendCC").css('display', "none"); // 참조처(+,-버튼 삭제)
                //$(strBodyTable).find("#PlusMinus").css('display', "none"); // 문서정보(+,-버튼 삭제)
                //$(strBodyTable).find("#divCooperationInfo").css('height', ""); // 양식하단-의견입력
                //$(strBodyTable).find("#divSendCC").css('height', ""); // 양식하단-의견입력
                //$(strBodyTable).find("#divSendCC").removeClass('overflow-y'); // 양식하단-의견입력
                //$(strBodyTable).find("#divDiplayCooperation").css('display', "block"); // 양식하단-의견입력
                $(strBodyTable).find("#spDiplayTitle").css('display', "none"); // 양식하단-의견입력 
                $(strBodyTable).find("#tbLinkInfo").css('display', "none");

                $(strBodyTable).find("#Comment_table_ctrldept").css('display', "none"); // 
                $(strBodyTable).find("#Comment_table_spec").css('display', "none"); // 프로젝트코드
                $(strBodyTable).find("#Comment_table_opinion").css('display', "none"); // 프로젝트코드
                $(strBodyTable).find("#Comment_table_exa").css('display', "none"); // 프로젝트코드
                $(strBodyTable).find("#Comment_table").css('display', "none"); // 프로젝트코드
                $(strBodyTable).find("#Comment_table_REC").css('display', "none"); // 프로젝트코드
                $(strBodyTable).find("#div_table").css('display', "none"); // 프로젝트코드
                $(strBodyTable).find("#trInvestEF").css('display', "none"); // 프로젝트코드
                $(strBodyTable).find("#trBugetCtrlYn").css('display', "none"); // 문서구분

                //================== 프로젝트 집행 ========================
                if (getInfo("fmpf") == "GWOK_PINVEST_W02") {
                    $(strBodyTable).find("#tblTotalApprove").css('display', "none"); // ■ 승인요청금액
                    $(strBodyTable).find("#tbtd_tbl").css('display', "none"); // 예산번호리스트
                    $(strBodyTable).find("#pPrint01").css('display', "none"); // 투자효과
                    $(strBodyTable).find("#tblExecDay").css('display', "none"); // 집행일정
                    $(strBodyTable).find("#pPrint02").css('display', "none"); // 생산공장
                    $(strBodyTable).find("#divSecurityInfo").css('display', "none"); // 보안점검
                    $(strBodyTable).find("#pPrint03").css('display', "none"); // 총괄부서
                    $(strBodyTable).find("#pPrint04").css('display', "none"); // 프로젝트코드
                    $(strBodyTable).find("#pPrint05").css('display', "none"); // 참조프로젝트코드
                    $(strBodyTable).find("#pPrint06").css('display', "none"); // 기품ㅇ의금액
                    $(strBodyTable).find("#trBugetCtrlYn").css('display', "none"); // 문서구분
                    $(strBodyTable).find("#pPrint07").css('display', "none"); // 투자개요
                    $(strBodyTable).find("#pPrint08").css('display', "none"); // 결재의견
                }
                //================== 프로젝트 집행 ========================
                //================== 해외공장 집행 ========================
                if (getInfo("fmpf") == "GWOK_INVEST_W03") {
                    $(strBodyTable).find("#Mandatory01").css("width", "21.75%");
                    $(strBodyTable).find("#Mandatory02").css("width", "20%");
                    $(strBodyTable).find("#Mandatory03").css("display", "");
                    $(strBodyTable).find("#Mandatory04").css("display", "");
                    $(strBodyTable).find("#Mandatory05").css("display", "");
                    $(strBodyTable).find("#Mandatory06").css("display", "");
                    $(strBodyTable).find("#Mandatory07").css("display", "");
                    $(strBodyTable).find("#Mandatory08").css("display", "");
                    $(strBodyTable).find("#Mandatory09").css("display", "");
                    $(strBodyTable).find("#Mandatory10").css("display", "");
                    $(strBodyTable).find("#Mandatory11").css("display", "");
                    $(strBodyTable).find("#pPrint01").css('display', "none"); // 문서구분
                    $(strBodyTable).find("#pPrint02").css('display', "none"); // 총괄부서
                    $(strBodyTable).find("#pPrint03").css('display', "none"); // 결재의견
                    $(strBodyTable).find("#pPrint04").css('display', "none"); // 투자개요
                }
                //================== 해외공장 집행 ========================
            	//================== 일반투자 집행 ======================== HMB 투자품의
                if (getInfo("fmpf") == "GWOK_INVEST_W01" || getInfo("fmpf") == "GWOK_OVERSEA_INVST_W01_KMI" || getInfo("fmpf") == "GWOK_OVERSEA_INVST_W01_HMI" || getInfo("fmpf") == "GWOK_OVERSEA_INVST_W01_HMB"
                    || getInfo("fmpf") == "GWOK_OVERSEA_INVST_W01_HMMR" || getInfo("fmpf") == "GWOK_OVERSEA_INVST_W01_HAOS" || getInfo("fmpf") == "GWOK_OVERSEA_INVST_W01_HMMC") {
                    $(strBodyTable).find("#Mandatory01").css("width", "21.75%");
                    $(strBodyTable).find("#Mandatory02").css("width", "20%");
                    $(strBodyTable).find("#Mandatory03").css("display", "");
                    $(strBodyTable).find("#Mandatory04").css("display", "");
                    $(strBodyTable).find("#Mandatory05").css("display", "");
                    $(strBodyTable).find("#Mandatory06").css("display", "");
                    $(strBodyTable).find("#Mandatory07").css("display", "");
                    $(strBodyTable).find("#Mandatory08").css("display", "");
                    $(strBodyTable).find("#Mandatory09").css("display", "");
                    $(strBodyTable).find("#Mandatory10").css("display", "");
                    $(strBodyTable).find("#Mandatory11").css("display", "");
                    $(strBodyTable).find("#print01").css('display', "none"); // ■ 승인요청금액
                    $(strBodyTable).find("#tbtd_tbl").css('display', "none"); // 예산번호리스트
                    $(strBodyTable).find("#print02").css('display', "none"); // 예산번호리스트
                    $(strBodyTable).find("#divSecurityInfo").css('display', "none"); // 보안점검
                    $(strBodyTable).find("#tblExecDay").css('display', "none"); // 예산번호리스트
                    $(strBodyTable).find("#print03").css('display', "none"); // 예산번호리스트
                    $(strBodyTable).find("#print04").css('display', "none"); // 총괄부서
                    $(strBodyTable).find("#print05").css('display', "none"); // 프로젝트코드
                    $(strBodyTable).find("#print06").css('display', "none"); // 총괄부서
                    $(strBodyTable).find("#print07").css('display', "none"); // 프로젝트코드
                }
                //================== 일반투자 집행 ========================
                $(strBodyTable).find("#Mandatory12").html(Common.GetDic("lbl_apv_DistributeDate_Invest2"));//협조처<br>배포일
                $(strBodyTable).find("#spanPDEPT").html(Common.GetDic("lbl_apv_DistributeDate_Invest3"));//Common.GetDic("lbl_Invest_Inform37")

                // 협조처 다시 생성
                $(strBodyTable).find("#RecLine")[0].innerHTML = initConsultList_INVEST();// 협조처 다시 생성

                //부회장 찍기
                $(strBodyTable).find("#AppLine").find("table > tbody > tr > th").each(function (i) {
                    if (i == 7) {
                        $(this)[0].innerText = "수석부회장";
                    }
                });

            } catch (e) { }

            //버튼처리
            $(strBodyTable).find(" button[class='c-button c-button--little']").each(function () {
                if ($(this).css("display") != "none") {
                    $(this).hide();
                }
            });
        } else {
            $(strBodyTable).find("a").each(function () {
                $(this).removeAttr("onclick").removeAttr("href");
            });
            //tr_WF_COMMENT, .btnattachdown .btnattachdel .btnattachadd
            $(strBodyTable).find("#tr_WF_COMMENT").remove();
            $(strBodyTable).find(".btnattachdown, .btnattachdel, .btnattachadd").remove();

            if ($("#AttFileInfo").text() != "") {
                //$(strBodyTable).find("#tbLinkInfo").css('display', "");
                $(strBodyTable).find("#trAttFileInfo").css('display', "");
                $(strBodyTable).find("#tbLinkInfo").css('display', "");
                $(strBodyTable).find("#TIT_ATTFILEINFO").find("img").remove();
                $(strBodyTable).find("#AttFileInfo").find("p").css("margin", "0px");
            }
            else {
                //$(strBodyTable).find("#tbLinkInfo").css('display', "");
                $(strBodyTable).find("#trAttFileInfo").css('display', "none");
                $(strBodyTable).find("#tbLinkInfo").css('display', "none");
            }

            $(strBodyTable).find("#btnCooperationView").remove();// 협조처 상세조회
            $(strBodyTable).find("#trAttFileInfoAdd").css('display', "none"); // 추가파일
            $(strBodyTable).find("#btReceiptView").css('display', "none"); // 협조처 참조 ▶ 버튼
            $(strBodyTable).find("#btCCInfoView").css('display', "none"); // 참조처 참조 ▶ 버튼
            $(strBodyTable).find("#CommentTable").css('display', "none"); // 양식하단-의견입력

            //$(strBodyTable).find("#Comment_table").css('display', "none");// 양식하단-검토의견
            //$(strBodyTable).find("#Comment_table_exa").css('display', "none");// 양식하단-검토의견
            //$(strBodyTable).find("#div_table").css('display', "none");// 양식하단-발신댓글
            //$(strBodyTable).find("#div_table_REC").css('display', "none");// 양식하단-수신댓글
            $(strBodyTable).find("> div > span").html($("#bodytable_content").html());
            $(strBodyTable).find("#DivFileAttachCtrl").css('display', "none");// 

            try {
                //$(strBodyTable).find("#PlusMinusCooperationInfo").css('display', "none"); // 협조처(+,-버튼 삭제)
                //$(strBodyTable).find("#PlusMinusSendCC").css('display', "none"); // 참조처(+,-버튼 삭제)
                //$(strBodyTable).find("#PlusMinus").css('display', "none"); // 문서정보(+,-버튼 삭제)
                //$(strBodyTable).find("#divCooperationInfo").css('height', ""); // 양식하단-의견입력
                //$(strBodyTable).find("#divSendCC").css('height', ""); // 양식하단-의견입력
                //$(strBodyTable).find("#divSendCC").removeClass('overflow-y'); // 양식하단-의견입력
                //$(strBodyTable).find("#divDiplayCooperation").css('display', "block"); // 양식하단-의견입력
                $(strBodyTable).find("#spDiplayTitle").css('display', "none"); // 양식하단-의견입력
            } catch (e) { }

            //버튼처리
            $(strBodyTable).find(" button[class='c-button c-button--little']").each(function () {
                if ($(this).css("display") != "none") {
                    $(this).hide();
                }
            });

            // 인쇄시 숨길 필드
            $(strBodyTable).find(".print-hide").hide();
            $(strBodyTable).find(".print-colspan").attr("colspan", $(".print-colspan").attr("colValue"));

            //TO-DO : 인쇄때 첨부파일 컨트롤 필요하지 않음
            //2019-03-22 BY YJYOO
            $(strBodyTable).find("#divFileControlContainer").remove();
        }
        for (var i = 0; i < document.styleSheets.length; i++) {
            if (document.styleSheets[i].href != null && (document.styleSheets[i].href.indexOf('common') > -1 || document.styleSheets[i].href.indexOf('pages') > -1 || document.styleSheets[i].href.indexOf('approval_form') > -1)) {
                //if ($.browser.msie == true && parseFloat($.browser.version) <= 8) //ie8 이하일때
                if (_ie)
                    sBodyHTML += getStyle(document.styleSheets[i].href, i);
                else
                    sBodyHTML += getStyleChrome(document.styleSheets[i]);
            }
        }
        if (Common.GetSession("DN_Code") == "K301") {
        	// KMM은 모든양식 프린트시 RESTRICTED 문구 추가
            $(strBodyTable).prepend("<p style='border:2px solid #F00;text-align:center;font-size:16px;margin:0px 0px 4px 0px;padding:4px 8px;color:#F00;float:left;'><em style='font-style:normal;font-weight:bold;'>RESTRICTED</em></p>");

			// 인쇄시 단어가 개행에 걸리지 않도록(공통영역)
            switch (getInfo("fmpf")) {
            	case "GWOE_COOPER_CL_W01":
            		$(strBodyTable).find("#ReceiveDate").closest("table").find("colgroup:eq(0)").html('<col style="width:11.5%;"/><col style="width:28.5%"/><col style="width:10%;"/><col style="width:20%"/><col style="width:10%;"/><col style="width:20%"/>');
            	case "GWOK_GENERAL":
            	case "WF_KMM_FI_PROVISION":
            	case "WF_KMM_FI_BUDGET":
            	case "WF_KMM_GA_RIDAC":
            	case "GWOK_WORKINGBUDGET_W01_KMM":
            	case "WF_KMM_FI_PURCHASE":
            		$(strBodyTable).find("#INITIATOR_DP").closest("table").find("colgroup:eq(0)").html('<col style="width:11.5%;"/><col style="width:38.5%"/><col style="width:11.5%;"/><col style="width:38.5%"/>');
            		$(strBodyTable).find("#SUBJECT").closest("table").find("colgroup:eq(0)").html('<col style="width:11.5%;"/><col style="width:88.5%"/>');
            		break;
            }
        	// 인쇄시 단어가 개행에 걸리지 않도록(양식별영역)
            if (getInfo("fmpf") == "GWOK_WORKINGBUDGET_W01_KMM") {
                $(strBodyTable).find("#multi02").attr("width", "5.5%");
                $(strBodyTable).find("#multi03").attr("width", "7%");
                $(strBodyTable).find("#multi04").attr("width", "12%");
                $(strBodyTable).find("#multi05").attr("width", "4%");
                $(strBodyTable).find("#multi09").attr("width", "6.5%");
                $(strBodyTable).find("#multi10").attr("width", "1%");
                $(strBodyTable).find("#multi11").attr("width", "1%");
                $(strBodyTable).find("#multi12").attr("width", "9%");
                $(strBodyTable).find("#multi13").attr("width", "9%");
            }
            else if (getInfo("fmpf") == "WF_KMM_FI_PURCHASE")
            {
                $(strBodyTable).find("#multi02").css("width", "10%");
                $(strBodyTable).find("#multi04").css("width", "10%");
                $(strBodyTable).find("#multi09").css("width", "8%");
                $(strBodyTable).find("#multi10").css("width", "8%");
                $(strBodyTable).find("#multi11").css("width", "8%");
                $(strBodyTable).find("#multi12").css("width", "8%");
                $(strBodyTable).find("#investment").css("padding-left", "");
            }
        }
        else if (Common.GetSession("DN_Code") == "H139" || Common.GetSession("DN_Code") == "H147") { //통합 결재 및 레거시 연동 IMG 태그 별도 처리 - 현대 건설, 현대 엔지니어링
            if (formJson.BODY_CONTEXT != undefined) {

                if (formJson.BODY_CONTEXT.BODY_IMGS != null && formJson.BODY_CONTEXT.BODY_IMGS != undefined) {
                    if (formJson.BODY_CONTEXT.BODY_IMGS.BODY_IMG != undefined) {
                        var arrImage = (formJson.BODY_CONTEXT.BODY_IMGS.BODY_IMG instanceof Array) ? formJson.BODY_CONTEXT.BODY_IMGS.BODY_IMG : [formJson.BODY_CONTEXT.BODY_IMGS.BODY_IMG];
                        var imgTotalPage = arrImage.length;

                        $(strBodyTable).find("#doc_body_images_paging").remove();
                        $(strBodyTable).find("#doc_body_images").empty();

                        //인쇄 시 후면 용지 빈 페이지 제거를 위해 필요
                        if ($(strBodyTable).find("#tbContentElement") != undefined) {
                            $(strBodyTable).find(".table_form_info_draft").remove();
                        }

                        var renderHtml = "";
                        for (var i = 0; i < imgTotalPage; i++) {
                            
                            if (typeof arrImage[i].img["@src"] == "undefined") {
                                var imgSrc = arrImage[i].img["src"];
                            }
                            else {
                                var imgSrc = arrImage[i].img["@src"];
                            }

                            if (typeof arrImage[i].img["@style"] == "undefined") {
                                var imgStyle = arrImage[i].img["style"];
                            }
                            else {
                                var imgStyle = arrImage[i].img["@style"];
                            }

                            renderHtml += "<div>";
                            renderHtml += "<img src='" + imgSrc + "' style='" + imgStyle + "'/>";
                            renderHtml += "</div>";
                        }

                        $(strBodyTable).find("#doc_body_images").html(renderHtml);
                    }                    
                }

                // 본문 태그
                if (formJson.BODY_CONTEXT.BODY_HTML != null && formJson.BODY_CONTEXT.BODY_HTML.length > 0) {
                    $(strBodyTable).find("#doc_body_html").removeClass("doc_body1");
                    $(strBodyTable).find("#doc_body_sub_html").removeClass("doc_body_sub1");  
            
                    $(strBodyTable).find("#doc_body_sub_html").css("width", ""); // 본문 가로사이즈 초기화

                    $(strBodyTable).find("#doc_body_html").css('display', 'flex');
                    $(strBodyTable).find("#doc_body_html").css('justify-content', 'center');
                    $(strBodyTable).find("#doc_body_html").css('align-items', 'center');


                }
            }
        	if (getInfo("fmpf") == "WF_HEC_PC_INTRODUCTION" || getInfo("fmpf") == "WF_HEC_IT_INTRODUCTION") {
                $(strBodyTable).find("[id^='TB_TYPE_']").show();
            }
        }


    } catch (e) { alert(e.description); }
    sBodyHTML += "</style></head><body topmargin='0' leftmargin='0' scroll='auto' align='center' class='approval_form'>" + strBodyTable.innerHTML + "</body></html>";

    return sBodyHTML;
}

//ie8을 제외한 ie9, ie10, chrome등에서 현재페이지에서 사용하는 스타일 가져오기 
function getStyleChrome(sheet) {

    var style = "";
    var rules = sheet.rules || sheet.cssRules;
    for (var r = 0; r < rules.length; r++) {
        style += rules[r].cssText;
    }
    return style;
}

function getStyle(sURL, index) {
    var objStyle = "";
    if (document.styleSheets[index].cssText != null) {
        objStyle += document.styleSheets[index].cssText
    }
    return objStyle.replace("undefined", "");
}

//합의부서 시작
function requestProcessDCooAbort(szOUs) {
    try {
        var sTargetURL = "/Approval/InstMgr/DeleteAssistOUs.aspx";
        var sText = "<request>" + getDefaultXML() + szOUs + "</request>";
        evalXML(sText);
        CFN_CallAjax(sTargetURL, sText, function (data) {
            receiveGeneralQuery(data);
            fnformmenuCallBack(gMessage170);
        }, true, "xml");
    } catch (e) {
        alert(gMessage73 + "\n" + e.description + "\nError number: " + e.number); //sMsgTitle+"하지 못했습니다.
    }
}

/* 날짜 가감 함수 
사용예 : 2009-01-01 에 3 일 더하기 ==> addDate("d", 3, "2009-01-01", "-");*/
function addDate(pInterval, pAddVal, pYyyymmdd, pDelimiter) {
    var yyyy;
    var mm;
    var dd;
    var cDate;
    var oDate;
    var cYear, cMonth, cDay;

    if (pDelimiter != "") {
        pYyyymmdd = pYyyymmdd.replace(eval("/\\" + pDelimiter + "/g"), "");
    }

    yyyy = pYyyymmdd.substr(0, 4);
    mm = pYyyymmdd.substr(4, 2);
    dd = pYyyymmdd.substr(6, 2);

    if (pInterval == "yyyy") {
        yyyy = (yyyy * 1) + (pAddVal * 1);
    } else if (pInterval == "m") {
        mm = (mm * 1) + (pAddVal * 1);
    } else if (pInterval == "d") {
        dd = (dd * 1) + (pAddVal * 1);
    }

    cDate = new Date(yyyy, mm - 1, dd) // 12월, 31일을 초과하는 입력값에 대해 자동으로 계산된 날짜가 만들어짐.
    cYear = cDate.getFullYear();
    cMonth = cDate.getMonth() + 1;
    cDay = cDate.getDate();

    cMonth = cMonth < 10 ? "0" + cMonth : cMonth;
    cDay = cDay < 10 ? "0" + cDay : cDay;

    if (pDelimiter != "") {
        return cYear + pDelimiter + cMonth + pDelimiter + cDay;
    } else {
        return cYear + cMonth + cDay;
    }
}
/*지정 반송 check*/
function fn_checkrejectedtoA() {
    if (getInfo("pfsk") == "T000") {
        var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
        var elmRoot = $(m_oApvList).find("steps");

        var oApprovedSteps;
        if (getInfo("mode") == "RECAPPROVAL") {
            oApprovedSteps = $(elmRoot).find("division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='completed'][kind!='charge'],division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > role > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='completed'][kind!='charge'] ");
        } else if (getInfo("mode") == "SUBAPPROVAL") { ///ou[taskinfo/@status='pending']/person[taskinfo/@kind='normal' and taskinfo/@status='inactive']
            oApprovedSteps = $(elmRoot).find("division:has(taskinfo[status='pending']) > step:has(taskinfo[status='pending']) > ou:has(taskinfo[status='pending'][piid='" + getInfo("piid").toUpperCase() + "']) > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][kind!='conveyance'][status='completed']");
        } else {
            oApprovedSteps = $(elmRoot).find("division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > person > taskinfo[kind!='charge'][kind!='review'][kind!='bypass'][kind!='skip'][status='completed']");
        }

        if (getInfo("scRJTO") == "1" && getInfo("scRJTOV") != "") {
            var iRJCnt = 0;
            var oRJSteps;
            if (getInfo("mode") == "RECAPPROVAL") {
                oRJSteps = $(elmRoot).find("division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > person > taskinfo[@rejectee='y']");
            } else if (getInfo("mode") == "SUBAPPROVAL") {
                oRJSteps = $(elmRoot).find("division:has(taskinfo[status='pending']) > step[routetype='consult'] > ou:has(taskinfo[status='pending'][piid='" + getInfo("piid").toUpperCase() + "']) > person > taskinfo[rejectee='y'],division:has(taskinfo[status='pending']) > step[routetype='consult'] > ou:has(taskinfo[status='pending'][piid='" + getInfo("piid").toUpperCase() + "']) > role > taskinfo[rejectee='y']");
            } else {
                oRJSteps = $(elmRoot).find("division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > person > taskinfo[rejectee='y'], division:has(taskinfo[status='pending']) > step[routetype='approve'] > ou > role > taskinfo[rejectee='y']");
            }

            iRJCnt = oRJSteps.length;
            if (iRJCnt >= parseInt(getInfo("scRJTOV"))) {
                return false;
            }
        }
        if (oApprovedSteps.length == 0) {
            return false;
        } else {
            var iApvCNT = 0;
            var szCode = "";
            var szName = "";
            $(oApprovedSteps).each(function (i, oTaskInfo) {
                var oStep = oTaskInfo.parentNode.parentNode.parentNode;
                if ($(oStep).attr("allottype") != "parallel") {
                    if ($(oTaskInfo).attr("rejectee") != 'y') {
                        iApvCNT++;
                        szCode = $(oTaskInfo).attr("wiid");
                    }
                }
            });
            if (iApvCNT > 0) {
                return true;
            } else {
                return false;
            }
        }
    } else {
        return false;
    }
}
function getLngLabel(szLngLabel, szType, szSplit) {
    var rtnValue = "";
    if (szSplit != null && szSplit != undefined) {
        var ary = szLngLabel.split(";");
        if (szSplit) { ary = szLngLabel.split(szSplit); }
        var sValue02 = "";
        for (var i = 0; i < ary.length; i++) {
            sValue02 = sValue02 + ary[i] + ";";
        }
        if (szType) {
            sValue02 = szLngLabel.substring(sValue.indexOf(";") + 1);
        }
        //TO-DO : 다국어 방식 변경에 따른 호출 함수변경
        //2017-04-24 BY YJYOO
        //return XFN_GetDicInfo(sValue02);
        return CFN_GetDicDatas(sValue02);
    } else {
        var sValue02 = szLngLabel;
        if (szType) {
            sValue02 = szLngLabel.substring(szLngLabel.indexOf(";") + 1);
        }
        //TO-DO : 다국어 방식 변경에 따른 호출 함수변경
        //2017-04-24 BY YJYOO
        //return XFN_GetDicInfo(sValue02);
        return CFN_GetDicDatas(sValue02);
    }
}
/*feedback 추가*/
function chk_feedback_onclick() {
    document.getElementById("chk_feedback").checked = (document.getElementById("chk_feedback").checked == true) ? false : true;
    document.getElementById("chk_feedback").value = (document.getElementById("chk_feedback").checked == true) ? "1" : "0";
    document.getElementById("DOC_SUMMARY").value = "feedback:" + document.getElementById("chk_feedback").value + "@" + document.getElementById("selfeedback").value;
}
function selfeedback_onchange(value) {
    document.getElementById("DOC_SUMMARY").value = "feedback:" + document.getElementById("chk_feedback").value + "@" + value;
}

/*새창으로 띄우기*/
function openNewFormWindow() {
    var sSize = "scroll"; var iWidth = 790; var iHeight = window.screen.availHeight - 100; //sUrl="PreView.aspx";
    var sUrl = String(document.location.href);
    sUrl = sUrl.replace("FormWrite", "Form"); //바닥 작성창에서 Open할 경우
    sUrl = sUrl.replace("openMode=L", "openMode=W"); //
    sUrl = sUrl.replace("openMode=P", "openMode=W"); //
    if (sUrl.lastIndexOf("#") == (sUrl.length - 1)) { sUrl = sUrl.substring(0, sUrl.lastIndexOf("#")); } //url에 #이 포함되어 있음 제거처리

    //신세계 Layer 수정 적용
    //2016-06-08
    //YJYOO
    //if (sUrl.lastIndexOf("openMode=") == -1) { sUrl = sUrl + "&openMode=W"; }
    //sUrl = sUrl + "&Readtype=openwindow";
    //CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);  //윈도우팝업창으로 띄울것이므로 현재창에서 바로띄움(HIW)

    if (sUrl.lastIndexOf("openMode=") == -1) { sUrl = sUrl + "&openMode=B"; }
    var mode = CFN_GetQueryString("mode");
    if (mode == "DRAFT") {
        Common.Confirm(Common.GetDic("msg_Mail_WritingContentsMayDeleted"), 'Confirmation Dialog', function (result) {
            if (result) {
                CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);  //윈도우팝업창으로 띄울것이므로 현재창에서 바로띄움(HIW)
            } else {
                self.close();
            }
        });
    } else {
        CFN_OpenWindow(sUrl, "", iWidth, iHeight, sSize);
    }
}

//InkComment 관련 전역변수
var igApvActBasicCnt = 0;
var objWriteRun = null;
var objViewRun = null;

function print_part(frame) {

    if (AUTO_OBJECT == 2) { objectRun(); }

    try {
        Printmade.Run(DEFAULT_OPTION + " /fid:'" + frame + "'");
    }
    catch (e) {
        alert(ERR_MSG);
    }

}

//2012.02.13 즐겨찾기 버튼 저장 이벤트 추가 시작
function favorform(szmode) {
    var sItems = "<request>";
    sItems += "<mode>" + szmode + "</mode>"; //worktiem 삭제 처리
    sItems += "<usid>" + getInfo("usid") + "</usid>";
    sItems += "<fmid>" + getInfo("fmid") + "</fmid>";
    var sUrl = "/Approval/Forms/favorform.aspx";
    sItems += "</request>";


    CFN_CallAjax(sUrl, sItems, function (data) {
        receiveGeneralQuery_favorform(data);
    }, true, "xml");

}

function receiveGeneralQuery_favorform(dataresponseXML) {
    var xmlReturn = dataresponseXML;
    var errorNode = $(xmlReturn).find("response > error");
    if (errorNode.length > 0) {
        Common.Error("Desc: " + $(errorNode).text());
        return;
    }
    else {
        display_favoritBtn();
        //Common.Inform(Common.GetDic("msg_117"), 'Information Dialog', function (result) {//성공적으로 저장되었습니다.....
        //    display_favoritBtn();
        //});
    }
}

function display_favoritBtn() {
    var sItems = "<request>";
    sItems += "<usid>" + getInfo("usid") + "</usid>";
    var sUrl = "/Approval/Forms/favorform_view.aspx";
    sItems += "</request>";

    CFN_CallAjax(sUrl, sItems, function (data) {
        receivefavorform_view(data);
    }, true, "xml");
}

function receivefavorform_view(dataresponseXML) {
    var xmlReturn = dataresponseXML;
    var errorNode = $(xmlReturn).find("response > strFMID");

    //2012.02.03 즐겨찾기 버튼 (비)활성화 추가 시작
    var szfmid = null;
    var bExist = false;
    szfmid = getInfo("fmid");


    if (errorNode.length == 0) {
        bExist = false;

    } else {
        var favor_value = errorNode.text().split("^");
        for (var i = 0; i < favor_value.length; i++) {
            if (szfmid == favor_value[i])
                bExist = true;
        }
    }

    //if (bExist) {
    //    document.getElementById("favorformadd").style.display = "none";
    //    document.getElementById("favorformdelete").style.display = "";
    //} else {
    //    document.getElementById("favorformadd").style.display = "";
    //    document.getElementById("favorformdelete").style.display = "none";
    //}
    //2012.02.03 즐겨찾기 버튼 (비)활성화 추가 끝	
}
//2012.02.13 즐겨찾기 버튼 이벤트 추가 끝

//결재하기 창을 보여 줄지 말지 확인
var sSingimg = "";
function openApvActBasic(sAction) {

    var _return = false;
    return true;

    var connectionname = "Common";
    var pXML = "GET_PERSONSETTING";
    var aXML = "<param><name>PERSON_CODE</name><type>varchar</type><length>50</length><value><![CDATA[" + getInfo("usid") + "]]></value></param>";
    var sXML = "<Items><connectionname>" + connectionname + "</connectionname><xslpath></xslpath><sql><![CDATA[" + pXML + "]]></sql><type>sp</type>" + aXML + "</Items>";
    var szURL = "/Approval/GetXMLQuery.aspx";
    var bActMSS = "N";
    var bIsPWD = "N";
    CFN_CallAjax(szURL, sXML, function (data) {
        var xmlReturn = data;
        var errorNode = $(xmlReturn).find("error");
        if (errorNode.length > 0) {
            Common.Error("Desc: " + $(errorNode).text());
        } else {
            bActMSS = $(xmlReturn).find("Table").find("ACT_MESSAGE_BOX_VIEW").text();
            bIsPWD = $(xmlReturn).find("Table").find("APPROVAL_PWD_IS_USE").text();
            sSingimg = $(xmlReturn).find("Table1").find("FILE_NAME").text();
        }
    }, false, "xml");

    //1. [환경 설정]에 "결재시 확인팝업"이 "Y" 무조건 뜸
    if (bActMSS == "Y") {
        _return = true;
    }

    //2. 결재비밀번호 입력 설정된 경우 뜸
    if (bIsPWD == "Y") {
        _return = true;
    }

    //3. 최종결재자일경우 : 지시사항을 입력받기 위해 무조건 뜸
    if (getIsLast() == "true") {
        _return = true;
    }

    //4. 서명이 2개 이상인  사용자일 경우 뜸

    return _return;
}

function popupGovStampSelectList() {
    /// <summary>전자 문서 직인 선택 팝업 추가 (2013-02-26 임현섭)</summary>
    var vRetval = "";

    var stampParams = new Array();
    stampParams["ent_code"] = getInfo("ENT_CODE");
    stampParams["objMessage"] = window;

    var szFont = "FONT-FAMILY: '굴림';font-size:9px;";
    var nWidth = 400;
    var nHeight = 300;
    var pWidth = (screen.availWidth - nWidth) / 2;  //lka ff에서 popup창 가운데 정렬 위하여 추가
    var pHeight = (screen.availHeight - nHeight) / 2;  //lka ff에서 popup창 가운데 정렬 위하여 추가

    // 양식 dField : StampID
    var dFStampID = "";
    if (getInfo("STAMPID") != undefined) {
        dFStampID = getInfo("STAMPID");
    }

    vRetval = window.showModalDialog("popupStampSelectList.aspx?entcd=" + getInfo("ENT_CODE") + "&fiid=" + getInfo("fiid") + "&fitn=" + getInfo("fitn") + "&dFStampID=" + dFStampID, stampParams, szFont + "dialogHeight:" + nHeight + "px;dialogWidth:" + nWidth + "px;dialogLeft:" + pWidth + "px;dialogTop:" + pHeight + "px;status:no;resizable:no;help:no;");
    return vRetval;
}

//2013.12.26 메일보내기 추가
function SendMailInBody() {
    //ToggleLoadingImage();
    //TO-DO : 기존의 결재문서 PDF생성 후 PDF 를 첨부한 메일 창을 Link 주소 첨부한 메일창으로 변경
    //PcSave(true);
    CallBackSendMailInBody(null);
}
//2013.12.26 메일보내기 추가
function CallBackSendMailInBody(strMailPDFInfo) {
    var sSubject = getInfo("SUBJECT"); // 제목 원본
    //var strSubject = "테스트입니다."; // 제목 테스트용
    if (sSubject == 'undefined') {
        sSubject = getInfo('fnmn');
    }

    var l_editor = "#editor";
    var strHTML = "";
    strHTML += "<link type='text/css' rel='stylesheet' href='/Images/css/approval_form.css' />"
    strHTML += $(l_editor).html();

    var strFileinfo = document.getElementById("ATTACH_FILE_INFO").value;
    if (strFileinfo != "") {
        strFileinfo = AttachFileBody(strFileinfo);
    }
    var sLINKUrl = parent.window.location.href;
    //var bReturn = false;
    //window.clipboardData.clearData("Text");
    //bReturn = window.clipboardData.setData("Text", sLINKUrl);
    //ToggleLoadingImage();
    //XFN_PopupMailWrite("MailWirtePop", "APPROVAL", "", "", "", strSubject, "", "HTML", strMailPDFInfo + strFileinfo);

    var sMailType = '';
    var TotalMsg = '';
    sbLinkURL = '';
    if (getInfo("mode") == "TEMPSAVE") {

        sbLinkURL = document.location.protocol + "//" + _WebServerDomain + "/Approval/Forms/Form.aspx";
        sbLinkURL += "?mode=" + getInfo('mode');
        sbLinkURL += "&fmid=" + getInfo('fmid');
        sbLinkURL += "&fiid=" + getInfo('fiid');
        sbLinkURL += "&ftid=" + getInfo('ftid');
    }
    else {
        sbLinkURL = document.location.protocol + "//" + _WebServerDomain + "/Approval/Forms/Form.aspx";
        sbLinkURL += "?processInstanceId=" + getInfo('piid');
        sbLinkURL += "&parentProcessInstanceId=" + getInfo('piid_parent');
        sbLinkURL += "&processCode=" + getInfo('pdef');
    }

    //TotalMsg = String.format(Common.GetDic("msg_alram_BODY_COMPLETE_EMAIL"), "<a style='text-decoration: none; display: block; cursor: pointer;' href='" + sbLinkURL + "'>", "</a>");
    TotalMsg = String.format(Common.GetDic("msg_alram_BODY_COMPLETE_EMAIL"), "<a href='" + sbLinkURL + "'>", "</a><br />");

    switch (getInfo('loct')) {
        case "COMPLETE":
            {
                sMailType = "<" + Common.GetDic("lbl_apv_ApprovalDoc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재문서
                break;
            }
        case "REJECT":
            {
                sMailType = "<" + Common.GetDic("lbl_apv_reject_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재반송
                break;
            }
        case "TEMPSAVE":
            {
                sMailType = "<" + Common.GetDic("lbl_review2") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//검토요청
                break;
            }
        default:
            {
                sMailType = "<" + Common.GetDic("MN_1780") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject; //결재진행
            }
    }
    //switch (getInfo('mode')) {
    //    //switch (getInfo('loct')) { //별도보고때문에 변경
    //    case "APPROVAL":
    //        {
    //            sMailType = "<" + Common.GetDic("MN_1780") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject; //결재진행
    //            break;
    //        }
    //    case "CHARGEJOB":
    //    case "REDRAFT":
    //        {
    //            sMailType = "<" + Common.GetDic("MN_1780") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject; //결재진행
    //            break;
    //        }
    //    case "CHARGE":
    //    case "REDRAFT_RE":
    //    case "COMPLETE":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_ApprovalDoc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//완료문서
    //            break;
    //        }
    //    case "REJECT":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_reject_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//
    //            break;
    //        }
    //    case "CCINFO":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_ccinfo_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//
    //            break;
    //        }
    //    case "CIRCULATION":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_ccinfo_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//
    //            break;
    //        }
    //    case "HOLD":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_hold_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재 보류알림
    //            break;
    //        }
    //    case "WITHDRAW":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_haesu_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재 회수알림
    //            break;
    //        }
    //    case "ABORT":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_cancel_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재 취소알림
    //            break;
    //        }
    //    case "APPROVECANCEL":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_approval_cancel_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재 승인취소알림
    //            break;
    //        }
    //    case "COMMENT":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_comment_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재 회수알림
    //            break;
    //        }
    //    case "PROCESS":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_apv_process_doc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재진행중 문서
    //            //mode 가 프로세스 이면서 loct가 COMPLETE 일경우 완료문서 처리
    //            if (getInfo('loct') == "COMPLETE") {
    //                sMailType = "<" + Common.GetDic("lbl_apv_ApprovalDoc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재완료 문서
    //            }
    //            break;
    //        }
    //    case "TEMPSAVE":
    //        {
    //            sMailType = "<" + Common.GetDic("lbl_review2") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//결재진행중 문서
    //            break;
    //        }
    //	case "":
    //	default:
    //		{
    //			if (getInfo("loct") == "COMPLETE") {
    //				sMailType = "<" + Common.GetDic("lbl_apv_ApprovalDoc") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject;//완료문서
    //			} else {
    //				sMailType = "<" + Common.GetDic("MN_1780") + " - " + Common.GetDic("FormName_" + _DN_Code + "_" + getInfo('fmpf')) + ">" + sSubject; //결재진행
    //			}
    //			break;
    //		}

    //}

    // 메일 쓰기 팝업
    // pStrPopupId : 쓰기 팝업창 ID
    // pStrCmd : 호출 Type (CONTACT/BOARD/APPROVAL)
    // pStrTo : 받는 사람 mail 주소 (To)
    // pStrCc : 받는 사람 mail 주소 (Cc)
    // pStrBcc : 받는 사람 mail 주소 (Bcc)
    // pStrSubject : Mail Subject 정의
    // pStrBody : Mail 본문 내용 정의
    // pStrBodyType : Mail 본문 내용 Type (HTML/TEXT)
    // pStrAttachmentFile : 첨부파일 정보 (Ex - ContactList_20130913_0346_1.csv:48:OLD:3966:csv:/GWStorage/Board/File/20131223/1590.0_ContactList_20130913_0346_1.csv; ContactList_20130913_0347.csv:198904:OLD:3967:csv:/GWStorage/Board/File/20131223/1590.1_ContactList_20130913_0347.csv; ContactList_20130913_0347.zip:18972:OLD:3968:zip:/GWStorage/Board/File/20131223/1590.2_ContactList_20130913_0347.zip)
    //sMailType = "[완료문서 -" + getInfo('fmnm') + "]" + sSubject ; //test
    //strAPPType = "완료문서"; //test 
    //TotalMsg = "<a href=" + sbLinkURL + ">" + strAPPType + "</a>   <--이 부분을 한번 누르시면 문서를 조회할 수 있습니다. <br> * 제목을 수정하시면 문서가 제대로 열리지 않을 수 있습니다.";

    //XFN_PopupMailWrite("MailWirtePop", "APPROVAL", "", "", "", sMailType, "<a href=" + sLINKUrl + ">" + sLINKUrl + "</a>", "HTML", "");
    XFN_PopupMailWrite("MailWirtePop", "APPROVAL", "", "", "", sMailType, TotalMsg, "HTML", "");
}

//연동재실행팝업
function fnRerunAction() {
    var szURL = "/ZAdmin/OperSystem/Approval/CfAdmin/Interlock_ReruntAction.aspx"/*?docid=" + $("#" + id_hidPIID).val()*/;
    CFN_OpenWindow(szURL, '', 650, 403, "scroll")

}

function fnGoPreNextList(objid) {
    var sPiid = "";
    var sWiid = "";
    var sPfid = "";
    var sPtid = "";
    var sMeggage = "";
    var sCount = "";

    //신세계 Layer 수정 적용
    //2016-06-08
    //YJYOO
    //var aPiid_List = opener.strPiid_List.split(",");
    //var aWiid_List = opener.strWiid_List.split(",");
    //var aPfid_List = opener.strPfid_List.split(",");
    //var aPtid_List = opener.strPtid_List.split(",");
    if (openMode == "L") {
        var aPiid_List = m_oInfoSrc.strPiid_List.split(",");
        var aWiid_List = m_oInfoSrc.strWiid_List.split(",");
        var aPfid_List = m_oInfoSrc.strPfid_List.split(",");
        var aPtid_List = m_oInfoSrc.strPtid_List.split(",");


    } else {
        var aPiid_List = opener.strPiid_List.split(",");
        var aWiid_List = opener.strWiid_List.split(",");
        var aPfid_List = opener.strPfid_List.split(",");
        var aPtid_List = opener.strPtid_List.split(",");
    }

    var nPoint = 0;
    var nTotal = aWiid_List.length;

    for (i = 0; i < nTotal; i++) {
        if (aWiid_List[i].toLowerCase() == "00000000-0000-0000-0000-000000000000") {
            if (aPiid_List[i].toLowerCase() == getInfo("piid").toLowerCase()) {
                nPoint = i;
                i = nTotal;
            }
        } else {
            if ('TCINFO' == getInfo('gloct') && 'COMPLETE' == getInfo('loct')) {   //[2016-01-25 modi kh] 개인결재함 > 참조/회람함 에는 piid 값만 존재 하므로 일괄확인 시 piid로 체크 한다
                if (aPiid_List[i].toLowerCase() == getInfo("piid").toLowerCase()) {
                    nPoint = i;
                    i = nTotal;
                }
            }
            else {
                if (aWiid_List[i].toLowerCase() == getInfo("wiid").toLowerCase()) {
                    nPoint = i;
                    i = nTotal;
                }
            }
        }
    }
    if (objid == "btPreList") {
        if (nPoint == 0) sMeggage = Common.GetDic("msg_apv_firstPage");
        else {
            sPiid = aPiid_List[nPoint - 1].toLowerCase();
            sWiid = aWiid_List[nPoint - 1].toLowerCase();
            sPfid = aPfid_List[nPoint - 1].toLowerCase();
            sPtid = aPtid_List[nPoint - 1].toLowerCase();
            sCount = String(nPoint + 1 - 1) + "/" + String(nTotal);
        }

    } else if (objid == "btNextList") {
        if (nPoint == nTotal - 1) sMeggage = Common.GetDic("msg_apv_lastPage");
        else {
            sPiid = aPiid_List[nPoint + 1].toLowerCase();
            sWiid = aWiid_List[nPoint + 1].toLowerCase();
            sPfid = aPfid_List[nPoint + 1].toLowerCase();
            sPtid = aPtid_List[nPoint + 1].toLowerCase();
            sCount = String(nPoint + 1 + 1) + "/" + String(nTotal);
        }
    }
    if (sMeggage != "") Common.Warning(sMeggage);
    else if (sPiid != "") {
        //신세계 Layer 수정 적용
        //2016-06-08
        //YJYOO
        //opener.sNowPiis = sPiid;
        //document.location.href = window.location.href.replace(CFN_GetQueryString("piid"), sPiid).replace(CFN_GetQueryString("wiid"), sWiid).replace(CFN_GetQueryString("pfid"), sPfid).replace("ptid=" + CFN_GetQueryString("ptid"), "ptid=" + sPtid).replace("#", "").replace("&scount=" + CFN_GetQueryString("scount"), "") + "&scount=" + sCount;
        if (openMode == "L") {
            m_oInfoSrc.sNowPiis = sPiid;
            document.location.href = window.location.href.replace(CFN_GetQueryString("piid"), sPiid).replace(CFN_GetQueryString("wiid"), sWiid).replace(CFN_GetQueryString("pfid"), sPfid).replace("ptid=" + CFN_GetQueryString("ptid"), "ptid=" + sPtid).replace("#", "").replace("&scount=" + CFN_GetQueryString("scount"), "") + "&scount=" + sCount;
        } else {
            opener.sNowPiis = sPiid;
            document.location.href = window.location.href.replace(CFN_GetQueryString("piid"), sPiid).replace(CFN_GetQueryString("wiid"), sWiid).replace(CFN_GetQueryString("pfid"), sPfid).replace("ptid=" + CFN_GetQueryString("ptid"), "ptid=" + sPtid).replace("#", "").replace("&scount=" + CFN_GetQueryString("scount"), "") + "&scount=" + sCount;
        }
    }
}

//moved from formedit.js : KJW 2014.04.21 : XFORM PRJ.
function DeCodeRecList(sRecList) {
    var r, res, sRecDept;
    var s = sRecList;
    res = /@/i;
    sRecDept = s.replace(res, "");
    m_oRecList = $.parseXML("<groups>" + sRecDept + "</groups>");
    var elmList = $(m_oRecList).find("groups > group");
    sRecDept = "";
    if (elmList.length != 0) {
        $(m_oRecList).each(function (i, elm) {
            sRecDept += "@";
            var sRecDeptNode = "";
            $(elm).find("item > AN").each(function (j, elmnode) {
                sRecDeptNode += ";" + $(elmnode).text();
            });
            if (sRecDeptNode.length > 0) sRecDeptNode = sRecDeptNode.substring(1);
            sRecDept += sRecDeptNode;
        });
        if (sRecDept.length > 0) sRecDept = sRecDept.substring(1);
    }
    if (sRecList.length > 1) {//수신처지정없음
        if (sRecList.substr(0, 1) == '@') sRecDept = "@" + sRecDept;
    }
    return sRecDept;
}
function getDocListXml() {
    var returnXml = "";
    var sDocListType = "3";
    if (CFN_GetQueryString("doclisttype") != null) sDocListType = CFN_GetQueryString("doclisttype");

    if (sDocListType == "10") {
        returnXml += makeNode("OwnerUnitCode", getInfo("etid"), null, true);
        returnXml += makeNode("DocumentUnitCode", getInfo("etid"), null, true);
        returnXml += makeNode("UnitAbbreviation", "", null, true);
        returnXml += makeNode("CategoryNumber", "", null, true);
        returnXml += makeNode("DocListType", sDocListType, null, true);
        returnXml += makeNode("RegistrationComment", "", null, true);
        returnXml += makeNode("RegistratorName", document.getElementById("NO").value, null, true); // NO
        returnXml += makeNode("RegistratorCode", getInfo("usid"), null, true);
        returnXml += makeNode("SentByUnitName", getInfo("dpnm"), null, true);
        returnXml += makeNode("SentByUnitCode", getInfo("dpid"), null, true);
        returnXml += makeNode("ReceivedByUnitName", "", null, true);
        returnXml += makeNode("ReceivedByUnitCode", "", null, true);
        returnXml += makeNode("DocumentSubject", document.getElementById("SUBJECT").value, null, true);
        returnXml += makeNode("PersonInChargeName", "", null, true);
        returnXml += makeNode("PersonInChargeCode", "", null, true);
        returnXml += makeNode("ApprovedDate", getInfo("svdt"), null, true);
        returnXml += makeNode("InitiatorName", getInfo("usdn"), null, true);
        returnXml += makeNode("InitiatorCode", getInfo("usid"), null, true);
        returnXml += makeNode("EffectuatedDate", getInfo("svdt"), null, true);
        returnXml += makeNode("EffectuationMethod", "", null, true);
    }
    return returnXml;
}

function chkWARCOMMENT() {
    var retResult = true;
    if (document.getElementById("WARCOMMENT") != undefined) {
        if (getIsLastApprover("receive")) {
            if (document.getElementById("WARCOMMENT").innerHTML != "") {
                if (window.confirm(formJson.localLangItems.msg_lastconfirm)) {
                    result = true;
                }
                else {
                    result = false;
                }
                document.getElementById("LASTCONFIRM").value = result;
                var tmpName = m_oFormMenu.getLngLabel(getInfo("usdn"), false);
                if (result == 'false') {
                    tmpName = "";
                }
                retResult = UpdateLastApproval(result, tmpName);
            }
        }
    }
    else {
        retResult = true;
    }
    return retResult;
}

function UpdateLastApproval(result, tmpName) {
    var flg = true;
    var sUrl = "/Approval/Controls/ApprovalWebservice.asmx";
    var oResult = CFN_CallAjaxJson(sUrl + "/checkUpdateLastApproval", "{LASTCONFIRM:'" + result + "', LASTAPPROVER:'" + tmpName + "', FIID:'" + getInfo("fiid") + "'}", false, null);

    var oRsltJSON = $.parseJSON(oResult);
    var rText = oRsltJSON.d.toString();
    if (rText.split(":")[0] == "E") {

        alert(rText.split(":")[1]);
        flg = false;
    }
    else {
        if (rText != "S:성공") {

        }
    }
    return flg;
}

function getIsLastApprover(pKind) {   //pKind: send(기안부서), receive(수신부서)
    var sRtn = "";
    var m_oApvList = $.parseXML(getInfo("apst"));

    var oPendingSteps = $(m_oApvList).find("steps > division[divisiontype='" + pKind + "'] > step > ou > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='pending'],steps > division > step > ou > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='reserved']");
    var oinActiveSteps = $(m_oApvList).find("steps > division[divisiontype='" + pKind + "'] > step > ou > person > taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='inactive']");
    if ((oPendingSteps.length == 1) && (oinActiveSteps.length == 0)) {
        sRtn = "true";
    } else {
        sRtn = "false";
    }
    if (sRtn == "false") {
        switch (getInfo("mode")) {
            case "PCONSULT":
                if (getInfo("mode") == "PCONSULT" && getInfo("pfsk") == "T004" && document.getElementById("ACTIONINDEX").value == 'reject') { //합의 반려 가능
                    sRtn = "true";
                }
                break;
            default:
                if (document.getElementById("ACTIONINDEX").value == 'reject') { //결재 반려 가능
                    sRtn = "true";
                }
                break;
        }
    }
    return sRtn;
}

function getIncludeFormPrefix(formStr, gubun) {
    var arrForms = formStr.split(gubun);
    var check = false;
    for (i = 0; i < arrForms.length; i++) {
        if (arrForms[i] == getInfo('fmpf')) {
            check = true;
            break;
        }
    }
    return check;
}


// XForm 저장연동 (장용욱:20160323)              
function fn_writelink(extdatatype) {
    var bLastApprovalYN = false;    // 마지막 결재자인지 여부

    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);

    // 후결(review), 후열(bypass), 결재안함(skip) 아니고 상태가 대기(pending) 이거나 보류(reserved) 인것
    var oPendingSteps = $(m_oApvList).find("steps > division > step:has(taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='pending']), steps > division > step:has(taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='reserved'])");
    // 후결(review), 후열(bypass), 결재안함(skip) 아니고 상태가 비활성화(inactive)
    var oinActiveSteps = $(m_oApvList).find("steps > division > step:has(taskinfo[kind!='review'][kind!='bypass'][kind!='skip'][status='inactive'])");

    // 대기(pending), 보류(reserved) 상태가 1개 이고, 비활성화(inactive) 상태가 0개 일 경우
    if ((oPendingSteps.length == 1) && (oinActiveSteps.length == 0)) {
        bLastApprovalYN = true;
    }

    // 1인결재 : 대기(pending), 보류(reserved) 상태가 0개 이고, 비활성화(inactive) 상태가 1개 일 경우
    if ((oPendingSteps.length == 0) && (oinActiveSteps.length == 1)) {
        bLastApprovalYN = true;
    }

    // Request 담당업무 : division 수가 담당업무 수보다 작을 경우에는 마지막 결재자가 아님
    if (bLastApprovalYN) {
        if (getInfo("scChgr") == "1" && getInfo("scChgrV") != "") {
            if ($(m_oApvList).find("steps > division").length < (getInfo("scChgrV").split('^').length + 1)) {
                bLastApprovalYN = false;
            }
        }
    }

    // Request 담당업무함 계열사별 지정 : division 수가 담당업무함 계열사별 지정 수보다 작을 경우에는 마지막 결재자가 아님
    if (bLastApprovalYN) {
        if (getInfo("scChgrEnt") == "1" && getInfo("scChgrEntV") != "") {
            if ($(m_oApvList).find("steps > division").length < (getInfo("scChgrEntV").split('^').length + 1)) {
                bLastApprovalYN = false;
            }
        }
    }

    // Request 담당업무함 사업장별 지정 : division 수가 담당업무함 사업장별 지정 수보다 작을 경우에는 마지막 결재자가 아님
    if (bLastApprovalYN) {
        if (getInfo("scChgrReg") == "1" && getInfo("scChgrRegV") != "") {
            if ($(m_oApvList).find("steps > division").length < (getInfo("scChgrRegV").split('^').length + 1)) {
                bLastApprovalYN = false;
            }
        }
    }

    // Request 담당부서사용 : division 수가 담당부서사용 수보다 작을 경우에는 마지막 결재자가 아님
    if (bLastApprovalYN) {
        if (getInfo("scChgrOU") == "1" && getInfo("scChgrOUV") != "") {
            if ($(m_oApvList).find("steps > division").length < (getInfo("scChgrOUV").split('^').length + 1)) {
                bLastApprovalYN = false;
            }
        }
    }

    // Request 담당부서 계열사별 지정 : division 수가 담당부서 계열사별 지정 수보다 작을 경우에는 마지막 결재자가 아님
    if (bLastApprovalYN) {
        if (getInfo("scChgrOUEnt") == "1" && getInfo("scChgrOUEntV") != "") {
            if ($(m_oApvList).find("steps > division").length < (getInfo("scChgrOUEntV").split('^').length + 1)) {
                bLastApprovalYN = false;
            }
        }
    }

    // Request 담당수신자사용 : division 수가 담당수신자사용 작을 경우에는 마지막 결재자가 아님
    if (bLastApprovalYN) {
        if (getInfo("scChgrPerson") == "1" && getInfo("scChgrPersonV") != "") {
            if ($(m_oApvList).find("steps > division").length < (getInfo("scChgrPersonV").split('^').length + 1)) {
                bLastApprovalYN = false;
            }
        }
    }

    // 협조문서는 기안부서 최종 결재선에서 연동 수신처 결재시는 제외     
    // 배포사용, 배포그룹사용
    if (bLastApprovalYN) {
        if (getInfo("scIPub") == "1" || getInfo("scGRec") == "") {
            if ($(m_oApvList).find("division[divisiontype='send']:has(>taskinfo[status='completed'])").length > 0) {
                bLastApprovalYN = false;
            }
        }
    }

    // alert(bLastApprovalYN);
    // alert(document.getElementById("ACTIONINDEX").value);
    // return;

    // 죄종승인자 일 경우
    if (bLastApprovalYN) {
        if (extdatatype == "writelink_d_text") {
            if (document.getElementById("ACTIONINDEX").value == 'approve') {
                var strXml = "<params>";
                $('*[ext-data-type1="writelink_d_text"]').each(function () {
                    // 연결정보
                    var strConnectString = $(this).attr('ext-data-type2');

                    var strTable = $(this).attr('ext-data-type3');
                    var strField = $(this).attr('ext-data-type4');


                    // JSON 파라미터 "'", "\" 처리                        
                    strValue = $(this).text();
                    strValue = strValue.replace(/'/g, "!!!!@@@@####^^^^");
                    strValue = strValue.replace(/\\/g, "!!!!@@@@####&&&&");
                    // JSON 파라미터 구성
                    strXml = strXml + "<param>";
                    strXml = strXml + "<connect>" + strConnectString + "</connect>";
                    strXml = strXml + "<tablename>" + strTable + "</tablename>";
                    strXml = strXml + "<columnname>" + strField + "</columnname>";
                    strXml = strXml + "<columnvalue><![CDATA[" + strValue + "]]></columnvalue>";
                    strXml = strXml + "</param>";
                });
                var strXml = strXml + "</params>";

                if (strXml != "<params></params>") {
                    CFN_PageMethodJSON_Url("/Approval/Forms/Templates/xform/xform_database.aspx", "SetDataInsert", "{strXml:'" + strXml
                        + "'}", false, function (pResult, pContext) {
                            if (pResult != "") {
                                if (pResult.d.indexOf('ERROR') == 0) {
                                    alert(pResult.d);
                                    //alert(Common.GetDic('msg_OccurError'));  //에러가 발생했습니다
                                    return;
                                }
                            }
                        });
                }
            }
        }
    }
}

function OpenFormTemplate() {
    var iWidth = 1100;

    //var iHeight = window.screen.height - 350;
    var iHeight = 630;
    var sx = window.screen.width / 2 - iWidth / 2; //레이어 사용

    var strURL = "/Approval/Custom/FormTemplate_Load.aspx?mode=new";
    CFN_OpenWindow(strURL, "FormTemplate", iWidth, iHeight, "fix");
    //Common.Show("divGalTableList", "", "템플릿 수정", strURL, iWidth, iHeight, "iframe", sx);
}

function fnLPAD(val, set, cnt) {
    if (!set || !cnt || val.length >= cnt) {
        return val;
    }

    var max = (cnt - val.length) / set.length;

    for (var i = 0; i < max; i++) {
        val = set + val;
    }

    return val;
}


// 부서예산 유무 체크 끝---------------------------------------------------------------------





//2017.02 yu2mi : 현기차 협조프로세스 시연용
//doButtonCase['btConsultList'] = function (oBtn, oVar) {//협조처
//    XFN_OrgMapShow_WindowOpen("btConsultList", "divMenu", "hidConsultList", "", "ConsultList_CallBack", "C9", "Y", "Y", "D", "APPROVAL", "", "");
//}
var ConsulteComment = "";
doButtonCase['btDeptLineConsult'] = function (oBtn, oVar) {//검토
    //XFN_OrgMapShow_WindowOpen("btDeptLineConsult", "divMenu", "hidConsultList", "", "DeptLineConsult_CallBack", "B1", "Y", "Y", "U", "APPROVAL", "", "");
    sWindowName = "winAction"; oVar.sSize = "resize";
    oVar.iHeight = 220; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ConsultBasic.aspx?type=DRAFT";

    if (getInfo("fmpf") == "WF_FORM_DRAFT_IC0_003") {
        oVar.sUrl = "/Approval/ApvProcess/ConsultBasic.aspx?type=DRAFT&fmpf=WF_FORM_DRAFT_IC0_003";
    }

    //재기안자 의견 가져오기 - 검토 의견으로 씀
    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
    var oComment;
    if (getInfo("mode") == "SUBAPPROVAL") {
        oComment = $(m_oApvList).find("division:has(taskinfo[status='pending'])>step>ou:has(taskinfo[status='pending'])>person>taskinfo[kind='charge']>comment");
    } else {
        oComment = $(m_oApvList).find("division:has(taskinfo[status='pending'])>step>ou>person>taskinfo[kind='charge']>comment");
    }
    if (oComment != null) {
        ConsulteComment = $(oComment).text();
    }
}

//doButtonCase['btDeptLineConsult2'] = function (oBtn, oVar) {//검토
//    //XFN_OrgMapShow_WindowOpen("btDeptLineConsult", "divMenu", "hidConsultList", "", "DeptLineConsult_CallBack", "B1", "Y", "Y", "U", "APPROVAL", "", "");
//    sWindowName = "winAction"; oVar.sSize = "resize";

//    oVar.iHeight = 220; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/ConsultBasic.aspx?type=DRAFT";

//    //재기안자 의견 가져오기 - 검토 의견으로 씀
//    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
//    var oComment;
//    if (getInfo("mode") == "SUBAPPROVAL") {
//        oComment = $(m_oApvList).find("division:has(taskinfo[status='pending'])>step>ou:has(taskinfo[status='pending'])>person>taskinfo[kind='charge']>comment");
//    } else {
//        oComment = $(m_oApvList).find("division:has(taskinfo[status='pending'])>step>ou>person>taskinfo[kind='charge']>comment");
//    }
//    if (oComment != null) {
//        ConsulteComment = $(oComment).text();
//    }

//}


//doButtonCase['btApproveD'] = function (oBtn, oVar) {//협조처 진행중 결재선 버튼


//    var msg = "";
//    msg += "협조결재가 완료되지 않았으며";
//    msg += "\n협조기한은 ";
//    msg += $("#CONSULT_DATE").html();
//    msg += " 입니다.";
//    msg += "\n결재를 진행하시려면";
//    msg += "\n협조처 추가/삭제 버튼을 눌러서 협조처를 삭제하신 후에 결재하십시오.";
//    msg += "\n\n미완료부서 :";
//    msg += $("#CONSULT_LIST_D").html();
//    msg += "";
//    msg += "";
//    msg += "";
//    msg += "";
//    alert(msg);
//}
//function ConsultList_CallBack(pStrItemInfo) {

//    $("#hidConsultList").val(pStrItemInfo);
//    var oXML = $.parseXML(pStrItemInfo);

//    var sConsult_D = "";
//    var sConsult_V = "";
//    if (oXML != null) {
//        $(oXML).find("item").each(function (i, oChild) {
//            sConsult_D += "," + XFN_GetDicInfo($(oChild).find("DN").text());

//            sConsult_V += "|" + $(oChild).find("AN").text() + ":" + $(oChild).find("DN").text();
//        });
//    }

//    //$("#CONSULT_LIST_D").val(sConsult_D.substring(1));
//    $("#CONSULT_LIST").val(sConsult_V.substring(1) + "@");

//    document.getElementById("RecLine").innerHTML = initConsultList();

//}
//협조 결재선 _ 최우석 
function initConsultList() {
    var szReturn = '';
    var aRec = $('#CONSULT_LIST').val().split("|");
    var Include = "";
    var i, chTR = 0;
    var maxLen = 12; //[일반품의서] 협조처 최대 12개
    var consult_status = [];
    var dept_name_td_Arr = [];
    var dif_dept_name_Arr = [];//bpm에서 받아온 결재선에 companyName 담아두는곳
    //테스트용 결재선
    //협조대기
    //var test = "<steps status=\"inactive\" initiatoroucode=\"\" initiatorcode=\"1395052\"><division name=\"신청부서\" divisiontype=\"send\" oucode=\"\" ouname=\"\"><taskinfo kind=\"send\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /><step name=\"기안자\" unittype=\"person\" routetype=\"approve\"><ou name=\"\" code=\"\"><person title=\"87;\" level=\";\" name=\"ko;TE장성현ST;TESUNG HYUN JANGST;\" oucode=\"H611_4665\" ouname=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\" code=\"1395052\" position=\"24;\" sipaddress=\"jsh1390@hyundai.com\"><taskinfo kind=\"charge\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /></person></ou></step></division></steps>";
    //협조대기,검토중
    //var test = "<steps status=\"inactive\" initiatoroucode=\"\" initiatorcode=\"1395052\"><division name=\"신청부서\" divisiontype=\"send\" oucode=\"\" ouname=\"\"><taskinfo kind=\"send\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /><step name=\"기안자\" unittype=\"person\" routetype=\"approve\"><ou name=\"\" code=\"\"><person title=\"87;\" level=\";\" name=\"ko;TE장성현ST;TESUNG HYUN JANGST;\" oucode=\"H611_4665\" ouname=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\" code=\"1395052\" position=\"24;\" sipaddress=\"jsh1390@hyundai.com\"><taskinfo kind=\"charge\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /></person></ou></step></division><division name=\"신청부서\" divisiontype=\"send\" oucode=\"\" ouname=\"\"><taskinfo kind=\"send\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /><step name=\"기안자\" unittype=\"person\" routetype=\"approve\"><ou name=\"\" code=\"\"><person title=\"87;\" level=\";\" name=\"ko;TE장성현ST;TESUNG HYUN JANGST;\" oucode=\"H611_4665\" ouname=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\" code=\"1395052\" position=\"24;\" sipaddress=\"jsh1390@hyundai.com\"><taskinfo kind=\"charge\" result=\"inactive\" status=\"complete\" datereceived=\"2017-04-27 14:19:59\" /></person></ou></step><step name=\"examine\" unittype=\"person\" routetype=\"examine\"><ou name=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\"><person title=\"87\" level=\"ko;과장;;\" name=\"ko;TE김연용ST;TEYEON YONG KIMST;\" ouname=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\" code=\"8914811\" position=\"24\"><taskinfo kind=\"normal\" result=\"inactive\" status=\"pending\" /></person></ou></step></division></steps>";
    //var test = "<steps status=\"inactive\" initiatoroucode=\"\" initiatorcode=\"1395052\"><division name=\"신청부서\" divisiontype=\"send\" oucode=\"\" ouname=\"\"><taskinfo kind=\"send\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /><step name=\"기안자\" unittype=\"person\" routetype=\"approve\"><ou name=\"\" code=\"\"><person title=\"87;\" level=\";\" name=\"ko;TE장성현ST;TESUNG HYUN JANGST;\" oucode=\"H611_4665\" ouname=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\" code=\"1395052\" position=\"24;\" sipaddress=\"jsh1390@hyundai.com\"><taskinfo kind=\"charge\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /></person></ou></step></division><division name=\"신청부서\" divisiontype=\"send\" oucode=\"\" ouname=\"\"><taskinfo kind=\"send\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /><step name=\"기안자\" unittype=\"person\" routetype=\"approve\"><ou name=\"\" code=\"\"><person title=\"87;\" level=\";\" name=\"ko;TE장성현ST;TESUNG HYUN JANGST;\" oucode=\"H611_4665\" ouname=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\" code=\"1395052\" position=\"24;\" sipaddress=\"jsh1390@hyundai.com\"><taskinfo kind=\"charge\" result=\"inactive\" status=\"complete\" datereceived=\"2017-04-27 14:19:59\" /></person></ou></step><step name=\"examine\" unittype=\"person\" routetype=\"examine\"><ou name=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\"><person title=\"87\" level=\"ko;과장;;\" name=\"ko;TE김연용ST;TEYEON YONG KIMST;\" ouname=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\" code=\"8914811\" position=\"24\"><taskinfo kind=\"normal\" result=\"inactive\" status=\"pending\" /></person></ou></step></division><division name=\"신청부서\" divisiontype=\"send\" oucode=\"\" ouname=\"\"><taskinfo kind=\"send\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /><step name=\"기안자\" unittype=\"person\" routetype=\"approve\"><ou name=\"\" code=\"\"><person title=\"87;\" level=\";\" name=\"ko;TE장성현ST;TESUNG HYUN JANGST;\" oucode=\"H611_4665\" ouname=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\" code=\"1395052\" position=\"24;\" sipaddress=\"jsh1390@hyundai.com\"><taskinfo kind=\"charge\" result=\"inactive\" status=\"complete\" datereceived=\"2017-04-27 14:19:59\" /></person></ou></step></division> <division name=\"신청부서\" divisiontype=\"send\" oucode=\"\" ouname=\"\"><taskinfo kind=\"send\" result=\"inactive\" status=\"inactive\" datereceived=\"2017-04-27 14:19:59\" /><step name=\"기안자\" unittype=\"person\" routetype=\"approve\"><ou name=\"\" code=\"\"><person title=\"87;\" level=\";\" name=\"ko;TE장성현ST;TESUNG HYUN JANGST;\" oucode=\"H611_4665\" ouname=\"ko;TE아산출고센터ST;TE아산출고센터ST_EN;\" code=\"1395052\" position=\"24;\" sipaddress=\"jsh1390@hyundai.com\"><taskinfo kind=\"charge\" result=\"inactive\" status=\"complete\" datereceived=\"2017-04-27 14:19:59\" /></person></ou></step></division></steps>";
    /* 스키마 -> 결재선 정보 협조처 체크 되어 있을 경우 value 값이 01로 표시 01일경우만 협조처 그림   
    품의서 조건 제거 && (getInfo('scApvLineTypeauto') == 'D') 
    getInfo('scInformationAppV') == '01' 일경우 결재선에서 협조처가 추가 된 것이다.
    */
    if (getInfo('strConsultJson') != '') {
        var consultApv = getInfo('strConsultJson');
        consultApv = $.parseXML(consultApv);
        var elmRoot_Con = $(consultApv).find("steps");
    }



    if ($('#CONSULT_LIST').val() == "") { //기본 결재선 [일반품의서] 일 경우
        //if (test == "") { //기본 결재선 빈칸으로 12칸
        szReturn += "<table class='table_10' style='margin:0px; padding:0px; border:hidden;'><colgroup><col style='width:44.45%'/><col style='width:55.55%'/></colgroup>";

        for (i = 0; i < 6; i++) {
            szReturn += "<tr><td></td><td></td></tr>";
        }
        szReturn += "</table>";

        /* 협조처 추가와 처음 결재선에서 추가  approval 모드 draft 모드일 경우
           getInfo(strConsultJson)( 결재선 협조처여부 )에 값이 없을시  $(elmRoot_Con)자체가 undefinde가 나와 length가 0으로 되어짐 
        */
        //} else if ($('#CONSULT_LIST').val() != "" && (getInfo('scInformationAppV') == '01' && ($(elmRoot_Con).find('division').length == 0))) {
        //    szReturn += "<table class='table_10' style='margin:0px; padding:0px; border:hidden;'><colgroup><col style='width:50%'/><col style='width:50%'/></colgroup>";

        //    //var B = aRec.toString();
        //    //aRec = B.split('@');
        //    var detp_name = '';
        //    var detp_name_td = '';

        //    /*테이블 하나당 2개씩 들어감 ex)   <Tr> 0 , 1 </tr> 
        //                                       <tr> 2 . 3 </tr> 
        //       위에 같은 방식으로 들어가게 되어 짝수에 tr을 붙여줌 _최우석
        //       보이는 11개만 표시해줌
        //    */
        //    for (i = 0; i < 12; i++) {
        //        if (i == 0 || i == 2 || i == 4 || i == 6 || i == 8 || i == 10) {
        //            szReturn += "<tr>";
        //        }
        //        if (aRec[i] != null) {
        //            //dept_name_td = aRec[i];
        //            //dept_name_td == undefined || dept_name_td == '' ? dept_name_td = '' : dept_name_td = dept_name_td.split(";")[0].split(":")[1].split("^")[1];

        //            //기안부서와 다른 부서가 하나라도 있을 경우  부서코드 표시 
        //            var UserDept = true;
        //            var aRecItem_Dept = aRec[i].split(":");
        //            if (getInfo('etid') != aRecItem_Dept[0]) {
        //                UserDept = false;
        //            }


        //            var aRecItem = aRec[i].split(":");
        //            if (aRecItem.length > 5) {
        //                if (UserDept == true) { //요청대기  lbl_apv_request_wait
        //                    szReturn += "<td><span id='ApvLineRecListTemp' style='font-weight:bold;'>[" + Common.GetDic("lbl_apv_request_wait") + "]</span>" + CFN_GetDicDatas(aRecItem[6]) + "</td>";
        //                } else {
        //                    szReturn += "<td><span id='ApvLineRecListTemp' style='font-weight:bold;'>[" + Common.GetDic("lbl_apv_request_wait") + "]</span>" + CFN_GetDicDatas(aRecItem[6]) + " (" + CFN_GetDicDatas(aRecItem[7]) + ") </td>";
        //                }

        //            } else {
        //                szReturn += "<td></td>";
        //            }
        //        } else {
        //            szReturn += "<td></td>";
        //        }
        //        if (i == 1 || i == 3 || i == 5 || i == 7 || i == 9 || i == 11) {
        //            szReturn += "</tr>";
        //        }
        //    }
        //    //}

        //    szReturn += "</table>";
        //협조 요청을 보내게 되면 strConsultJson을 받아 온다. 
    }
    else if ((getInfo('scInformationAppV') == '010' || getInfo('scInformationAppV') == '110' || getInfo('scInformationAppV') == '011' || getInfo('scInformationAppV') == '111' || getInfo('scInformationApp_coop_only') == '1') && ($('#CONSULT_LIST').val() != "" || (getInfo('strConsultJson') != null && getInfo('strConsultJson') != undefined && getInfo('strConsultJson') != ''))) // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
    {
        //} else if (test != null && test != undefined && test != '') {
        /*
         협조부서를 받아 올때  결재선형태로 가지고 있음 
        */
        szReturn += "<table class='table_10' style='margin:0px; padding:0px; border:hidden;'><colgroup><col style='width:44.45%'/><col style='width:55.55%'/></colgroup>";

        var consultApv = getInfo('strConsultJson');
        consultApv = $.parseXML(consultApv);
        var elmRoot_Con = $(consultApv).find("steps");

        //var consultApv = test;

        // 1. 협조대기 == division 의 ouname 표시 step과 person이 1개이면서 person의 taskinfo의 status가 inactive 
        // 2. 검토중 == division 의 ouname 표시 하고 division 하위의 person 중에 taskinfo의 Status가 pending인게 1개라도있으면 
        // 3. 협조완료 == division 의 ouname 표시 하고 division 하위의 person 의 taskinfo의 Status가 모두 complete 이면
        // 4. 협조거부 == division 의 ouname 표시 하고 division 하위의 person 의 taskinfo의 Status가 rejectd 1개라도 있으면
        //$(this).find("step > taskinfo[@routetype='pending'")

        /*
        상태값을 배열로 넣어 둔다.
        각 division마다 상태값과 부서명을 담아두고 표를 그릴때 하나씩 빼서 그린다.
        */

        //var UserDept = true;

        $(elmRoot_Con).find("division").each(function (i, element) {

            //var aRecItem_Dept = aRec[i].split(":");
            //if (getInfo('etid') != aRecItem_Dept[0]) {
            //    UserDept = false;
            //}

            //if (getInfo('etid') != $(this).find("step>ou").attr("companycode")) {
            //    UserDept = false;
            //}
            if ($(this).find("step").length == 1) {
                if ($(this).find("taskinfo").attr("result") == "error") {
                    consult_status.push(Common.GetDic("lbl_apv_error")); // 오류
                    //if (UserDept) {
                    //    dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')));
                    //} else {
                    //dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')) + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                    if(_DN_Code == "H147") {
                        dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ': $(this).find("step").find("person").attr('ouname')) + ":"+$(this).find("step").find("person").attr('oucode').replace("H147", "")  + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                    }
                    else {
                        dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')) + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                    }
                    //}
                }
                else if ($(this).find("step").find("person").length == 1) {
                    //step과 person이 하나이면서 
                    if ($(this).find("step").find("person").find("taskinfo[status='pending']").length > 0 && $(this).find("step").attr('routetype') == 'assist') {
                        consult_status.push(Common.GetDic("lbl_apv_Cooperation_Wait")); // 협조대기
                    }
                    else if ($(this).find("step").find("person").find("taskinfo[status='completed']").length > 0) {
                        consult_status.push(Common.GetDic("lbl_apv_Cooperation_Complete") + ";" + CFN_TransLocalTime($(this).find('step:last() > ou > person > taskinfo').attr('datecompleted'), _UR_DateFormat)); //협조완료
                    }
                    else if ($(this).find("step").find("person").find("taskinfo[status='pending']").length >= 1 && $(this).find("step").attr('routetype') == 'examine') { //step이 하나이고 person이 하나이면서 pending일때 
                        consult_status.push(Common.GetDic("lbl_apv_Examination_Before")); //검토중
                    }
                    else if ($(this).find("step").find("person").find("taskinfo[status='reject']").length >= 1) { //step이 하나이고 person이 하나이면서 pending일때 
                        consult_status.push(Common.GetDic("lbl_apv_Cooperation_Reject") + ";" + CFN_TransLocalTime($(this).find('step:last() > ou > person > taskinfo').attr('datecompleted'), _UR_DateFormat)); //협조거부
                    }
                    //if (UserDept) {
                    //    dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')));
                    //} else {
                    if(_DN_Code == "H147"){
                        dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')) + ":"+$(this).find("step").find("person").attr('oucode').replace("H147", "") + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                    }
                    else {
                        dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')) + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                    }
                    //}
                }

                //pending를 찾아야함
            } else {
                if ($(this).find("taskinfo").attr("result") == "error") {
                    consult_status.push(Common.GetDic("lbl_apv_error")); // 오류
                }
                else if ($(this).find("step[routetype='examine']").length >= 1 && $(this).find("step[routetype='assist'] > ou > person > taskinfo[status='pending']").length >= 1) {
                    consult_status.push(Common.GetDic("lbl_apv_CompleteReview"));//검토완료
                } else if ($(this).find("step[routetype='assist']").length >= 1 && $(this).find("step[routetype='examine'] > ou > person > taskinfo[status='pending']").length >= 1) {
                    //person
                    consult_status.push(Common.GetDic("lbl_apv_Examination_Before"));//검토중
                } else if ($(this).find("step").find("person").find("taskinfo[status='completed']").length == $(this).find("step").find("person").length) {
                    consult_status.push(Common.GetDic("lbl_apv_Cooperation_Complete") + ";" + CFN_TransLocalTime($(this).find('step:last() > ou > person > taskinfo').attr('datecompleted'), _UR_DateFormat)); //협조완료 // 20171220 hpark 협조 날짜오류 수정 - 마지막결재자 날짜 가져오도록

                } else if ($(this).find("step").find("person").find("taskinfo[status='reject']").length >= 1) {
                    consult_status.push(Common.GetDic("lbl_apv_Cooperation_Reject") + ";" + CFN_TransLocalTime($(this).find("step:last() > ou > person > taskinfo[status='reject']").attr('datecompleted'), _UR_DateFormat));//협조거부 // 20171220 hpark 협조 날짜오류 수정 - 거부한 사용자 날짜 가져오도록

                }
                //if ($(this).find("step").find("ou").attr('companycode') == getInfo('etid')) {
                //    dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')));
                //} else {
                if(_DN_Code == "H147"){
                    dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')) + ":"+$(this).find("step").find("person").attr('oucode').replace("H147", "") + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                }
                else {
                    dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')) + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                }
                //}
            }
        });


        //
        if ($('#CONSULT_LIST').val().indexOf(":N:") > -1) {
            for (i = 0; i < aRec.length; i++) {
                //var UserDept = true;
                var aRecItem_Dept = aRec[i].split(":");
                //if (getInfo('etid') != aRecItem_Dept[0]) {
                //    UserDept = false;
                //}
                var aRecItem = aRec[i].split(":");
                if (aRecItem[6] == "N") {
                    consult_status.push(Common.GetDic("lbl_apv_request_wait"));
                    //if (UserDept) {
                    //    dept_name_td_Arr.push(CFN_GetDicDatas(aRecItem[7]));
                    //}
                    //else {
                    //TO-DO : 현대건설 사특화 요청으로 인하여 부서명 옆에 부서코드 표현
                    //2020-09-23 BY YJYOO
                    //if (Common.GetBaseConfig("HEC_COMPANY") != "Y") {
                    if(_DN_Code == "H147"){
                        dept_name_td_Arr.push(CFN_GetDicDatas(aRecItem[7]) +":"+aRecItem[3].replace("H147", "")+ " (" + CFN_GetDicDatas(aRecItem[8]) + ")");
                    }
                    else {
                        dept_name_td_Arr.push(CFN_GetDicDatas(aRecItem[7]) + " (" + CFN_GetDicDatas(aRecItem[8]) + ")");
                    }
                        //} 
                }
            }
        }

        for (i = 0; i < 12; i++) {

            if (i == 0 || i == 2 || i == 4 || i == 6 || i == 8 || i == 10) {
                szReturn += "<tr>";
            }

            if ((dept_name_td_Arr[i] != '') && (dept_name_td_Arr[i] != undefined)) {
                if (getInfo("reuse") == "Y")
                    //  szReturn += "<td>" + dept_name_td_Arr[i] + "</td>";
                    szReturn += "<td><span id='ApvLineRecListTemp' style='font-weight:bold;'>[" + consult_status[i] + "]</span>" + " " + CFN_GetDicDatas(dept_name_td_Arr[i]) + "</td>";
                else
                    if (consult_status[i].split(';')[0] == Common.GetDic("btn_apv_CompleteConsult") || consult_status[i].split(';')[0] == Common.GetDic("lbl_apv_Cooperation_Reject")) {
                        szReturn += "<td><span id='ApvLineRecListTemp' style='font-weight:bold;'>[" + consult_status[i].split(';')[0] + "]</span>" + " " + CFN_GetDicDatas(dept_name_td_Arr[i]) + " " + CFN_TransLocalTime(consult_status[i].split(';')[1], _UR_DateFormat) + "</td>";
                    } else {
                        if (consult_status[i].split(';')[0] == Common.GetDic("lbl_apv_error")) {
                            szReturn += "<td><span id='ApvLineRecListTemp' style='font-weight:bold;cursor:pointer;' class='tooltip' title='" + Common.GetDic("lbl_ConsultErrorTooltip") + "'>[" + consult_status[i] + "]</span>" + CFN_GetDicDatas(dept_name_td_Arr[i]) + "</td>";
                        }
                        else {
                            szReturn += "<td><span id='ApvLineRecListTemp' style='font-weight:bold;'>[" + consult_status[i] + "]</span>" + CFN_GetDicDatas(dept_name_td_Arr[i]) + "</td>";
                        }

                    }

            } else {
                szReturn += "<td></td>";
            }

            if (i == 1 || i == 3 || i == 5 || i == 7 || i == 9 || i == 11) {
                szReturn += "</tr>";
            }
        }
        szReturn += "</table>";
    }

    // 2017.9.05 by 김봉옥
    // 협조처 초과 숫자 표시
    if (aRec.length - 1 > 12) {
        var i = aRec.length - 13;
        $("#CooperationCount").html("+&nbsp;" + i);
    } else {
        $("#CooperationCount").html('');
    }

    if (szReturn != "") {
        if (document.getElementById("ReceiveLine") != null) {
            document.getElementById("ReceiveLine").style.display = "";
        }
    }

    if ($('#CONSULT_LIST').val() == "" && getInfo('scInformationAppV') && getInfo('scInformationAppV').length == 3 && getInfo('scInformationAppV').substr(1, 1) != '1' && getInfo('scInformationApp_coop_only') != '1') { // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
        $("#ConsultLine").hide();
        $("#ReceiveLine").hide();
    }

    return szReturn;
}

function insertDefaultConsultList() {
    var DefaultCooperationInfo = getInfo("DefaultCooperationInfo");
    var chkIS_Required = getInfo("chkIS_Required");

    //if ((DefaultCooperationInfo != undefined && DefaultCooperationInfo != "") && (chkIS_Required != undefined && chkIS_Required != "")) {
    if (DefaultCooperationInfo && chkIS_Required) {
        if (chkIS_Required == "Y") {
            $("#CONSULT_LIST").val($("#CONSULT_LIST").val() + DefaultCooperationInfo);
            $("#CONSULT_EXLIST").val($("#CONSULT_EXLIST").val() + DefaultCooperationInfo);
            
        }
        else {
            $("#CONSULT_LIST").val($("#CONSULT_LIST").val() + DefaultCooperationInfo);
        }
        document.getElementById("RecLine").innerHTML = initConsultList();
    }
}

//기본참조처 설정 20200115 STS PBJ
function insertDefaultReferenceList() {
    var strReferenceCode = getInfo("DefaultReferenceInfo");

    if (strReferenceCode != undefined && strReferenceCode != "")
    {
        var addReCode = strReferenceCode.split("|");

        for (var i = 0 ; i < addReCode.length - 1 ; i++) {
            var objGR = Common.GetObjectInfo('GO', addReCode[i].split(":")[0]).Table[0];

            if (objGR != undefined) {
                var m_oApvList = $.parseXML($("#APVLIST").val());
                var oCcinfo = m_oApvList.createElement("ccinfo");
                m_oApvList.documentElement.appendChild(oCcinfo);


                $(oCcinfo).attr("belongto", "sender");
                $(oCcinfo).attr("datereceived", "");

                var oCcOu = m_oApvList.createElement("ou");
                oCcinfo.appendChild(oCcOu);

                $(oCcOu).attr("code", objGR.DeptCode);
                $(oCcOu).attr("name", objGR.ExDisplayName);
                $(oCcOu).attr("companycode", objGR.DN_Code);
                $(oCcOu).attr("companyname", objGR.DN);
                $(oCcOu).attr("exorggradename", objGR.ExOrgGradeName);
                $(oCcOu).attr("orggradecode", objGR.OrgGradeCode);
                $(oCcOu).attr("originidccode", objGR.FarmCode);

                $("#APVLIST").val(CFN_XmlToString(m_oApvList));


            }
        }
        displayCCInfo($(m_oApvList).find("steps"));
    }
}

function initConsultList_INVEST() {
    var szReturn = '';
    var deptArray = '';
    var aRec = $('#CONSULT_LIST').val().split("|");
    var Include = "";
    var i, chTR = 0;
    var maxLen = 8; //[일반품의서] 협조처 최대 12개
    var consult_status = [];
    var dept_name_td_Arr = [];
    var dif_dept_name_Arr = [];//bpm에서 받아온 결재선에 companyName 담아두는곳

    if (getInfo('strConsultJson') != '') {
        var consultApv = getInfo('strConsultJson');
        consultApv = $.parseXML(consultApv);
        var elmRoot_Con = $(consultApv).find("steps");
    }



    if ($('#CONSULT_LIST').val() == "") { //기본 결재선 [일반품의서] 일 경우
        //if (test == "") { //기본 결재선 빈칸으로 12칸
        szReturn += "<table class='table_10' style='margin:0px; padding:0px; border:hidden;'><colgroup><col style='width:44.45%'/><col style='width:55.55%'/></colgroup>";

        for (i = 0; i < 6; i++) {
            szReturn += "<tr><td></td><td></td></tr>";
        }
        szReturn += "</table>";

        //협조 요청을 보내게 되면 strConsultJson을 받아 온다. 
    } else if ((getInfo('scInformationAppV') == '010' || getInfo('scInformationAppV') == '110' || getInfo('scInformationAppV') == '011' || getInfo('scInformationAppV') == '111' || getInfo('scInformationApp_coop_only') == '1') && ($('#CONSULT_LIST').val() != "" || (getInfo('strConsultJson') != null && getInfo('strConsultJson') != undefined && getInfo('strConsultJson') != ''))) { // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
        //} else if (test != null && test != undefined && test != '') {
        /*
         협조부서를 받아 올때  결재선형태로 가지고 있음 
        */
        szReturn += "<table class='table_10' style='margin:0px; padding:0px; border:hidden;'><colgroup><col style='width:44.45%'/><col style='width:55.55%'/></colgroup>";

        //사업부 이상만 뽑아서 변수에 담는다
        //KRHQ001:H101:T:TCAD::43:Y:ko-KR;경영분석팀;BUSINESS ANALYSIS TEAM:ko-KR;현대자동차;Hyundai Motor Company:ko-KR;팀;|
        //KRHQ001:H101:T:1DBC::32:Y:ko-KR;기획지원4팀;Corporate Planning Team 4:ko-KR;현대기아차;HKMC:ko-KR;실;|
        //KRHQ001:H101:T:1A38::10:Y:ko-KR;담당사장;담당사장:ko-KR;현대기아차;HKMC:ko-KR;사장;|
        //KRHQ001:H101:T:YK__::20:Y:ko-KR;정보기술본부;HYUNDAI & KIA CORPORATE IT DIVISION:ko-KR;현대기아차;HKMC:ko-KR;본부;|
        //KRHQ001:H101:T:YK_A::28:Y:ko-KR;IT추진사업부;IT INITIATIVES DIVISON:ko-KR;현대기아차;HKMC:ko-KR;사업부;|
        //KRHQ001:H101:T:YKGA::43:Y:ko-KR;IT진단팀;IT ASSESSMENT TEAM:ko-KR;현대기아차;HKMC:ko-KR;팀;|
        for (i = 0; i < aRec.length; i++) {
            var aRecItem = aRec[i].split(":");
            if (aRecItem[5] != "" && parseInt(aRecItem[5]) <= 30) {
                deptArray += aRecItem[3] + "|";
            }
        }

        var consultApv = getInfo('strConsultJson');
        consultApv = $.parseXML(consultApv);
        var elmRoot_Con = $(consultApv).find("steps");

        $(elmRoot_Con).find("division").each(function (i, element) {
            var divisionCode = $(this).find("step > ou").attr("code");

            if (deptArray.indexOf(divisionCode) > -1) {
                if ($(this).find("step").length == 1) {
                    if ($(this).find("taskinfo").attr("result") == "error") {
                        consult_status.push(Common.GetDic("lbl_apv_error")); // 오류
                        //if (UserDept) {
                        //    dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')));
                        //} else {
                        dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')) + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                        //}
                    }
                    else if ($(this).find("step").find("person").length == 1) {
                        //step과 person이 하나이면서 
                        if ($(this).find("step").find("person").find("taskinfo[status='pending']").length > 0 && $(this).find("step").attr('routetype') == 'assist') {
                            consult_status.push(Common.GetDic("lbl_apv_Cooperation_Wait")); // 협조대기
                        }
                        else if ($(this).find("step").find("person").find("taskinfo[status='completed']").length > 0) {
                            consult_status.push(Common.GetDic("lbl_apv_Cooperation_Complete") + ";" + CFN_TransLocalTime($(this).find('step:last() > ou > person > taskinfo').attr('datecompleted'), _UR_DateFormat)); //협조완료
                        }
                        else if ($(this).find("step").find("person").find("taskinfo[status='pending']").length >= 1 && $(this).find("step").attr('routetype') == 'examine') { //step이 하나이고 person이 하나이면서 pending일때 
                            consult_status.push(Common.GetDic("lbl_apv_Examination_Before")); //검토중
                        }
                        else if ($(this).find("step").find("person").find("taskinfo[status='reject']").length >= 1) { //step이 하나이고 person이 하나이면서 pending일때 
                            consult_status.push(Common.GetDic("lbl_apv_Cooperation_Reject") + ";" + CFN_TransLocalTime($(this).find('step:last() > ou > person > taskinfo').attr('datecompleted'), _UR_DateFormat)); //협조거부
                        }
                        //if (UserDept) {
                        //    dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')));
                        //} else {
                        dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')) + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                        //}
                    }

                    //pending를 찾아야함
                } else {
                    if ($(this).find("taskinfo").attr("result") == "error") {
                        consult_status.push(Common.GetDic("lbl_apv_error")); // 오류
                    }
                    else if ($(this).find("step[routetype='examine']").length >= 1 && $(this).find("step[routetype='assist'] > ou > person > taskinfo[status='pending']").length >= 1) {
                        consult_status.push(Common.GetDic("lbl_apv_CompleteReview"));//검토완료
                    } else if ($(this).find("step[routetype='assist']").length >= 1 && $(this).find("step[routetype='examine'] > ou > person > taskinfo[status='pending']").length >= 1) {
                        //person
                        consult_status.push(Common.GetDic("lbl_apv_Examination_Before"));//검토중
                    } else if ($(this).find("step").find("person").find("taskinfo[status='completed']").length == $(this).find("step").find("person").length) {
                        consult_status.push(Common.GetDic("lbl_apv_Cooperation_Complete") + ";" + CFN_TransLocalTime($(this).find('step:last() > ou > person > taskinfo').attr('datecompleted'), _UR_DateFormat)); //협조완료 // 20171220 hpark 협조 날짜오류 수정 - 마지막결재자 날짜 가져오도록

                    } else if ($(this).find("step").find("person").find("taskinfo[status='reject']").length >= 1) {
                        consult_status.push(Common.GetDic("lbl_apv_Cooperation_Reject") + ";" + CFN_TransLocalTime($(this).find("step:last() > ou > person > taskinfo[status='reject']").attr('datecompleted'), _UR_DateFormat));//협조거부 // 20171220 hpark 협조 날짜오류 수정 - 거부한 사용자 날짜 가져오도록

                    }
                    //if ($(this).find("step").find("ou").attr('companycode') == getInfo('etid')) {
                    //    dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')));
                    //} else {
                    dept_name_td_Arr.push(XFN_GetDicInfo($(this).find("step").find("person").attr('ouname') == '' ? ' ' : $(this).find("step").find("person").attr('ouname')) + "(" + XFN_GetDicInfo($(this).find("step").find("ou").attr('companyname')) + ")");
                    //}
                }
            }
        });

        for (i = 0; i < 8; i++) {

            if (i == 0 || i == 2 || i == 4 || i == 6 || i == 8 || i == 10) {
                szReturn += "<tr>";
            }

            if ((dept_name_td_Arr[i] != '') && (dept_name_td_Arr[i] != undefined)) {
                if (getInfo("reuse") == "Y")
                    //  szReturn += "<td>" + dept_name_td_Arr[i] + "</td>";
                    szReturn += "<td><span id='ApvLineRecListTemp' style='font-weight:bold;'>[" + consult_status[i] + "]</span>" + CFN_GetDicDatas(dept_name_td_Arr[i]) + "</td>";
                else
                    if (consult_status[i].split(';')[0] == Common.GetDic("btn_apv_CompleteConsult") || consult_status[i].split(';')[0] == Common.GetDic("lbl_apv_Cooperation_Reject")) {
                        szReturn += "<td><span id='ApvLineRecListTemp' style='font-weight:bold;'>[" + consult_status[i].split(';')[0] + "]</span>" + CFN_GetDicDatas(dept_name_td_Arr[i]) + " " + CFN_TransLocalTime(consult_status[i].split(';')[1], _UR_DateFormat) + "</td>";
                    } else {
                        szReturn += "<td><span id='ApvLineRecListTemp' style='font-weight:bold;'>[" + consult_status[i] + "]</span>" + CFN_GetDicDatas(dept_name_td_Arr[i]) + "</td>";
                    }

            } else {
                szReturn += "<td></td>";
            }

            if (i == 1 || i == 3 || i == 5 || i == 7 || i == 9 || i == 11) {
                szReturn += "</tr>";
            }
        }
        szReturn += "</table>";
    }

    // 2017.9.05 by 김봉옥
    // 협조처 초과 숫자 표시
    if (aRec.length - 1 > 8) {
        var i = aRec.length - 9;
        $("#CooperationCount").html("+&nbsp;" + i);
    } else {
        $("#CooperationCount").html('');
    }

    if (szReturn != "") {
        if (document.getElementById("ReceiveLine") != null) {
            document.getElementById("ReceiveLine").style.display = "";
        }
    }
    return szReturn;
}

//검토자 지정 했을 경우
function DeptLineConsultOK(kind) {
    //var user_code = Common.GetSession("UR_Code");
    //var gr_code = Common.GetSession("GR_Code");
    //var processcode = getInfo("pdef");
    //var processinstanceid = getInfo("piid");

    //oVar.iHeight = 800; oVar.iWidth = 500; oVar.sUrl = "/Approval/ApvProcess/SetApvChargerAndPublicity_Pop.aspx?type=REFERENCEDISPLAY&user=" + user_code + "&group=" + gr_code + "&processcode=" + processcode + "&processinstanceid=" + processinstanceid;
    //sWindowName = "winAction"; oVar.sSize = 'resize';

    if (kind == "CONSULT") {
        //var sWidth = "500";
        //var sHeight = "460";
        //var sWidth = "800";
        var sWidth = "850";
        var sHeight = "760";
        var user_code = _UR_Code;
        var gr_code = getInfo("CurrentApprovalParicipant_approverDepartmentCode") == "" ? _DeptCode : getInfo("CurrentApprovalParicipant_approverDepartmentCode");//Common.GetSession("GR_Code");
        var company_code = getInfo("CurrentApprovalParicipant_approverCompanyCode") == "" ? _DN_Code : getInfo("CurrentApprovalParicipant_approverCompanyCode");
        var strURL = "/Approval/ApvProcess/ConsultBasic_PopUp.aspx?user=" + user_code + "&group=" + gr_code + "&company=" + company_code + "&kind=CONSULT";// + "&Comment=" + Comment; //의견도 ... 
        if (g_IS_TabUI == "Y") { strURL = strURL + "&IS_Tab=Y"; }
        //CFN_OpenWindow(strURL, "", sWidth, sHeight, "scroll");
        parent.Common.ShowDialog("ConsultBasic", "ConsultBasic", Common.GetDic("lbl_Reviewer_select"), strURL + "&openID=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
    }
    else if (kind == "EXAMINATION") {
        //var sWidth = "500";
        //var sHeight = "460";
        //var sWidth = "800";
        var sWidth = "850";
        var sHeight = "760";
        var user_code = _UR_Code;
        var gr_code = getInfo("CurrentApprovalParicipant_approverDepartmentCode") == "" ? _DeptCode : getInfo("CurrentApprovalParicipant_approverDepartmentCode");//Common.GetSession("GR_Code");
        var company_code = getInfo("CurrentApprovalParicipant_approverCompanyCode") == "" ? _DN_Code : getInfo("CurrentApprovalParicipant_approverCompanyCode");
        var strURL = "/Approval/ApvProcess/ConsultBasic_PopUp.aspx?user=" + user_code + "&group=" + gr_code + "&company=" + company_code + "&kind=EXAMINATION";// + "&Comment=" + Comment; //의견도 ... 
        if (g_IS_TabUI == "Y") { strURL = strURL + "&IS_Tab=Y"; }
        parent.Common.ShowDialog("ConsultBasic", "ConsultBasic", Common.GetDic("lbl_Reviewer_select"), strURL + "&openID=" + CFN_GetQueryString("CFN_OpenLayerName"), sWidth, sHeight, "iframe-ifNoScroll");    // 레이블 수정 필요.
    }
    else if (kind == "APPROVE") {
        document.getElementById("APVLIST").value = CFN_XmlToString(m_oApvList);
        requestProcess("APPROVE");
    } else {
        requestProcess("COMPLETECONSULT"); // 협조완료
    }
}
//wsc_검토자지정콜백,검토자지정callback
var UserComment = '';
function DeptLineConsult_CallBack(jsonValue) {
    var UR_Code = jsonValue.UR_Code;
    //파견부서로 검토자 지정 시 원소속으로 발송하는 오류 수정
    //var GR_Code = jsonValue.DN_Code + "_" + jsonValue.DeptCode;

    //var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본
    //var m_oSubReStep;
    //if ($(m_oApvList).find("division[divisiontype='cooperation']").length > 0) {
    //    $(m_oApvList).find("division[divisiontype!='cooperation']").remove();//협조처가 아닌 Division 삭제
    //    m_oSubReStep = $(m_oApvList).find("division[divisiontype='cooperation']"); //원본
    //}
    //else {
    //    m_oApvList = $.parseXML(getInfo("strConsultJson"));
    //    $(m_oApvList).find("division[divisiontype!='COOPERATION_PLACE']").remove();//협조처가 아닌 Division 삭제
    //    m_oSubReStep = $(m_oApvList).find("division[divisiontype='COOPERATION_PLACE']"); //원본
    //}

    //var currentApprovalOrder = $(m_oSubReStep).find("step[processinstanceid='"+getInfo("piid")+"']:has(ou > person > taskinfo[status='pending'])").attr("approvalorder");
    //$(m_oSubReStep).find("step").remove();//열람자 협조처의 협조완료된 STEP 제거

    //var oStep = m_oApvList.createElement("step");
    //var oOU = m_oApvList.createElement("ou");
    //var oPerson = m_oApvList.createElement("person");
    //var oTaskinto = m_oApvList.createElement("taskinfo");

    //$(m_oSubReStep).append(makeStep(m_oApvList, UR_Code, "examine", "normal", currentApprovalOrder));
    //document.getElementById("APVLIST").value = CFN_XmlToString(m_oApvList);
    //requestProcess("ASSIGNREVIEW");


    var curApvList = $.parseXML("<steps></steps>"); //원본
    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본
    var m_oCurrentDivision;
    if ($(m_oApvList).find("division[divisiontype='cooperation']").length > 0) {
        m_oCurrentDivision = $(m_oApvList).find("division[divisiontype='cooperation']:has(step[processinstanceid='" + getInfo("piid") + "'])").parent(); //원본
    }
    else {
        m_oApvList = $.parseXML(getInfo("strConsultJson"));
        m_oCurrentDivision = $(m_oApvList).find("division[divisiontype='COOPERATION_PLACE']:has(step[processinstanceid='" + getInfo("piid") + "'])").parent(); //원본
    }

    var currentApprovalOrder = $(m_oCurrentDivision).find("step[processinstanceid='" + getInfo("piid") + "']:has(ou > person > taskinfo[status='pending'])").attr("approvalorder");

    var oDivision = curApvList.createElement("division");
    curApvList.documentElement.appendChild(oDivision);
    $(oDivision).attr("divisiontype", "COOPERATION_PLACE");
    var divisionTask = curApvList.createElement("taskinfo");
    $(oDivision).append(divisionTask);
    $(divisionTask).attr("kind", "COOPERATION_PLACE");
    $(divisionTask).attr("result", "");
    $(divisionTask).attr("status", "");

    //파견부서로 검토자 지정 시 원소속으로 발송하는 오류 수정
    $(oDivision).append(makeStep(curApvList, UR_Code, "examine", "normal", currentApprovalOrder)); 
    //$(oDivision).append(makeStepCheckDisJob(curApvList, UR_Code, "examine", "normal", currentApprovalOrder, null, null, GR_Code));
    
    document.getElementById("APVLIST").value = CFN_XmlToString(curApvList);
    requestProcess("ASSIGNREVIEW");
}
//TO-DO : 총괄부서 검토자지정콜백
//2019-09-23 BY YJYOO
function AssignExamination_CallBack(jsonValue) {
    var UR_Code = jsonValue.UR_Code;

    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본

    var currentApprovalOrder = $(m_oApvList).find("steps > division[divisiontype='send'] > step:has(ou > role > person > taskinfo[status='pending'])").attr("approvalorder");
    //function makeStep(xmlApv, ur_code, routetype, kind, currentApprovalOrder, stepName, isCheckDeputy) {
    var ExaminationStep = makeStepExamination(m_oApvList, UR_Code, "approve", "normal", currentApprovalOrder, "EXAMINATION_RECEIVE", "EXAMINATION_RECEIVE");

    $(m_oApvList).find("steps > division > step").each(function (i, element) {
           //트랜시스 통제처 검토자지정 기능 추가(롤결재) 200131 홍성빈
        if (($(element).attr("name") == "MANAGE_DEPT" || $(element).attr("name") == "롤결재") && ($(element).attr("approverat") == "Y" || $(element).find("ou > person > taskinfo").attr('status') == "pending")) {
            $(element).after(ExaminationStep);    //총괄부서 삽입
        }
    });

    document.getElementById("APVLIST").value = CFN_XmlToString(m_oApvList);
    requestProcess("CTRL_DEPT_SET_EXMNT");
}

var GongRam = '';
function GongRam_CallBack(jsonValue) {
    GongRam = '';
    for (var i = 0 ; i <= jsonValue.length - 1; i++) {
        GongRam += jsonValue[i];
    }
    requestProcess("REFERENCEDISPLAY");//  공람자 결재 
}

function foldermove_OnClick(gubun) {

    var strURL = "/Approval/UserFolderMgr.aspx?mode=copy";
    //var strURL = "UserFolderMgr.aspx?mode=copy";
    //부서문서함의 폴더 이동 혹은 복사처리
    if (gubun == "unit") {
        strURL += "&uid=" + uid.substring(0, uid.lastIndexOf("_"));
    } else {
        if (gubun != "user") {
            strURL += "&uid=" + uid;
        }
    }
    if (gubun == "" || gubun == null || gubun == undefined) gubun = "user";
    //    moveFolder(strURL, gubun);

    strURL += "&type=" + gubun;
    //신세계 Layer 수정 적용
    //2016-06-08
    //YJYOO
    //Common.ShowDialog("a_userfoldermove", "DivPop_Folder", $("#a_userfoldermove").text(), strURL, "345px", "460px", "iframe-ifNoScroll");
    Common.ShowDialog("a_userfoldermove", "DivPop_Folder", Common.GetDic("lbl_apv_select_userfolder"), strURL, "345px", "430px", "iframe-ifNoScroll");
}

//사용자 폴더 이동 데이터 생성
function foldermove_makeData(szfolderid) {
    var sItems = "";

    sItems += "<item>";
    sItems += makefolderinfo(szfolderid);
    sItems += "</item>";

    return sItems;
}
function makefolderinfo(szfolderid) {

    var apvlist = $('#APVLIST').val();
    var apv = $.parseXML(apvlist);
    var elm = $(apv).find("division").eq(0).find("step");
    var initiator_name, initiator_unit_name, initiator_id, initiator_unit_id;
    $(elm).each(function (idex, element) {
        // TO-DO : 첫번째 step(기안자)의 kind 가 normal 인 케이스가 있음
        //if ($(element).find("taskinfo").attr("kind") == "charge") {
        if (idex == 0) {
            initiator_name = $(element).find("person").attr("name");
            initiator_unit_name = $(element).find("ou").attr("name");
            initiator_id = $(element).find("person").attr("code");
            initiator_unit_id = $(element).find("ou").attr("code");
        }
    });

    var sItems = "";
    sItems += "<folderid>" + szfolderid + "</folderid>";
    sItems += "<formname><![CDATA[" + getInfo("fmnm") + "]]></formname>"; //g_eGalTable.rows[x].cells[2].innerHTML 
    sItems += "<formprefix><![CDATA[" + getInfo("fmpf") + "]]></formprefix>";
    sItems += "<subject><![CDATA[" + $('#SUBJECT').html() + "]]></subject>";
    sItems += "<initiator_name><![CDATA[" + initiator_name + "]]></initiator_name>";
    sItems += "<initiator_unit_name><![CDATA[" + initiator_unit_name + "]]></initiator_unit_name>";
    sItems += "<linkurl><![CDATA[" + getInfo("piid") + ";" + getInfo("piid_parent") + ";" + getInfo("pdef") + "]]></linkurl>";
    //sItems += "<linkkey><![CDATA[" + "undefined" + "]]></linkkey>";
    //sItems += "<wfmode><![CDATA[" + "undefined" + "]]></wfmode>";
    //sItems += "<deputystate><![CDATA[" + "undefined" + "]]></deputystate>";
    sItems += "<initiator_id><![CDATA[" + initiator_id + "]]></initiator_id>";
    sItems += "<initiator_unit_id><![CDATA[" + initiator_unit_id + "]]></initiator_unit_id>";
    /*오토에버 user_folderlist 항목 추가 _최우석 */
    sItems += "<fiid><![CDATA[" + getInfo('fiid') + "]]></fiid>";
    sItems += "<scid><![CDATA[" + getInfo('scid') + "]]></scid>";
    sItems += "<fmid><![CDATA[" + getInfo('fmid') + "]]></fmid>";


    return sItems;
}
//템플릿 추가,삭제 버튼 활성화
//TO-DO : 2017-09-09 템플릿 추가/삭제 기능은 품의서,협조전,대외문 만 사용한다.
function TemplateButtonDisplay() {
    //if (getInfo("fmpf") == "GWOK_GENERAL" || getInfo("fmpf") == "GWOE_COOPER_CL_W01" || getInfo("fmpf") == "GWOJ_VENDOR_W01") {
    //TO-DO : 마이그레이션 된 결재문서 DOC_SUMMARY에 값을 M으로 넣었음 재사용 방지(복사,재사용,템플릿 추가/삭제 동일)
    //2019-02-12 BY YJYOO
    if (getInfo("UseAddTemplate") == "Y" && getInfo("DOC_SUMMARY") != "M") {
        if (getInfo("templateuse_yn") == "Y") {
            $("#divbtAddTemplate").hide();
            $("#divbtRemoveTemplate").show();
        }
        else {
            $("#divbtAddTemplate").show();
            $("#divbtRemoveTemplate").hide();
        }

    }
    return false;
}

function approvalRequset(pContents) {

    alert('메일발송 의견은 : ' + pContents);

}

//TO-DO : 협조처 정보 정제작업
function setSendConsultCheck() {
    var arrReturn = [];
    var HasSend = false;     //보낼 대상자가 있는지 확인
    var HasMustSend = true;//무조건 보내야 결재됨.
    var transferCooperationInfo = "";
    var sCONSULT_LIST = $("#CONSULT_LIST").val();
    var aItemList = $("#CONSULT_LIST").val().split("|");
    var sSendConsultKind = Common.GetBaseConfig('SendConsultKind');

    if (sCONSULT_LIST == "") {
        arrReturn.push(HasSend);
        arrReturn.push(false);
        arrReturn.push(sCONSULT_LIST);
        arrReturn.push(transferCooperationInfo);
        return arrReturn;
    }

    //내 다음 결재자 중 협조 요청 권한 있는사람(is_manager)가 있는지 확인
    m_evalXML = $.parseXML($("#APVLIST").val())
    var elmRoot = $(m_evalXML).find("steps");
    // TO-DO : 현 결재자이후의 결재자 체크하는 로직인데 기안자를 제외한 전체 결재선을 체크함
    //선결재 N인 경우는 중 최종 결재자가 회장(최상위 부서) 인 경우에 이전 결재자가 전체 협조 요청 보냄
    // 20181204 박한 HAEA ES양식에서 CEO 전 모든협조가 완료되어 있어야되는조건 추가
    var sHighestDeptCode = Common.GetBaseConfig('HighestDeptCode');
    if ((sSendConsultKind == "N" || getInfo("fmpf") == "PR_INVST_W01") && sHighestDeptCode != "") {
        $(elmRoot).find("division > step > ou[code!='" + sHighestDeptCode + "'] > person:has(taskinfo[kind!='charge'][result='inactive'])").each(function (i, elm) {
            if ($(elm).attr("dutycode") != "") {
                //is_manager 확인
                var Gr_code = Common.GetObjectInfo("UR", $(elm).attr("code"), "GR_Code").Table[0].GR_Code; //$(elm).parent().attr("companycode") + "_" + $(elm).parent().attr("code");
                var ManagerCode = Common.GetObjectInfo("GR", Gr_code, "ManagerCode").Table[0].ManagerCode;
                if ($(elm).attr("code") == ManagerCode) HasMustSend = false;
            }
        });
    } else {
        //TO-DO : 글로비스 추가/변경예산 신청서 및 법인인감 신청서일 경우 수신처 결재선에 전결권자 존재하기 때문에 체크 로직에서 Role 뒤로 모두제거
        //2019-03-06 BY YJYOO
        //지마린서비스 법인인감신청서 추가
        if (getInfo("fmpf") == "GWOK_ADD_BUDGET" || getInfo("fmpf") == "GWOK_BUDGET_RQST" || getInfo("fmpf") == "HWGP_CORPSEALRQST_W01" || getInfo("fmpf") == "HWGP_CORPSEALRQST_OVER_W01" || getInfo("fmpf") == "HWGP_CORPSEALRQST_EXPIRE_W01" || getInfo("fmpf") == "WF_GMARINE_CORPSEAL" || getInfo("fmpf") == "WF_GMARINE_CORPSEAL_O" || getInfo("fmpf") == "WF_GMARINE_CORPSEAL_E") {
            var is_role = false;
            $(elmRoot).find("division > step").each(function (i, elm) {
                if ($(elm).attr("unittype") == "role") {
                    $(elm).remove();
                    is_role = true;
                }
                else {
                    if (is_role) {
                        $(elm).remove();
                    }
                }
            });
        }

        // 다음 결재자의 정보 (persion 노드)
        $(elmRoot).find("division > step > ou > person:has(taskinfo[kind!='charge'][result='inactive'])").each(function (i, elm) {
            if ($(elm).attr("dutycode") != "") {
                //is_manager 확인
                var Gr_code = Common.GetObjectInfo("UR", $(elm).attr("code"), "GR_Code").Table[0].GR_Code; //$(elm).parent().attr("companycode") + "_" + $(elm).parent().attr("code");
                var ManagerCode = Common.GetObjectInfo("GR", Gr_code, "ManagerCode").Table[0].ManagerCode;

                // 터키(HAOS) 협조/신청 제외한 나머지 양식 협조요청 발송 최소직책 로직 추가 (참고 > 다음 결재자의 직책코드으로 판단). beokim. 2020-10-13
                if (_DN_Code == "HA10") {
                    var DO_NOT_REQUESTCONSULT_JOBTITLE = "^*^"; // 기초설정이 없는 경우 빈 값으로 리턴되므로 임의값 지정.
                    var REQUESTCONSULT_LEAST_JOBTITLE_FORM = "^*^";
                    var NEXT_APPROVER_DUTYCODE = "^*^";
                    DO_NOT_REQUESTCONSULT_JOBTITLE = Common.GetBaseConfig("DO_NOT_REQUESTCONSULT_JOBTITLE", _DN_ID);
                    REQUESTCONSULT_LEAST_JOBTITLE_FORM = Common.GetBaseConfig("REQUESTCONSULT_LEAST_JOBTITLE_FORM", _DN_ID);
                    NEXT_APPROVER_DUTYCODE = $(elm).attr("dutycode");

                    // 대상양식 + 다음결재자 직책이 협조요청을 보내면 안되는 경우
                    if (REQUESTCONSULT_LEAST_JOBTITLE_FORM.indexOf(getInfo("fmpf")) > -1 && DO_NOT_REQUESTCONSULT_JOBTITLE.indexOf(NEXT_APPROVER_DUTYCODE) > -1) {
                        HasMustSend = true; // 협조요청 강제화 (결재버튼 안보임)
                        return false; // 일치하는 조건 발생 시 탐색 중단
                    }
                    else {
                        if ($(elm).attr("code") == ManagerCode) {
                            HasMustSend = false;
                            return false;
                        }
                    }                    
                }
                else {
                    // 기존로직 (2020-10-13)
                    if ($(elm).attr("code") == ManagerCode) HasMustSend = false;
                }
            }
        });
    }
    if (HasMustSend == true || getInfo("pdef") == "STEP3_PATTERN") sSendConsultKind = "Y"; //무조건 보낼 시에는 전체 다 보냄.
    
    for (var i = 0; i < aItemList.length; i++) {
        var aItem = aItemList[i].split(":");
        if (aItem.length > 6) {
            if (aItem[6] == "N") {
                if (sSendConsultKind == "Y") {
                    //전체 보내기
                    if (aItem[3] != "1E__") {
                        transferCooperationInfo += String.format("{0};{1};{2};{3};{4}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4]);
                        sCONSULT_LIST = sCONSULT_LIST.replace(
                                            String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "N", aItem[7], aItem[8], aItem[9]),
                                            String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "Y", aItem[7], aItem[8], aItem[9]));

                        HasSend = true;
                    }
                } else {
                    //팀.실 구분 해서 보내기
                    var strWhere = "";
                    var orgGradeCode = "";
                    var RoleTEMP = $.parseXML($("#APVLIST").val());
                    var elmRootTEMP = $(RoleTEMP).find("steps");
                    $(elmRootTEMP).find("division > step[name='롤결재']").remove(); //롤결재자가 다음결재자일시 전부발송해서 제외 200131 홍성빈
                    if (getInfo("CurrentApprovalParicipant_approverCompanyCode") != null && getInfo("CurrentApprovalParicipant_approverDepartmentCode") != "") {
                        //2019.11.02 트랜시스, 협조처 발송 시 결재자가 아닌 다음결재자 orgGrade 미만인 협조처에 발송.
                        if (_DN_Code == "H104" && $(elmRootTEMP).find("division > step[approvalorder='" + getInfo("approvalOrder") + "']").next().length > 0) {
                            var parentDeptCode = $($(elmRootTEMP).find("division > step[approvalorder='" + getInfo("approvalOrder") + "']").next()).find("ou").attr("code");
                            strWhere = String.format("A.DN_Code='{0}' AND A.DeptCode='{1}'", getInfo("CurrentApprovalParicipant_approverCompanyCode"), parentDeptCode);
                            var oRet = Common.GetObjectInfo("GR", "", "", strWhere).Table[0];
                            orgGradeCode = oRet.OrgGradeCode;
                        } else {
                            strWhere = String.format("A.DN_Code='{0}' AND A.DeptCode='{1}'", getInfo("CurrentApprovalParicipant_approverCompanyCode"), getInfo("CurrentApprovalParicipant_approverDepartmentCode"));
                            var oRet = Common.GetObjectInfo("GR", "", "", strWhere).Table[0];
                            orgGradeCode = oRet.OrgGradeCode;
                        }
                    }

                    if (_DN_Code == "H104") {
                        //if (parseInt(aItem[5]) >= parseInt(Common.GetSession("OrgGradeCode"))) {
                        if (orgGradeCode != undefined && orgGradeCode != "" && orgGradeCode != "undefined") {
                            if (parseInt(aItem[5]) > parseInt(orgGradeCode)) {//현 조직의 OrgGradeCode를 받아오는 것으로 수정
                                transferCooperationInfo += String.format("{0};{1};{2};{3};{4}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4]);
                                sCONSULT_LIST = sCONSULT_LIST.replace(
                                                    String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "N", aItem[7], aItem[8], aItem[9]),
                                                    String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "Y", aItem[7], aItem[8], aItem[9]));
                                HasSend = true;
                            }
                        }
                    } else {
                        //if (parseInt(aItem[5]) >= parseInt(Common.GetSession("OrgGradeCode"))) {
                        if (orgGradeCode != undefined && orgGradeCode != "" && orgGradeCode != "undefined") {
                            if (parseInt(aItem[5]) >= parseInt(orgGradeCode)) {//현 조직의 OrgGradeCode를 받아오는 것으로 수정
                                transferCooperationInfo += String.format("{0};{1};{2};{3};{4}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4]);
                                sCONSULT_LIST = sCONSULT_LIST.replace(
                                                    String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "N", aItem[7], aItem[8], aItem[9]),
                                                    String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "Y", aItem[7], aItem[8], aItem[9]));
                                HasSend = true;
                            }
                        }
                    }
                }
            }
        }
    }
    arrReturn.push(HasSend);
    arrReturn.push(HasMustSend);
    arrReturn.push(sCONSULT_LIST);
    arrReturn.push(transferCooperationInfo);
    return arrReturn;
}

//TO-DO : 협조처 변경시 협조처 목록 작업
function EditSendConsultCheck() {

    var arrReturn = [];
    var HasSend = false;     //보낼 대상자가 있는지 확인
    var HasMustSend = true;//무조건 보내야 결재됨.
    var transferCooperationInfo = "";
    var sCONSULT_LIST = $("#CONSULT_LIST").val();
    var aItemList = $("#CONSULT_LIST").val().split("|");

    if (sCONSULT_LIST == "") {
        arrReturn.push(HasSend);
        arrReturn.push(false);
        arrReturn.push(sCONSULT_LIST);
        arrReturn.push(transferCooperationInfo);
        return arrReturn;
    }
    for (var i = 0; i < aItemList.length; i++) {
        var aItem = aItemList[i].split(":");
        if (aItem.length > 6) {
            if (aItem[6] == "N") {
                //전체 보내기
                if (aItem[3] != "1E__") {
                    transferCooperationInfo += String.format("{0};{1};{2};{3};{4};C|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4]);
                    sCONSULT_LIST = sCONSULT_LIST.replace(
                                        String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "N", aItem[7], aItem[8], aItem[9]),
                                        String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "Y", aItem[7], aItem[8], aItem[9]));
                    HasSend = true;
                }
            }
        }
    }
    arrReturn.push(HasSend);
    arrReturn.push(HasMustSend);
    arrReturn.push(sCONSULT_LIST);
    arrReturn.push(transferCooperationInfo);
    return arrReturn;
}

//TO-DO : 협조 취소시 CONSULT_LIST의 발송여부를 N으로 복원한다.
function setSendConsultCancel() {
    var arrSendDept = [];
    var sCONSULT_LIST = $("#CONSULT_LIST").val();
    var aItemList = $("#CONSULT_LIST").val().split("|");
    var RequestApprovalOrder = getInfo("approvalOrder");

    //협조 취소하는 사람의 ApprovalOrder로 발송된 협조처의 발송여부를 N으로 원복한다
    m_evalXML = $.parseXML(getInfo("strConsultJson"));
    var elmRoot = $(m_evalXML).find("steps");

    $(elmRoot).find("division[parentapprovalorder='" + RequestApprovalOrder + "']").each(function (i, elm) {
        if ($(elm).attr("oucode") != "") {
            arrSendDept.push($(elm).attr("oucode"));
        }
    });

    for (var i = 0; i < aItemList.length; i++) {
        var aItem = aItemList[i].split(":");
        var hasSendDept = false;
        for (var x = 0; x < arrSendDept.length; x++) {
            if (arrSendDept[x] == aItem[3]) {
                hasSendDept = true;
                break;
            }
        }
        if (hasSendDept && aItem[6] == "Y") {
            sCONSULT_LIST = sCONSULT_LIST.replace(
                                String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "Y", aItem[7], aItem[8], aItem[9]),
                                String.format("{0}:{1}:{2}:{3}:{4}:{5}:{6}:{7}:{8}:{9}|", aItem[0], aItem[1], aItem[2], aItem[3], aItem[4], aItem[5], "N", aItem[7], aItem[8], aItem[9]));
        }
    }
    $("#CONSULT_LIST").val(sCONSULT_LIST);
}

function setBookingApprovalReferenceList() {
    //설명 : 부서/개인 참조정보를 array처리
    //표현 : {법인코드}+';'+{['R'ole:'T'eam:'U'ser] 구분}+';'+{팀코드}+';'+{사번} + {'C'reate:'D'elete} + {업무구분코드[COPERATION_COMPANY]} +{공람/참조 종류코드[REFERENCE_BEFORE,REFERENCE_AFTER,DISPLAY_DRAFT,DISPLAY_ARBITRARILY]} + "|" 
    //샘플 : "HMMA;T;TOO1;U001;C;COPERATION_COMPANY;DISPLAY_DRAFT|HMMA;U;;User002;D;;COPERATION_COMPANY;DISPLAY_DRAFT"
    var referenceDisplayList = "";
    m_evalXML = $.parseXML($("#APVLIST").val())
    var elmCCInfoOuList = $(m_evalXML).find("steps > ccinfo > ou");
    $(elmCCInfoOuList).each(function (i, elm) {
        //referenceDisplayList += $(elm).attr("companycode") + ";T;" + $(elm).attr("code") + ";;C;COPERATION_COMPANY;REFERENCE_AFTER|";
        //referenceDisplayList += $(elm).attr("farmcode") + ";" + $(elm).attr("companycode") + ";T;" + $(elm).attr("code") + ";;C;COPERATION_COMPANY;REFERENCE_AFTER|";
        referenceDisplayList += $(elm).attr("originidccode") + ";" + $(elm).attr("companycode") + ";T;" + $(elm).attr("code") + ";;C;COPERATION_COMPANY;REFERENCE_AFTER|";
        $("#REFERENCE_DISPLAY_INFO").val(referenceDisplayList);
    })
}

//function makeStep(xmlApv, ur_code, routetype, kind, currentApprovalOrder,stepName) {
//    var oStep = xmlApv.createElement("step");
//    var oOU = xmlApv.createElement("ou");
//    var oPerson = xmlApv.createElement("person");
//    var oTaskinfo = xmlApv.createElement("taskinfo");
//    $(oStep).append(oOU);
//    $(oOU).append(oPerson);
//    $(oPerson).append(oTaskinfo);

//    var tbUR = Common.GetObjectInfo('UR', ur_code).Table[0];
//    var tbDN = Common.GetObjectInfo('DN', tbUR.DN_Code).Table[0];

//    $(oStep).attr("unittype", "person");
//    $(oStep).attr("routetype", routetype);
//    $(oStep).attr("name", (stepName != null && stepName != undefined && stepName != "") ? stepName : "normal");
//    $(oStep).attr("approvalorder", (currentApprovalOrder != null && currentApprovalOrder != undefined && currentApprovalOrder != "") ? String(parseInt(currentApprovalOrder) + 100) : "");

//    $(oOU).attr("code", tbUR.DeptCode);
//    $(oOU).attr("name", tbUR.ExGroupName);
//    $(oOU).attr("companycode", tbUR.DN_Code);
//    $(oOU).attr("companyname", tbDN.ExDisplayName);

//    $(oPerson).attr("code", tbUR.UR_Code);
//    $(oPerson).attr("name", tbUR.ExDisplayName);
//    $(oPerson).attr("position", tbUR.JobPositionCode);
//    $(oPerson).attr("positionname", tbUR.ExJobPositionName);
//    $(oPerson).attr("title", "");
//    $(oPerson).attr("level", "");
//    $(oPerson).attr("ouname", tbUR.ExGroupName);
//    $(oPerson).attr("oucode", tbUR.DeptCode);
//    $(oPerson).attr("dutycode", tbUR.JobTitleCode);
//    $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
//    $(oPerson).attr("batchAt", '');
//    $(oPerson).attr("delegationAt", '');

//    if (kind != null)
//        $(oTaskinfo).attr("kind", kind);
//    else
//        $(oTaskinfo).attr("kind", "normal");

//    $(oTaskinfo).attr("status", "inactive");
//    $(oTaskinfo).attr("result", "inactive");
//    return oStep;
//}

//TO-DO : 대결자 설정 체크 로직 추가
function makeStep(xmlApv, ur_code, routetype, kind, currentApprovalOrder, stepName, isCheckDeputy) {
    var oStep = xmlApv.createElement("step");
    var oOU = xmlApv.createElement("ou");
    var oPerson = xmlApv.createElement("person");
    var oTaskinfo = xmlApv.createElement("taskinfo");
    $(oStep).append(oOU);
    $(oOU).append(oPerson);
    $(oPerson).append(oTaskinfo);

    var tbUR;
    var tbOriginUR = null;
    //TO-DO : 대결 사용여부 플래그 확인하여 대결자 정보 설정
    if (isCheckDeputy != null && isCheckDeputy != undefined && isCheckDeputy == "Y") {
        var today = new Date();
        var mm = today.getMonth() + 1;
        var dd = today.getDate();
        var yyyy = today.getFullYear();
        if (today.getDate() < 10) {
            dd = '0' + today.getDate()
        }
        if (mm < 10) {
            mm = '0' + mm
        }
        var tbUR = Common.GetObjectInfo("UR", ur_code).Table[0];
        if (tbUR != null && tbUR.Deputy_YN == "Y" && parseInt(tbUR.DeputyToDate.replace(/-/g, "")) >= parseInt(yyyy + "" + mm + "" + dd)) {
            tbUR = Common.GetObjectInfo('UR', tbUR.DeputyCode).Table[0];
            tbOriginUR = Common.GetObjectInfo('UR', ur_code).Table[0];
        }
    }
    else {
        tbUR = Common.GetObjectInfo('UR', ur_code).Table[0];
    }

    var tbDN = Common.GetObjectInfo('DN', tbUR.DN_Code).Table[0];

    $(oStep).attr("unittype", "person");
    $(oStep).attr("routetype", routetype);
    $(oStep).attr("name", (stepName != null && stepName != undefined && stepName != "") ? stepName : "normal");
    $(oStep).attr("approvalorder", (currentApprovalOrder != null && currentApprovalOrder != undefined && currentApprovalOrder != "") ? String(parseInt(currentApprovalOrder) + 100) : "");

    $(oOU).attr("code", tbUR.DeptCode);
    $(oOU).attr("name", tbUR.ExGroupName);
    $(oOU).attr("companycode", tbUR.DN_Code);
    $(oOU).attr("companyname", tbDN.ExDisplayName);
    $(oOU).attr("originidccode", tbDN.FarmCode);

    $(oPerson).attr("code", tbUR.UR_Code);
    $(oPerson).attr("name", tbUR.ExDisplayName);
    $(oPerson).attr("position", tbUR.JobPositionCode);
    $(oPerson).attr("positionname", tbUR.ExJobPositionName);
    $(oPerson).attr("title", "");
    $(oPerson).attr("level", "");
    $(oPerson).attr("ouname", tbUR.ExGroupName);
    $(oPerson).attr("oucode", tbUR.DeptCode);
    if (stepName == "롤결재" && _DN_Code == "H104")
    {   //롤결재일시 협조처 발송제외를 위해 dutycode 삭제
        $(oPerson).attr("dutycode", '');
        $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
    }
    else
    {
        if (tbOriginUR != null && tbOriginUR != undefined && $(tbOriginUR).length > 0) {
            $(oPerson).attr("dutycode", tbOriginUR.JobTitleCode);
            $(oPerson).attr("dutyname", tbOriginUR.ExJobTitleName);
        }
        else {
            $(oPerson).attr("dutycode", tbUR.JobTitleCode);
            $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
        }
    }
    $(oPerson).attr("batchAt", '');
    $(oPerson).attr("delegationAt", '');

    if (kind != null)
        $(oTaskinfo).attr("kind", kind);
    else
        $(oTaskinfo).attr("kind", "normal");

    $(oTaskinfo).attr("status", "inactive");
    $(oTaskinfo).attr("result", "inactive");
    return oStep;
}

//TO-DO : 대결자 설정 체크 로직 추가
function makeStepExamination(xmlApv, ur_code, routetype, kind, currentApprovalOrder, stepName, documentStepCode) {
    var oStep = xmlApv.createElement("step");
    var oOU = xmlApv.createElement("ou");
    var oPerson = xmlApv.createElement("person");
    var oTaskinfo = xmlApv.createElement("taskinfo");
    $(oStep).append(oOU);
    $(oOU).append(oPerson);
    $(oPerson).append(oTaskinfo);

    var tbUR = Common.GetObjectInfo('UR', ur_code).Table[0];
    var tbOriginUR = null;


    var tbDN = Common.GetObjectInfo('DN', tbUR.DN_Code).Table[0];

    $(oStep).attr("unittype", "person");
    $(oStep).attr("routetype", routetype);
    $(oStep).attr("name", (stepName != null && stepName != undefined && stepName != "") ? stepName : "normal");
    $(oStep).attr("approvalorder", (currentApprovalOrder != null && currentApprovalOrder != undefined && currentApprovalOrder != "") ? String(parseInt(currentApprovalOrder) + 100) : "");

    $(oOU).attr("code", tbUR.DeptCode);
    $(oOU).attr("name", tbUR.ExGroupName);
    $(oOU).attr("companycode", tbUR.DN_Code);
    $(oOU).attr("companyname", tbDN.ExDisplayName);
    $(oOU).attr("originidccode", tbDN.FarmCode);

    $(oPerson).attr("code", tbUR.UR_Code);
    $(oPerson).attr("name", tbUR.ExDisplayName);
    $(oPerson).attr("position", tbUR.JobPositionCode);
    $(oPerson).attr("positionname", tbUR.ExJobPositionName);
    $(oPerson).attr("title", "");
    $(oPerson).attr("level", "");
    $(oPerson).attr("ouname", tbUR.ExGroupName);
    $(oPerson).attr("oucode", tbUR.DeptCode);
    if (tbOriginUR != null && tbOriginUR != undefined && $(tbOriginUR).length > 0) {
        $(oPerson).attr("dutycode", tbOriginUR.JobTitleCode);
        $(oPerson).attr("dutyname", tbOriginUR.ExJobTitleName);
    }
    else {
        $(oPerson).attr("dutycode", tbUR.JobTitleCode);
        $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
    }
    $(oPerson).attr("batchAt", '');
    $(oPerson).attr("delegationAt", '');
    if (documentStepCode != null)
        $(oPerson).attr("documentstepcode", documentStepCode);

    if (kind != null)
        $(oTaskinfo).attr("kind", kind);
    else
        $(oTaskinfo).attr("kind", "normal");

    $(oTaskinfo).attr("status", "inactive");
    $(oTaskinfo).attr("result", "inactive");
    return oStep;
}
//TO-DO : 대결자 설정 체크 로직 추가
//TO-DO : 겸직부서 체크 로직 추가
function makeStepCheckAddJob(xmlApv, ur_code, routetype, kind, currentApprovalOrder, stepName, isCheckDeputy, gr_code) {
    var oStep = xmlApv.createElement("step");
    var oOU = xmlApv.createElement("ou");
    var oPerson = xmlApv.createElement("person");
    var oTaskinfo = xmlApv.createElement("taskinfo");
    $(oStep).append(oOU);
    $(oOU).append(oPerson);
    $(oPerson).append(oTaskinfo);
    //debugger;
    var tbUR;
    var tbOriginUR = null;
    //TO-DO : 대결 사용여부 플래그 확인하여 대결자 정보 설정
    if (isCheckDeputy != null && isCheckDeputy != undefined && isCheckDeputy == "Y") {
        var today = new Date();
        var mm = today.getMonth() + 1;
        var dd = today.getDate();
        var yyyy = today.getFullYear();
        if (today.getDate() < 10) {
            dd = '0' + today.getDate()
        }
        if (mm < 10) {
            mm = '0' + mm
        }
        var tbUR = Common.GetObjectInfo("UR", ur_code).Table[0];
        if (tbUR != null && tbUR.Deputy_YN == "Y" && parseInt(tbUR.DeputyToDate.replace(/-/g, "")) >= parseInt(yyyy + "" + mm + "" + dd)) {
            tbUR = Common.GetObjectInfo('UR', tbUR.DeputyCode).Table[0];
            tbOriginUR = Common.GetObjectInfo('UR', ur_code).Table[0];
        }
    }
    else {
        tbUR = Common.GetObjectInfo('UR', ur_code).Table[0];
    }

    /* 20190117 결재선 오류시 문구 안내 */
    if (tbUR == null || tbUR == undefined) {
        Common.Warning(Common.GetDic("msg_apv_ApprovalLineSetFail2"));  // 결재선 세팅을 실패하였습니다.
        //return false;
    }
    else if (gr_code != tbUR.GR_Code) {
        //tbUR = Common.GetObjectInfo('AJ', ur_code).Table[0];
        tbUR = Common.GetObjectInfo('AJ', "", "", "C.UR_CODE='" + ur_code + "' AND D.GR_CODE='" + gr_code + "'", "").Table[0];
    }

    /* 20190107 결재선 오류시 문구 안내 */
    if (tbUR == null || tbUR == undefined) {
        Common.Warning(Common.GetDic("msg_apv_ApprovalLineSetFail2"));  // 결재선 세팅을 실패하였습니다.
        //return false;
    }

    var tbDN = Common.GetObjectInfo('DN', tbUR.DN_Code).Table[0];

    $(oStep).attr("unittype", "person");
    $(oStep).attr("routetype", routetype);
    $(oStep).attr("name", (stepName != null && stepName != undefined && stepName != "") ? stepName : "normal");
    $(oStep).attr("approvalorder", (currentApprovalOrder != null && currentApprovalOrder != undefined && currentApprovalOrder != "") ? String(parseInt(currentApprovalOrder) + 100) : "");

    $(oOU).attr("code", tbUR.DeptCode);
    $(oOU).attr("name", tbUR.ExGroupName);
    $(oOU).attr("companycode", tbUR.DN_Code);
    $(oOU).attr("companyname", tbDN.ExDisplayName);
    $(oOU).attr("originidccode", tbDN.FarmCode);

    $(oPerson).attr("code", tbUR.UR_Code);
    $(oPerson).attr("name", tbUR.ExDisplayName);
    $(oPerson).attr("position", tbUR.JobPositionCode);
    $(oPerson).attr("positionname", tbUR.ExJobPositionName);
    $(oPerson).attr("title", "");
    $(oPerson).attr("level", "");
    $(oPerson).attr("ouname", tbUR.ExGroupName);
    $(oPerson).attr("oucode", tbUR.DeptCode);
    if (tbOriginUR != null && tbOriginUR != undefined && $(tbOriginUR).length > 0) {
        $(oPerson).attr("dutycode", tbOriginUR.JobTitleCode);
        $(oPerson).attr("dutyname", tbOriginUR.ExJobTitleName);
    }
    else {
        $(oPerson).attr("dutycode", tbUR.JobTitleCode);
        $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
    }
    $(oPerson).attr("batchAt", '');
    $(oPerson).attr("delegationAt", '');

    if (kind != null)
        $(oTaskinfo).attr("kind", kind);
    else
        $(oTaskinfo).attr("kind", "normal");

    $(oTaskinfo).attr("status", "inactive");
    $(oTaskinfo).attr("result", "inactive");
    return oStep;
}

//TO-DO : 대결자 설정 체크 로직 추가
//TO-DO : 검토자 파견 설정 체크 로직 추가
function makeStepCheckDisJob(xmlApv, ur_code, routetype, kind, currentApprovalOrder, stepName, isCheckDeputy, gr_code) {
    var oStep = xmlApv.createElement("step");
    var oOU = xmlApv.createElement("ou");
    var oPerson = xmlApv.createElement("person");
    var oTaskinfo = xmlApv.createElement("taskinfo");
    $(oStep).append(oOU);
    $(oOU).append(oPerson);
    $(oPerson).append(oTaskinfo);

    var tbUR;
    var tbOriginUR = null;
    //TO-DO : 대결 사용여부 플래그 확인하여 대결자 정보 설정
    if (isCheckDeputy != null && isCheckDeputy != undefined && isCheckDeputy == "Y") {
        var today = new Date();
        var mm = today.getMonth() + 1;
        var dd = today.getDate();
        var yyyy = today.getFullYear();
        if (today.getDate() < 10) {
            dd = '0' + today.getDate()
        }
        if (mm < 10) {
            mm = '0' + mm
        }
        var tbUR = Common.GetObjectInfo("UR", ur_code).Table[0];
        if (tbUR != null && tbUR.Deputy_YN == "Y" && parseInt(tbUR.DeputyToDate.replace(/-/g, "")) >= parseInt(yyyy + "" + mm + "" + dd)) {
            tbUR = Common.GetObjectInfo('UR', tbUR.DeputyCode).Table[0];
            tbOriginUR = Common.GetObjectInfo('UR', ur_code).Table[0];
        }
    }
    else {
        tbUR = Common.GetObjectInfo('UR', ur_code).Table[0];
    }
    
    //파견자 체크
    if (tbUR == null || tbUR == undefined) {
        Common.Warning(Common.GetDic("msg_apv_ApprovalLineSetFail2"));  // 결재선 세팅을 실패하였습니다.
        //return false;
    }
    else if (gr_code != tbUR.GR_Code) {
        tbUR = Common.GetObjectInfo('AJ', "", "", "C.UR_CODE='" + ur_code + "' AND D.GR_CODE='" + gr_code + "'", "").Table[0];
    }

    var tbDN = Common.GetObjectInfo('DN', tbUR.DN_Code).Table[0];

    $(oStep).attr("unittype", "person");
    $(oStep).attr("routetype", routetype);
    $(oStep).attr("name", (stepName != null && stepName != undefined && stepName != "") ? stepName : "normal");
    $(oStep).attr("approvalorder", (currentApprovalOrder != null && currentApprovalOrder != undefined && currentApprovalOrder != "") ? String(parseInt(currentApprovalOrder) + 100) : "");

    $(oOU).attr("code", tbUR.DeptCode);
    $(oOU).attr("name", tbUR.ExGroupName);
    $(oOU).attr("companycode", tbUR.DN_Code);
    $(oOU).attr("companyname", tbDN.ExDisplayName);
    $(oOU).attr("originidccode", tbDN.FarmCode);

    $(oPerson).attr("code", tbUR.UR_Code);
    $(oPerson).attr("name", tbUR.ExDisplayName);
    $(oPerson).attr("position", tbUR.JobPositionCode);
    $(oPerson).attr("positionname", tbUR.ExJobPositionName);
    $(oPerson).attr("title", "");
    $(oPerson).attr("level", "");
    $(oPerson).attr("ouname", tbUR.ExGroupName);
    $(oPerson).attr("oucode", tbUR.DeptCode);
    if (stepName == "롤결재" && _DN_Code == "H104") {   //롤결재일시 협조처 발송제외를 위해 dutycode 삭제
        $(oPerson).attr("dutycode", '');
        $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
    }
    else {
        if (tbOriginUR != null && tbOriginUR != undefined && $(tbOriginUR).length > 0) {
            $(oPerson).attr("dutycode", tbOriginUR.JobTitleCode);
            $(oPerson).attr("dutyname", tbOriginUR.ExJobTitleName);
        }
        else {
            $(oPerson).attr("dutycode", tbUR.JobTitleCode);
            $(oPerson).attr("dutyname", tbUR.ExJobTitleName);
        }
    }
    $(oPerson).attr("batchAt", '');
    $(oPerson).attr("delegationAt", '');

    if (kind != null)
        $(oTaskinfo).attr("kind", kind);
    else
        $(oTaskinfo).attr("kind", "normal");

    $(oTaskinfo).attr("status", "inactive");
    $(oTaskinfo).attr("result", "inactive");
    return oStep;
}

function makeRoleStep(xmlApv, stepname, role_code, role_dn_code, kind, currentApprovalOrder, documentstepcode) {
    var oStep = xmlApv.createElement("step");
    var oOU = xmlApv.createElement("ou");
    var oRole = xmlApv.createElement("role");
    var oTaskinfo = xmlApv.createElement("taskinfo");
    var objRole = Common.GetObjectInfo('RO', role_code, "", "DN_Code='" + role_dn_code + "'").Table[0];
    if (objRole != null && objRole != undefined) {
        var role_name = objRole.ROLE_NAME;
        var role_companycode = objRole.DN_CODE;
        var role_companyname = Common.GetObjectInfo('DN', objRole.DN_CODE).Table[0].ExDisplayName;
        var role_language = (role_name.indexOf(";") > -1 && role_name.split(/;/g)[0] != "") ? role_name.split(/;/g)[0] : _Language;

        $(oStep).append(oOU);
        $(oOU).append(oRole);
        $(oRole).append(oTaskinfo);

        $(oStep).attr("unittype", "role");
        $(oStep).attr("routetype", "approve");
        if (role_language != "") {
            $(oStep).attr("language", role_language);
        }


        if (stepname != null)
            $(oStep).attr("name", stepname);
        else
            //$(oStep).attr("name", "normal");
            $(oStep).attr("name", role_name);

        $(oStep).attr("approvalorder", (currentApprovalOrder != null && currentApprovalOrder != undefined && currentApprovalOrder != "") ? String(parseInt(currentApprovalOrder) + 100) : "");

        //TO-DO : 현재 ROLE의 회사 코드, 회사명 획득할 수 있는 정확한 방법이 존재하지 않음
        $(oOU).attr("companycode", role_companycode);
        $(oOU).attr("companyname", role_companyname);

        $(oRole).attr("code", role_code);
        $(oRole).attr("name", role_name);
        $(oRole).attr("documentstepcode", documentstepcode);

        if (kind != null)
            $(oTaskinfo).attr("kind", kind);
        else
            $(oTaskinfo).attr("kind", "normal");

        $(oTaskinfo).attr("status", "inactive");
        $(oTaskinfo).attr("result", "inactive");
    }
    return oStep;
}

function makeDivision(xmlApv, code, unittype, kind, name) {

    var oDiv = xmlApv.createElement("division");
    var oDivTaskinfo = xmlApv.createElement("taskinfo");

    if (unittype == "ou") {
        if (name == "" || name == undefined) {
            name = "담당부서수신";
        }
        var oStep = xmlApv.createElement("step");
        var oOU = xmlApv.createElement("ou");
        var oTaskinfo = xmlApv.createElement("taskinfo");

        $(oDiv).append(oDivTaskinfo);
        $(oDiv).append(oStep);
        $(oStep).append(oOU);
        $(oOU).append(oTaskinfo);

        var objGR = Common.GetObjectInfo('GR', code).Table[0];
        var objDN = Common.GetObjectInfo('DN', objGR.DN_Code).Table[0];

        $(oDiv).attr("divisiontype", "receive");
        $(oDiv).attr("name", name);
        $(oDiv).attr("oucode", objGR.DeptCode);
        $(oDiv).attr("ouname", objGR.ExDisplayName);

        $(oDivTaskinfo).attr("status", "inactive");
        $(oDivTaskinfo).attr("result", "inactive");
        $(oDivTaskinfo).attr("kind", "receive");

        $(oStep).attr("unittype", unittype);
        $(oStep).attr("routetype", "receive");
        $(oStep).attr("name", name);
        $(oStep).attr("approvalorder", "");

        $(oOU).attr("code", objGR.DeptCode);
        $(oOU).attr("name", objGR.ExDisplayName);
        $(oOU).attr("companycode", objGR.DN_Code);
        $(oOU).attr("companyname", objDN.ExDisplayName);

        $(oTaskinfo).attr("kind", "normal");
        $(oTaskinfo).attr("status", "inactive");
        $(oTaskinfo).attr("result", "inactive");
    } else {
        if (name == "" || name == undefined) {
            name = "수신";
        }
        if (unittype == "person") {
            $(oDiv).append(oDivTaskinfo);
        } else {
            $(oDiv).append(oDivTaskinfo);
        }
        var tbObject = Common.GetObjectInfo('UR', code).Table[0];

        $(oDiv).attr("divisiontype", "receive");
        $(oDiv).attr("name", name);
        $(oDiv).attr("oucode", tbObject.DeptCode);
        $(oDiv).attr("ouname", tbObject.DeptCode);

        $(oDivTaskinfo).attr("status", "inactive");
        $(oDivTaskinfo).attr("result", "inactive");
        $(oDivTaskinfo).attr("kind", "send");
    }



    //   $(oStep).attr("unittype", unittype);
    // $(oStep).attr("routetype", "approve");
    //   $(oStep).attr("name", "normal");
    //  $(oStep).attr("approvalorder", ""); 

    ////   $(oOU).attr("code", tbObject.DeptCode);
    //  $(oOU).attr("name", tbObject.ExGroupName);
    ///   $(oOU).attr("companycode", tbObject.DN_Code); 
    //  $(oOU).attr("companyname", tbDN.ExDisplayName);


    //if(kind != null)
    //    $(oTaskinfo).attr("kind", kind);
    //else
    //    $(oTaskinfo).attr("kind", "normal");

    //$(oTaskinfo).attr("status", "inactive");
    //$(oTaskinfo).attr("result", "inactive");

    //if(unittype =="person"){
    //    $(oPerson).attr("code", tbUR.UR_Code);
    //    $(oPerson).attr("name", tbUR.ExDisplayName);
    //    $(oPerson).attr("position", tbUR.JobPositionCode);
    //    $(oPerson).attr("positionname", tbUR.ExJobPositionName);
    //    $(oPerson).attr("title", "");
    //    $(oPerson).attr("level", "");
    //    $(oPerson).attr("ouname", tbUR.DeptCode);
    //    $(oPerson).attr("oucode", tbUR.ExGroupName);
    //    $(oPerson).attr("dutycode", tbUR.JobTitleCode);     
    //    $(oPerson).attr("dutyname", tbUR.ExJobTitleName);    
    //    $(oPerson).attr("batchAt", '');  
    //    $(oPerson).attr("delegationAt", '');
    //}
    return oDiv;
}

//xmlApv                결재선XML OBJECT
//gr_code               부서코드
//nStep                 상위결재자 몇명
//nCurrentApprovalOrder 현재ApprovalOrder
//bManagerCheck         true: 내가 manager 이면 -1 , false 면 무조건 계산해줌. 기본은 (true)
function setManager(xmlApv, gr_code, nStep, nCurrentApprovalOrder, bManagerCheck) {
    //var GroupPath = Common.GetSession("GR_FullCode"); //Common.GetObjectInfo("GR", gr_code, "GroupPath").Table[0].GroupPath;
    var GroupPath = Common.GetObjectInfo("FullCode", gr_code, "").Table[0].GR_FullCode;

    if (bManagerCheck == null) bManagerCheck = true;
    var aDepth = 0;
    var aGroupPath = GroupPath.split(";");
    //if (Common.GetSession("UR_IsManager") == "True" && bManagerCheck) //
    if (getInfo("usismanager") == "Y" && bManagerCheck) //
    {
        nStep = nStep - 1;
        aDepth = aGroupPath.length - 2;
    } else {
        aDepth = aGroupPath.length - 1;
    }

    for (var i = 0; i < nStep; i++) {

        //var ntopDept = aGroupPath.length - 3 - i;
        if ((aDepth - i) > -1) {
            var sManagerCode = Common.GetObjectInfo("GR", aGroupPath[aDepth - i], "ManagerCode").Table[0].ManagerCode;
            if (sManagerCode != "") {
                //var sStep = makeStep(xmlApv, sManagerCode, "approve", null, nCurrentApprovalOrder);
                var sStep = makeStepCheckAddJob(xmlApv, sManagerCode, "approve", null, nCurrentApprovalOrder, null, null, aGroupPath[aDepth - i]);

                //TO-DO : 양식설정의 전결권 설정에 따라 Manager 추가 여부가 결정되도록 변경
                if ($(sStep).find("ou > person").attr("dutycode") != "" && getInfo("ApprovalRule") != "" && $(xmlApv).find("division").attr("divisiontype") == "send") {
                    if (parseInt($(sStep).find("ou > person").attr("dutycode")) >= parseInt(getInfo("ApprovalRule"))) {
                        if ($(xmlApv).find("division:has(step > ou > person > taskinfo[status='pending'])").length == 0) {
                            $($(xmlApv).find("division")).append(sStep);
                        }
                        else {
                            $($(xmlApv).find("division:has(step > ou > person > taskinfo[status='pending'])")).append(sStep);
                        }
                    }
                }
                else {
                    if ($(xmlApv).find("division:has(step > ou > person > taskinfo[status='pending'])").length == 0) {
                        $($(xmlApv).find("division")).append(sStep);
                    }
                    else {
                        $($(xmlApv).find("division:has(step > ou > person > taskinfo[status='pending'])")).append(sStep);
                    }
                }
            }
            //$($(xmlApv).find("division")).append(sStep);
        }
    }
    return xmlApv;
}

//사용인감날인신청-관리번호 코드 조회 (2019.10.30)
function fn_CommonRQSTAES_Click(flag) {
    var url;
    var Title;
    //통합로그 기록
    XFN_AccessLogWrite("102", LogType.Event, getInfo("piid"), getInfo("fmpf"), getInfo("fmnm"), "관리번호 코드 조회", "", BizCode.ApprovalForm, AccessTargetType.Page, AccessEventCodeType.Etc);
    if (flag != "1") {
        url = "/Approval/Forms/Templates/popup/SearchSapManageNoProxy.aspx?strFlag=" + flag;
        Title = Common.GetDic("lbl_SapManageNoRegist");
        Common.Show("SearchSapManageNo", "SearchSapManageNo", Title, url, "700px", "475px", "iframe-ifNoScroll");
    } else {
        url = "/Approval/Forms/Templates/popup/SearchSapManageNoProxy.aspx?strFlag=" + flag;
        Title = Common.GetDic("btn_apv_chkManageNo");
        Common.Show("SearchSapManageNo", "SearchSapManageNo", Title, url, "700px", "295px", "iframe-ifNoScroll");
    }
}

//수주품의-프로젝트 코드 조회
function fn_GeneralAES_Click(flag) {
    var url;
    var Title;
    //통합로그 기록
    XFN_AccessLogWrite("102", LogType.Event, getInfo("piid"), getInfo("fmpf"), getInfo("fmnm"), "프로젝트 코드 조회", "", BizCode.ApprovalForm, AccessTargetType.Page, AccessEventCodeType.Etc);
    if (flag != "1") {
        //url = "/Approval/Forms/Templates/popup/SearchSapProject.aspx?strFlag=" + flag + "&strRemain=" + encodeURI($("#PROJ_LIST").val()) + "&strProjectCombo=" + $("#PROJECT_COMB").val();
        url = "/Approval/Forms/Templates/popup/SearchSapProjectProxy.aspx?strFlag=" + flag + "&strProjectCombo=" + $("#PROJECT_COMB").val();
        Title = Common.GetDic("lbl_SapProjectCodeRegist");
        Common.Show("SearchSapProject", "SearchSapProject", Title, url, "700px", "475px", "iframe-ifNoScroll");
    } else {
        //if (getInfo("templatemode") == "Read") {
        //    //url = "/Approval/Forms/Templates/popup/SearchSapProject.aspx?strFlag=" + flag + "&strRemain=" + encodeURI($("#PROJ_LIST").text()) + "&strProjectCombo=" + $("#PROJECT_COMB").text();
        //} else {
        //    url = "/Approval/Forms/Templates/popup/SearchSapProject.aspx?strFlag=" + flag + "&strRemain=" + encodeURI($("#PROJ_LIST").val()) + "&strProjectCombo=" + $("#PROJECT_COMB").val();
        //}
        //url = "/Approval/Forms/Templates/popup/SearchSapProject.aspx?strFlag=" + flag + "&strRemain=" + encodeURI($("#PROJ_LIST").val()) + "&strProjectCombo=" + $("#PROJECT_COMB").val();
        url = "/Approval/Forms/Templates/popup/SearchSapProjectProxy.aspx?strFlag=" + flag + "&strProjectCombo=" + $("#PROJECT_COMB").val();
        Title = Common.GetDic("lbl_SapProjectCodeView");
        Common.Show("SearchSapProject", "SearchSapProject", Title, url, "700px", "295px", "iframe-ifNoScroll");
    }
}

//수주품의-수정품의
function fnGeneralAesEditForm() {
    var fmid = getInfo("fmid");
    var fmnm = getInfo("fmnm");
    var fmpt = getInfo("fmpf");
    var scid = getInfo("scid");
    var fmrv = getInfo("fmrv");
    var fmfn = getInfo("fmfn");
    //통합로그 기록
    XFN_AccessLogWrite("102", LogType.Event, getInfo("piid"), getInfo("fmpf"), getInfo("fmnm"), "수정품의", "", BizCode.ApprovalForm, AccessTargetType.Page, AccessEventCodeType.Etc);
    // if (g_IS_TabUI == "Y") { url = url + "?IS_Tab=Y"; }
    var strURL = "/Approval/Forms/Form.aspx?fmid=" + fmid + "&mode=DRAFT" + "&GAfiid=" + getInfo("fiid");   // 20171025 hpark 수주품의 fiid중복으로인해 변수명 변경
    if (g_IS_TabUI == "Y") { strURL = strURL + "&IS_TabUI=Y"; }
    location.href = strURL;
}


function fn_ReplaceAll(oldStr, findStr, repStr) {
    try {
        var srchNdx = 0;
        var newStr = "";
        while (oldStr.indexOf(findStr, srchNdx) != -1) {
            newStr += oldStr.substring(srchNdx, oldStr.indexOf(findStr, srchNdx));
            newStr += repStr;
            srchNdx = (oldStr.indexOf(findStr, srchNdx) + findStr.length);
        }
        newStr += oldStr.substring(srchNdx, oldStr.length);
        return newStr;
    }
    catch (exception) { }
}

//협조처 상세 조회
function fn_ConsultView() {
    //결재문서가 상신 또는 임시저장 또는 발신부서 측 조회시에는 CONSULT_LIST 정보로 조회한다.
    var currApvListXML = $.parseXML($("#APVLIST").val());
    var SendApprovalCnt = $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='pending'],steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='inactive']").length; //발신부서 결재완료 여부(협조전 확인용)
    var SendCooperationPlace = false;
    //통합로그 기록
    XFN_AccessLogWrite("102", LogType.Event, getInfo("piid"), getInfo("fmpf"), getInfo("fmnm"), "협조처", "", BizCode.ApprovalForm, AccessTargetType.Page, AccessEventCodeType.Attribute);
    if (formJson.oFormData.mode == "DRAFT" || formJson.oFormData.mode == "TEMPSAVE") {
        var url = "/Approval/Forms/Templates/popup/Consult_List.aspx";
        var Title = Common.GetDic("lbl_apv_DistributeList");
        Common.Show("Consult_List_popup", "Consult_List_popup", Title, url, "400px", "500px", "iframe");
    }
        //결재문서가 협조요청된 이후에는 BPM I/F 호출하여 조회한다.
    else {
        if (SendApprovalCnt == 0) {
            if (getInfo("piid_parent") != "") {
                SendCooperationPlace = true;
            }
            else {
                if (getInfo("loct") != "REJECT") {
                    SendCooperationPlace = true;
                }
                else {
                    SendCooperationPlace = false;
                }
            }
        }
        else {
            SendCooperationPlace = false;
        }

        if (SendCooperationPlace) {
            //OpenCooperationView_PopUp();
            var pdef = getInfo("pdef");
            var process_instance_id = getInfo("PROCESS_INSTANCE_ID");
            var Subject = escape(escape(getInfo("SUBJECT")).replace(/\+/g, "%2B"));
            var defaultCommentAll = getInfo("DefaultCommentAll");
            var defaultComment = getInfo("DefaultComment");
            var defaultOpinion = getInfo("DefaultOpinion");
            var defaultExamination = getInfo("DefaultExamination");
            var defaultCtrlComment = getInfo("DefaultCtrlComment");

            var strURL = String.format("/Approval/Forms/Templates/popup/ReceiptStatus_Popup.aspx?pdef={0}&process_instance_id={1}&Subject={2}&DefaultCommentAll={3}&DefaultComment={4}&DefaultOpinion={5}&DefaultExamination={6}&DefaultCtrlComment={7}", pdef, process_instance_id, Subject, defaultCommentAll, defaultComment, defaultOpinion, defaultExamination, defaultCtrlComment);
            if (getInfo("loct") == "ARCHIVE") strURL = String.format("/Approval/Forms/Templates/popup/ReceiptStatus_Popup_Archive.aspx?pdef={0}&process_instance_id={1}&Subject={2}&FORM_INST_ID={3}", pdef, process_instance_id, Subject, getInfo("FORM_INST_ID"));
            var Title = Common.GetDic("btn_ReceiptStatus");//계정검색
            Common.Show("WorkingBudget", "1", Title, strURL, "800px", "560px", "iframe");
            return false;
        }
        else {
            var url = "/Approval/Forms/Templates/popup/Consult_List.aspx";
            var Title = Common.GetDic("lbl_apv_DistributeList");
            Common.Show("Consult_List_popup", "Consult_List_popup", Title, url, "400px", "500px", "iframe");
            return false;
        }
    }
}

//참조처 상세 조회
function fn_ReferenceView() {
    var url = "/Approval/Forms/Templates/popup/Reference_List.aspx";
    var Title = Common.GetDic("lbl_apv_ReferenceList");
    Common.Show("Reference_List", "Reference_List", Title, url, "400px", "500px", "iframe");
}

//참조자 상세 조회 // 20200427 hpark 참조자 추가
function fn_ReferencePersonView() {
	var url = "/Approval/Forms/Templates/popup/Reference_Person_List.aspx";
	var Title = Common.GetDic("lbl_apv_reference_person_list"); // 참조자 목록
	Common.Show("Reference_Pseron_List", "Reference_Pseron_List", Title, url, "400px", "500px", "iframe");
}

//예약결재 여부 조회
function fn_PopBooking_Approval() {
    var url = "/Approval/Forms/Templates/popup/BookingApproval_Poup.aspx";
    if (g_IS_TabUI == "Y") { url = url + "?IS_Tab=Y"; }
    var Title = Common.GetDic("btn_Booking_Approval");//계정검색
    Common.Show("BookingApproval_Poup", "1", Title, url, "600px", "180px", "iframe");
    return false;
}
//기안시 협조처 개수를 CONSULT_ADD_COUNT에 등록(파일 업로드시 협조처가 200개 이상인 경우 사전 암호화 수행).2017.09.08 양유빈
function SetConsultAddCount() {
    try {
        var ExistObject = $("#CONSULT_DRM_YN").length;//object 여부 확인
        var CONSULT_LIST = $("#CONSULT_LIST").val();
        var DOCLEVEL = $("#DOCLEVEL").val();
        var DrmConsultCount = parseInt(Common.GetBaseConfig("DRM_CONSULT_COUNT"));
        //object가 있고, CONSULT_LIST 값이 있을때
        if (ExistObject == 1 && CONSULT_LIST.length > 0) {
            var ConsultCount = CONSULT_LIST.split("|");
            //대외문일경우 CONSULT_DRM_YN 값을 Y로 셋팅해주도록 처리, approvalservice에서 첨부파일 처리 시 대외문일경우에는업로드시 DRM처리로직을 예외하도록 로직 처리 (사내한)
            //대외문이 아니고 협조처가 특정개수 이상일 경우 첨부파일 업로드시 첨부파일 암호화 진행 (사내한)
            if ((getInfo("fmpf") == "GWOJ_VENDOR_W01" || ConsultCount.length >= DrmConsultCount) && DOCLEVEL == "00") {
                //업로드시 DRM 수행
                $("#CONSULT_DRM_YN").val("Y");
            }
            else {
                //업로드시 DRM 수행 안함
                $("#CONSULT_DRM_YN").val("N");
            }
        }
        else {
            $("#CONSULT_DRM_YN").val("N");
        }
    }
    catch (e) {
        //Skip
    }
}
function popSelectReceiveDept(callBackMethod) {
    // 조직도 타입
    // sid = id;
    var sType = "C1";
    // 그룹사 포함 여부
    var sGroup = "Y";
    //  검색 대상
    var sTarget = "D";
    //  타회사 포함여부
    var sCompany = "Y";
    // 검색조건
    var sSearchType = "";
    // 검색어
    var sSearchText = "";
    // 서브 시스템
    var sSubSystem = "APPROVAL";
    // 트리 종류
    var sTreeKind = "Dept";
    // 
    var sCaller = "User";

    var sIframeName = "";

    //TO-DO : TAB UI 파라미터 전환작업 2017-12-07 BY YJYOO
    //if (parent.g_strApprovalTabUI_YN == "Y") {
    //if (parent.g_IS_TabUI == "Y") {
    //if (parent.document.location.href.toUpperCase().indexOf("APPROVAL_PORTAL") > -1) {
    if (g_IS_TabUI == "Y") {
        sIframeName = parent.$("#hidMasterCurrentTab").val();
    } else if (CFN_GetQueryString("CFN_OpenLayerName") != "undefined") {
        sIframeName = CFN_GetQueryString("CFN_OpenLayerName");
    }

    parent.XFN_OrgMapShow("OrgMap", "divOrgMap", "", sIframeName, callBackMethod, sType, sGroup, sCompany, sTarget, sSubSystem, sSearchType, sSearchText, sTreeKind, sCaller);
}

function fnCheckConsultPending() {
    var consultApv_exa = getInfo('strConsultJson');
    consultApv_exa = $.parseXML(consultApv_exa);
    var bReturn = false;
    var bOuname = "";
    $(consultApv_exa).find("steps > division[divisiontype='COOPERATION_PLACE'] > step > ou:has(person > taskinfo[status='pending'])").each(function () {
        bReturn = true;
        bOuname += "," + CFN_GetDicDatas($(this).attr("name"));

    });

    if (bReturn) {
        Common.Warning(String.format(Common.GetDic("msg_apv_form_003"), getInfo("CONSULT_DATE"), bOuname.substring(1)));
    }
    return bReturn;
}

function MANAGER_ASSIGN_CallBack(jsonValue) {
    var s4STEP_PROCESS_DEPT_CODE = Common.GetBaseConfig("4STEP_PROCESS_DEPT_CODE");

    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value); //원본
    $(m_oApvList).find("division[divisiontype!='receive'][oucode!='" + s4STEP_PROCESS_DEPT_CODE + "']").remove();//세무팀 아닌 Division 삭제
    var m_oSubReStep = $(m_oApvList).find("division"); //원본
    $(m_oSubReStep).find("step").remove();//STEP 제거

    var currentApprovalOrder = getInfo("approvalOrder");


    var sManagerCode = Common.GetObjectInfo("GR", _GR_Code, "ManagerCode").Table[0].ManagerCode;

    $(m_oSubReStep).append(makeStep(m_oApvList, sManagerCode, "approve", null, currentApprovalOrder));
    document.getElementById("APVLIST").value = CFN_XmlToString(m_oApvList);
    requestProcess("MANAGER_ASSIGN");
}

function ReceiptStatusAddDel_Popup_CallBack() {
    if (_UR_IsManager == "True" || getInfo("Form_Deputy_YN") == "Y" ||
         (getInfo("loct") == "JOBFUNCTION" && getInfo("mode") == "APPROVAL")) {
        var arrReturn = setSendConsultCheck();
        var HasConsult = arrReturn[0];
        var HasMustSend = arrReturn[1];
        var sCONSULT_LIST = arrReturn[2];
        var transferCooperationInfo = arrReturn[3];

        if (HasConsult) {
            //Common.Confirm(Common.GetDic("msg_apv_form_002").replace(/\\n/g, "\n"), $("#btapproved").text(), function (result) {
            //    if (result) {

            //    }
            //});
            setInfo("transferCooperationInfo", transferCooperationInfo);
            $("#CONSULT_LIST").val(sCONSULT_LIST);
            requestProcess("REQUESTCONSULT");
            return false;
        }
    }
}

// 20171124 hpark 공통 기안전처리
//var _g_b_cooperationMsg100 = true;
//function fnCommonCheckForm() {

//    // 협조전류 협조처 100개 이상일 경우 안내메세지
//    if (getInfo("pdef") == "COOPERATION_PATTERN"
//		&& (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE")) {
//    	if ($("#CONSULT_LIST").val().split("|").length > 100) {
//    		if (_g_b_cooperationMsg100) {
//    			Common.Inform(Common.GetDic("msg_alert_cooperation100"), "", "fnCooperationCallback"); // 협조처가 100개 이상인 경우 일반 게시판을 활용해 보세요.
//    			_g_b_cooperationMsg100 = false;
//    			return false;
//    		}
//    	} else {
//    		_g_b_cooperationMsg100 = true;
//    	}
//    }
//    return true;
//}

//function fnCooperationCallback(pReturn) {
//    $("#btDraft").trigger("click");
//    //_g_b_cooperationMsg100 = true; // 첨부파일 콜백대기와 협조처100개이상 체크 메세지가 겹쳐서 수정
//}



function initBtnArchive() {
    //TO-DO : 현재 결재선의 결재한 사람존재여부 체크
    //2017-06-08 BY YJYOO
    var currApvListXML = $.parseXML(document.getElementById("APVLIST").value);
    var currApprovalCnt = 0;
    currApprovalCnt = $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='completed'][kind!='charge']").length; //현결재자 존재여부

    //발신부서 기안자 전결일 경우는 1로 만듬.
    if ($(currApvListXML).find("steps > division[divisiontype='send'] > step").length == 1)
        currApprovalCnt = $(currApvListXML).find("steps > division[divisiontype='send'] > step").length;

    var SendApprovalCnt = $(currApvListXML).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo[status='pending'],[status='inactive'], steps > division[divisiontype='send'] > step >  ou > role > person > taskinfo[status='pending'],[status='inactive']").length; //발신부서 결재완료 여부(협조전 확인용)

    //TO-DO : 품의서류 협조처 발송여부 체크
    //2017-06-26 BY YJYOO
    var checkHasConsult = false;
    if (getInfo("strConsultJson") != null && getInfo("strConsultJson") != undefined && getInfo("strConsultJson") != "") {
        if ($($.parseXML(getInfo("strConsultJson"))).find("division > step").length > 0) { checkHasConsult = true; }
    }

    if (formJson.oFormData.DOC_LEVEL != undefined && formJson.oFormData.DOC_LEVEL == "00") {
        $("#divbtMailSend").show();
    }


    /*****************************공통 버튼 활성화 영역*******************************/
    //협조전/3단계 류
    if (SendApprovalCnt == 0 && (getInfo("pdef") == "COOPERATION_PATTERN" || getInfo("pdef") == "STEP3_PATTERN")) {
        if (getInfo("piid_parent") != "") {
            $("#btnReceiptStatus").show();//협조처 수신확인
        }
        else {
            if (getInfo("loct") != "REJECT") {
                $("#btnReceiptStatus").show();//협조처 수신확인
            }
        }
    }
    else {
        //품의서류 협조처 발송시 권한에 관계없이 협조처 상세조회 버튼 활성화
        if (getInfo("CONSULT_LIST") != undefined && getInfo("CONSULT_LIST") != "" && getInfo("CONSULT_LIST").indexOf(":Y:") > -1) {
            $("#btnCooperationView").show();
        }
    }
    $("#btGongRam").show();//공람자 버튼 

    //아이콘 처리
    //if (formJson.oFormData.DOC_LEVEL != 00 && formJson.oFormData.DOC_LEVEL != undefined) {
    if (formJson && formJson.oFormData && formJson.oFormData.DOC_LEVEL != undefined && formJson.oFormData.DOC_LEVEL == "01") {
        //버튼제어
    }
        //1104 보관함 문서 중 보안 분서 인쇄 아이콘 표시
        //else if (getInfo("SECURITY_YN") == "Y") {
        //}
    else {
        if ((getInfo("mode") != "DRAFT" && getInfo("mode") != "TEMPSAVE") && getInfo("templatemode") == "Read" && getInfo("SECURITY_YN") != "Y") { //1104 보안 문서 조건 추가
            //if (Common.GetBaseConfig('PCSave_UseYN') == "Y") {
            if (getInfo('PCSave_UseYN') == "Y") {
                $("#divbtPcSave").show();
            } else {
                $("#divbtPcSave").hide();
            }

        }
        if (getInfo("fmpf") != "GOJP_WORKFORM_W01") { // 업무표준은 인쇄버튼 양식에서 제어
            if (getInfo("loct") == "TEMPSAVE" || getInfo("loct") == "DRAFT" || (getInfo("templatemode") == "Write" || getInfo("editmode") == "M")) {
                $("#divbtPreView").show();
            }
            else {
                $("#divbtPrint").show();
            }
        }
    }
    /*****************************공통 버튼 활성화 영역*******************************/
    //권한이 없는 사용자(Link로 문서 열었을 경우)
    if (getInfo("gloct") == "NOT_AUTH") {
        $('#CommentTable').css('display', 'none');
        return;
    }
    if (getInfo("gloct") == "SEND_PLACE") { //발신처 부서원
        //부서내류, 부서간류, 3단계류, 전산사용권한류를 제외한 모든 문서 공람자 활성화
        if (getInfo("loct") == "COMPLETE" && (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN")) {
            $("#btGongRam").show();//공람자 버튼 
        }
        return;
    }
    else if (getInfo("gloct") == "COOPERATION_PLACE") { //협조처 부서원
        if (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN") {
            $("#btGongRam").show();//공람자 버튼 
        }

        return;
    }
    else if (getInfo("gloct") == "RECEIVE_PLACE") { //수신처 부서원
        if (getInfo("pdef") != "DEPT_INTER_PATTERN" && getInfo("pdef") != "DEPT_WITHIN_PATTERN" && getInfo("pdef") != "STEP3_PATTERN" && getInfo("pdef") != "COMPUTATION_PATTERN") {
            $("#btGongRam").show();//공람자 버튼 
        }

        //2018.08.23 한규동 대리 요청으로 부서원에게 회람기능 추가.
        //공문 프로세스 회람기능 안보이게 처리
        if (getInfo("pdef") != "REQST_CRRF_PATTERN") {
            if (getInfo("farmCode") == _FarmCode && (getInfo("fmpf") != "GWOJ_VENDOR_W01" && getInfo("fmpf") != "GWOE_EXECUTE_LETTER") && (Common.GetBaseConfig("ShareUseYN") != "N")) {
                if (((formJson.oFormData.DOC_LEVEL == "01" && formJson.oFormData.DOC_LEVEL != undefined) || (getInfo("SecurityForm") != undefined && getInfo("SecurityForm") == "Y") || (formJson.BODY_CONTEXT != undefined && formJson.BODY_CONTEXT.DOCSECURITY == "1" && formJson.BODY_CONTEXT.DOCSECURITY != undefined))) {
                    $("#btShare").hide();//회람
                } else {
                    $("#btShare").show();//회람
                }
            }
        }

        return;
    }

    if (getInfo("readtype") == "openwindow") //새창보기
    {
        return;
    }
}

//첨부파일 처리 로직
function FormAttachProcess(pEvent) {
    if (typeof pEvent == "function") {
        fnUploadCompletedCallBackMethod = function () {
            pEvent();
        };
    } else {
        fnUploadCompletedCallBackMethod = function () {
            $("#" + pEvent).trigger("click");
        };
    }

    if (g_CheckFileUpload) {
        g_CheckFileUpload = false;
        if (XFN_FileUpload()) {
            g_CheckFileUpload = true;
            fnUploadCompletedCallBackMethod = undefined;
            return true;
        }
        return false;
    }
    g_CheckFileUpload = true;
    fnUploadCompletedCallBackMethod = undefined;
    return true;
}

function setLineFeedDel(val) {
    var regexp = new RegExp(/[\x0B]/g);
    return val.replace(regexp, '');
}

function IsFormSave() {
    var IsFormSave = false;

    $(Common.GetBaseConfig('FormSaveFMPF').split(';')).each(function (i, item) {
        if (item == getInfo("fmpf")) {
            IsFormSave = true;
        }
    });

    return IsFormSave;
}

function ChangeIncentive(txtComment) {
    if (IsFormSave()) {
        if ($("#ChkIncentive").val() == 'Y' && getInfo("editmode") == "Y") {
            if (txtComment == "") {
                txtComment = Common.GetDic("msg_chgIncentive"); //[인센티브 수정했습니다.]
            } else {
                txtComment += "\r\n" + Common.GetDic("msg_chgIncentive"); //[인센티브 수정했습니다.]
            }
        }
    }
    return txtComment;
}

//**주재원 작업**
function fnCheckResidentAuthorityYN() {
    var bReturn = false;
    //추가한 사람의 같은 부서내의 마지막(협조요청 권한이 있는) 사람이 협조 요청함 

    var gr_code = getInfo("CurrentApprovalParicipant_approverDepartmentCode") == "" ? _DeptCode : getInfo("CurrentApprovalParicipant_approverDepartmentCode");


    m_evalXML = $.parseXML(document.getElementById("APVLIST").value);
    var elmList = $(m_evalXML).find("steps > division[divisiontype='send'] > step > ou > person:has(taskinfo[status='inactive'])[oucode='" + gr_code + "']");
    if (elmList.length == 0)
        bReturn = true;

    return bReturn;
}

// 결재선 생성
function fn_SetCommonApvLineInfo(xmlApv) {
    //var GroupPath = Common.GetSession("GR_FullCode"); //Common.GetObjectInfo("GR", gr_code, "GroupPath").Table[0].GroupPath;
    var GroupPath = fn_GetCommonFullPathAP();
    if (GroupPath == "") {
        Common.Inform("There is no approval line information.");
        return false;
    }
    var aGroupPath = GroupPath.split(";").reverse();
    var nCurrentApprovalOrder = (getInfo("approvalOrder") != "") ? parseInt(getInfo("approvalOrder")) : 100;
    $(xmlApv).find("division[divisiontype='send'] > step[approvalorder='" + nCurrentApprovalOrder + "']").nextAll().remove();

    var nextDept = true;
    var iLast = 0;
    var sLastGradeCode = "";
    var ex = false;

    for (var i = 0; i < aGroupPath.length; i++) {

        iLast = i;
        var sTable = Common.GetObjectInfo("GR", aGroupPath[i], "ManagerCode,OrgGradeCode").Table[0];//.ManagerCode;
        var sOrgGradeCode = sTable.OrgGradeCode;
        var sManagerCode = sTable.ManagerCode;
        if ($.trim(sManagerCode) == "") continue;
        ex = false;
        
        //양식 설정 -> 전결권자 설정 값
        var ApprovalRule = ($.trim(getInfo("ApprovalRule")).length == 0) ? "0" : getInfo("ApprovalRule");
        var OrgGradeCode = ($.trim(sOrgGradeCode).length == 0) ? "0" : sOrgGradeCode;

        //if (ApprovalRule == "0" || OrgGradeCode == "0") { }

        if (parseInt(ApprovalRule) > parseInt(OrgGradeCode)) break;
        //ex = false;

        //현재(기본), 상위(33) < 기준(33) sOrgGradeCode

        var initiatorcode = $(xmlApv).find("steps").attr("initiatorcode");
        if (sManagerCode == initiatorcode) continue;
        if (getInfo("usid") == sManagerCode) continue;
        // 상신이 대결일 경우 팀장제외
        try {
            var sStep = makeStepCheckAddJob(xmlApv, sManagerCode, "approve", null, nCurrentApprovalOrder, null, null, aGroupPath[i]);
            nCurrentApprovalOrder = nCurrentApprovalOrder + 100;
            // 오류가 있어서 임시 주석처리함
            if ($(xmlApv).find("division:has(step > ou > person > taskinfo[status='pending'])").length == 0) {
                $($(xmlApv).find("division")).append(sStep);
            }
            else {
                $($(xmlApv).find("division:has(step > ou > person > taskinfo[status='pending'])")).append(sStep);
            }
        }
        catch (ex) { }
    }

    return xmlApv;
}


function fn_GetCommonFullPathAP() {
    var strDepts;

    var Param = String.format("{ GR_Code:'{0}'}", _GR_Code);

    CFN_CallAjaxJson(Common.GetBaseConfig('WebServicePath') + "/ClientWebService.asmx/GetFullPathAP", Param, false, function (data) {
        strDepts = $.parseJSON(data).d;

    }, false);
    return strDepts;
}

function fn_SetCommonApvLine() {

    var tmpApvList = $.parseXML($("#APVLIST").val());

    if ($(tmpApvList).find("steps > division[divisiontype='send'] > step").length == 1) {
        //GradecodeCD 를 산출하고 그에 맞는 결재 리스트 쿼리
        $("#APVLIST").val(CFN_XmlToString(fn_SetCommonApvLineInfo(tmpApvList)));
        initApvList();
    }
}

// 현대제철 보안문서해제요청서 업로드 첨부파일 체크
function fn_HSTEEL_SecurityDocumentRelease_FileSizeCheck() {
    var isOverTotalFileSize = false;

    var HSTEEL_SR_List = GetApprovalUpLoadFileList();
    var HSTEEL_SR_fileSize = 0.0;
    //var HSTEEL_SR_fileCnt = 0;
    var HSTEEL_SR_MaxFileSize = Common.GetBaseConfig("HSTEEL_SecurityRelease_MaxFileSize");

    $.each(HSTEEL_SR_List, function () {
        //var Name = this.FileName;
        var Size = this.FileSize;
        //HSTEEL_SR_fileCnt++;
        //HSTEEL_SR_fileSize += Math.ceil(parseInt(Size).toFixed(2) / 1024); // 단위 KB
        HSTEEL_SR_fileSize = Math.ceil(parseInt(Size).toFixed(2) / 1024); // 단위 KB
        // 파일 개당 150MB 넘는지 체크
        if (parseInt(HSTEEL_SR_fileSize) > parseInt(HSTEEL_SR_MaxFileSize)) {
            isOverTotalFileSize = true;
            return false;
        }
    });

    //if (parseInt(HSTEEL_SR_fileSize) > parseInt(HSTEEL_SR_MaxFileSize)) {
    //    isOverTotalFileSize = true;
    //}

    return isOverTotalFileSize;
}

// 예결함에서 선결재한 문서 중간결재자 확인(btAfterConfirm) // 20200610 hpark 예결함에서 선결
function fnAfterConfirm() {

	/*
		comment : escape(document.getElementById("txtComment").value)
		서버 : commentContents = HttpUtility.UrlDecode(txtComment).Replace("&", "&amp;").Replace("<", "&lt;").Replace(">", "&gt;").Replace("\"", "&quot;").Replace("'", "&apos;"); // 의견내용
		commentContents = Regex.Replace(commentContents, "[\x0B]", "", RegexOptions.Compiled);
	*/

	if (!getInfo("approvalOrder") || !getInfo("pdef") || !getInfo("piid")) {
		Common.Error(Common.GetDic("msg_apv_nodata")); // 결재 정보가 없습니다.
		return;
	}

	var jsonParam = "{pProcessCode:'" + getInfo("pdef") + "', pProcessId:'" + getInfo("piid") + "', pProcessId_parent:'" + getInfo("piid_parent")
		+ "', pApprovalOrder:'" + getInfo("approvalOrder") + "', txtComment:'" + ""
		+ "', hidAttachmentFileUrl:'" + "" + "', CommentType:'" + "" + "', fiid:'" + getInfo("fiid") + "', fmpf:'" + getInfo("fmpf")
		+ "', SUBJECT:'" + escape(getInfo("SUBJECT")) + "', INITIATOR_ID:'" + getInfo("INITIATOR_ID") + "'}";

	Common.Confirm(gMessage77, $("#btapproved").text(), function (result) {
		if (result) {
			CFN_PageMethodJSON_Url("/Approval/Forms/MethodForClientFormCall.aspx", "btnConfirm", jsonParam, false, function (result, pContext) {
				if (result.d.indexOf("ERROR|") > -1) {
					Common.Error(result.d.split("ERROR|")[1])
				} else {
					Common.Inform(Common.GetDic("msg_ItsDone"), Common.GetDic("lbl_Alram"), function () { // 처리되었습니다
						//m_oFormMenu.self.location.reload(true);
						fnformmenuCallBack();
						//Common.Close();
					});
				}
			});
		} else {
			return;
		}
	});
}

// c-type 결재 양식 상단 > 수신처 전 임직원 전체 메일 발송 공지사항 이미지
// [GreatJSK][20200612]
function fn_ShowMessageSendMail() {
    var NOTICE_msg_url = Common.GetDomainBaseConfig("HDEC_AUTOMATIC_SEND_MAIL_NOTICE", "H147"); //"/gwstorage/form_image/autonoti.jpg"     
    var NOTICE_title = Common.GetDic("gMessage_IWF_002");//"전사 공지사항 개인 메일발송 기준 (발송부서 선택사항)";
    Common.ShowDialog("showmessagesendmail", "", NOTICE_title, NOTICE_msg_url, 620, 335, "iframe");
    return false;
}
 
// [GreatJSK][20200612]
function chk_receiverSendMail() {
    if (getInfo("templatemode") == "Read") {
        //
    } else {
        if ($("#chk_receiverSendMail").is(":checked")) {
            $("#hidChkReceiverAutomaticSendMail").val("Y");
        } else {
            $("#hidChkReceiverAutomaticSendMail").val("N");
        }
    }

}

function getApprovalPhase() {
    var intPhase = 0;
    var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
    var m_divisionList = $(m_oApvList).find("division");
    for (var i = 0; i < m_divisionList.length; i++) {
        intPhase = (i + 1);
        if ($(m_divisionList[i]).find("step > ou > person > taskinfo[status='pending']").length > 0 || $(m_divisionList[i]).find("step > ou > person > taskinfo[status='inactive']").length > 0) {
            break;
        }
    }

    return intPhase;
}


//통합결재 편집시 임시저장함에 결재선및 첨부등 저장하고 이동 하기 위해 분기문
//[GreatJSK][20200710]
var TempApprovalState = false;
function TempApprovalStateSave() {
    // 통합결재 편집창 오픈시 변수값 true로 설정됨
    TempApprovalState = true;
    $("#btSave").trigger("click");   
} 

//통합결재 편집시 임시저장함에 결재선및 첨부등 저장하고 이동 하기 위해 분기문
//[GreatJSK][20200710]
function EditIntegratedApproval() {
    var strBizSystemID = "";
    if (getInfo("etid").toUpperCase() == "H139") {
        strBizSystemID = Common.GetBaseConfig("BizSystemID_HEC");
    } else if (getInfo("etid").toUpperCase() == "H147") {
        strBizSystemID = Common.GetBaseConfig("BizSystemID_HDEC");
    } else if (getInfo("etid").toUpperCase() == "H150") {
        strBizSystemID = Common.GetBaseConfig("BizSystemID_HESI");
    } else if (getInfo("etid").toUpperCase() == "H151") {
        strBizSystemID = Common.GetBaseConfig("BizSystemID_HDAE");
    }
    var szURL = Common.GetBaseConfig('WebServicePath') + "/ClientWebService.asmx/GetToken";
    var Param = String.format("{ _BizSystemID:'{0}', _CompanyCode:'{1}', _UserID:'{2}', _UserIP:'{3}' }", strBizSystemID, getInfo("etid"), getInfo("usid"), getInfo("ClientIp"));
    CFN_CallAjaxJson(szURL, Param, false, function (pObjData) {
        var sResult = $.parseJSON($.parseJSON(pObjData).d);
        var sResultCode, sResultMessage;
        sResultCode = sResult.ResultCode;
        sResultMessage = sResult.ResultMessage;
        var strToken = "";
        if (sResultCode == "1000") {
            strToken = sResultMessage;
            CallBack_mf_OpenIntegratedWindow(strToken);
        } else {
            alert("보안토큰 생성실패 : [" + sResultCode + "] " + sResultMessage);
            return;
        }
    });
}

//스크립트 차수 구하기 approvalOrder로 차수 구하기
function GetDivisionPhase(currApvListXML) {

    var index = 0;
    var ApprovalOrder = getInfo("approvalOrder");
    
    //신청서 복수 담당자인 경우
    if (getInfo("pdef") == "REQUEST_PATTERN") {
        if (getInfo("mode_unit") == "RECEIVECHR_APPROVAL") {
            ApprovalOrder = $(currApvListXML).find("division[divisiontype='receive'] > step[routetype='multi_charge'][processinstanceid='" + getInfo("piid") + "']:has(ou > person[code='" + getInfo("usid") + "'] > taskinfo[visible!='N'])").attr("approvalorder");
        }
    }

    $(currApvListXML).find("division").each(function (i, item) {

        if ($(item).find("step[approvalorder='" + ApprovalOrder + "'][processinstanceid='" + getInfo("piid") + "']").length > 0) {
            index = i;
            return;
        }
    });

    return index;
}

//저장된 결재선 및 기본결재선 참조자, 협조처를 제외한 결재자 (일반,협조)
function fn_BasicApvListCheck(oApvList, jsonTable) {
    var isResult = true;

    var StepCount = $(oApvList).find("steps > division:eq(" + getInfo("CurrentDivisionIdx") + ") > step:not(:first)").length;

    if (StepCount == 0 && $(jsonTable).length > 0) {
        isResult = false;
    }
    else if (StepCount > 0 && $(jsonTable).length == 0) {
        isResult = true;
    }
    else if (StepCount == 0 && $(jsonTable).length == 0) {
        isResult = true;
    }
    else {
        //var oStep = $(oApvList).find("steps > division:eq(" + getInfo("CurrentDivisionIdx") + ") > step:not(:first):has(ou > person[is_fixed='Y'])");

        var oStep = $(oApvList).find("steps > division:eq(" + getInfo("CurrentDivisionIdx") + "):has(step:not(:first))");

        $(jsonTable).each(function (i, item) {

            if ($(item).attr("IS_FIXED") == "Y") {

                if ($(oStep).find("step > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code ='" + $(item).attr("U_UR_CODE") + "']").length == 0) {
                    isResult = false;
                    return false;
                }
                else {
                    
                    var routeType = $(oStep).find("step > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code ='" + $(item).attr("U_UR_CODE") + "']").parent().parent().attr("routetype");
                    var allotType = XFN_IsNullOrEmptyToString($(oStep).find("step > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code ='" + $(item).attr("U_UR_CODE") + "']").parent().parent().attr("allottype"));
                    var approvalType = $(item).attr("APPROVAL_TYPE");

                    if ($.trim(allotType).length == 0)
                    {
                        if (routeType != approvalType) {
                            isResult = false;
                            return false;
                        }
                    }
                    else
                    {
                        if (allotType != approvalType) {
                            isResult = false;
                            return false;
                        }
                    }
                }
            }
        });
    }
    return isResult;
}

//저장된 결재선 및 기본결재선 참조자, 협조처를 제외한 결재자 (일반,협조)
function fn_SetBasicApvList(oApvList, jsonTable, openerDivisionType, phase, isResult) {
    if (openerDivisionType == "SEND") {
        if (isResult) {

            var ApprovalOrder = 100;
            var oPerson = $(oApvList).find("steps > division:eq(0) > step:not(:first) > ou > person");
            $(oPerson).each(function (i, p_item) {

                ApprovalOrder = ApprovalOrder + 100;

                var isCheck = false;
                $(jsonTable).each(function (j, item) {
                    if ($(p_item).attr("code") == $(item).attr("U_UR_CODE") && $(p_item).parent().attr("code") == $(item).attr("G_DEPTCODE")) {

                        var stepAllottype = XFN_IsNullOrEmptyToString($(p_item).parent().parent().attr("allottype"));
                        var stepName = XFN_IsNullOrEmptyToString($(p_item).parent().parent().attr("name"));

                        $(p_item).parent().parent().remove();

                        var sStep = makeStepBasic(oApvList, item,  ApprovalOrder.toString(), "STEP");

                        if ($.trim(stepAllottype).length > 0) {
                            $(sStep).attr("allottype", stepAllottype);
                            $(sStep).attr("name", stepName);
                        }

                        $($(oApvList).find("division:eq(0) > step:eq("+i+")")).after(sStep);

                        isCheck = true;
                        return false;
                    }
                });
                if (!isCheck) {
                    $(p_item).attr("is_fixed", "N");
                    $(p_item).parent().parent().attr("approvalorder", ApprovalOrder);
                    //$(p_item).attr("is_hidden", "N");
                }
            });
        }
        else {

            $(oApvList).find("division:eq(0) > step:not(:first)").remove();
            var ApprovalOrder = parseInt($(oApvList).find("steps > division:eq(0) > step:first").attr("approvalorder"));
            if (ApprovalOrder == "" || ApprovalOrder == "0") { ApprovalOrder = 100; }

            //$(oApvList).find("division:eq(0) > step:first");

            $(jsonTable).each(function (i, item) {

                ApprovalOrder = ApprovalOrder + 100;
                var sStep = makeStepBasic(oApvList, item, ApprovalOrder.toString(), "STEP");

                $($(oApvList).find("division:eq(0)")).append(sStep);

            });
        }
    }
    else {
        if (isResult) {

            var DivisionPhase = "";

            //ApprovalOrder 구하기
            if (phase == "1") {
                DivisionPhase = "0";
            }
            else if (phase == "2") {
                DivisionPhase = "1";
            }

            var ApprovalOrder = 0;

            ApprovalOrder = parseInt($(oApvList).find("steps > division:last > step:last").attr("approvalorder"));

            if ($(oApvList).find("steps > division[divisiontype='receive']:last > step:last[routetype='multi_charge']").length == 1) {

                $(oApvList).find("steps > division[divisiontype='receive']:last > step > ou:not(:first)").each(function (i, item) {
                    ApprovalOrder = ApprovalOrder + 100;
                });
            }

            //$(oApvList).find("division:eq(" + DivisionPhase + ")");

            var oDivR = oApvList.createElement("division");
            var oDivTaskinfoR = oApvList.createElement("taskinfo");
            var oStepR = oApvList.createElement("step");


            $(jsonTable).each(function (i, item) {

                if ($(item).attr("APPROVAL_TYPE") == "multi_charge" || $(item).attr("APPROVAL_TYPE") == "receive_dept") {

                    if (i == 0) {
                        ApprovalOrder = ApprovalOrder + 100;
                        var oDivR = oApvList.createElement("division");
                        var oDivTaskinfoR = oApvList.createElement("taskinfo");
                        var oStepR = oApvList.createElement("step");

                        oDivR.setAttribute("divisiontype", "receive");
                        oDivR.setAttribute("name", "수신");
                        oDivR.setAttribute("oucode", XFN_IsNullOrEmptyToString($(item).attr("G_DEPTCODE")));
                        oDivR.setAttribute("ouname", XFN_IsNullOrEmptyToString($(item).attr("G_EXDISPLAYNAME")));
                        oDivR.setAttribute("parentapprovalorder", "");
                        oDivR.setAttribute("approvalgrouporder", "0");

                        oDivTaskinfoR.setAttribute("status", "inactive");
                        oDivTaskinfoR.setAttribute("result", "inactive");
                        oDivTaskinfoR.setAttribute("kind", "receive");
                        oDivTaskinfoR.setAttribute("datereceived", "");

                        $(oDivR).append(oDivTaskinfoR);

                        $($(oApvList).find("division:last")).after(oDivR);

                        if ($(item).attr("APPROVAL_TYPE") == "receive_dept") {
                            ApprovalOrder = 100;
                        }

                        var sStep = makeStepBasic(oApvList, item, ApprovalOrder.toString(), "STEP");
                        $($(oApvList).find("division:last")).append(sStep);


                        if ($(item).attr("APPROVAL_TYPE") == "receive_dept") {
                            $($(oApvList).find("division:last")).append(sStep);
                            //신청서 수신 부서는 담당부서만 
                            return false;
                        }
                    }
                    else {
                        ApprovalOrder = ApprovalOrder + 100;
                        var sStep = makeStepBasic(oApvList, item, ApprovalOrder.toString(), "OU");
                        $($(oApvList).find("division:last > step")).append(sStep);
                    }
                }
                else {
                    ApprovalOrder = ApprovalOrder + 100;
                    var sStep = makeStepBasic(oApvList, item, ApprovalOrder.toString(), "STEP");
                    $($(oApvList).find("division:last")).append(sStep);
                }

            });
        }
        else {
            $(oApvList).find("division:last > step:not(:first)").remove();
            var ApprovalOrder = parseInt($(oApvList).find("steps > division:eq(" + phase + ") > step:first").attr("approvalorder"));

            $(jsonTable).each(function (i, item) {

                var sStep = makeStepBasic(oApvList, item, ApprovalOrder.toString(), "STEP");
                $($(oApvList).find("division:last")).append(sStep);

            });
        }
    }
}

function fn_SetBasicCCInfoApvList(oApvList, JsonTable) {
    //var arrCCInfo = (JsonTable instanceof Array) ? JsonTable : [JsonTable];
    //steps > ccinfo 가 없으면
    if ($(oApvList).find("steps > ccinfo").length == 0) {
        //참조자 출력
        $(JsonTable).each(function (i, item) {
            var sStep = makeCCinfoBasic(oApvList, item);
            $($(oApvList).find("steps")).append(sStep);
        });
    }
    else {

        //참조자에 옵션 중 IS_HIDDEN 값을 N으로 변경
        $(oApvList).find("ccinfo > ou > person").attr("is_hidden", "N");

        //참조자 병합 단 임시저장된 결재선에 경우 숨김처리 제어
        //기본 결재선과 임시저장된 결재선 비교하여 없으면 참조자를 넣는다
        $(JsonTable).each(function (i, item) {

            if ($(oApvList).find("ccinfo > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length > 0) {
                $(oApvList).find("steps > ccinfo:has(ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "'])").remove();
            }
            var sStep = makeCCinfoBasic(oApvList, item);
            $($(oApvList).find("steps")).append(sStep);

        });
    }

}

//기본 결재선 협조처
function fn_SetBasicConsultApvList(JsonTable) {

    var arrConsultList = ($.trim($("#CONSULT_LIST").val()).length == 0) ? [] : $('#CONSULT_LIST').val().split("|");
    var arrConsultExList = ($.trim($("#CONSULT_EXLIST").val()).length == 0) ? [] : $('#CONSULT_EXLIST').val().split("|");

    if ($(JsonTable).length > 0) {
        $(JsonTable).each(function (i, ConsultItem) {

            if (arrConsultList.length > 0) {
                //협조처 중복 확인
                $(arrConsultList).each(function (j, item) {
                    //같으면
                    if ($.trim(item).length > 0) {
                        var arr_List = item.split(":");
                        var sTemp = "";
                        if (arr_List[3].length > 0) sTemp = arr_List[3];

                        if ($(ConsultItem).attr("G_DEPTCODE").indexOf(sTemp) != -1) {
                            arrConsultList.splice(j, 1);
                            return false;
                        }
                    }

                });
            }

            if (arrConsultExList.length > 0) {
                //필수 협조처 - 필수이면서 중복 확인 
                $(arrConsultExList).each(function (j, item) {
                    //같으면
                    if ($.trim(item).length > 0) {
                        var arr_List = item.split(":");
                        var sTemp = "";
                        if (arr_List[3].length > 0) sTemp = arr_List[3];

                        if ($(ConsultItem).attr("G_DEPTCODE").indexOf(sTemp) != -1) {
                            arrConsultExList.splice(j, 1);
                            return false;
                        }
                    }
                });
            }

            var strConsult = String.format("{0}:{1}:T:{2}::{3}:N:{4}:{5}:{6}"
            , XFN_IsNullOrEmptyToString($(ConsultItem).attr("D_FARMCODE"))
            , XFN_IsNullOrEmptyToString($(ConsultItem).attr("D_DN_CODE"))
            , XFN_IsNullOrEmptyToString($(ConsultItem).attr("G_DEPTCODE"))
            , XFN_IsNullOrEmptyToString($(ConsultItem).attr("G_ORGGRADECODE"))
            , XFN_IsNullOrEmptyToString($(ConsultItem).attr("G_EXDISPLAYNAME"))
            , XFN_IsNullOrEmptyToString($(ConsultItem).attr("D_EXDISPLAYNAME"))
            , XFN_IsNullOrEmptyToString($(ConsultItem).attr("G_GD_ExDisplayName")));

            arrConsultList.push(strConsult);

            if ($(ConsultItem).attr("IS_FIXED") == "Y") {
                arrConsultExList.push(strConsult);
            }
        });

        //중복 확인
        $("#CONSULT_LIST").val("");
        $("#CONSULT_EXLIST").val("");

        var strConsultDeptInfoList = "";
        var strConsultDeptInfoExList = "";

        $(arrConsultList).each(function (j, item) {
            if ($.trim(item).length > 0) {
                strConsultDeptInfoList += item + "|";
            }

        });

        $(arrConsultExList).each(function (j, item) {
            if ($.trim(item).length > 0) {
                strConsultDeptInfoExList += item + "|";
            }
        });

        $("#CONSULT_LIST").val(strConsultDeptInfoList);
        $("#CONSULT_EXLIST").val(strConsultDeptInfoExList);
    }

}


//기본 결재선 셋팅
function makeStepBasic(oApvList, item, ApprovalOrder, apvType) {
    var oStep = oApvList.createElement("step");
    var oOU = oApvList.createElement("ou");
    var oPerson = oApvList.createElement("person");
    var oTaskinfo = oApvList.createElement("taskinfo");


    var b_addjob = ($(item).attr("U_GR_CODE") == $(item).attr("G_GR_CODE")) ? false : true; //겸직여부
    var s_unittype = "";

    switch ($(item).attr("APPROVAL_TYPE")) {
        case "approve":
            $(oStep).attr("unittype", "person");
            $(oStep).attr("routetype", "approve");
            $(oStep).attr("name", "결재");
            var s_unittype = "person";
            break;
        case "multi_charge":
            $(oStep).attr("unittype", "person");
            $(oStep).attr("routetype", "multi_charge");
            $(oStep).attr("name", "결재");
            var s_unittype = "person";
            break;
        case "receive_dept":
            $(oStep).attr("unittype", "ou");
            $(oStep).attr("routetype", "receive_dept");
            $(oStep).attr("name", "결재");
            var s_unittype = "ou";
            break;
        case "parallel":
            $(oStep).attr("unittype", "person");
            $(oStep).attr("routetype", "assist");
            $(oStep).attr("allottype", "parallel");
            $(oStep).attr("name", "parallel");
            var s_unittype = "person";
            break;
        case "serial":
            $(oStep).attr("unittype", "person");
            $(oStep).attr("routetype", "assist");
            $(oStep).attr("allottype", "serial");
            $(oStep).attr("name", "serial");
            var s_unittype = "person";
            break;
    }

    if (s_unittype == "person") {
        $(oStep).append(oOU);
        $(oOU).append(oPerson);
        $(oPerson).append(oTaskinfo);
    }
    else {
        $(oStep).append(oOU);
        $(oOU).append(oTaskinfo);
    }

    $(oStep).attr("approvalorder", ApprovalOrder);
    $(oStep).attr("language", XFN_IsNullOrEmptyToString($(item).attr("D_LANGUAGE_CODE")));
    $(oStep).attr("beforeapprovalat", "");
    $(oStep).attr("approverat", "N");
    $(oStep).attr("processinstanceid", "");

    // OU
    $(oOU).attr("name", XFN_IsNullOrEmptyToString($(item).attr("G_EXDISPLAYNAME")));
    $(oOU).attr("code", XFN_IsNullOrEmptyToString($(item).attr("G_DEPTCODE")));
    $(oOU).attr("companycode", XFN_IsNullOrEmptyToString($(item).attr("D_DN_CODE")));
    $(oOU).attr("companyname", XFN_IsNullOrEmptyToString($(item).attr("D_EXDISPLAYNAME")));
    $(oOU).attr("originidccode", XFN_IsNullOrEmptyToString($(item).attr("D_FARMCODE")));

    if (s_unittype == "person") {
        // PERSON
        $(oPerson).attr("name", XFN_IsNullOrEmptyToString($(item).attr("U_EXDISPLAYNAME")));
        $(oPerson).attr("code", XFN_IsNullOrEmptyToString($(item).attr("U_UR_CODE")));
        $(oPerson).attr("ouname", XFN_IsNullOrEmptyToString($(item).attr("G_EXDISPLAYNAME")));
        $(oPerson).attr("oucode", XFN_IsNullOrEmptyToString($(item).attr("G_DEPTCODE")));
        $(oPerson).attr("originidccode", XFN_IsNullOrEmptyToString($(item).attr("D_FARMCODE")));
        $(oPerson).attr("sipaddress", XFN_IsNullOrEmptyToString($(item).attr("U_MSN_SIPADDRESS")));
        $(oPerson).attr("positionname", XFN_IsNullOrEmptyToString($(item).attr("U_EXJOBPOSITIONNAME")));
        $(oPerson).attr("position", XFN_IsNullOrEmptyToString($(item).attr("U_JOBPOSITIONCODE")));
        $(oPerson).attr("dutyname", (b_addjob) ? XFN_IsNullOrEmptyToString($(item).attr("AD_EXJOBTITLENAME")) : XFN_IsNullOrEmptyToString($(item).attr("U_EXJOBTITLENAME")));
        $(oPerson).attr("dutycode", (b_addjob) ? XFN_IsNullOrEmptyToString($(item).attr("AD_JOBTITLECODE")) : XFN_IsNullOrEmptyToString($(item).attr("U_JOBTITLECODE")));
        $(oPerson).attr("delegationAt", "");
        $(oPerson).attr("batchAt", "");
        $(oPerson).attr("is_hidden", XFN_IsNullOrEmptyToString($(item).attr("IS_HIDDEN")));
        $(oPerson).attr("is_fixed", XFN_IsNullOrEmptyToString($(item).attr("IS_FIXED")));
        $(oPerson).attr("documentstepcode", "");
    }

    $(oTaskinfo).attr("kind", "normal");
    $(oTaskinfo).attr("status", "inactive");
    $(oTaskinfo).attr("result", "inactive");
    $(oTaskinfo).attr("datereceived", "");
    $(oTaskinfo).attr("datecompleted", "");
    $(oTaskinfo).attr("customattribute1", "");
    $(oTaskinfo).attr("wiid", "");

    switch (apvType) {
        case "STEP":
            return oStep;
        case "OU":
            return oOU;
        default:
            return oStep;
    }
}

//기본 결재선 참조자 결재선
function makeCCinfoBasic(oApvList, item) {
    var oCcinfo = oApvList.createElement("ccinfo");
    var oOU = oApvList.createElement("ou");
    var oPerson = oApvList.createElement("person");

    $(oCcinfo).append(oOU);
    $(oOU).append(oPerson);

    var c_type = ";"
    var c_step = "";
    var c_belongto = "sender";
    var c_datereceived = "";

    var b_addjob = ($(item).attr("U_GR_CODE") == $(item).attr("G_GR_CODE")) ? false : true; //겸직여부

    switch ($(item).attr("APPROVAL_TYPE")) {
        case "before":
            c_type = "before";
            break;
        case "after":
            c_type = "after";
            if ($(item).attr("CC_AFTER_SEND") == "0") c_step = "1";
            else if ($(item).attr("CC_AFTER_SEND") == "1") c_step = "2";
            else if ($(item).attr("CC_AFTER_SEND") == "2") c_step = "3";
            break;
    }

    // CCINFO
    $(oCcinfo).attr("type", c_type);
    $(oCcinfo).attr("datereceived", c_datereceived);

    if ($.trim(c_step).length > 0) {
        $(oCcinfo).attr("step", c_step);
    }

    $(oCcinfo).attr("belongto", c_belongto);

    // OU
    $(oOU).attr("name", XFN_IsNullOrEmptyToString($(item).attr("G_EXDISPLAYNAME")));
    $(oOU).attr("code", XFN_IsNullOrEmptyToString($(item).attr("G_DEPTCODE")));
    $(oOU).attr("companycode", XFN_IsNullOrEmptyToString($(item).attr("D_DN_CODE")));
    $(oOU).attr("companyname", XFN_IsNullOrEmptyToString($(item).attr("D_EXDISPLAYNAME")));
    $(oOU).attr("originidccode", XFN_IsNullOrEmptyToString($(item).attr("D_FARMCODE")));
    $(oOU).attr("orggradecode", XFN_IsNullOrEmptyToString($(item).attr("G_ORGGRADECODE")));
    $(oOU).attr("exorggradename", XFN_IsNullOrEmptyToString($(item).attr("G_GD_ExDisplayName")));


    // PERSON
    $(oPerson).attr("name", XFN_IsNullOrEmptyToString($(item).attr("U_EXDISPLAYNAME")));
    $(oPerson).attr("code", XFN_IsNullOrEmptyToString($(item).attr("U_UR_CODE")));
    $(oPerson).attr("ouname", XFN_IsNullOrEmptyToString($(item).attr("G_EXDISPLAYNAME")));
    $(oPerson).attr("oucode", XFN_IsNullOrEmptyToString($(item).attr("G_DEPTCODE")));
    $(oPerson).attr("originidccode", XFN_IsNullOrEmptyToString($(item).attr("D_FARMCODE")));
    $(oPerson).attr("sipaddress", XFN_IsNullOrEmptyToString($(item).attr("U_MSN_SIPADDRESS")));
    $(oPerson).attr("positionname", XFN_IsNullOrEmptyToString($(item).attr("U_EXJOBPOSITIONNAME")));
    $(oPerson).attr("position", XFN_IsNullOrEmptyToString($(item).attr("U_JOBPOSITIONCODE")));
    $(oPerson).attr("dutyname", (b_addjob) ? XFN_IsNullOrEmptyToString($(item).attr("AD_EXJOBTITLENAME")) : XFN_IsNullOrEmptyToString($(item).attr("U_EXJOBTITLENAME")));
    $(oPerson).attr("dutycode", (b_addjob) ? XFN_IsNullOrEmptyToString($(item).attr("AD_JOBTITLECODE")) : XFN_IsNullOrEmptyToString($(item).attr("U_JOBTITLECODE")));
    $(oPerson).attr("delegationAt", "");
    $(oPerson).attr("batchAt", "");
    $(oPerson).attr("is_hidden", XFN_IsNullOrEmptyToString($(item).attr("IS_HIDDEN")));
    $(oPerson).attr("is_fixed", XFN_IsNullOrEmptyToString($(item).attr("IS_FIXED")));

    return oCcinfo;
}

function fn_ApvLineBasicYN(oApvList) {
    //오토웨이 시작 양식만 결재선 병합 (통합결재 및 레거시양식은 병합 제외하며 구분값으로는 M필드 m_is_IWF_Legacy) 
    var isApvBasic = false;
    if (getInfo("USE_BASIC_APPROVAL_LINE") == "Y") {

        if (formJson.BODY_CONTEXT != undefined) {
            var tmpIWFLegacy = (formJson.BODY_CONTEXT.m_is_IWF_Legacy != undefined) ? formJson.BODY_CONTEXT.m_is_IWF_Legacy : "";
            if (tmpIWFLegacy != "Y") {
                //본문, 본문 및 결재선 정보
                if ((getInfo("reuse") == "C" && getInfo("reuseinfo") == "C") && getInfo("mode") == "DRAFT") 
                {
                    isApvBasic = false;
                }
                else if ((getInfo("reuse") != "" || getInfo("reuseinfo") != "") && getInfo("mode") == "DRAFT") {
                    isApvBasic = true;
                    //재사용, 복사, 템블릿 시 DRAFT 모드에서 결재선 병합 
                }
                else if (getInfo("mode") == "TEMPSAVE") {
                    isApvBasic = true;
                    //임시저장 시 병합
                }
            }
        }
        else {  //본문, 본문 및 결재선 정보
            if ((getInfo("reuse") == "C" && getInfo("reuseinfo") == "C") && getInfo("mode") == "DRAFT") {
                isApvBasic = false;
            }
            else if ((getInfo("reuse") != "" || getInfo("reuseinfo") != "") && getInfo("mode") == "DRAFT") {
                isApvBasic = true;
                //재사용, 복사, 템블릿 시 DRAFT 모드에서 결재선 병합 
            }
        }
    }
    return isApvBasic;
}
//기본 결재선 셋팅하기 단 임시 저장은 비교, 수신부서 도착시 다시 셋팅 
//oApvList -> 결재선 , isAbsent -> 인사정보 메세지 유무 
function fn_SetApvBasic(oApvList, isAbsent) {

    var Param = String.format("{ fmid:'{0}', UR_Code: '{1}'}", getInfo("fmid"), getInfo("usid"));
    CFN_PageMethodJSON_Url("setDomainData.aspx", "WF_BASIC_APPROVAL_LINE_ALL", Param, false, function (result) {

        if (result.d != "" && result != undefined) {
            var objData = $.parseJSON(result.d);
            var jsonDataSet = objData.NewDataSet;

            if (jsonDataSet.Table != undefined) {
                if (jsonDataSet.Table.LINE_CNT != undefined) {
                    if (parseInt(jsonDataSet.Table.LINE_CNT) > 0) {

                        //발신 결재선
                        if (jsonDataSet.Table1 != undefined) {
                            var arr_Table = (jsonDataSet.Table1 instanceof Array) ? jsonDataSet.Table1 : [jsonDataSet.Table1];
                            if (arr_Table.length > 0) {
                                var isResult = fn_BasicApvListCheck(oApvList, jsonDataSet.Table1);
                                fn_SetBasicApvList(oApvList, arr_Table, "SEND", "0", isResult);
                                //복사 기능일 아닌 경우 확인(임시저장된 후 Reload) or 템플릿 복사 아닌 경우
                                if (!(getInfo("reuse") == "P" || (getInfo("reuse") == "C" && getInfo("reuseinfo") == "C") && getInfo("mode") == "DRAFT")) {
                                    if (!isResult && isAbsent) {
                                        alert(Common.GetDic("msg_apv_ApprovalBasic01"));
                                        //alert("기본결재선으로 변경되었습니다. 결재선을 확인해주세요");
                                    }
                                }
                            }
                        }

                        //수신 담당자 및 수신 부서 지우기
                        $(oApvList).find("steps > division[divisiontype='receive']").each(function (idx, item) {
                            $(item).remove();
                        });

                        //수신1차
                        if (jsonDataSet.Table2 != undefined) {
                            var arr_Table = (jsonDataSet.Table2 instanceof Array) ? jsonDataSet.Table2 : [jsonDataSet.Table2];
                            if (arr_Table.length > 0) {
                                fn_SetBasicApvList(oApvList, arr_Table, "RECEIVE", "1", true);
                            }
                        }
                        //수신2차
                        if (jsonDataSet.Table3 != undefined) {
                            var arr_Table = (jsonDataSet.Table3 instanceof Array) ? jsonDataSet.Table3 : [jsonDataSet.Table3];
                            if (arr_Table.length > 0) {
                                fn_SetBasicApvList(oApvList, arr_Table, "RECEIVE", "2", true);
                            }
                        }
                        //참조자
                        if (jsonDataSet.Table4 != undefined) {
                            var arr_Table = (jsonDataSet.Table4 instanceof Array) ? jsonDataSet.Table4 : [jsonDataSet.Table4];
                            if (arr_Table.length > 0) {
                                fn_SetBasicCCInfoApvList(oApvList, arr_Table);
                            }
                        }
                        //협조처
                        if (jsonDataSet.Table5 != undefined) {
                            var arr_Table = (jsonDataSet.Table5 instanceof Array) ? jsonDataSet.Table5 : [jsonDataSet.Table5];
                            if (arr_Table.length > 0) {
                                fn_SetBasicConsultApvList(arr_Table);
                            }
                        }

                    }
                }
            }
        }

    });
}

//참조자 및 협조처 초기화
function fn_SetApvRemove(oApvList) {

    $(oApvList).find("ccinfo").remove();
    $("#CONSULT_LIST").val("");
    $("#CONSULT_EXLIST").val("");
}

// 20200821 hpark 기본결재선 상신시/수신부서 접수시 필수체크
function fn_ValidBasicApvList() {

	// 오토웨이 양식일때만 체크
	var isValidForm = false;
	if (formJson.BODY_CONTEXT != undefined) {
		var tmpIWFLegacy = (formJson.BODY_CONTEXT.m_is_IWF_Legacy != undefined) ? formJson.BODY_CONTEXT.m_is_IWF_Legacy : "";
		if (tmpIWFLegacy != "Y") isValidForm = true;
	} else {
		isValidForm = true;
	}

	var _sChkMode = ""; // DRAFT(상신) , REC1(수신부서1접수) , REC2(수신부서2접수)
	var _isValidApvLine = true;

	if (isValidForm) {

		// 기안시점 , 신청서 수신부서의 접수시점에만 체크
		if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") _sChkMode = "DRAFT";
		else if (getInfo("pdef") == "REQUEST_PATTERN" && getInfo("mode") == "REDRAFT" && getInfo("mode_unit") == "RECEIVEDEPT_APPROVAL" && getInfo("loct") == "APPROVAL") {
			if (getInfo("CurrentDivisionIdx") == "1") _sChkMode = "REC1";
			else if (getInfo("CurrentDivisionIdx") == "2") _sChkMode = "REC2";
		}

		if (_sChkMode != "") {
			var Param = String.format("{ fmid:'{0}', UR_Code: '{1}'}", getInfo("fmid"), getInfo("usid"));
			CFN_PageMethodJSON_Url("setDomainData.aspx", "WF_BASIC_APPROVAL_LINE_ALL", Param, false, function (result) { // 기본결재선 조회

				if (result.d != "" && result != undefined) {
					var objData = $.parseJSON(result.d);
					var jsonDataSet = objData.NewDataSet;

					// 해당양식 기본결재선이 있을때만 체크
					if (jsonDataSet.Table != undefined) {
						if (jsonDataSet.Table.LINE_CNT != undefined) {
							if (parseInt(jsonDataSet.Table.LINE_CNT) > 0) {

								var currApvListXML = $.parseXML(document.getElementById("APVLIST").value);

								// 기안시
								if (_sChkMode == "DRAFT") {

									//발신 결재선
									if (jsonDataSet.Table1 != undefined) {
										var arr_Table = (jsonDataSet.Table1 instanceof Array) ? jsonDataSet.Table1 : [jsonDataSet.Table1];
										if (arr_Table.length > 0) {
											$(jsonDataSet.Table1).each(function (idx, item) {
												if ($(item).attr("IS_FIXED") == "Y") {
													switch ($(item).attr("APPROVAL_TYPE")) {
														case "approve":
															var tmpCnt = $(currApvListXML).find("steps > division:eq(0)").find("step[routetype='approve'] > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length;
															if (tmpCnt == 0) {
																_isValidApvLine = false;
																return false;
															}
															break;
														case "parallel":
														case "serial":
															var tmpCnt = $(currApvListXML).find("steps > division:eq(0)").find("step[routetype='assist'][allottype='" + $(item).attr("APPROVAL_TYPE") + "'] > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length;
															if (tmpCnt == 0) {
																_isValidApvLine = false;
																return false;
															}
															break;
													}
												}
											});
											if (!_isValidApvLine) return false;
										}
									}

									//수신1차
									if (jsonDataSet.Table2 != undefined) {
										var arr_Table = (jsonDataSet.Table2 instanceof Array) ? jsonDataSet.Table2 : [jsonDataSet.Table2];
										if (arr_Table.length > 0) {
											$(jsonDataSet.Table2).each(function (idx, item) {
												switch ($(item).attr("APPROVAL_TYPE")) {
													case "multi_charge":
														var tmpCnt = $(currApvListXML).find("steps > division:eq(1)").find("step[routetype='multi_charge'] > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length;
														if (tmpCnt == 0) {
															_isValidApvLine = false;
															return false;
														}
														break;
													case "receive_dept":
														var tmpCnt = $(currApvListXML).find("steps > division:eq(1)").find("step[routetype='receive_dept'] > ou[code='" + $(item).attr("G_DEPTCODE") + "']").length;
														if (tmpCnt == 0) {
															_isValidApvLine = false;
															return false;
														}
														break;
												}
											});
											if (!_isValidApvLine) return false;
										}
									}

									//수신2차
									if (jsonDataSet.Table3 != undefined) {
										var arr_Table = (jsonDataSet.Table3 instanceof Array) ? jsonDataSet.Table3 : [jsonDataSet.Table3];
										if (arr_Table.length > 0) {
											$(jsonDataSet.Table3).each(function (idx, item) {
												switch ($(item).attr("APPROVAL_TYPE")) {
													case "multi_charge":
														var tmpCnt = $(currApvListXML).find("steps > division:eq(2)").find("step[routetype='multi_charge'] > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length;
														if (tmpCnt == 0) {
															_isValidApvLine = false;
															return false;
														}
														break;
													case "receive_dept":
														var tmpCnt = $(currApvListXML).find("steps > division:eq(2)").find("step[routetype='receive_dept'] > ou[code='" + $(item).attr("G_DEPTCODE") + "']").length;
														if (tmpCnt == 0) {
															_isValidApvLine = false;
															return false;
														}
														break;
												}
											});
											if (!_isValidApvLine) return false;
										}
									}

									//참조자
									if (jsonDataSet.Table4 != undefined) {
										var arr_Table = (jsonDataSet.Table4 instanceof Array) ? jsonDataSet.Table4 : [jsonDataSet.Table4];
										if (arr_Table.length > 0) {
											$(jsonDataSet.Table4).each(function (idx, item) {
												if ($(item).attr("IS_HIDDEN") == "Y") {
													var tmpCnt = $(currApvListXML).find("steps > ccinfo > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length;
													if (tmpCnt == 0) {
														_isValidApvLine = false;
														return false;
													}
												}
											});
											if (!_isValidApvLine) return false;
										}
									}

									//협조처
									if (jsonDataSet.Table5 != undefined) {
										var arr_Table = (jsonDataSet.Table5 instanceof Array) ? jsonDataSet.Table5 : [jsonDataSet.Table5];
										if (arr_Table.length > 0) {
											$(jsonDataSet.Table5).each(function (idx, item) {
												if ($(item).attr("G_ORGGRADECODE") != "" && $(item).attr("IS_FIXED") == "Y") {
													if ($("#CONSULT_LIST").val() == "") {
														_isValidApvLine = false;
														return false;
													} else if ($("#CONSULT_LIST").val().indexOf(":" + $(item).attr("D_DN_CODE") + ":T:" + $(item).attr("G_DEPTCODE") + ":") == -1) {
														_isValidApvLine = false;
														return false;
													}
												}
											});
											if (!_isValidApvLine) return false;
										}
									}

								}

								//수신1차
								else if (_sChkMode == "REC1") {
									if (jsonDataSet.Table2 != undefined) {
										var arr_Table = (jsonDataSet.Table2 instanceof Array) ? jsonDataSet.Table2 : [jsonDataSet.Table2];
										if (arr_Table.length > 0) {
											$(jsonDataSet.Table2).each(function (idx, item) {
												if ($(item).attr("IS_FIXED") == "Y") {
													switch ($(item).attr("APPROVAL_TYPE")) {
														case "approve":
															var tmpCnt = $(currApvListXML).find("steps > division:eq(1)").find("step[routetype='approve'] > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length;
															if (tmpCnt == 0) {
																_isValidApvLine = false;
																return false;
															}
															break;
														case "parallel":
														case "serial":
															var tmpCnt = $(currApvListXML).find("steps > division:eq(1)").find("step[routetype='assist'][allottype='" + $(item).attr("APPROVAL_TYPE") + "'] > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length;
															if (tmpCnt == 0) {
																_isValidApvLine = false;
																return false;
															}
															break;
													}
												}
											});
										}
									}
								}

								//수신2차
								else if (_sChkMode == "REC2") {
									if (jsonDataSet.Table3 != undefined) {
										var arr_Table = (jsonDataSet.Table3 instanceof Array) ? jsonDataSet.Table3 : [jsonDataSet.Table3];
										if (arr_Table.length > 0) {
											$(jsonDataSet.Table3).each(function (idx, item) {
												if ($(item).attr("IS_FIXED") == "Y") {
													switch ($(item).attr("APPROVAL_TYPE")) {
														case "approve":
															var tmpCnt = $(currApvListXML).find("steps > division:eq(2)").find("step[routetype='approve'] > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length;
															if (tmpCnt == 0) {
																_isValidApvLine = false;
																return false;
															}
															break;
														case "parallel":
														case "serial":
															var tmpCnt = $(currApvListXML).find("steps > division:eq(2)").find("step[routetype='assist'][allottype='" + $(item).attr("APPROVAL_TYPE") + "'] > ou[code='" + $(item).attr("G_DEPTCODE") + "'] > person[code='" + $(item).attr("U_UR_CODE") + "']").length;
															if (tmpCnt == 0) {
																_isValidApvLine = false;
																return false;
															}
															break;
													}
												}
											});
										}
									}
								}

							}
						}
					}
				}

			});

			if (!_isValidApvLine) alert(Common.GetDic("msg_apv_chk_apvline")); // 필수 결재정보가 지정되지 않았습니다. 결재정보를 다시 지정해주세요.
		}


	}

	return _isValidApvLine;
}



// 공문프로세스 완료된 문서 접수취소 버튼 노출
function fnCompleteCancelReceipt() {
    if (getInfo("templatemode") == "Read") {
        if (getInfo("chkAcceptCancelUseYN") != undefined) {
            if (getInfo("chkAcceptCancelUseYN") == "Y") { // 접수취소사용여부

                var currApvListXML = $.parseXML(document.getElementById("APVLIST").value);

                // 수신처 팀장이 접수, 접수담당자가 접수
                if ($(currApvListXML).find("division[divisiontype='receive'] > step[approvalorder='100'][processinstanceid='" + getInfo("piid") + "'] > ou> person[code ='" + getInfo("usid") + "']:has(> taskinfo[status='completed'],[status='reject'])").length > 0) {

                    // 결재완료날짜
                    var cmplDate = $(currApvListXML).find("division[divisiontype='receive'] > step[processinstanceid='" + getInfo("piid") + "'] > ou> person > taskinfo[status='completed'],[status='reject']:last").attr("datecompleted");
                    cmplDate = CFN_TransLocalTime(cmplDate).substring(0, 10);    // 본인 타임존에 맞는 날짜 가져오기

                    // 오늘 날짜
                    var tmpDate = new Date();
                    var CurDate = tmpDate.getFullYear() + "-" + (tmpDate.getMonth() + 1) + "-" + tmpDate.getDate();

                    // 날짜 비교
                    var arrDate1 = cmplDate.split("-");
                    var getDate1 = new Date(parseInt(arrDate1[0]), parseInt(arrDate1[1]) - 1, parseInt(arrDate1[2]));
                    var arrDate2 = CurDate.split("-");
                    var getDate2 = new Date(parseInt(arrDate2[0]), parseInt(arrDate2[1]) - 1, parseInt(arrDate2[2]));

                    var getDiffTime = getDate2.getTime() - getDate1.getTime();

                    var dateDiff = Math.floor(getDiffTime / (1000 * 60 * 60 * 24));
                    if (dateDiff <= 14) {// 완료날짜 2주이내 문서인 경우

                        // 접수 취소 버튼 노출
                        $("#btCompleteCancelReceipt").show();
                    }
                }
            }
        }

    }

}

//TO-DO : 통합결재문서 본문 클릭시 본문 저장을 위한 함수 생성
//2020-10-23 BY YJYOO
function changeFormDataFromIntegratedForm()
{
    //TO-DO : 결재문서 수정내역 관리를 위하여 수정일자 관리적용(전체 그룹사 공통 적용 : 현대엔지니어링-> 수신복수 담당자(MULTIUSER), 그외 그룹사 : 수신담당자(ROLE))
    //2020-09-17 BY YJYOO
    var iscontinue = false;
    try {
        var m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
        var current_user_type = "";
        var current_taskinfo = $(m_oApvList).find("person > taskinfo[status='pending']");
        if (current_taskinfo.length > 0 && $(current_taskinfo[0]).parent().parent()[0].nodeName.toUpperCase() == "ROLE") {
            current_user_type = "ROLE";
        }
        if (current_taskinfo.length > 0 && $(current_taskinfo[0]).parent().parent().parent()[0].nodeName.toUpperCase() == "STEP" && $(current_taskinfo[0]).parent().parent().parent().attr("routetype") == "multi_charge") {
            current_user_type = "MULTI_CHARGE";
        }
        if (current_taskinfo.length > 0 && $(current_taskinfo[0]).parent().parent().parent()[0].nodeName.toUpperCase() == "STEP" && $(current_taskinfo[0]).parent().parent().parent().attr("routetype") == "receive_dept") {
            current_user_type = "RECEIVE_DEPT";
        }
        if (current_user_type != "") {
            var getInfo_LastModifyDateTime = getInfo("LAST_MODIFIED_DATE");
            var if_LastModifyDateTime = "";
            var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/GetDocLastModifiedDate";
            var Param = String.format("{ piid:'{0}' }", (typeof getInfo("piid_parent") != "undefined" && getInfo("piid_parent") != "") ? getInfo("piid_parent") : getInfo("piid"));
            CFN_CallAjaxJson(szURL, Param, false, function (pObjData) {
                if_LastModifyDateTime = String($.parseJSON(pObjData).d);

                if (getInfo_LastModifyDateTime != if_LastModifyDateTime) {
                    Common.Warning(Common.GetDic("HDEC_LBL_ITG_EDIT_ERROR"));
                    return;
                }
                else {
                    iscontinue = true;
                }
            });

        }
        else {
            iscontinue = true;
        }
    }
    catch (e) {
        iscontinue = true;
    }

    if (iscontinue) {
        if (getInfo("editmode") == "M") {
            changeFormdataFromIntegratedForm();
        } else {
            if (checkForm(false))
                changeFormdataFromIntegratedForm();
        }
    }
}

function changeFormdataFromIntegratedForm(msg) {
    //첨부파일 처리
    if (!FormAttachProcess(function () { changeFormdataFromIntegratedForm(msg); }))
        return;
    XFN_FileSave();
    fnFormAttachUpload();

    //TO-DO : 예약 결재시 참조처 정보 셋팅
    if ($("#BOOKING_APPROVAL_YN").val() == "Y" && (getInfo("editmode") == "Y" || getInfo("editmode") == "M")) {
        setBookingApprovalReferenceList();
    }

    var sFormXml = getChangeFormXML();
    var sXML = "";

    //admin과 일반 사용자 구분, 양유빈, 2017.04.19
    if (admintype == "ADMIN") {
        sXML = "<request>" + getEnableProcessStep("1:1:1:0:0") + "<admintype>ADMIN</admintype>" + getDefaultXML() + sFormXml + "<type>MODIFY</type>" + makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) + "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata></request>";//(양식정보 저장 실행:첨부파일 저장 실행:BPM프로세스 실행:연동 실행여부:알람발송 실행) // 20171219 hpark 편집>저장시 참조처 중복추가되는현상 : referenceDisplayInfoBPMInfo 추가함
    }
    else {
        sXML = "<request>" + getEnableProcessStep("1:1:1:0:0") + "<admintype></admintype>" + getDefaultXML() + sFormXml + "<type>MODIFY</type>" + makeNode("referenceDisplayInfoBPMInfo", getInfo("referenceDisplayInfo")) + "<bpmformdata>" + getInfoBodyContext() + "</bpmformdata></request>"; // 20171219 hpark 편집>저장시 참조처 중복추가되는현상 : referenceDisplayInfoBPMInfo 추가함
    }

    try {
        CFN_CallAjax("submitForm.aspx", sXML, function (data) {
            EditIntegratedApproval();
        }, true, "xml");
    } catch (e) {
        Common.Error(e.message);
    }
}