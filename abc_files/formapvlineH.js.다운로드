

//var ApvLineType = Common.GetSession("ApvLineType");//사용자가 지정한 결재선 형태
//var ApvLineType;
var m_oApvList;
var strwidth = "86"; //테이블형 결재선 한 테이블의 넓이(초기값)

//var _aStrGetDicAll = Common.GetDicAll('lbl_Regist;lbl_Receptionist;lbl_apv_investigation;lbl_apv_Deputy;lbl_apv_jobtitle;lbl_JobPosition;lbl_apv_charge;lbl_Complete_Date;lbl_apv_receive;lbl_apv_send;btn_apv_CompleteConsult;btn_apv_RejectConsult;lbl_apv_returnForm;btn_apv_Deny;lbl_apv_reject;lbl_ApprovalComplete;btn_apv_cancel;lbl_apv_Cooperation_Wait;lbl_apv_Cooperation_Process;lbl_apv_charge_person;TodoMsgType_ApprovalComment;btn_apv_Order_comment;COMMENT_TYPE_EXAMINATION;btn_apv_have_comment_exa;btn_apv_have_comment_exa_2;lbl_apv_Cooperation_Complete;lbl_apv_Special_Report;lbl_Area;btn_Booking_Approval;btn_Apporval_opnion_Exist;lbl_apv_Receiving_Dept_Reply;msg_Processing;lbl_apv_Approved;lbl_apv_username;lbl_dept;lbl_sign;lbl_apv_date;lbl_ApprovalState;msg_apv_chkcooperatedata;lbl_apv_pending;DocSecurityGrade_00;DocSecurityGrade_01;SaveDuration_00001;SaveDuration_00003;SaveDuration_00006;SaveDuration_00012;SaveDuration_99999;lbl_apv_request_wait;lbl_apv_Cooperation_Reject;lbl_apv_error;lbl_apv_filelist_has;msg_selected;lbl_units;lbl_added;lbl_max;lbl_limits;msg_apv_dayDelay;lbl_apv_etc;btn_open;btn_Close;');

function initApvList() {

    //스마트보고서 결재선 형태 Fix. 2017.10.13, 양유빈
    if (getInfo("fmpf") == "GWOK_REPORT_W03") {
        //ApvLineType = "2";
        setInfo("ApvLineType", "2");
    }

    //Call_privateApprovalline();
    if (document.getElementById("APVLIST").value != "") {
        m_oApvList = $.parseXML(document.getElementById("APVLIST").value);

        setInlineApvList(m_oApvList);
    }
    m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
    if (getInfo("pdef") == "STEP3_PATTERN")
        setCommentDisplay_(m_oApvList);
    else
        setCommentDisplay_(m_oApvList);

    // AppLine 결재선 표시 제한
    if (typeof AppLineLimit == 'function') {
        AppLineLimit();
    }

}

function setInlineApvList(oApvList) {
    if (oApvList == null) {//IE8.0대비
        if (document.getElementById("APVLIST") == undefined) {
            oApvList = null;
            return;
        }
        else {
            m_oApvList = $.parseXML(document.getElementById("APVLIST").value);
            oApvList = m_oApvList;
        }
        //삭제?
        if (getInfo('scApvLineTypeauto') == 'D' && (getInfo("pdef") == "GENERAL_PATTERN" || getInfo("pdef") == "UNITY_REQST_PATTERN") && (getInfo('scInformationAppV') == '010' || getInfo('scInformationAppV') == '110' || getInfo('scInformationAppV') == '011' || getInfo('scInformationAppV') == '111' || getInfo('scInformationApp_coop_only') == '1')) { // 협조처만 사용 20200608 hpark 자동결재라인,결재선병합,결재/협조/참조/고정/숨김 작업
            if ($("#RecLine").length > 0) document.getElementById("RecLine").innerHTML = initConsultList();
        }
    }
    setApvStatus(oApvList);  // 업무전결 규정 및 지출승인 규정에 의거 전결권자 표시
    //ApvLineType = "3";
    var elmDivison = $(oApvList).find("steps > division[divisiontype!='cooperation']:has(step > ou > person > taskinfo[visible!='n'],step > ou > role > person > taskinfo[visible!='n'],step > ou > person > taskinfo[visible!='n'],step > ou > taskinfo[visible!='n'])")

    setApprovalLineTitle();

    //if (ApvLineType == "1") { //개인 환경설정의 값이 가로(section type)일경우
    if(getInfo("ApvLineType") == "1"){
        displayApvListCols(elmDivison);
        //} else if (ApvLineType == "2") {//개인 환경설정의 값이 가로(table type)일경우
    } else if (getInfo("ApvLineType") == "2") {//개인 환경설정의 값이 가로(table type)일경우
        displayApvList(elmDivison);
        //} else if (ApvLineType == "3") {//개인 환경설정의 값이 가로(Line type)일경우
    } else if (getInfo("ApvLineType") == "3") {//개인 환경설정의 값이 가로(Line type)일경우
        displayApvListLine(elmDivison);
    } else {
        displayApvList(elmDivison);
    }
    displayCCInfo($(oApvList).find("steps"));
    if (getInfo("fmpf") == "GWOK_FIXED_W01" || getInfo("fmpf") == "GWOK_ACQURPT_W01" || getInfo("fmpf") == "GWOK_EDUCATION_W01") setStepCombo();

    if (getInfo("scApvLineMgrButton") == "1" && (getInfo("typeImg") == "T9" || getInfo("typeImg") == "T11"))
    {
        var elmAssistList = $(elmDivison).find("step[routetype='assist'] > ou > person ");
        if (elmAssistList.length > 0) {
            document.getElementById("AssistLineExt").innerHTML = displayAssistEx(elmAssistList);
        }
        else {
            document.getElementById("AssistLineExt").innerHTML = displayAssistEx(elmAssistList);
        }
        //트랜시스 투자품의서류 통제처 표시추가 200131 홍성빈
        if (getInfo("ENT_CODE") == "H104" && getInfo("fmpf").indexOf("WF_HPT_AW_SAP_PREFIX_WF50") > -1)
        {
            var ctrldept_list = $(elmDivison).find("step[name='롤결재'] > ou > person ,[name='EXAMINATION_RECEIVE'] > ou > person");
            if (ctrldept_list.length > 0)
            {
                document.getElementById("ControlLineExt").innerHTML = displaycontrolEx(ctrldept_list);
            }
            else {
                document.getElementById("ControlLineExt").innerHTML = "";
            }
            var elmControlList = $(elmDivison).find("step > ou > role ");
            if (elmControlList.length > 0) {
                document.getElementById("ControlLineExt").innerHTML = displayControlLineExt(elmControlList);
            }
        }
        else {            
            var elmControlList = $(elmDivison).find("step > ou > role ");
            if (elmControlList.length > 0) {
                document.getElementById("ControlLineExt").innerHTML = displayControlLineExt(elmControlList);
            }
            else {
                document.getElementById("ControlLineExt").innerHTML = "";
            }
        }
    }
    //  트랜시스투자품의서류 scApvLineMgrButton(사별특화버튼) 사용안함으로 인한 추가  
    if (getInfo("scApvLineMgrButton") == "0" && (getInfo("fmpf").indexOf("WF_HPT_AW_SAP_PREFIX_WF50") > -1 || getInfo("scid") == "8e09504d-c87d-4dd3-9295-64e5c6b71af3")) {
        var elmAssistList = $(elmDivison).find("step[routetype='assist'] > ou > person ");
        if (elmAssistList.length > 0){ 
            document.getElementById("AssistLineExt").innerHTML = displayAssistEx(elmAssistList);
        }
        else {
            document.getElementById("AssistLineExt").innerHTML = displayAssistEx(elmAssistList);
        }

        var ctrldept_list = $(elmDivison).find("step[name='롤결재'] > ou > person ,[name='EXAMINATION_RECEIVE'] > ou > person");
        if (ctrldept_list.length > 0) {
            document.getElementById("ControlLineExt").innerHTML = displaycontrolEx(ctrldept_list);
        }
        else {
            document.getElementById("ControlLineExt").innerHTML = "";
        }
        var elmControlList = $(elmDivison).find("step > ou > role ");
        if (elmControlList.length > 0) {
            document.getElementById("ControlLineExt").innerHTML = displayControlLineExt(elmControlList);
        }
    }
}

function displayApvList(elmDivison) {
    var elmRoot, elmList, elmAssistList, elmVisible;
    var Apvlines = "";
    var noDisplay = 0;
    var appLength = 0;
    var SendTitle = "";
    var ReceiveTitle = "";
    var ReceiveTitle2 = "";
    var boolDisplayAssist = false;
    //elmRoot = $(oApvList).find("steps");
    if (elmDivison != null) {
        $("#RApvLine_R").html("");
        elmDivison.each(function (i, element) {

            if (i == 0) {//발신일때
                ////TO-DO : HMI와 HMMR의 해외투자품의일 경우 적용
                ////2019-09-20 BY YJYOO
                //if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN") {
                //    elmList = $(element).find("step[routetype='approve'] > ou > person,step[routetype='approve']  > ou > role ");
                //}
            	//else {

            	// HMB 투자품의 step name CTRL_CFO , CTRL_CFO_HMB 별도표시위해 삭제(HMMC CFO도 동일하게 적용)
                elmList = $(element).find("step[routetype='approve'][name!='MANAGE_DIVISION'][name!='MANAGE_PM'][name!='reference'][name!='CTRL_CFO'][name!='CTRL_CFO_HMB'][name!='CTRL_CFO_HMMC'] > ou > person[is_hidden!='Y'][documentstepcode!='EXAMINATION_RECEIVE'],step[routetype='approve'][name!='reference']  > ou > role[documentstepcode!='MANAGEMENT_RECEIVE'][documentstepcode!='CONTROL_DEPT_RECEIVE']");
            	//}

                // 기아 해외출장품의 총무팀 Role 보여줌 20170920
                if (getInfo("fmpf").indexOf("KMC_OVER_BIZ_TRIP_MF") > 0) {
                    //elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > person,step[routetype='approve'][name!='reference']  > ou > role[documentstepcode='MANAGEMENT_RECEIVE'] ");
                    elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > person[is_hidden!='Y'], step[routetype='approve'][name!='reference']  > ou > role");
                }
                // 현대 해외출장품의 총무팀 Role 보여줌 20170920 
                if (getInfo("fmpf").indexOf("HMC_OVER_BIZ_TRIP_MF") > 0) {
                    //elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > person,step[routetype='approve'][name!='reference']  > ou > role[documentstepcode!='MANAGEMENT_RECEIVE'],step[routetype='approve'][name!='reference']  > ou > role[documentstepcode='MANAGEMENT_RECEIVE']:has(taskinfo[visible='y']) ");
                    elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > person[is_hidden!='Y'], step[name!='reference']  > ou > role");
                }
                if (getInfo("scApvLineMgrButton") == "1" && getInfo("typeImg") == "T9") // 파워텍 이 타입일 대는 role 결재선에서 빼기.
                {
                    if (getInfo("fmpf").indexOf("WF_HPT_AW_SAP_PREFIX_WF50") > -1)  // 트랜시스 투자품의 결재선에 통제처 제외 200131 홍성빈
                    {
                        elmList = $(element).find("step[routetype='approve'][name!='MANAGE_DIVISION'][name!='MANAGE_PM'][name!='롤결재'][name!='EXAMINATION_RECEIVE'][name!='reference'] > ou > person[is_hidden!='Y']");
                    }
                    else
                    {
                        elmList = $(element).find("step[routetype='approve'][name!='MANAGE_DIVISION'][name!='MANAGE_PM'][name!='reference'] > ou > person[is_hidden!='Y']");
                    }
                }
                //  트랜시스투자품의서류 scApvLineMgrButton(사별특화버튼) 사용안함으로 인한 추가
                if (getInfo("scApvLineMgrButton") == "0" && (getInfo("fmpf").indexOf("WF_HPT_AW_SAP_PREFIX_WF50") > -1 || getInfo("scid") == "8e09504d-c87d-4dd3-9295-64e5c6b71af3")) {
                    elmList = $(element).find("step[routetype='approve'][name!='MANAGE_DIVISION'][name!='MANAGE_PM'][name!='롤결재'][name!='EXAMINATION_RECEIVE'][name!='reference'] > ou > person");
                }

            } else {//수신일때
                var oStep = document.createElement("step");
                var oOU = document.createElement("ou");
                var oPerson = document.createElement("person");
                var oTaskinfo = document.createElement("taskinfo");
                var ApprovalCnt = elmDivison.eq(i - 1).find("step > ou > person[is_hidden!='Y'] > taskinfo[status='pending'], step > ou > person[is_hidden!='Y'] > taskinfo[status='inactive'], step >  ou > role > person[is_hidden!='Y'] > taskinfo[status='pending'], step > ou > person[is_hidden!='Y'] > taskinfo[status='inactive']").length;

                $(oStep).append(oOU);
                $(oOU).append(oPerson);
                $(oPerson).append(oTaskinfo);

                $(oStep).attr("approvalorder", "100");
                $(oStep).attr("approverat", "N");
                $(oStep).attr("routetype", "approve");
                $(oTaskinfo).attr("status", "inactive");
                $(oTaskinfo).attr("kind", "normal");

                elmList = $(element).find("step[name!='reference'] > ou > role,step[name!='reference'] > ou > person[is_hidden!='Y'] "); //(person|role)
                elmVisible = $(element).find("step[name!='reference'] > ou > role:has(taskinfo[visible='n']),step[name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[visible='n']),step[name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                if ($(element).find("step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y']").length > 0) {
                    if ($(element).find("step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[datecompleted!=''][datecompleted])").length > 0) {
                        elmList = $(element).find("step[name!='reference'] > ou > role,step[routetype!='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y'],step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[datecompleted!=''][datecompleted]) ");
                    } else if ($(element).find("step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y'][code='" + getInfo('usid') + "'] ").length > 0 && ApprovalCnt == 0) {
                        elmList = $(element).find("step[name!='reference'] > ou > role,step[routetype!='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y'],step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y'][code='" + getInfo('usid') + "'] ");
                    } else {
                        $(oPerson).attr("code", getInfo("usid"));
                        elmList = $(element).prepend(oStep).find("step[name!='reference'] > ou > role,step[routetype!='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y']");
                    }
                } else if ($(element).find("step[routetype='receive_dept'][name!='reference'] > ou").length > 0 && $(element).find("step[routetype='receive_dept'][name!='reference'] > ou > person[is_hidden!='Y']").length == 0) {
                    elmList = $(element).prepend(oStep).find("step[routetype!='receive_dept'][name!='reference'] > ou > role,step[routetype!='receive_dept'][name!='reference'] > ou > person[is_hidden!='Y'] ");
                } else if (elmList.length == 0) {
                    elmList = $(element).find("step[routetype='receive'] > ou"); //(person|role)
                    elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou > role:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                } 
            }

            if (getInfo('typeImg') == "T13" || getInfo('typeImg') == "T14" || getInfo('typeImg') == "T15" || getInfo('typeImg') == "T16") {
                elmAssistList = $(element).closest('steps').find("step[routetype='assist'] > ou > person[is_hidden!='Y'][documentstepcode!='COOPERATION_REQUEST']").sort(function (a, b) {
                    if ($(a).closest("step").attr("allottype") == "parallel" && $(a).find("taskinfo[datecompleted!=''][datecompleted]").length > 0 &&
                        $(b).closest("step").attr("allottype") == "parallel" && $(b).find("taskinfo[datecompleted!=''][datecompleted]").length == 0) {
                        return -1;
                    } else {
                        return 1;
                    }
                });
                elmList = elmList.filter(function (x) { return elmAssistList.toArray().indexOf(elmList[x]) < 0; });
            } else if (getInfo('typeImg') == "T12" || getInfo('typeImg') == "T17" || getInfo('typeImg') == "T18" || getInfo('typeImg') == "T19" || getInfo('typeImg') == "T20") {
                elmAssistList = $(element).find("step[routetype='assist'] > ou > person[is_hidden!='Y'][documentstepcode!='COOPERATION_REQUEST']").sort(function (a, b) {
                    if ($(a).closest("step").attr("allottype") == "parallel" && $(a).find("taskinfo[datecompleted!=''][datecompleted]").length > 0 &&
                        $(b).closest("step").attr("allottype") == "parallel" && $(b).find("taskinfo[datecompleted!=''][datecompleted]").length == 0) {
                        return -1;
                    } else {
                        return 1;
                    }
                });
                elmList = elmList.filter(function (x) { return elmAssistList.toArray().indexOf(elmList[x]) < 0; });
            }

            if ($("#APPROVAL_TITLE_YN").val() == "Y") {
                SendTitle = CFN_GetDicInfo($("#SEND_TITLE").val());
                ReceiveTitle = CFN_GetDicInfo($("#RECEIVE_TITLE").val());
                ReceiveTitle2 = CFN_GetDicInfo($("#RECEIVE_TITLE2").val());
            } else if (getInfo('scApvLineTypeauto') == 'D') {//일반품의서
                SendTitle = "";
                ReceiveTitle = "";
                ReceiveTitle2 = "";
            } else if (getInfo('scApvLineTypeauto') == 'C') {//협조전류
                SendTitle = m_oFormMenu.gLabel_request_dept;
                ReceiveTitle = m_oFormMenu.gLabel_Receiving_Dept;
                ReceiveTitle2 = m_oFormMenu.gLabel_Receiving_Dept;
            } else if (getInfo('scApvLineTypeauto') == 'R') {//신청서류
                SendTitle = m_oFormMenu.gLabel_request_dept;
                ReceiveTitle = m_oFormMenu.gLabel_Receiving_Dept;
                ReceiveTitle2 = m_oFormMenu.gLabel_Receiving_Dept;

                //조건에 미주 -트랜스 리드 추가 GOJP_WORKFORM_OVERSEAS
                if (getInfo("fmpf") == "GOJP_WORKFORM_W01" || getInfo("fmpf") == "GOJP_WORKFORM_OVERSEAS")
                    ReceiveTitle = Common.GetDic("lbl_Regist");
                else if (getInfo("fmpf") == "GWOK_REMITTANCE" || getInfo("fmpf") == "HKMC_GWOK_REMITTANCE") {
                    if (i == 1)
                        ReceiveTitle = "예산통제부서";
                    else if ($(elmList).attr("ouname") != null)
                        ReceiveTitle = CFN_GetDicDatas($(elmList).attr("ouname"));
                    else if ($(elmList)[0].nodeName == "ou" && $(elmList).attr("name") != null)
                        ReceiveTitle = CFN_GetDicDatas($(elmList).attr("name"));
                }
            }

            if (getInfo('scApvLineTypeauto') == 'D') {//일반품의서
                if (i == 0) {
                    if (getInfo('typeImg') == "T12") {
                        $("#ApvLineType_HDEC").show();
                        $("#ApvLineType_C").hide();

                        document.getElementById("LApvLine_L1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                        if (elmAssistList.length > 0) {
                            document.getElementById("CApvLine_L2_HDEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                        } else {
                            document.getElementById("CApvLine_L2_HDEC").innerHTML = "";
                        }
                    } else if (getInfo('typeImg') == "T18") {
                        $("#ApvLineType_HEC").show();
                        $("#ApvLineType_C").hide();

                        document.getElementById("LApvLine_L1_HEC").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                        if (elmAssistList.length > 0) {
                            document.getElementById("CApvLine_L1_HEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                        } else {
                            document.getElementById("CApvLine_L1_HEC").innerHTML = "";
                        }
                    } else {
                        document.getElementById("AppLine").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                    }
                }
            } else if (getInfo('scApvLineTypeauto') == 'C') {//협조전류
                if (i == 0) {
                    if (getInfo('typeImg') == "T17") {
                        $("#ApvLineType_C").hide();

                        if ($("#ApvLinePlusMinus").val() == "+") {
                            $("#ApvLineType_HDEC").hide();
                        } else {
                            $("#ApvLineType_HDEC").show();
                        }

                        document.getElementById("LApvLine_L1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                        document.getElementById("RApvLine1_L1_HDEC").innerHTML = getRequestApvList($(element).find(""), $(element).find(""), "", false, ReceiveTitle);
                        if (elmAssistList.length > 0) {
                            document.getElementById("CApvLine_L1_HDEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                        } else {
                            document.getElementById("CApvLine_L1_HDEC").innerHTML = "";
                        }
                    } else if (getInfo('typeImg') == "T20") {
                        $("#ApvLineType_C").hide();

                        if ($("#ApvLinePlusMinus").val() == "+") {
                            $("#ApvLineType_HEC").hide();
                        } else {
                            $("#ApvLineType_HEC").show();
                        }

                        document.getElementById("LApvLine_L1_HEC").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                        document.getElementById("RApvLine1_L1_HEC").innerHTML = getRequestApvList($(element).find(""), $(element).find(""), "", false, ReceiveTitle);
                        if (elmAssistList.length > 0) {
                            document.getElementById("CApvLine_L1_HEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                        } else {
                            document.getElementById("CApvLine_L1_HEC").innerHTML = "";
                        }
                    } else {
                        document.getElementById("LApvLine").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                        if (elmDivison.length == 1) {
                            document.getElementById("RApvLine").innerHTML = getRequestApvList($(element).find(""), $(element).find(""), "", false, ReceiveTitle);
                        }
                    }
                }
                else {
                    var apvStepArray = new Array();//결재선 Json Array
                    var elmSortList;
                    //수신처 division을 제외한 모든 항목 삭제
                    var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
                    $(xmlApv).find("steps > division[divisiontype='send']").remove();
                    var xmlApvReceiveList = $(xmlApv).find("steps > division[divisiontype='receive']");
                    $(xmlApvReceiveList).find("step").remove();

                    //수신처 결재선 목록을 Sort 대상 Json 개체로 생성한다.
                    $(elmList).each(function (i, elm) {
                        if ($(elm).find("taskinfo").attr("visible") != 'n') {
                            var apvStepObject = new Object();//결재 단위 개체
                            apvStepObject.code = $(elm).attr("code");
                            apvStepObject.dutycode = $(elm).attr("dutycode");
                            apvStepObject.approvalorder = $(elm).parent().parent().attr("approvalorder");
                            apvStepArray.push(apvStepObject);
                        }
                    });

                    // dutycode sort 순서 => 빈값 > 큰값 > 작은값
                    // 100, 200의 duty를 비교해 담당자 지정 vs 상신결재 판단 - 그 외에는 approvalorder만 이용
                    if (apvStepArray[0] != null && apvStepArray[0] != undefined && apvStepArray[0] != "" && apvStepArray[1] != null && apvStepArray[1] != undefined && apvStepArray[1] != "") {
                        if (apvStepArray[0].dutycode < apvStepArray[1].dutycode || apvStepArray[1].dutycode == '') { // 하위 담당자 지정
                            apvStepArray.sort(function (a, b) {
                                if (a.approvalorder > b.approvalorder) return -1;
                                else return 1;
                            });
                        } else {
                            apvStepArray.sort(function (a, b) {
                                if (a.approvalorder > b.approvalorder) return 1;
                                else return -1;
                            });
                        }
                    }

                    $(apvStepArray).each(function (i, apvArr) {
                        var elm;
                        $(elmList).each(function (i, _elm) {
                            if ($(_elm).find("taskinfo").attr("visible") != 'n' && ($(_elm).attr("code") == apvArr.code && $(_elm).parent().parent().attr("approvalorder") == apvArr.approvalorder)) {
                                $(xmlApvReceiveList).append($(_elm).parent().parent());
                            }
                        });
                    });
                    elmSortList = $(xmlApv).find("division[divisiontype='receive'] > step[name!='reference']  > ou > role,division[divisiontype='receive'] > step[name!='reference']  > ou > person "); //(person|role)

                    if (getInfo('typeImg') == "T17") {
                        document.getElementById("RApvLine1_L1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle);
                    } else if (getInfo('typeImg') == "T20") {
                        document.getElementById("RApvLine1_L1_HEC").innerHTML = getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle);
                    } else {
                        document.getElementById("RApvLine").innerHTML = getRequestApvList(elmSortList, elmVisible, "", true, ReceiveTitle);
                    }
                }
            } else if (getInfo('scApvLineTypeauto') == 'R') {//신청서류
                $("#ApvLineType_R").show();
                $("#ApvLineType_C").hide();

                if (getInfo('typeImg') == "T13" || getInfo('typeImg') == "T14" || getInfo('typeImg') == "T15" || getInfo('typeImg') == "T16") {
                    $("#ApvLineType_R").hide();

                    if ($("#ApvLinePlusMinus").val() == "+") {
                        $("#ApvLineType_HDEC").hide();
                    } else {
                        $("#ApvLineType_HDEC").show();
                    }

                    if (getInfo('typeImg') == "T13") {
                        if (i == 0) {
                            document.getElementById("LApvLine_L1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                            document.getElementById("RApvLine1_D2_HDEC").innerHTML = getRequestApvList($(element).find(""), $(element).find(""), "", true, ReceiveTitle,null, "D");
                            document.getElementById("CApvLine_D1_HDEC").innerHTML = "<td>" + getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"), null, "D"); + "</td>";
                        } else {
                            document.getElementById("RApvLine1_D2_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle, null, "D");
                        }
                    } else if (getInfo('typeImg') == "T14") {
                        if (i == 0) {
                            document.getElementById("LApvLine_L1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                            document.getElementById("RApvLine1_L1_HDEC").innerHTML = getRequestApvList($(element).find(""), $(element).find(""), "", true, ReceiveTitle);
                            if (elmAssistList.length > 0) {
                                document.getElementById("CApvLine_L2_HDEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                            } else {
                                document.getElementById("CApvLine_L2_HDEC").innerHTML = "";
                            }
                        } else {
                            document.getElementById("RApvLine1_L1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle);
                        }
                    } else if (getInfo('typeImg') == "T15") {
                        if (i == 0) {
                            document.getElementById("LApvLine_L1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                            document.getElementById("RApvLine1_D1_HDEC").innerHTML = getRequestApvList($(element).find(""), $(element).find(""), "", true, ReceiveTitle, null, "D");
                            document.getElementById("RApvLine2_D1_HDEC").innerHTML = "<td>" + getRequestApvList($(element).find(""), $(element).find(""), "", true, ReceiveTitle2, null, "D"); + "</td>";
                            if (elmAssistList.length > 0) {
                                document.getElementById("CApvLine_L2_HDEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                            } else {
                                document.getElementById("CApvLine_L2_HDEC").innerHTML = "";
                            }
                        } else if (i == 1) {
                            document.getElementById("RApvLine1_D1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle, null, "D");;
                        } else {
                            document.getElementById("RApvLine2_D1_HDEC").innerHTML = "<td>" + getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle2, null, "D"); + "</td>";
                        }
                    } else if (getInfo('typeImg') == "T16") {
                        if (i == 0) {
                            document.getElementById("LApvLine_L1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                            document.getElementById("RApvLine1_L1_HDEC").innerHTML = getRequestApvList($(element).find(""), $(element).find(""), "", true, ReceiveTitle);
                            document.getElementById("RApvLine2_L1_HDEC").innerHTML = "<td>" + getRequestApvList($(element).find(""), $(element).find(""), "", true, ReceiveTitle2) + "</td>";
                            if (elmAssistList.length > 0) {
                                document.getElementById("CApvLine_L2_HDEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                            } else {
                                document.getElementById("CApvLine_L2_HDEC").innerHTML = "";
                            }
                        } else if (i == 1) {
                            document.getElementById("RApvLine1_L1_HDEC").innerHTML = getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle);
                        } else {
                            document.getElementById("RApvLine2_L1_HDEC").innerHTML = "<td>" + getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle2) + "</td>";
                        }
                    }
                } else if (getInfo('typeImg') == "T19") {
                    $("#ApvLineType_R").hide();

                    if ($("#ApvLinePlusMinus").val() == "+") {
                        $("#ApvLineType_HEC").hide();
                    } else {
                        $("#ApvLineType_HEC").show();
                    }

                    if (i == 0) {
                        document.getElementById("LApvLine_L1_HEC").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                        document.getElementById("RApvLine1_L1_HEC").innerHTML = getRequestApvList($(element).find(""), $(element).find(""), "", true, ReceiveTitle);
                        if (elmAssistList.length > 0) {
                            document.getElementById("CApvLine_L1_HEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                        } else {
                            document.getElementById("CApvLine_L1_HEC").innerHTML = "";
                        }
                    } else if (i == 1) {
                        document.getElementById("RApvLine1_L1_HEC").innerHTML = getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle);
                        if (elmAssistList.length > 0) {
                            document.getElementById("CApvLine_L2_HEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                        } else {
                            document.getElementById("CApvLine_L2_HEC").innerHTML = "";
                        }
                    } else {
                        document.getElementById("RApvLine2_L1_HEC").innerHTML = getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle2);
                        if (elmAssistList.length > 0) {
                            document.getElementById("CApvLine_L3_HEC").innerHTML = getRequestApvList(elmAssistList, elmVisible, "", false, Common.GetDic("lbl_apv_consult"));
                        } else {
                            document.getElementById("CApvLine_L3_HEC").innerHTML = "";
                        }
                    }
                } else if ($(element).find("step > ou > person[documentstepcode='REGISTER_RECEIVE']").length > 0) {
                    if (i == 0) {
                        var RoleApprovalOrder = parseInt($($(element).find("step:has(ou > person[documentstepcode='REGISTER_RECEIVE'])")).attr("approvalorder"));
                        elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > *");
                        elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou >*:has(taskinfo[visible='n'])");  //전달 person도 제외에 체크

                        document.getElementById("LApvLine_R").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle, RoleApprovalOrder);
                        document.getElementById("RApvLine_R").innerHTML = "<td>" + getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle, RoleApprovalOrder) + "</td>";
                    }
                } else if (elmDivison.length > 1) {
                    //TO-DO : 전산사용권한 양식의 경우 결재순서를 뒤집어서 표현한다.
                    if (getInfo("pdef") == "COMPUTATION_PATTERN") {
                        if (i == 0) {
                            document.getElementById("LApvLine_R").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                        }
                        else if (i == 1) {
                            var apvStepArray = new Array();//결재선 Json Array
                            var elmSortList;
                            //수신처 division을 제외한 모든 항목 삭제
                            var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
                            $(xmlApv).find("steps > division[divisiontype='send']").remove();
                            var xmlApvReceiveList = $(xmlApv).find("steps > division[divisiontype='receive']:has( > step[name='SUPV_DEPT'])");
                            $(xmlApvReceiveList).find("step").remove();

                            //수신처 결재선 목록을 Sort 대상 Json 개체로 생성한다.
                            $(elmList).each(function (i, elm) {
                                if ($(elm).find("taskinfo").attr("visible") != 'n' && $(elm).parent().parent().attr("name") == "SUPV_DEPT") {
                                    var apvStepObject = new Object();//결재 단위 개체
                                    apvStepObject.code = $(elm).attr("code");
                                    apvStepObject.dutycode = $(elm).attr("dutycode");
                                    apvStepObject.approvalorder = $(elm).parent().parent().attr("approvalorder");
                                    apvStepArray.push(apvStepObject);
                                }
                            });
                            // dutycode sort 순서 => 빈값 > 큰값 > 작은값
                            apvStepArray.sort(function (a, b) {
                                if (a.dutycode == '') return -1;
                                if (b.dutycode == '') return 1;
                                if (a.dutycode < b.dutycode) return 1;
                                if (b.dutycode < a.dutycode) return -1;
                            });

                            $(apvStepArray).each(function (i, apvArr) {
                                var elm;
                                $(elmList).each(function (i, _elm) {
                                    if ($(_elm).find("taskinfo").attr("visible") != 'n' && ($(_elm).attr("code") == apvArr.code && $(_elm).parent().parent().attr("approvalorder") == apvArr.approvalorder)) {
                                        $(xmlApvReceiveList).append($(_elm).parent().parent());
                                    }

                                });
                            });
                            elmSortList = $(xmlApv).find("division[divisiontype='receive'] > step[name='SUPV_DEPT']  > ou > person");
                            document.getElementById("RApvLine_R").innerHTML = "<td>" + getRequestApvList(elmSortList, elmVisible, "", true, ReceiveTitle) + "</td>";
                        }
                        else {
                            var apvStepArray = new Array();//결재선 Json Array
                            var elmSortList;
                            //수신처 division을 제외한 모든 항목 삭제
                            var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
                            $(xmlApv).find("steps > division[divisiontype='send']").remove();
                            var xmlApvReceiveList = $(xmlApv).find("steps > division[divisiontype='receive']:has( > step[name='SYS_DEPT'])");
                            $(xmlApvReceiveList).find("step").remove();

                            //수신처 결재선 목록을 Sort 대상 Json 개체로 생성한다.
                            $(elmList).each(function (i, elm) {
                                if ($(elm).find("taskinfo").attr("visible") != 'n' && $(elm).parent().parent().attr("name") == "SYS_DEPT") {
                                    var apvStepObject = new Object();//결재 단위 개체
                                    apvStepObject.code = $(elm).attr("code");
                                    apvStepObject.dutycode = $(elm).attr("dutycode");
                                    apvStepObject.approvalorder = $(elm).parent().parent().attr("approvalorder");
                                    apvStepArray.push(apvStepObject);
                                }
                            });

                            // dutycode sort 순서 => 빈값 > 큰값 > 작은값
                            apvStepArray.sort(function (a, b) {
                                if (a.dutycode == '') return -1;
                                if (b.dutycode == '') return 1;
                                if (a.dutycode < b.dutycode) return 1;
                                if (b.dutycode < a.dutycode) return -1;
                            });

                            $(apvStepArray).each(function (i, apvArr) {
                                var elm;
                                $(elmList).each(function (i, _elm) {
                                    if ($(_elm).find("taskinfo").attr("visible") != 'n' && ($(_elm).attr("code") == apvArr.code && $(_elm).parent().parent().attr("approvalorder") == apvArr.approvalorder)) {
                                        $(xmlApvReceiveList).append($(_elm).parent().parent());
                                    }

                                });
                            });
                            elmSortList = $(xmlApv).find("division[divisiontype='receive'] > step[name='SYS_DEPT']  > ou > person"); //(person|role)
                            document.getElementById("RApvLine_R").innerHTML += "<td>" + getRequestApvList(elmSortList, elmVisible, "", true, ReceiveTitle) + "</td>";
                        }
                    }
                    else {
                        if (i == 0)
                            document.getElementById("LApvLine_R").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);
                        //조건에 미주 - 트랜스 리드 업무표준 추가 GOJP_WORKFORM_OVERSEAS
                        else if (!(getInfo("fmpf") == "GOJP_WORKFORM_W01" || getInfo("fmpf") == "GOJP_WORKFORM_OVERSEAS")) {
                            document.getElementById("RApvLine_R").innerHTML += "<td>" + getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle) + "</td>";
                        }
                    }

                } else if ($(element).find("step > ou > role").length > 0) {
                    var RoleApprovalOrder = parseInt($($(element).find("step:has(ou > role)")).attr("approvalorder"));
                    elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > *");
                    elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou >*:has(taskinfo[visible='n'])");  //전달 person도 제외에 체크
                    document.getElementById("LApvLine_R").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle, RoleApprovalOrder);
                    document.getElementById("RApvLine_R").innerHTML += "<td>" + getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle, RoleApprovalOrder) + "</td>";
                } else {
                    if (i == 0)
                        document.getElementById("LApvLine_R").innerHTML = getRequestApvList(elmList, elmVisible, "", false, SendTitle);

                    if (elmDivison.length == 1) {
                        document.getElementById("RApvLine_R").innerHTML = "<td>" + getRequestApvList($(element).find(""), $(element).find(""), "", false, ReceiveTitle) + "</td>";
                    }
                    else
                        document.getElementById("RApvLine_R").innerHTML += "<td>" + getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle) + "</td>";
                }
            }
        });
    }
}


/*수신처, 발신처 부서 결재선 표현 "일반품의서" */

function getRequestApvList(elmList, elmVisible, sMode, bReceive, sApvTitle, RoleApprovalOrder, DisplayType) {//신청서html
    var elm, elmTaskInfo, elmReceive, elmApv;
    var strDate;
    var visibleApvlineCnt = 0;
    var Apvlines = "";
    var ApvPOSLines = "<tr>"; //부서명 or 발신부서,신청부서,담당부서,수신부서 등등 으로 표기<tr>
    var ApvPOSLinesTemp = "<tr>";
    var ApvTitleLines = "";
    var ApvSignLines = "<tr>"; //결재자 사인이미지 들어가는 부분<tr>
    var ApvSignLinesTemp = "<tr>";
    var ApvApproveNameLines = "<tr>"; //결재자 성명 및 contextmenu 및 </br>붙임 후 결재일자 표기<tr>
    var ApvApproveNameLinesTemp = "<tr>";
    var ApvDateLines = "<tr>"; //사용안함
    var ApvDateLinesTemp = "<tr>";
    var ApvHeader = "";
    var cntDPLine = tableLineMax;
    var ApvListMaxLength = getInfo("scApvlineCntV");    //결재방 갯수 지정 스키마 값 by ssuby
    var Role_No = 0;    //현대기아 해품 접수자 순번
    var initiatedDate;

    if (sApvTitle != "" && ApvHeader == "") {
        if (getInfo('scApvLineTypeauto') == 'R' &&
            getInfo('typeImg') != "T13" && getInfo('typeImg') != "T14" && getInfo('typeImg') != "T15" && getInfo('typeImg') != "T16" && getInfo('typeImg') != "T19") {
            //예산통제부서만 11px로 처리. 2017.11.24 양유빈
            if (sApvTitle == "예산통제부서") {
                ApvHeader = "<th rowspan='5'  style='width: 20px; font-size: 11px;' >" + sApvTitle.substring(0, 6) + "</th>";
            }
            else {
                ApvHeader = "<th rowspan='5'  style='width: 20px; font-size: 12px;' >" + sApvTitle.substring(0, 6) + "</th>";
            }

        } else {
            ApvHeader = "<tr><th class='tit'>" + sApvTitle + "</th></tr>";
        }
    }

    
    elmList.each(function (i, elm) {
        elmTaskInfo = $(elm).find("taskinfo");
        var CurrentStep = $(elm).parent().parent();
        var CurrentApprovalOrder = parseInt(CurrentStep.attr("approvalorder"));
        var CurrentApprovaerAt = CurrentStep.attr("approverat");//현결재자:Y,겸직자:X, 현결재자아님:N
        var CurrentRoutetype = CurrentStep.attr("routetype");
        var bDisplay = true;
        if (RoleApprovalOrder != null) {
            if (!bReceive) {
                if (CurrentApprovalOrder >= RoleApprovalOrder)
                    bDisplay = false;
            } else {
                if (CurrentApprovalOrder < RoleApprovalOrder)
                    bDisplay = false;
                if ($(elm).parent().parent().attr("approvalorder") == "")
                    bDisplay = false;
            }
        }

        //[파워텍] 수신부서 담당자가 결재자 추가 시 발신부서가 아닌 수신부서에 결재자들의 서명란이 추가되지 않는 현상 수정 KBW20180207

        // 롤 결재자가 수신 부서인 경우 로직 추가 LISTTYPE KBW20181114
        if (getInfo("openerDocumentStepCode") == "CHARGE_RECEIVE" && $(elmTaskInfo).attr("status") == "inactive") {
            if ((getInfo("ENT_CODE") == "H104" || getInfo("ENT_CODE") == "H109") && $(elm).parent().parent().attr("approvalorder") == "") {
                if (bReceive)
                    bDisplay = true;
                else
                    bDisplay = false;
            }
            else if ((getInfo("pdef") == "DEPT_INTER_PATTERN") && $(elm).parent().parent().attr("approvalorder") == "") {
                if (bReceive)
                    bDisplay = true;
                else
                    bDisplay = false;
            }
        }
        //if (elm.nodeName == "role") { RoleListType = true; }

        //if (RoleListType && (getInfo("pdef") == "UNITY_REQST_PATTERN") && $(elm).parent().parent().attr("approvalorder") == "") {
        //    if (bReceive)
        //        bDisplay = true;
        //    else
        //        bDisplay = false;
        //}
        //else if (RoleListType && (getInfo("pdef") == "DEPT_INTER_PATTERN") && $(elm).parent().parent().attr("approvalorder") == "") {
        //    if (bReceive)
        //        bDisplay = true;
        //    else
        //        bDisplay = false;
        //}



        if (bDisplay && elmTaskInfo.attr("kind") != 'conveyance') {

            //if ((bDisplayCharge && i == 0) || (elmTaskInfo.attr("visible") != "n")) //결재선 숨기기한 사람 숨기기
            if (elmTaskInfo.attr("visible") != "n") //결재선 숨기기한 사람 숨기기
            {
                var sTitle = "";
                try {
                    var splittitle = ($(elm).attr("dutyname") != null && $(elm).attr("dutyname") != undefined && $(elm).attr("dutyname") != "") ? $(elm).attr("dutyname") : "";

                    if ((getInfo('typeImg') == "T12" || getInfo('typeImg') == "T13" || getInfo('typeImg') == "T14" || getInfo('typeImg') == "T15" || getInfo('typeImg') == "T16" || getInfo('typeImg') == "T17") && sApvTitle == Common.GetDic("lbl_apv_consult")) {
                        splittitle = ($(elm).attr("ouname") != null && $(elm).attr("ouname") != undefined && $(elm).attr("ouname") != "") ? $(elm).attr("ouname") : "";
                    }

                    //sTitle = (splittitle != "") ? CFN_GetDicDatas(splittitle) : Common.GetDic("lbl_apv_charge")
                    // 기아/현대 해외출장품의 접수자 추가 20170920
                    if (getInfo("fmpf").indexOf("_OVER_BIZ_TRIP_MF") > 0) {
                        // 현대 수정(임시)
                        if (getInfo("fmpf").indexOf("KMC_OVER_BIZ_TRIP_MF") > 0) {
                            if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                                sTitle = CFN_GetDicDatas(splittitle);
                            else if (($(elmTaskInfo).attr("kind") == "charge") && $(elm).attr("documentstepcode") != "MANAGEMENT_RECEIVE")
                                sTitle = Common.GetDic("lbl_apv_charge");
                            else if ($(elm).attr("documentstepcode") == "MANAGEMENT_RECEIVE") {
                                sTitle = Common.GetDic("lbl_Receptionist");
                                Role_No = i;
                            }
                            else
                                sTitle = Common.GetDic("lbl_apv_investigation");
                        } else {
                            if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                                sTitle = CFN_GetDicDatas(splittitle);
                            else if ($(elmTaskInfo).attr("kind") == "charge")
                                sTitle = Common.GetDic("lbl_apv_charge");
                            else if (elm.nodeName == "role") {
                                sTitle = Common.GetDic("lbl_Receptionist");
                                Role_No = i;
                            } else if (bReceive && i == 0) {
                                sTitle = Common.GetDic("lbl_apv_charge");
                            }
                            else
                                sTitle = Common.GetDic("lbl_apv_investigation");
                        }
                        
                    }
                    //TO-DO : 해외투자 품의 문서의 통제부서와 통제부서 검토자의 명칭 변경
                    //2019-09-25 BY YJYOO
                    if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN") {
                        if ($(elm).attr("documentstepcode") == "CONTROL_DEPT_RECEIVE")
                            sTitle = Common.GetDic("lbl_control_dept");
                        else if ($(elm).attr("documentstepcode") == "EXAMINATION_RECEIVE")
                            sTitle = Common.GetDic("lbl_Reviewer");
                        else if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                            sTitle = CFN_GetDicDatas(splittitle);
                        else if ($(elmTaskInfo).attr("kind") == "charge")
                            sTitle = Common.GetDic("lbl_apv_charge");
                        else if (elm.nodeName == "role") 
                            sTitle = Common.GetDic("lbl_apv_charge");
                        else if (bReceive && i == 0)
                            sTitle = Common.GetDic("lbl_apv_charge");
                        else
                            sTitle = Common.GetDic("lbl_apv_investigation");
                    }
                    else {
                        if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                            sTitle = CFN_GetDicDatas(splittitle);
                        else if ($(elmTaskInfo).attr("kind") == "charge")
                            sTitle = Common.GetDic("lbl_apv_charge");
                        else if (elm.nodeName == "role") {
                            sTitle = Common.GetDic("lbl_apv_charge");
                        } else if (bReceive && i == 0) {
                            sTitle = Common.GetDic("lbl_apv_charge");
                        }
                        else
                            sTitle = Common.GetDic("lbl_apv_investigation");
                    }
                } catch (e) {
                    if (elm.nodeName == "role") {
                        sTitle = m_oFormMenu.gLabel_charge; //"담당"
                    }
                }

                if (getInfo("fmpf").toUpperCase() == "GWOK_DINVEST_W01") {
                    //var initiatedDate;
                    if (i == 0) {
                        initiatedDate = $(elmTaskInfo).attr("datereceived");
                    }
                    //var initiator = $(elmList).p.find("step[name='기안자'] > ou > person >taskinfo");
                    //var initiator = $(elmList).find("division[divisiontype='send'] > step > ou:has( person > taskinfo[kind='charge'])");
                    //var elmFirstStep = $(elmList).find("step[approvalorder='100']");
                    if (initiatedDate <= "2020-08-06") {
                        if (i == 3) {
                            sTitle = Common.GetDic("lbl_apv_assistant");
                        } else if (i == 4) {
                            sTitle = Common.GetDic("lbl_apv_chief");
                        }
                    }
                    else {
                        if (i == 4) {
                            sTitle = Common.GetDic("lbl_apv_assistant");
                        } else if (i == 5) {
                            sTitle = Common.GetDic("lbl_apv_chief");
                        }
                    }
                }

            	// 20200824 hpark 대시보드,결재선보기에서 부서도착시점에 부서장정보 안보이도록
                if (getInfo("pdef") == "REQUEST_PATTERN") {
                	if ($(elm).closest("step").attr("routetype") == "receive_dept"){
                		if($(elm).find("taskinfo").attr("status") == "inactive"
							|| ($(elm).find("taskinfo").attr("status") == "pending" && $(elm).attr("code") != getInfo("usid"))) {
                			sTitle = "";
                		}
                	} else if ($(elm).attr("code") == undefined) { // 상단에서 수신부서 도착전에는 person이 없어서 빈Step,Person을 넘기므로 수신부서 미도착으로 간주
                		sTitle = "";
                	}
						
                }

                ApvPOSLines += "<th width='" + strwidth + "' >" + sTitle + "</th>";

                ApvDateLines += "<td align='center' valign='middle' >";
                ApvSignLines += "<td align='center' valign='middle'>";
                ApvApproveNameLines += "<td class='la'>";

                strDate = ($(elmTaskInfo).attr("datecompleted") != "" && $(elmTaskInfo).attr("datecompleted") != undefined) ? $(elmTaskInfo).attr("datecompleted") : "";

                if (elm.nodeName == "role") {
                    try {
                        var roleperson = $(elm).find("person");
                        if (roleperson.length > 0)
                            elm = roleperson[0];

                    } catch (e) { }
                }



                var bRejected = false;

                // [2016-08-03 leesm] 반송도 결재 라인에 표시되야 하므로 아래 구문 주석
                if ($(elmTaskInfo).attr("result") == "rejected") {
                    //bRejected = true;
                }

                var split_elmTitle = ($(elm).attr("dutyname") != null && $(elm).attr("positionname") != undefined && $(elm).attr("positionname") != "") ? $(elm).attr("positionname") : "";
                elmTitle = (split_elmTitle != "") ? CFN_GetDicDatas(split_elmTitle) : Common.GetDic("lbl_apv_charge");

                switch ($(elmTaskInfo).attr("kind")) {
                    case "authorize":
                        //TO-DO : 다국어 방식 변경에 따른 호출 함수변경
                        //2017-04-24 BY YJYOO
                        ApvSignLines += (strDate == "") ? CFN_GetDicDatas(elm.getAttribute("name")) + "<br /><font size='2'>(" + m_oFormMenu.gLabel_authorize + ")</font>" : ((bRejected) ? interpretResult($(elmTaskInfo).attr("result"), "", $(elmTaskInfo).attr("kind")) : getSignUrl(sCode, $(elmTaskInfo).attr("customattribute1"), $(elm).attr("name"), strDate, true, $(elmTaskInfo).attr("result"), true));
                        ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + CFN_GetDicDatas(elm.getAttribute("name")) + " " + m_oFormMenu.gLabel_authorize + "</span>";
                        ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");

                        LastApv = "/";
                        LastApvName = CFN_GetDicDatas($(elmname).attr("name")) + interpretResult($(elmTaskInfo).attr("result")) + "<br />";
                        LastDate = formatDate(strDate);
                        break;

                    case "substitute":
                        ApvSignLines += (strDate == "") ? CFN_GetDicDatas(elm.getAttribute("name")) + "<br /><font size='2'>(" + m_oFormMenu.gLabel_substitue + ")</font>" : ((bRejected) ? interpretResult($(elmTaskInfo).attr("result"), "", $(elmTaskInfo).attr("kind")) : CFN_GetDicDatas(elm.getAttribute("name")));
                        ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : (($(elmTaskInfo).attr("result") != "rejected") ? (($(elmTaskInfo).attr("result") == "opinion") ? "<span>" + CFN_GetDicDatas(elm.getAttribute("name")) + " " + interpretResult($(elmTaskInfo).attr("result"), "", $(elmTaskInfo).attr("kind")) + "</span>" : "<span class='txt_gn11_blur'>" + XFN_GetDicInfo(elm.getAttribute("name")) + " " + m_oFormMenu.gLabel_substitue + "</span>") : "<span class='txt_gn11_blur'>" + XFN_GetDicInfo(elm.getAttribute("name")) + " " + interpretResult($(elmTaskInfo).attr("result"), "", $(elmTaskInfo).attr("kind")) + "</span>");
                        ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");

                        LastApv = "";
                        LastApvName = "";
                        LastDate = "";
                        break;
                    case "skip":
                        ApvSignLines += "/";
                        ApvApproveNameLines += "<span>&nbsp;</span>";
                        ApvDateLines += "&nbsp;";
                        break;

                    case "bypass":
                        ApvSignLines += (strDate == "") ? CFN_GetDicDatas(elm.getAttribute("name")) + "<br /><font size='2'>(" + m_oFormMenu.gLabel_bypass + ")</font>" : m_oFormMenu.gLabel_bypass;
                        ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + CFN_GetDicDatas(elm.getAttribute("name")) + " " + m_oFormMenu.gLabel_bypass + "</span>";
                        ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break; //"후열"
                    case "review":
                        ApvSignLines += (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);
                        ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + CFN_GetDicDatas(elm.getAttribute("name")) + " " + m_oFormMenu.gLabel_review + "</span>";
                        ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "charge":
                        ApvSignLines += (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);

                        // [2016-08-11 leesm] 기안자에게도 승인 정보 표시하기
                        if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "")
                            ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : "<span>(" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
                        else
                            ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "passed_approval": //대면결재
                        ApvSignLines += (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);
                        ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + CFN_GetDicDatas(elm.getAttribute("name")) + " (" + m_oFormMenu.gLabel_face_to_face + ")</span>";
                        ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break; //"후열"
                    default:
                        //if (elm.nodeName == "role") {
                        //    var roleperson = $(elm).find("person");
                        //    if (roleperson.length > 0)
                        //        elm = roleperson[0];
                        //    ApvSignLines += (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                        //    ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        //    ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        //}
                        //else {
                        //TO-DO : 협조요청 및 협조처 완료후 직급과 이름만 표시하는 로직
                        if ((elm.getAttribute("documentstepcode") != null && elm.getAttribute("documentstepcode") == "COOPERATION_REQUEST") || (getInfo("coperationCompletedAt") == "Y" && BPMBeforeApproval == "Y")) {
                        //if ((elm.getAttribute("documentstepcode") != null && elm.getAttribute("documentstepcode") == "COOPERATION_REQUEST" && BPMBeforeApproval == "Y") || (getInfo("coperationCompletedAt") == "Y" && BPMBeforeApproval == "Y")) {
                            ApvSignLines += ($(elmTaskInfo).attr("status") == "inactive") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                            if ($(elmTaskInfo).attr("status") == "inactive") {
                                ApvApproveNameLines += "<span>&nbsp;</span>";
                            } else {
                                if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "")
                                    ApvApproveNameLines += "<span>(" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
                                else
                                    ApvApproveNameLines += "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                            }
                            ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        }
                        else {
                            //TO-DO : 겸직자가 연속된 결재자일때 협조요청 또는 협조처 완료된 문서의 직급과 이름만 표시하는 로직
                            if (CurrentApprovaerAt == "X" && (($(CurrentStep).next().length > 0 && $(CurrentStep).next().find("ou > person").attr("documentstepcode") == "COOPERATION_REQUEST") || getInfo("coperationCompletedAt") == "Y")) {
                                ApvSignLines += ($(elmTaskInfo).attr("status") == "inactive") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                                ApvApproveNameLines += ($(elmTaskInfo).attr("status") == "inactive") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                                ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                            }
                            else {
                                ApvSignLines += ($(elmTaskInfo).attr("status") == "inactive" || $(elmTaskInfo).attr("status") == "pending") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                                //ApvApproveNameLines += ($(elmTaskInfo).attr("status") == "inactive" || $(elmTaskInfo).attr("status") == "pending") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                                if ($(elmTaskInfo).attr("status") == "inactive" || $(elmTaskInfo).attr("status") == "pending") {
                                    ApvApproveNameLines += "<span>&nbsp;</span>";

                                } else {
                                	if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "") {
                                		if ($(CurrentStep).attr("isprecdng") != null && $(CurrentStep).attr("isprecdng") == "Y")
                                			ApvApproveNameLines += "<span>(" + Common.GetDic("lbl_apv_Deputy") + ")" + "(" + Common.GetDic("btn_apv_preApproval") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"; // 20200610 hpark 예결함에서 선결
                                		else
                                			ApvApproveNameLines += "<span>(" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                                	}
                                	else {
                                		if ($(CurrentStep).attr("isprecdng") != null && $(CurrentStep).attr("isprecdng") == "Y")
                                			ApvApproveNameLines += "<span>" + "(" + Common.GetDic("btn_apv_preApproval") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"; // 20200610 hpark 예결함에서 선결
                                		else
                                			ApvApproveNameLines += "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                                	}
                                }
                                ApvDateLines += (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                            }
                        }
                        //}
                }

                ApvSignLines += "</td>";
                ApvApproveNameLines += "</td>";

                ApvDateLines += "</span></td>";
                visibleApvlineCnt++;
            }
        }
    });
    

    //TO-DO : 결재방 빈방 그리기
    //2017-07-19 BY YJYOO
    if (getInfo('typeImg') == "T13" || getInfo('typeImg') == "T14" || getInfo('typeImg') == "T15" || getInfo('typeImg') == "T16" ||
        getInfo('typeImg') == "T18" || getInfo('typeImg') == "T19" || getInfo('typeImg') == "T20" ||
       ((getInfo('typeImg') == "T12" || getInfo('typeImg') == "T17") && sApvTitle != Common.GetDic("lbl_apv_consult"))) {
        var k = ApvListMaxLength;

        if (DisplayType == "D") {
            k = Number(Common.GetBaseConfig('HDEC_DIV_TYPE_MAX_APVLINE'));
        }

        if (visibleApvlineCnt > k) {
            for (var i = 0; i < k; i++) {
                ApvPOSLinesTemp += $(ApvPOSLines).find('th')[i].outerHTML;
                ApvSignLinesTemp += $(ApvSignLines).find('td')[i].outerHTML;
                ApvApproveNameLinesTemp += $(ApvApproveNameLines).find('td')[i].outerHTML;
                ApvDateLinesTemp += $(ApvDateLines).find('td')[i].outerHTML;
            }
            ApvPOSLines = ApvPOSLinesTemp;
            ApvSignLines = ApvSignLinesTemp;
            ApvApproveNameLines = ApvApproveNameLinesTemp;
            ApvDateLines = ApvDateLinesTemp;
        }

        for (k; k > visibleApvlineCnt; k--) {
            ApvPOSLines += "<th width='" + strwidth + "' >&nbsp;</th>";
            ApvSignLines += "<td align='center' valign='middle'>&nbsp;</td>";
            ApvApproveNameLines += "<td class='la'><p class='grv_ellipsis_none'><span>&nbsp;</span></p></td>";
            ApvDateLines += "<td align='center' valign='middle'><span>&nbsp;</span></td>";
        }
    } else if (getInfo('scApvLineTypeauto') != 'R') {
        var k = ApvListMaxLength;
        for (k; k > visibleApvlineCnt; k--) {
            ApvPOSLines += "<th width='" + strwidth + "' >&nbsp;</th>";
            ApvSignLines += "<td align='center' valign='middle'>&nbsp;</td>";
            ApvApproveNameLines += "<td class='la'><p class='grv_ellipsis_none'><span>&nbsp;</span></p></td>";
            ApvDateLines += "<td align='center' valign='middle'><span>&nbsp;</span></td>";
        }
    } else if (ApvPOSLines == "<tr>") {
        ApvPOSLines += "<th width='" + strwidth + "' >&nbsp;</th>";
        ApvSignLines += "<td align='center' valign='middle'>&nbsp;</td>";
        ApvApproveNameLines += "<td class='la'><p class='grv_ellipsis_none'><span>&nbsp;</span></p></td>";
        ApvDateLines += "<td align='center' valign='middle'><span>&nbsp;</span></td>";
    }

    var tempApvLine = "";

    if (visibleApvlineCnt > ApvListMaxLength && (getInfo('typeImg') == "T12" || getInfo('typeImg') == "T17") && sApvTitle == Common.GetDic("lbl_apv_consult")) {
        ApvPOSLinesTemp = "<tr>";
        ApvSignLinesTemp = "<tr>";
        ApvApproveNameLinesTemp = "<tr>";
        ApvDateLinesTemp = "<tr>";

        for(var i = 0; i < visibleApvlineCnt; i++){
            ApvPOSLinesTemp += $(ApvPOSLines).find('th')[i].outerHTML;
            ApvSignLinesTemp += $(ApvSignLines).find('td')[i].outerHTML;
            ApvApproveNameLinesTemp += $(ApvApproveNameLines).find('td')[i].outerHTML;
            ApvDateLinesTemp += $(ApvDateLines).find('td')[i].outerHTML;

            if (i != 0 && i != visibleApvlineCnt - 1 && i % ApvListMaxLength == ApvListMaxLength - 1) {
                tempApvLine += ApvPOSLinesTemp + "</tr>" + ApvSignLinesTemp + "</tr>" + ApvApproveNameLinesTemp + "</tr>" + ApvDateLinesTemp + "</tr>" + "<tr style='height:10px; border-top:1px solid #ddd;'></tr>";

                ApvPOSLinesTemp = "<tr>";
                ApvSignLinesTemp = "<tr>";
                ApvApproveNameLinesTemp = "<tr>";
                ApvDateLinesTemp = "<tr>";
            }
        }

        if (visibleApvlineCnt % ApvListMaxLength != 0) {
            var k = ApvListMaxLength;
            for (k; k > visibleApvlineCnt % ApvListMaxLength; k--) {
                ApvPOSLinesTemp += "<th width='" + strwidth + "' >&nbsp;</th>";
                ApvSignLinesTemp += "<td align='center' valign='middle'>&nbsp;</td>";
                ApvApproveNameLinesTemp += "<td class='la'><p class='grv_ellipsis_none'><span>&nbsp;</span></p></td>";
                ApvDateLinesTemp += "<td align='center' valign='middle'><span>&nbsp;</span></td>";
            }
        }

        tempApvLine = (sApvTitle == "" ? "" : ApvHeader) + tempApvLine + ApvPOSLinesTemp + "</tr>" + ApvSignLinesTemp + "</tr>" + ApvApproveNameLinesTemp + "</tr>" + ApvDateLinesTemp + "</tr>";
    } else {
        tempApvLine = (sApvTitle == "" ? "" : ApvHeader) + ApvPOSLines + "</tr>" + ApvSignLines + "</tr>" + ApvApproveNameLines + "</tr>" + ApvDateLines + "</tr>";
    }

    Apvlines += tempApvLine;

    ApvPOSLines = "";
    ApvTitleLines = "";
    ApvSignLines = "";
    ApvApproveNameLines = "";
    ApvDateLines = "";

    var Width = "width:100%;";
    if (getInfo('scApvLineTypeauto') == 'R' &&
        getInfo('typeImg') != "T13" && getInfo('typeImg') != "T14" && getInfo('typeImg') != "T15" && getInfo('typeImg') != "T16" &&
        getInfo('typeImg') != "T17" && getInfo('typeImg') != "T18" && getInfo('typeImg') != "T19" && getInfo('typeImg') != "T20" && getInfo('typeImg') != "T23") Width = "";
    if (Apvlines != "") Apvlines = "<table class='table_1' summary='서명' cellpadding='0' cellspacing='0' style='" + Width + "'>" + Apvlines + "</table>"; //width:95%;

    // 기아/현대 해외출장품의 접수자 추가 20170920 - 자리바꿈
    if (getInfo("fmpf").indexOf("_OVER_BIZ_TRIP_MF") > 0) {
        var $Apvlines = $(Apvlines);
        var $Row = $Apvlines.find("tr");

        $.each($Row, function (idx, item) {
            var $TempItem;
            if ($(item).find("td:eq(" + Role_No + ")").length > 0) {
                $TempItem = $(item).find("td:eq(" + Role_No + ")");
            } else {
                $TempItem = $(item).find("th:eq(" + Role_No + ")");
            }
            $(item).prepend($TempItem);
        });

        Apvlines = $Apvlines.clone().wrapAll("<table/>").parent().html();
    }
    return Apvlines;
}



//Section Type 결재타입 
function displayApvListCols(elmDivison) {
    var elmRoot;
    var Apvlines = "";
    var TaskInfo = "";

    if (elmDivison != null) {
        elmDivison.each(function (i, element) {
            TaskInfo = $(element).attr("divisiontype");
            if (i == 0) {//발신일때
                //TO-DO : HMI와 HMMR의 해외투자품의일 경우 적용
                //2019-09-20 BY YJYOO
                //if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN") {
                //    elmList = $(element).find("step[routetype='approve'] > ou > person,step[routetype='approve']  > ou > role");
                //    elmVisible = $(element).find("step[routetype='approve'] > ou > role:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person:has(taskinfo[visible='n']),step[routetype='approve'] > ou > person:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                //}
            	//else {
            	// HMB 투자품의 step name CTRL_CFO , CTRL_CFO_HMB 별도표시위해 삭제
                elmList = $(element).find("step[routetype='approve'][name!='MANAGE_DIVISION'][name!='MANAGE_PM'][name!='reference'][name!='CTRL_CFO'][name!='CTRL_CFO_HMB'] > ou > person[is_hidden!='Y'][documentstepcode!='EXAMINATION_RECEIVE'],step[routetype='approve'][name!='reference']  > ou > role[documentstepcode!='CONTROL_DEPT_RECEIVE']");
                elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou > role[documentstepcode!='MANAGEMENT_RECEIVE']:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                //}
            } else {//수신일때
                elmList = $(element).find("step[name!='reference']  > ou > role,step[name!='reference']  > ou > person[is_hidden!='Y'] "); //(person|role)
                elmVisible = $(element).find("step[name!='reference'] > ou > role:has(taskinfo[visible='n']),step[name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[visible='n']),step[name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                if (elmList.length == 0) {
                    elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > role, step[routetype='approve'][name!='reference']  > ou > person[is_hidden!='Y']"); //(person|role)
                    elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou > role:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                }
            }
            var sApvTitle;

        	// hpark 20180210 리스트타입 타이틀 수정
            //if (elmDivison.length > 1) {
            //	sApvTitle = $(element).attr("name"); 
            //}
            if (i == 0) sApvTitle = m_oFormMenu.gLabel_request_dept;
            else sApvTitle = m_oFormMenu.gLabel_Receiving_Dept;

            if (getInfo('scApvLineTypeauto') == 'D') {//일반품의서
                Apvlines += getApvListCols(elmList);
            } else if (getInfo('scApvLineTypeauto') == 'C') {//협조전류
                if (i == 0) {
                    Apvlines += getApvListCols(elmList, sApvTitle);
                }
                else {
                    var apvStepArray = new Array();//결재선 Json Array
                    var elmSortList;
                    //수신처 division을 제외한 모든 항목 삭제
                    var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
                    $(xmlApv).find("steps > division[divisiontype='send']").remove();
                    var xmlApvReceiveList = $(xmlApv).find("steps > division[divisiontype='receive']");
                    $(xmlApvReceiveList).find("step").remove();

                    //수신처 결재선 목록을 Sort 대상 Json 개체로 생성한다.
                    $(elmList).each(function (i, elm) {
                        if ($(elm).find("taskinfo").attr("visible") != 'n') {
                            var apvStepObject = new Object();//결재 단위 개체
                            apvStepObject.code = $(elm).attr("code");
                            apvStepObject.dutycode = $(elm).attr("dutycode");
                            apvStepObject.approvalorder = $(elm).parent().parent().attr("approvalorder");
                            apvStepArray.push(apvStepObject);
                        }
                    });

                    // dutycode sort 순서 => 빈값 > 큰값 > 작은값
                    apvStepArray.sort(function (a, b) {
                        if (a.dutycode == '') return -1;
                        if (b.dutycode == '') return 0;
                        if (a.dutycode < b.dutycode) return 1;
                        if (b.dutycode < a.dutycode) return -1;
                    });

                    $(apvStepArray).each(function (i, apvArr) {
                        var elm;
                        $(elmList).each(function (i, _elm) {
                            if ($(_elm).find("taskinfo").attr("visible") != 'n' && ($(_elm).attr("code") == apvArr.code && $(_elm).parent().parent().attr("approvalorder") == apvArr.approvalorder)) {
                                $(xmlApvReceiveList).append($(_elm).parent().parent());
                            }
                        });
                    });
                    elmSortList = $(xmlApv).find("division[divisiontype='receive'] > step[name!='reference']  > ou > role,division[divisiontype='receive'] > step[name!='reference']  > ou > person "); //(person|role)
                    Apvlines += getApvListCols(elmSortList, sApvTitle);
                }
            } else if (getInfo('scApvLineTypeauto') == 'R') {//신청서류
                $("#ApvLineType_R").show();
                $("#ApvLineType_C").hide();

                var ReceiveTitle = m_oFormMenu.gLabel_Receiving_Dept;

                if ($(element).find("step > ou > person[is_hidden!='Y'][documentstepcode='REGISTER_RECEIVE']").length > 0) {
                    if (i == 0) {
                        var RoleApprovalOrder = parseInt($($(element).find("step:has(ou > person[is_hidden!='Y'][documentstepcode='REGISTER_RECEIVE'])")).attr("approvalorder"));
                        elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > *");
                        elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou >*:has(taskinfo[visible='n'])");  //전달 person도 제외에 체크
                        //document.getElementById("LApvLine_R").innerHTML = getRequestApvList(elmList, elmVisible, "", false, m_oFormMenu.gLabel_request_dept, RoleApprovalOrder);
                        //document.getElementById("RApvLine_R").innerHTML = "<td>" + getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle, RoleApprovalOrder) + "</td>";
                        Apvlines += getApvListCols(elmList, sApvTitle, false, RoleApprovalOrder);
                        Apvlines += getApvListCols(elmList, ReceiveTitle, true, RoleApprovalOrder);
                    }
                }
                else if (elmDivison.length > 1) {
                    if (i == 0) {
                        Apvlines += getApvListCols(elmList, sApvTitle);
                    }
                    //조건에 미주 - 트랜스 리드 업무표준 추가 GOJP_WORKFORM_OVERSEAS
                    else if (!(getInfo("fmpf") == "GOJP_WORKFORM_W01" || getInfo("fmpf") == "GOJP_WORKFORM_OVERSEAS")) {
                        Apvlines += getApvListCols(elmList, sApvTitle);
                    }
                } else if ($(element).find("step > ou > role").length > 0) {
                    var RoleApprovalOrder = parseInt($($(element).find("step:has(ou > role)")).attr("approvalorder"));
                    elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > *");
                    elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou >*:has(taskinfo[visible='n'])");  //전달 person도 제외에 체크

                    //sApvTitle = $(element).attr("name"); // hpark 20180210 리스트타입 타이틀 수정
                    Apvlines += getApvListCols(elmList, sApvTitle, false, RoleApprovalOrder);

                	// hpark 20180210 리스트타입 타이틀 수정
                	//sApvTitle = $($(element).find("step:has(ou > role)")).attr("name") 
                    sApvTitle = m_oFormMenu.gLabel_Receiving_Dept;

                    Apvlines += getApvListCols(elmList, sApvTitle, true, RoleApprovalOrder);
                } else {
                    if (i == 0)
                        Apvlines += getApvListCols(elmList, sApvTitle);
                    else
                        Apvlines += getApvListCols(elmList, sApvTitle);
                }
            }

            // Apvlines += getApvListCols(elmList);

        });
        document.getElementById("AppLineListType").innerHTML = Apvlines;
    }
}


//Section Type 결재타입 
function getApvListCols(elmListSteps, sApvTitle, bReceive, RoleApprovalOrder) {
    var elmStep, elmList, elm, elmTaskInfo;
    var strDate, LastDate;
    //elmListSteps = 
    var ApvPOSLines = "";
    var Apvdecide = "";
    var ApvState = "";
    var ApvSignLines = "";
    var ApvSign = "";
    var ApvDept = "";
    var ApvApproveNameLines = "";
    var ApvDateLines = "";
    var sTitle = "";
    var cnt = 1;
    var ApvVisible;
    var sPosition;
    var ApvHeader = "";
    //for (var ii = 0; ii < elmListSteps.length; ii++) {

    var RoleListType = false;
    elmListSteps.each(function (i, elm) {
    	elmTaskInfo = $(elm).find("taskinfo");
    	var CurrentStep = $(elm).parent().parent(); // 20200610 hpark 예결함에서 선결
        var CurrentApprovalOrder = parseInt($(elm).parent().parent().attr("approvalorder"));
        var bDisplay = true;
        if (RoleApprovalOrder != null) {
            if (!bReceive) {
                if (CurrentApprovalOrder >= RoleApprovalOrder)
                    bDisplay = false;
            } else {
                if (CurrentApprovalOrder < RoleApprovalOrder)
                    bDisplay = false;
            }
        }


        if (elm.nodeName == "role" && getInfo('scApvLineTypeauto') == 'D') {
            return;
        }

        // 롤 결재자가 수신 부서인 경우 로직 추가 LISTTYPE KBW20181114
        if (elm.nodeName == "role") { RoleListType = true; }

        if (bReceive == false && RoleListType && getInfo("pdef") == "DEPT_INTER_PATTERN" && getInfo('scApvLineTypeauto') == 'R') {
            return false;
        }

        if (RoleListType && getInfo("pdef") == "DEPT_INTER_PATTERN" && getInfo('scApvLineTypeauto') == 'R') {
            if (bReceive) bDisplay = true;
        }


        if (bDisplay && elmTaskInfo.attr("kind") != 'conveyance') {

            //if ((bDisplayCharge && i == 0) || (elmTaskInfo.attr("visible") != "n")) //결재선 숨기기한 사람 숨기기
            if (elmTaskInfo.attr("visible") != "n") //결재선 숨기기한 사람 숨기기
            {
                var sTitle = "";
                try {
                    var splittitle = ($(elm).attr("dutyname") != null && $(elm).attr("dutyname") != undefined && $(elm).attr("dutyname") != "") ? $(elm).attr("dutyname") : "";
                    //sTitle = (splittitle != "") ? CFN_GetDicDatas(splittitle) : Common.GetDic("lbl_apv_charge")
                    if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                        sTitle = CFN_GetDicDatas(splittitle);
                    else if ($(elmTaskInfo).attr("kind") == "charge")
                        sTitle = Common.GetDic("lbl_apv_charge");
                    else if (elm.nodeName == "role")
                        sTitle = Common.GetDic("lbl_apv_charge");
                    else if (bReceive)
                        sTitle = Common.GetDic("lbl_apv_charge");
                    else
                        sTitle = Common.GetDic("lbl_apv_investigation");

                } catch (e) {
                    if (elm.nodeName == "role") {
                        sTitle = m_oFormMenu.gLabel_charge; //"담당"
                    }
                }

                if (getInfo("fmpf").toUpperCase() == "GWOK_DINVEST_W01") {
                    //var initiatedDate;
                    if (i == 0) {
                        initiatedDate = $(elmTaskInfo).attr("datereceived");
                    }
                    //var initiator = $(elmList).p.find("step[name='기안자'] > ou > person >taskinfo");
                    //var initiator = $(elmList).find("division[divisiontype='send'] > step > ou:has( person > taskinfo[kind='charge'])");
                    //var elmFirstStep = $(elmList).find("step[approvalorder='100']");
                    if (initiatedDate <= "2020-08-06") {
                        if (i == 3) {
                            sTitle = Common.GetDic("lbl_apv_assistant");
                        } else if (i == 4) {
                            sTitle = Common.GetDic("lbl_apv_chief");
                        }
                    }
                    else {
                        if (i == 4) {
                            sTitle = Common.GetDic("lbl_apv_assistant");
                        } else if (i == 5) {
                            sTitle = Common.GetDic("lbl_apv_chief");
                        }
                    }
                }

                strDate = ($(elmTaskInfo).attr("datecompleted") != "" && $(elmTaskInfo).attr("datecompleted") != undefined) ? $(elmTaskInfo).attr("datecompleted") : "";

                if (elm.nodeName == "role") {
                    try {
                        var roleperson = $(elm).find("person");
                        if (roleperson.length > 0)
                            elm = roleperson[0];

                    } catch (e) { }
                }

                var bRejected = false;


                var split_elmTitle = ($(elm).attr("dutyname") != null && $(elm).attr("positionname") != undefined && $(elm).attr("positionname") != "") ? $(elm).attr("positionname") : "";
                elmTitle = (split_elmTitle != "") ? CFN_GetDicDatas(split_elmTitle) : Common.GetDic("lbl_apv_charge");

                switch ($(elmTaskInfo).attr("kind")) {
                    case "authorize":
                        ApvSignLines = (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                        ApvApproveNameLines = (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "substitute":
                        ApvSignLines = (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                        ApvApproveNameLines = (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "skip":
                        ApvSignLines = "/";
                        ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = "";
                        break;
                    case "bypass":
                        ApvSignLines = (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                        ApvApproveNameLines = (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break; //"후열"
                    case "review":
                        ApvSignLines = (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                        ApvApproveNameLines = (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "charge":
                        ApvSignLines = (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;

                        if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "")
                            ApvApproveNameLines = "<span>(" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
                        else
                            ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"

                        //ApvApproveNameLines = (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "consent":
                        ApvSignLines = (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                        ApvApproveNameLines = (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    default:
                        //if (elm.nodeName == "role") {
                        //    var roleperson = $(elm).find("person");
                        //    if (roleperson.length > 0)
                        //        elm = roleperson[0];
                        //} else {
                        //    ApvApproveNameLines += (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        //}
                        ApvSignLines = (strDate == "") ? "" : (getLngLabel(XFN_GetDicInfo(elmTitle), true) == ";;;;;;;;") ? "" : getLngLabel(XFN_GetDicInfo(elmTitle), true);;
                        //ApvApproveNameLines = (strDate == "") ? "<span>&nbsp;</span>" : "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        if ($(elmTaskInfo).attr("status") == "inactive" || $(elmTaskInfo).attr("status") == "pending") {
                            ApvApproveNameLines = "<span>&nbsp;</span>";

                        } else {
                        	if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "") {
                        		if ($(CurrentStep).attr("isprecdng") != null && $(CurrentStep).attr("isprecdng") == "Y")
                        			ApvApproveNameLines = "<span>(" + Common.GetDic("lbl_apv_Deputy") + ")" + "(" + Common.GetDic("btn_apv_preApproval") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"; // 20200610 hpark 예결함에서 선결
                        		else
                        			ApvApproveNameLines = "<span>(" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        	}
                        	else {
                        		if ($(CurrentStep).attr("isprecdng") != null && $(CurrentStep).attr("isprecdng") == "Y")
                        			ApvApproveNameLines = "<span>" + "(" + Common.GetDic("btn_apv_preApproval") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"; // 20200610 hpark 예결함에서 선결
                        		else
                        			ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        	}
                        }
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");

                }

                ApvPOSLines += "<tr>";
                ApvPOSLines += "<td>" + sTitle + "</td>";
                ApvPOSLines += "<td>" + ApvSignLines + "</td>";
                ApvPOSLines += "<td>" + ApvApproveNameLines + "</td>";
                ApvPOSLines += "<td>" + ApvDateLines + "</td>";

                ApvPOSLines += "</tr>";

                cnt++;
            }
        }
    });

    var Apvlines = "";
    if (sApvTitle != null && sApvTitle != "") {
        Apvlines += "<table><tr>";
    	//Apvlines += "<td align = 'left' width='50'><br /> " + sApvTitle + " </a>"; 
        Apvlines += "<td align = 'left' width='200'><br /> " + sApvTitle + " </a>"; // hpark 20180210 리스트타입 타이틀 수정
        Apvlines += "</td></tr></table>";
    }

    Apvlines += "<!-- 본문 시작 -->";
    Apvlines += "<table class='table_10' style='border:0px;'>";
    Apvlines += "<colgroup>";
    Apvlines += "<col style='width: 20%;'>";
    Apvlines += "<col style='width: 20%;'>";
    Apvlines += "<col style='width: 40%;'>";
    Apvlines += "<col style='width: 20%;'>";
    Apvlines += "</colgroup>";
    Apvlines += "<thead>";
    Apvlines += "<tr>";
    Apvlines += String.format("<th>{0}</th>", Common.GetDic("lbl_apv_jobtitle"));
    Apvlines += String.format("<th>{0}</th>", Common.GetDic("lbl_JobPosition"));
	// 리스트타입 다국어 변경(미주)
	//Apvlines += String.format("<th>{0}</th>", Common.GetDic("lbl_apv_charge"));
    //Apvlines += String.format("<th>{0}</th>", Common.GetDic("lbl_Complete_Date"));
    Apvlines += String.format("<th>{0}</th>", Common.GetDic("lbl_apv_username"));
    Apvlines += String.format("<th>{0}</th>", Common.GetDic("lbl_apv_date"));
    Apvlines += "</tr>";
    Apvlines += "</thead>";
    Apvlines += "<tbody>";
    Apvlines += "<!--결재선-->";
    Apvlines += ApvPOSLines;
    Apvlines += "<!--결재선-->";
    Apvlines += "</tbody>";
    Apvlines += "</table>";

    return Apvlines;
}



//Line Type 결재타입 
function displayApvListLine(elmDivison) {
    var elmRoot;
    var Apvlines = "";
    var TaskInfo = "";
    if (elmDivison != null) {

        elmDivison.each(function (i, element) {
            TaskInfo = $(element).attr("divisiontype");
            if (i == 0) {//발신일때
                ////TO-DO : HMI와 HMMR의 해외투자품의일 경우 적용
                ////2019-09-20 BY YJYOO
                //if (Common.GetBaseConfig("INVEST_PROCESS_TYPE") == "A" && getInfo("pdef") == "INVEST_PATTERN") {
                //    elmList = $(element).find("step[routetype='approve'] > ou > person,step[routetype='approve']  > ou > role ");
                //    elmVisible = $(element).find("step[routetype='approve'] > ou > role:has(taskinfo[visible='n']),step[routetype='approve'] > ou > person:has(taskinfo[visible='n']),step[routetype='approve'] > ou > person:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                //}
            	//else {
            	// HMB 투자품의 step name CTRL_CFO , CTRL_CFO_HMB 별도표시위해 삭제
                elmList = $(element).find("step[routetype='approve'][name!='MANAGE_DIVISION'][name!='MANAGE_PM'][name!='reference'][name!='CTRL_CFO'][name!='CTRL_CFO_HMB'] > ou > person[is_hidden!='Y'][documentstepcode!='EXAMINATION_RECEIVE'],step[routetype='approve'][name!='reference']  > ou > role[documentstepcode!='CONTROL_DEPT_RECEIVE']");
                elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou > role[documentstepcode!='MANAGEMENT_RECEIVE']:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                //}
                
                // 기아/현대 해외출장품의 총무팀 Role 보여줌 20170920
                if (getInfo("fmpf").indexOf("_OVER_BIZ_TRIP_MF") > 0) {
                    //elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > person,step[routetype='approve'][name!='reference']  > ou > role[documentstepcode!='MANAGEMENT_RECEIVE'],step[routetype='approve'][name!='reference']  > ou > role[documentstepcode='MANAGEMENT_RECEIVE']:has(taskinfo[visible='y']) ");
                    elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > person[is_hidden!='Y'],step[routetype='approve'][name!='reference']  > ou > role[documentstepcode='MANAGEMENT_RECEIVE'] ");
                }
            } else {//수신일때
                elmList = $(element).find("step[name!='reference']  > ou > role,step[name!='reference']  > ou > person[is_hidden!='Y'] "); //(person|role)
                elmVisible = $(element).find("step[name!='reference'] > ou > role:has(taskinfo[visible='n']),step[name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[visible='n']),step[name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                if (elmList.length == 0) {
                    elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > role, step[routetype='approve'][name!='reference']  > ou > person[is_hidden!='Y']"); //(person|role)
                    elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou > role:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[visible='n']),step[routetype='approve'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[kind='conveyance'])");  //전달 person도 제외에 체크
                }
            }
            var sApvTitle
            if (elmDivison.length > 1) {
                sApvTitle = $(element).attr("name");
            }

            if (getInfo('scApvLineTypeauto') == 'D') {//일반품의서
                if (i == 0) Apvlines = getApvListLine(elmList);
            } else if (getInfo('scApvLineTypeauto') == 'C') {//협조전류
                if (i == 0) {
                    Apvlines += getApvListLine(elmList, sApvTitle);
                }
                else {
                    //var apvStepArray = new Array();//결재선 Json Array
                    //var elmSortList;
                    ////수신처 division을 제외한 모든 항목 삭제
                    //var xmlApv = $.parseXML(document.getElementById("APVLIST").value);
                    //$(xmlApv).find("steps > division[divisiontype='send']").remove();
                    //var xmlApvReceiveList = $(xmlApv).find("steps > division[divisiontype='receive']");
                    //$(xmlApvReceiveList).find("step").remove();

                    ////수신처 결재선 목록을 Sort 대상 Json 개체로 생성한다.
                    //$(elmList).each(function (i, elm) {
                    //    if ($(elm).find("taskinfo").attr("visible") != 'n') {
                    //        var apvStepObject = new Object();//결재 단위 개체
                    //        apvStepObject.code = $(elm).attr("code");
                    //        apvStepObject.dutycode = $(elm).attr("dutycode");
                    //        apvStepObject.approvalorder = $(elm).parent().parent().attr("approvalorder");
                    //        apvStepArray.push(apvStepObject);
                    //    }
                    //});

                    //// dutycode sort 순서 => 빈값 > 큰값 > 작은값
                    //apvStepArray.sort(function (a, b) {
                    //    if (a.dutycode == '') return -1;
                    //    if (b.dutycode == '') return 0;
                    //    if (a.dutycode < b.dutycode) return 1;
                    //    if (b.dutycode < a.dutycode) return -1;
                    //});

                    //$(apvStepArray).each(function (i, apvArr) {
                    //    var elm;
                    //    $(elmList).each(function (i, _elm) {
                    //        if ($(_elm).find("taskinfo").attr("visible") != 'n' && ($(_elm).attr("code") == apvArr.code && $(_elm).parent().parent().attr("approvalorder") == apvArr.approvalorder)) {
                    //            $(xmlApvReceiveList).append($(_elm).parent().parent());
                    //        }
                    //    });
                    //});
                    //elmSortList = $(xmlApv).find("division[divisiontype='receive'] > step[name!='reference']  > ou > role,division[divisiontype='receive'] > step[name!='reference']  > ou > person "); //(person|role)
                    //Apvlines += getApvListLine(elmSortList, sApvTitle);
                    Apvlines += getApvListLine(elmList, sApvTitle);
                }
            } else if (getInfo('scApvLineTypeauto') == 'R') {//신청서류
                $("#ApvLineType_R").show();
                $("#ApvLineType_C").hide();

                var ReceiveTitle = m_oFormMenu.gLabel_Receiving_Dept;

                if ($(element).find("step > ou > person[is_hidden!='Y'][documentstepcode='REGISTER_RECEIVE']").length > 0) {
                    if (i == 0) {
                        var RoleApprovalOrder = parseInt($($(element).find("step:has(ou > person[is_hidden!='Y'][documentstepcode='REGISTER_RECEIVE'])")).attr("approvalorder"));
                        elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > *");
                        elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou >*:has(taskinfo[visible='n'])");  //전달 person도 제외에 체크
                        //document.getElementById("LApvLine_R").innerHTML = getRequestApvList(elmList, elmVisible, "", false, m_oFormMenu.gLabel_request_dept, RoleApprovalOrder);
                        //document.getElementById("RApvLine_R").innerHTML = "<td>" + getRequestApvList(elmList, elmVisible, "", true, ReceiveTitle, RoleApprovalOrder) + "</td>";
                        Apvlines += getApvListLine(elmList, sApvTitle, false, RoleApprovalOrder);
                        Apvlines += getApvListLine(elmList, ReceiveTitle, true, RoleApprovalOrder);
                    }
                }
                else if (elmDivison.length > 1) {
                    if (i == 0) {
                        Apvlines += getApvListLine(elmList, sApvTitle, false);
                    }
                    //조건에 미주 - 트랜스 리드 업무표준 추가 GOJP_WORKFORM_OVERSEAS
                    else if (!(getInfo("fmpf") == "GOJP_WORKFORM_W01" || getInfo("fmpf") == "GOJP_WORKFORM_OVERSEAS")) {
                        Apvlines += getApvListLine(elmList, sApvTitle, true);
                    }
                } else if ($(element).find("step > ou > role").length > 0) {
                    var RoleApprovalOrder = parseInt($($(element).find("step:has(ou > role)")).attr("approvalorder"));
                    elmList = $(element).find("step[routetype='approve'][name!='reference']  > ou > *");
                    elmVisible = $(element).find("step[routetype='approve'][name!='reference'] > ou >*:has(taskinfo[visible='n'])");  //전달 person도 제외에 체크

                    sApvTitle = $(element).attr("name");
                    Apvlines += getApvListLine(elmList, sApvTitle, false, RoleApprovalOrder);
                    sApvTitle = $($(element).find("step:has(ou > role)")).attr("name")
                    Apvlines += getApvListLine(elmList, sApvTitle, true, RoleApprovalOrder);
                } else {
                    if (i == 0)
                        Apvlines += getApvListLine(elmList, sApvTitle);
                    else
                        Apvlines += getApvListLine(elmList, sApvTitle);
                }
            }
        });
        var ApvlineHtml = "";

        ApvlineHtml += "<div class='s-form-route'>";
        ApvlineHtml += "<div class='s-form-route__list'>";
        ApvlineHtml += Apvlines;
        ApvlineHtml += "</div>";
        ApvlineHtml += "</div>";

        document.getElementById("AppLineListType").innerHTML = ApvlineHtml;
    }
}



//Section Type 결재타입 
function getApvListLine(elmListSteps, sApvTitle, bReceive, RoleApprovalOrder) {
    var elmStep, elmList, elm, elmTaskInfo;
    var strDate, LastDate;
    //elmListSteps = 
    var ApvPOSLines = "";
    var Apvdecide = ""; 				//2005-12-05 신택상 대결,후열 등을 표시
    var ApvState = "";
    var ApvSignLines = "";
    var ApvSign = "";
    var ApvDept = "";
    var ApvApproveNameLines = "";
    var ApvDateLines = "";
    var sTitle = "";
    var cnt = 1;
    var ApvVisible;
    var sPosition;
    var ApvHeader = "";
    //for (var ii = 0; ii < elmListSteps.length; ii++) {
    elmListSteps.each(function (i, elm) {
        elmTaskInfo = $(elm).find("taskinfo");
        var CurrentStep = $(elm).parent().parent();
        var CurrentApprovalOrder = parseInt(CurrentStep.attr("approvalorder"));
        var CurrentApprovaerAt = CurrentStep.attr("approverat");//현결재자:Y,겸직자:X, 현결재자아님:N
        var elmDivision = $(elm).parent().parent().parent();
        var bDisplay = true;
        if (RoleApprovalOrder != null) {
            if (!bReceive) {
                if (CurrentApprovalOrder >= RoleApprovalOrder)
                    bDisplay = false;
            } else {
                if (CurrentApprovalOrder < RoleApprovalOrder)
                    bDisplay = false;
            }
        }

        if (elm.nodeName == "role" && getInfo('scApvLineTypeauto') == 'D') {
            return;
        }
        if (bDisplay && elmTaskInfo.attr("kind") != 'conveyance') {

            if (elmTaskInfo.attr("visible") != "n") //결재선 숨기기한 사람 숨기기
            {
                var sTitle = "";
                try {
                    var splittitle = ($(elm).attr("dutyname") != null && $(elm).attr("dutyname") != undefined && $(elm).attr("dutyname") != "") ? $(elm).attr("dutyname") : "";
                    //sTitle = (splittitle != "") ? CFN_GetDicDatas(splittitle) : Common.GetDic("lbl_apv_charge")
                    // 기아/현대 해외출장품의 접수자 추가 20170920
                    if (getInfo("fmpf").indexOf("_OVER_BIZ_TRIP_MF") > 0) {
                        if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                            sTitle = CFN_GetDicDatas(splittitle);
                        else if ($(elmTaskInfo).attr("kind") == "charge")
                            sTitle = Common.GetDic("lbl_apv_charge");
                        else if ($(elm).attr("documentstepcode") == "MANAGEMENT_RECEIVE") {
                            sTitle = Common.GetDic("lbl_Receptionist");
                            Role_No = i;
                        }
                        else
                            sTitle = Common.GetDic("lbl_apv_investigation");
                    } else {
                        if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                            sTitle = CFN_GetDicDatas(splittitle);
                        else if ($(elmTaskInfo).attr("kind") == "charge")
                            sTitle = Common.GetDic("lbl_apv_charge");
                        else if (elm.nodeName == "role")
                            sTitle = Common.GetDic("lbl_apv_charge");
                        else if (bReceive)
                            sTitle = Common.GetDic("lbl_apv_charge");
                        else
                            sTitle = Common.GetDic("lbl_apv_investigation");
                    }
                } catch (e) {
                    if (elm.nodeName == "role") {
                        sTitle = m_oFormMenu.gLabel_charge; //"담당"
                    }
                }

                if (getInfo("fmpf").toUpperCase() == "GWOK_DINVEST_W01") {
                    //var initiatedDate;
                    if (i == 0) {
                        initiatedDate = $(elmTaskInfo).attr("datereceived");
                    }
                    //var initiator = $(elmList).p.find("step[name='기안자'] > ou > person >taskinfo");
                    //var initiator = $(elmList).find("division[divisiontype='send'] > step > ou:has( person > taskinfo[kind='charge'])");
                    //var elmFirstStep = $(elmList).find("step[approvalorder='100']");
                    if (initiatedDate <= "2020-08-06") {
                        if (i == 3) {
                            sTitle = Common.GetDic("lbl_apv_assistant");
                        } else if (i == 4) {
                            sTitle = Common.GetDic("lbl_apv_chief");
                        }
                    }
                    else {
                        if (i == 4) {
                            sTitle = Common.GetDic("lbl_apv_assistant");
                        } else if (i == 5) {
                            sTitle = Common.GetDic("lbl_apv_chief");
                        }
                    }
                }

                if (sTitle.length > 0) {
                    var sDivision = "";


                    if (elm.nodeName == "role")
                        sDvision = Common.GetDic("lbl_apv_receive");//"수신";
                    else if ($(elmDivision).attr("divisiontype") == "send")
                        sDvision = Common.GetDic("lbl_apv_send");//"발신";
                    else
                        sDvision = Common.GetDic("lbl_apv_receive");//"수신";

                    if (RoleApprovalOrder != null) {
                        if (bReceive) {
                            if (CurrentApprovalOrder < RoleApprovalOrder)
                                sDvision = Common.GetDic("lbl_apv_send");//"발신";
                            else
                                sDvision = Common.GetDic("lbl_apv_receive");//"수신";
                        }
                    }
                    sTitle = String.format("{0}<br/>{1}", sDvision, sTitle);
                }
                strDate = ($(elmTaskInfo).attr("datecompleted") != "" && $(elmTaskInfo).attr("datecompleted") != undefined) ? $(elmTaskInfo).attr("datecompleted") : "";

                if (elm.nodeName == "role") {
                    try {
                        var roleperson = $(elm).find("person");
                        if (roleperson.length > 0)
                            elm = roleperson[0];

                    } catch (e) { }
                }

                var bRejected = false;

                var split_elmTitle = ($(elm).attr("positionname") != null && $(elm).attr("positionname") != "") ? $(elm).attr("positionname") : "";
                elmTitle = (split_elmTitle != "") ? CFN_GetDicDatas(split_elmTitle) : Common.GetDic("lbl_apv_charge");

                switch ($(elmTaskInfo).attr("kind")) {
                    case "authorize":
                        ApvSignLines = elmTitle;
                        ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "substitute":
                        ApvSignLines = elmTitle;
                        ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "skip":
                        ApvSignLines = "/";
                        ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = "";
                        break;
                    case "bypass":
                        ApvSignLines = elmTitle;
                        ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break; //"후열"
                    case "review":
                        ApvSignLines = elmTitle;
                        ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "charge":
                        ApvSignLines = elmTitle;
                        //ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "")
                            ApvApproveNameLines = "<span>(" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
                        else
                            ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    case "consent":
                        ApvSignLines = elmTitle;
                        ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                        break;
                    default:
                        
                        ApvSignLines = elmTitle;
                        //ApvApproveNameLines =  "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>";
                        if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "")
                            ApvApproveNameLines = "<span>(" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
                        else
                            ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"

                        ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");
                }
                var sStatus = $(elmTaskInfo).attr("status");
                var sDivStatusClss = "";
                var sDivIngHtml = "";
                switch (sStatus) {
                    case "inactive":
                        sDivStatusClss = "s-form-route__item";
                        break;
                    case "pending":
                        sDivStatusClss = "s-form-route__item s-form-route__item--current";
                        if (i > 0 || $(elmDivision).attr("divisiontype") != "send") {
                            sDivIngHtml += "<div class='s-form-route__ing'>";
                            sDivIngHtml += "<div class='s-form-route__ing-item'></div>";
                            sDivIngHtml += "<div class='s-form-route__ing-item'></div>";
                            sDivIngHtml += "<div class='s-form-route__ing-item'></div>";
                            sDivIngHtml += "<div class='s-form-route__ing-item'></div>";
                            sDivIngHtml += "<div class='s-form-route__ing-item'></div>";
                            sDivIngHtml += "</div>";
                        }
                        break;
                    case "completed":
                    case "reject":
                        var sNextStatus = "";
                        var temp = elm;
                        var bWhile = true;
                        var nWhile = 0;
                        while (bWhile) {//다음 결재자 상태 찾아 오기. 다음 node에 따라 현 node 의 class가 다름.
                            temp = $(temp).parent()[0];
                            if ($(temp).next().length > 0) {
                                if (temp.nodeName == "step") {
                                    if ($(temp).next().find("ou > * > taskinfo[visible!='n']").length > 0) {
                                        if ($(temp).next().find("ou > role > taskinfo[visible!='n']").length > 0) {
                                            if ($(temp).next().find("ou > role").length > 0 && getInfo('scApvLineTypeauto') == 'D') {
                                                temp = $(temp).next()[0];
                                                if ($(temp).next().find("ou > person >taskinfo[visible!='n']").length > 0) {
                                                    sNextStatus = $(temp).next().find("ou > person >taskinfo[visible!='n']").attr("status");
                                                }
                                            } else {
                                                sNextStatus = $(temp).next().find("ou > role > person >taskinfo[visible!='n']").attr("status");
                                            }
                                        } else {
                                            if ($(temp).next().attr("name") == "MANAGE_PM" || $(temp).next().attr("name") == "MANAGE_DIVISION") {
                                                temp = $(temp).next()[0];
                                                if ($(temp).next().next().length > 0) {
                                                    sNextStatus = $(temp).next().next().find("ou > * > taskinfo[visible!='n']").attr("status");
                                                } else {
                                                    sNextStatus = $(temp).next().find("ou > * > taskinfo[visible!='n']").attr("status");
                                                }
                                            } else {
                                                sNextStatus = $(temp).next().find("ou > * > taskinfo[visible!='n']").attr("status");
                                            }
                                        }
                                    } else if ($(temp).next().find("ou > role > person > taskinfo[visible!='n']").length > 0) {
                                        if ($(temp).next().find("ou > role").length > 0 && getInfo('scApvLineTypeauto') == 'D') {
                                            temp = $(temp).next()[0];
                                            if ($(temp).next().find("ou > person >taskinfo[visible!='n']").length > 0) {
                                                sNextStatus = $(temp).next().find("ou > person >taskinfo[visible!='n']").attr("status");
                                            }
                                        } else {
                                            if ($(temp).next().attr("name") == "MANAGE_PM" || $(temp).next().attr("name") == "MANAGE_DIVISION") {
                                                temp = $(temp).next()[0];
                                                if ($(temp).next().next().length > 0) {
                                                    sNextStatus = $(temp).next().next().find("ou > * > taskinfo[visible!='n']").attr("status");
                                                } else {
                                                    sNextStatus = $(temp).next().find("ou > * > taskinfo[visible!='n']").attr("status");
                                                }
                                            } else {
                                                sNextStatus = $(temp).next().find("ou > * > taskinfo[visible!='n']").attr("status");
                                            }
                                        }
                                    }
                                } else if (temp.nodeName == "division") {
                                    if ($(temp).next().find("step > ou > person > taskinfo[visible!='n']").length > 0) {
                                        sNextStatus = $(temp).next().find("step > ou > person > taskinfo[visible!='n']").attr("status");
                                    } else if ($(temp).next().find("step > ou > role > person > taskinfo[visible!='n']").length > 0) {
                                        sNextStatus = $(temp).next().find("step > ou > role > person >taskinfo[visible!='n']").attr("status");
                                    } else {
                                        bWhile = false;
                                    }
                                }
                            }
                            if (sNextStatus != "") bWhile = false;
                            if (nWhile > 20) bWhile = false; //혹시모를 결재선 문제로 무한루프방지.
                            nWhile++
                        }

                        if (sNextStatus == "pending")
                            sDivStatusClss = "s-form-route__item s-form-route__item--prev s-form-route__item--prev-last";
                        else
                            sDivStatusClss = "s-form-route__item s-form-route__item--prev";
                        break;
                }
                ApvPOSLines += "<div class='" + sDivStatusClss + "'>";
                ApvPOSLines += "<div class='s-form-route__radius'>";
                ApvPOSLines += sDivIngHtml;
                ApvPOSLines += "<div class='s-form-route__title'>" + sTitle + "</div>";
                ApvPOSLines += "</div>";
                ApvPOSLines += "<div class='s-form-route__text' style='text-align: center;'>";
                ApvPOSLines += "<div class='s-form-route__name'>";
                //ApvPOSLines += "<div class='s-form-route__status s-form-route__status--off'></div>";
                ApvPOSLines += "<div class='s-form-route__name-text'>" + ApvApproveNameLines + "</div>";
                ApvPOSLines += "</div>";
                ApvPOSLines += "<div class='s-form-route__class'>" + ApvSignLines + "</div>";
                ApvPOSLines += "<div class='s-form-route__date'>" + ApvDateLines + "</div>";
                ApvPOSLines += "</div>";
                ApvPOSLines += "</div>";
                cnt++;
            }
        }
    });

    return ApvPOSLines;
}


function interpretKind(strkind, strresult, routetype, allottype, name) {
    var sKind;
    switch (strkind) {
        case "normal": sKind = "Review"; break; //sKind = m_oFormMenu.gLabel_tit_approval2; break; //"결재"
        case "charge": sKind = "Draft"; break; // sKind = m_oFormMenu.gLabel_charge; break;  		//"담당"
        case "authorize": sKind = m_oFormMenu.gLabel_authorize; break; 	//"전결"
        case "review": sKind = m_oFormMenu.gLabel_review; break; 		//"후결"
        case "consent": sKind = m_oFormMenu.gLabel_consent; break; 		//""
        case "substitute": sKind = m_oFormMenu.gLabel_substitue; break; 	//"대결"
        case "bypass": sKind = m_oFormMenu.gLabel_bypass; break; 		//"후열"
        case "confirm": sKind = m_oFormMenu.gLabel_confirm; break; //"확인"
        case "reference": sKind = m_oFormMenu.gLabel_reference; break; //"확인"
        case "skip": sKind = "--"; break;
        case "consult": sKind = "consult"; break;
    }
    //normal일 경우 세부설정
    if (strkind == "normal") {
        if (routetype == "assist") {
            sKind = m_oFormMenu.gLabel_assist;
            sKind = "consult";
            //            }
        } else if (routetype == "audit") {
            //결재선에서 넘어온 이름을 그대로 사용
            if (name == "audit") {
                sKind = m_oFormMenu.gLabel_audit; //감사;
            } else {
                sKind = m_oFormMenu.gLabel_person_audit1; //준법감시;
            }

        } else if (name == "ExtType") {
            sKind = m_oFormMenu.gLabel_ExtType;
        }
    } else {
        if ((strresult == "rejected") && (strkind != "normal")) {
            sKind = sKind + ((getInfo("fmbt") == "HWP") ? " " + m_oFormMenu.gLabel_reject : "<br>" + m_oFormMenu.gLabel_reject);
        } else if ((strresult == "rejected") && (strkind == "normal")) {
            sKind = m_oFormMenu.gLabel_reject; //"반려"
        }
    }
    return sKind;
}

//참조자 2008.09
function displayCCInfo(elmRoot) {
    var ccInfos = $(elmRoot).find("ccinfo");
    var sSendccInfos = "";
    var sRecccInfos = "";
    var cntSencCC = 0;
    var cntRecCC = 0;

	// 20200427 hpark 참조자 추가
    var sSendccInfosPerson = "";
    var sRecccInfosPerson = "";
    var cntSencCCPerson = 0;
    var cntRecCCPerson = 0;

    //debugger;
    if (ccInfos.length > 0) {
        $(ccInfos).each(function (index, ccInfo) {
        	var sList = "";
        	var sListPerson = ""; // 20200427 hpark 참조자 추가
            var sBelongTo = $(ccInfo).attr("belongto");
            var ccList = $(ccInfo.childNodes);
            var ccListIndex = 0;
            var cc = ccList[ccListIndex]; ccListIndex++;

            while (cc != null) {
                if (cc.hasChildNodes()) cc = cc.firstChild;
                if (cc.nodeName == "person") {
                	// sList += (sList.length > 0 ? "," : "") + CFN_GetDicDatas($(cc).attr("ouname")) + " " + CFN_GetDicDatas($(cc).attr("name")) + " " + getLngLabel($(cc).attr("position"), true);
                	// 20200427 hpark 참조자 추가
                	if ($(cc).attr("is_hidden") != "Y") {
                		sListPerson += (sListPerson.length > 0 ? "," : "") + CFN_GetDicDatas($(cc).attr("name"));
                		if (sBelongTo == "sender") cntSencCCPerson++;
                		else if (sBelongTo == "receiver") cntRecCCPerson++;
                	}

                } else if (cc.nodeName == "ou") {
                    sList += (sList.length > 0 ? "," : "") + CFN_GetDicDatas($(cc).attr("name"));
                } else if (cc.nodeName == "group") {
                    sList += (sList.length > 0 ? "," : "") + CFN_GetDicDatas($(cc).attr("name"));
                }

                cc = ccList[ccListIndex]; ccListIndex++;
            }
            switch (sBelongTo) {
                case "sender":
                	// 20200427 hpark 참조자 추가
                	//sSendccInfos += (sSendccInfos.length > 0 && sList.length > 0 ? ", " : "") + sList;
                	//cntSencCC++;
                	//$("#CCLine").show();
                	if (sList.length > 0) {
                		sSendccInfos += (sSendccInfos.length > 0 && sList.length > 0 ? ", " : "") + sList;
                		cntSencCC++;
                	} else if (sListPerson.length > 0) {
                		sSendccInfosPerson += (sSendccInfosPerson.length > 0 && sListPerson.length > 0 ? ", " : "") + sListPerson;
                	}
                    break;
                case "receiver":
                	//$("#CCLine").show();

                	// 20200427 hpark 참조자 추가
                	//$("#RecCC").parent().parent().css({ "display": "" });
                	//sRecccInfos += (sRecccInfos.length > 0 && sList.length > 0 ? ", " : "") + sList;
                	//document.getElementById("RecCC").innerHTML = sRecccInfos;
                	//cntRecCC++;
                	if (sList.length > 0) {
                		$("#RecCC").parent().parent().css({ "display": "" });
                		sRecccInfos += (sRecccInfos.length > 0 && sList.length > 0 ? ", " : "") + sList;
                		document.getElementById("RecCC").innerHTML = sRecccInfos;
                		cntRecCC++;
                	} else if (sListPerson.length > 0) {
                		$("#RecCCPerson").parent().parent().css({ "display": "" });
                		sRecccInfosPerson += (sRecccInfosPerson.length > 0 && sListPerson.length > 0 ? ", " : "") + sListPerson;
                		document.getElementById("RecCCPerson").innerHTML = sRecccInfosPerson;
                	}

                    break;
            }
        });
        $("#divSendCC").html(sSendccInfos);
        
        if (sSendccInfos.length + sRecccInfos.length > 0) {
            //스마트보고는 항상 히든--> 팝업 창에서 따로 보여줌. 2017.10.12, 양유빈
            if (getInfo("fmpf") != "GWOK_REPORT_W03") {
                try { document.getElementById("CCLine").style.display = ""; } catch (e) { }
            }
            $("#CCSendCount").text("(" + cntSencCC.toString() + ")");
            $("#CCRecCount").text("(" + cntRecCC.toString() + ")");
        } else {
        	try { document.getElementById("CCLine").style.display = "none"; } catch (e) { }
        	$("#CCSendCount").text("");
        	$("#CCRecCount").text("");
        }

    	// 20200427 hpark 참조자 추가
        $("#divSendCCPerson").html(sSendccInfosPerson); // divSendCC , sSendccInfos
        if (sSendccInfosPerson.length + sRecccInfosPerson.length > 0) { // sSendccInfos , sRecccInfos
        	//스마트보고는 항상 히든--> 팝업 창에서 따로 보여줌. 2017.10.12, 양유빈
        	if (getInfo("fmpf") != "GWOK_REPORT_W03") {
        		try { document.getElementById("CCPersonLine").style.display = ""; } catch (e) { } // CCLine
        	}
        	$("#CCPersonSendCount").text("(" + cntSencCCPerson.toString() + ")"); // CCSendCount
        	$("#CCPersonRecCount").text("(" + cntRecCCPerson.toString() + ")"); // CCRecCount
        } else {
        	try { document.getElementById("CCPersonLine").style.display = "none"; } catch (e) { } // CCLine
        	$("#CCPersonSendCount").text(""); // CCSendCount
        	$("#CCPersonRecCount").text(""); // CCRecCount
        }

    	try {
    		if (sSendccInfos.length > 0) {
    			$('#divSendCC').css('height', "");
                if ($("#divSendCC").height() > 48) {
                    //if ($("#PlusMinusSendCC").val() != "-") {
                        $("#PlusMinusSendCC").val("+");
                        $('#PlusMinusSendCC').css('display', "");
                        $("#divSendCC").css("height", "48px");
                        $("#divSendCC").css("overflow-y", "hidden");
                    //}
                } else {
                    //if ($("#PlusMinusSendCC").val() != "+") {
                        $("#PlusMinusSendCC").val("");
                        $('#PlusMinusSendCC').css('display', "none");
                    //}
                }
    		}

    		// 20200427 hpark 참조자 추가
    		if (sSendccInfosPerson.length > 0) { // sSendccInfos
    			$('#divSendCCPerson').css('height', ""); // divSendCC
    			if ($("#divSendCCPerson").height() > 48) { // divSendCC
    				$("#PlusMinusSendCCPerson").val("+"); // PlusMinusSendCC
    				$('#PlusMinusSendCCPerson').css('display', ""); // PlusMinusSendCC
    				$("#divSendCCPerson").css("height", "48px"); // divSendCC
    				$("#divSendCCPerson").css("overflow-y", "hidden"); // divSendCC
    				//}
    			} else {
    				$("#PlusMinusSendCCPerson").val(""); // PlusMinusSendCC
    				$('#PlusMinusSendCCPerson').css('display', "none"); // PlusMinusSendCC
    			}
    		}

        } catch (e) { }
    } else {
    	try {
    		document.getElementById("CCLine").style.display = "none";
    		$("#divSendCC").html("");
    		$("#RecCC").html("");
    		$("#CCSendCount").text("");
    		$("#CCRecCount").text("");

    		// 20200427 hpark 참조자 추가
    		document.getElementById("CCPersonLine").style.display = "none"; // CCLine
    		$("#divSendCCPerson").html(""); // divSendCC
    		$("#RecCCPerson").html(""); // RecCC
    		$("#CCPersonSendCount").text(""); // CCSendCount
    		$("#CCPersonRecCount").text(""); // CCRecCount

    	} catch (e) { }
    }
}


// TO-DO : 전결권자 및 문서 진행 상태 표기 함수
// 2017-05-22 BY YJYOO
function setApvStatus(oApvList) {
    var elmRoot = $(oApvList).find("steps");// 결재선
    var strConsultApv = getInfo('strConsultJson');

    //1. 전결권자 처리 => 기안부서 맨 마지막 결재자 표시
    //TO-DO : 일부양식 예외 처리 필요함(발신처에 포함되지만 수신처로 그리고 있음)
    //(1). ROLE 결재자 이전이 전결권자
    //인사발령 GW_REQUEST_W05
    //서식등록 GOJR_FIXFORM
    //문화회관 KWHK_CUL_ADT_W01 
    //통합신청서 HWGP_COMMONRQST_W01 (20200709 HJW 추가)
    var strApvOwner;
    if (getInfo("fmpf") == "GW_REQUEST_W05" || getInfo("fmpf") == "GOJR_FIXFORM" || getInfo("fmpf") == "KWHK_CUL_ADT_W01" || getInfo("fmpf") == "HWGP_COMMONRQST_W01") {
        for (var i = 0; i < $(elmRoot).find("division[divisiontype='send'] > step").length; i++) {
            if ($($(elmRoot).find("division[divisiontype='send'] > step")[i]).attr("unittype") != "role") {
                strApvOwner = $($(elmRoot).find("division[divisiontype='send'] > step")[i]).find("ou > person");
            }
            else {
                break;
            }
        }
    }
    //(2). documentstepcode값이 REGISTER_RECEIVE
    //업무표준 GOJP_WORKFORM_W01
    //조건에 미주 - 트랜스 리드 업무표준 추가 GOJP_WORKFORM_OVERSEAS
    else if (getInfo("fmpf") == "GOJP_WORKFORM_W01" || getInfo("fmpf") == "GOJP_WORKFORM_OVERSEAS") {
        for (var i = 0; i < $(elmRoot).find("division[divisiontype='send'] > step > ou > person").length; i++) {
            if ($($(elmRoot).find("division[divisiontype='send'] > step > ou > person")[i]).attr("documentstepcode") != "REGISTER_RECEIVE") {
                strApvOwner = $($(elmRoot).find("division[divisiontype='send'] > step > ou > person")[i]);
            }
            else {
                break;
            }
        }
    }
    else{
        strApvOwner = $(elmRoot).find("division[divisiontype='send'] >  step[unittype!='role'][name!='MANAGE_DIVISION']:last > ou > person");// 전결권자 변수
    }
    // 기아해외출장품의 
    if (getInfo("fmpf").indexOf("KMC_OVER_BIZ_TRIP_MF") > 0) {
        strApvOwner = $(elmRoot).find("division[divisiontype='send'] >  step[unittype!='role'][name!='MANAGE_DIVISION'] > ou > person[documentstepcode!='MANAGEMENT_RECEIVE']:last");// 전결권자 변수
    }
    if (strApvOwner.length > 0) {
        //if ($(strApvOwner).)
        $('#APV_OWNER').text((strApvOwner != null && strApvOwner != undefined && ($(strApvOwner).attr("dutycode") != null && $(strApvOwner).attr("dutycode") != undefined && $(strApvOwner).attr("dutycode") != "")) ? CFN_GetDicDatas($(strApvOwner).attr("dutyname")) : Common.GetDic("lbl_apv_charge"));
    }

    //2. 문서 상태 처리 => 기안부서의 기안자 정보 + 작성중
    var strApvStatus = "";
    if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE") {
        strApvStatus = $(elmRoot).find("division[divisiontype=send] > step:first > ou > person");
        if (strApvStatus.length > 0)
            $('#ApvLineTemp').text((strApvStatus != null && strApvStatus != undefined && $(strApvStatus).attr("dutycode") != "") ? CFN_GetDicDatas($(strApvStatus).attr("dutyname")) + " " + Common.GetDic("btn_apv_drafting") : Common.GetDic("lbl_apv_charge") + " " + Common.GetDic("btn_apv_drafting"));
    }
    else {
    	if (getInfo("documentViewStateCode") == "COMPLETE" || getInfo("documentViewStateCode") == "PRE_COMPLETE") { // 20200610 hpark 예결함에서 선결
            if (getInfo("currentDocumentStateCode") == "COOPERATION_WAIT" || getInfo("currentDocumentStateCode") == "COOPERATION" || getInfo("currentDocumentStateCode") == "EXAMINATION") {
                if ($(strApvStatus).find("step").find("person").find("taskinfo[status='completed']").length == $(strApvStatus).find("step").find("person").length) { //협조완료
                    $('#ApvLineTemp').text(Common.GetDic("btn_apv_CompleteConsult"));
                } else if ($(strApvStatus).find("step").find("person").find("taskinfo[status='reject']").length > 0) { // 협조거부
                    $('#ApvLineTemp').text(Common.GetDic("btn_apv_RejectConsult"));
                }

            }
            else if (getInfo("currentDocumentStateCode") == "RECEIVE_WAIT" && getInfo("pdef") == "REQST_CRRF_PATTERN" && getInfo("openerDivisionType") == "RECEIVE")
            {
                if ($(strApvStatus).find("step").find("person").find("taskinfo[status='completed']").length == $(strApvStatus).find("step").find("person").length) { //협조완료
                    $('#ApvLineTemp').text(Common.GetDic("btn_apv_CompleteConsult"));
                } else if ($(strApvStatus).find("step").find("person").find("taskinfo[status='reject']").length > 0) { //반송
                    $('#ApvLineTemp').text(Common.GetDic("lbl_apv_returnForm"));
                }
            }
            else {
                //2. 문서 상태 처리 => 완료 때는 별도의 TEXT를 표기하지 않음
                $('#ApvLineTemp').text("");
            }
        }
        else if (getInfo("documentViewStateCode") == "REJECT") {
        	// 협조거부시 기각 부서정보 표시
        	if (getInfo("pdef") == "GENERAL_PATTERN" && getInfo("cooperDenyDeptInfo") && getInfo("cooperDenyDeptInfo").split("||").length > 4) { // getInfo("scCooperDenyReject") == "1"
        		var arrDeptInfo = getInfo("cooperDenyDeptInfo").split("||");
        		var str_display = XFN_GetDicInfo(arrDeptInfo[0] + ";" + arrDeptInfo[3] + ";" + arrDeptInfo[4]);
        		$('#ApvLineTemp').text(str_display + " " + Common.GetDic("btn_apv_RejectConsult"));
        	}
            else if (getInfo("currentDocumentStateCode") == "COOPERATION_WAIT" || getInfo("currentDocumentStateCode") == "COOPERATION" || getInfo("currentDocumentStateCode") == "EXAMINATION") {
            	$('#ApvLineTemp').text(Common.GetDic("btn_apv_RejectConsult"));
            	if (getInfo("pdef") == "COOPERATION_PATTERN") $('#ApvLineTemp').text(Common.GetDic("lbl_apv_returnForm")); 
            } else if (getInfo("currentDocumentStateCode") == "SEND") {
                strApvStatus = $(elmRoot).find("division[divisiontype='send']");
                var strApvStatusStep = $(strApvStatus).find("step:has(> ou > person > taskinfo[status='reject']), step:has(> ou > role > person > taskinfo[status='reject'])");//결재 진행중인경우
                if (strApvStatusStep.length > 0) {
                    $('#ApvLineTemp').text(((strApvStatusStep != null && strApvStatusStep.length > 0 && ($(strApvStatusStep).find("ou > person").attr("dutycode") != undefined && $(strApvStatusStep).find("ou > person").attr("dutycode") != "")) ? CFN_GetDicDatas($(strApvStatusStep).find("ou > person").attr("dutyname")) + " " : "") + Common.GetDic("btn_apv_Deny"));
                }
                else {
                    if (getInfo("pdef") == "REQUEST_PATTERN") { //기각
                        $('#ApvLineTemp').text(Common.GetDic("btn_apv_Deny"));
                    }
                    else {
                        $('#ApvLineTemp').text(Common.GetDic("lbl_apv_reject"));
                    }
                }
            } else {
            	if (getInfo("pdef") == "REQUEST_PATTERN") { //기각
            		$('#ApvLineTemp').text(Common.GetDic("btn_apv_Deny"));
            	} else {
            		//2. 문서 상태 처리 => 반송
            		$('#ApvLineTemp').text(Common.GetDic("lbl_apv_reject"));
            	}
            }
        }
        else if (getInfo("pdef") == "REQUEST_PATTERN") { //신청서

            strApvStatus = $(elmRoot).find("division > step:has(> ou > person > taskinfo[status='pending'])");

            if (strApvStatus.length > 0) {
                if (getInfo("documentViewStateCode") == "RESERVATION") {
                    $('#ApvLineTemp').text(Common.GetDic("lbl_apv_hold"));
                }
                else if ($(strApvStatus).attr("routetype") == "multi_charge") {
                    $('#ApvLineTemp').text(Common.GetDic("lbl_apv_receive") + Common.GetDic("lbl_apv_charge_person") + " " + Common.GetDic("RECEIVEWAIT"));
                }
                    //else if ($(strApvStatus).parent().parent().attr("routetype") == "receive_dept") {
                else if ($(strApvStatus).attr("routetype") == "receive_dept") {
                    $('#ApvLineTemp').text(Common.GetDic("lbl_apv_receive") + Common.GetDic("lbl_apv_department") + " " + Common.GetDic("RECEIVEWAIT"));
                }
                else {
                    if (strApvStatus.length != 1) {// 겸직일때
                        $('#ApvLineTemp').text((strApvStatus != null && strApvStatus != undefined && $(strApvStatus).find("[approverat='Y'] > ou > person").attr("dutycode") != "") ? CFN_GetDicDatas($(strApvStatus).find("[approverat='Y'] > ou > person").attr("dutyname")) + " " + Common.GetDic("lbl_apv_pending") : Common.GetDic("lbl_apv_charge") + " " + Common.GetDic("lbl_apv_pending"));
                    }
                    else {
                        $('#ApvLineTemp').text((strApvStatus != null && strApvStatus != undefined && $(strApvStatus).find("ou > person").attr("dutycode") != "") ? CFN_GetDicDatas($(strApvStatus).find("ou > person").attr("dutyname")) + " " + Common.GetDic("lbl_apv_pending") : Common.GetDic("lbl_apv_charge") + " " + Common.GetDic("lbl_apv_pending"));
                    }
                }
            }
            else {
                switch (getInfo("documentViewStateCode")) {
                    case "COMPLETE"://완료
                        $('#ApvLineTemp').text(Common.GetDic("lbl_ApprovalComplete"));
                        break;
                    case "REJECT"://기각
                        $('#ApvLineTemp').text(Common.GetDic("btn_apv_Deny"));
                        break;
                    case "CANCEL"://취소
                        $('#ApvLineTemp').text(Common.GetDic("btn_apv_cancel"));
                        break;
                    case "RESERVATION"://보류
                        $('#ApvLineTemp').text(Common.GetDic("lbl_apv_hold"));
                        break;
                }
            }
        }
        else if (getInfo("pdef") == "REQST_CRRF_PATTERN" && getInfo("openerDivisionType") == "RECEIVE") { //공문

            var strConsultApvLine; // 협조처 결재선
            if (strConsultApv != null && strConsultApv != undefined && strConsultApv != "") {
                strConsultApvLine = $.parseXML(strConsultApv); // 협조처 결재선
                strApvStatus = $(strConsultApvLine).find("steps > division:has(step:eq(0)[processinstanceid='" + getInfo("piid") + "'])"); // 협조처 결재선

                if (strApvStatus.length > 0 && getInfo("currentDocumentStateCode") != "") {
                    if (($(strApvStatus).length == $(strApvStatus).find("step[routetype='receive']").length) && ($(strApvStatus).find("step[routetype='receive']").length > 0 && $(strApvStatus).find("step[routetype='receive'] > ou > person > taskinfo[status='pending']").length > 0)) {
                        $('#ApvLineTemp').text(Common.GetDic("lbl_apv_Cooperation_Wait"));
                    }
                    else if ($(strApvStatus).find("step[routetype='approve']").length > 0 && $(strApvStatus).find("step[routetype='approve'] > ou > person > taskinfo[status='pending']").length > 0) {
                        $('#ApvLineTemp').text(Common.GetDic("lbl_apv_Cooperation_Process"));
                    }
                    else if ($(strApvStatus).find("step").find("person").find("taskinfo[status='completed']").length == $(strApvStatus).find("step").find("person").length) { //협조완료
                        $('#ApvLineTemp').text(Common.GetDic("btn_apv_CompleteConsult"));
                    } else if ($(strApvStatus).find("step").find("person").find("taskinfo[status='reject']").length > 0) { // 협조 반송
                        $('#ApvLineTemp').text(Common.GetDic("lbl_apv_returnForm"));
                    }
                }
            }
        }
        else {
            if (getInfo("currentDocumentStateCode") == "SEND") {
                //발신부서의 경우
                strApvStatus = $(elmRoot).find("division[divisiontype='send']");
                if ($(strApvStatus).attr("divisiontype") == "send") {
                    //var strApvStatusPerson = $(strApvStatus).find("step > ou > person:has(taskinfo[status='pending'])");//결재 진행중인경우
                    var strApvStatusStep = $(strApvStatus).find("step:has(> ou > person > taskinfo[status='pending']), step:has(> ou > role > person > taskinfo[status='pending']), step:has(> ou > role > taskinfo[status='pending'])");//결재 진행중인경우

                    if (getInfo("documentViewStateCode") == "RESERVATION") {
                        $('#ApvLineTemp').text(Common.GetDic("lbl_apv_hold"));
                    }
                    else if (strApvStatusStep.length > 0) {
                        if ($(strApvStatusStep).attr("unittype") == "role") {
                            //$('#ApvLineTemp').text((strApvStatusStep != null && strApvStatusStep != undefined && $(strApvStatusStep).attr("name") != "") ? Common.GetDic($(strApvStatusStep).attr("name")) + " " + Common.GetDic("lbl_apv_pending") : "");
                            $('#ApvLineTemp').text((strApvStatusStep != null && strApvStatusStep != undefined && $(strApvStatusStep).find("ou > role").attr("name") != "") ? CFN_GetDicDatas($(strApvStatusStep).find("ou > role").attr("name")) + " " + Common.GetDic("lbl_apv_pending") : "");
                        }
                        else {
                            if (strApvStatusStep.length != 1) {// 겸직일때
                                $('#ApvLineTemp').text((strApvStatusStep != null && strApvStatusStep != undefined && $(strApvStatusStep).find("[approverat='Y'] > ou > person").attr("dutycode") != "") ? CFN_GetDicDatas($(strApvStatusStep).find("[approverat='Y'] > ou > person").attr("dutyname")) + " " + Common.GetDic("lbl_apv_pending") : Common.GetDic("lbl_apv_charge") + " " + Common.GetDic("lbl_apv_pending"));
                            }
                            else {
                                $('#ApvLineTemp').text((strApvStatusStep != null && strApvStatusStep != undefined && $(strApvStatusStep).find("ou > person").attr("dutycode") != "") ? CFN_GetDicDatas($(strApvStatusStep).find("ou > person").attr("dutyname")) + " " + Common.GetDic("lbl_apv_pending") : Common.GetDic("lbl_apv_charge") + " " + Common.GetDic("lbl_apv_pending"));
                                // 기아해외출장품의
                                if (getInfo("fmpf").indexOf("KMC_OVER_BIZ_TRIP_MF") > 0 && $(strApvStatusStep).find("ou > person").attr("documentstepcode") == "MANAGEMENT_RECEIVE") {
                                    $('#ApvLineTemp').text(CFN_GetDicDatas($(strApvStatusStep).find("ou").attr("name")) + " " + Common.GetDic("btn_apv_charge") + " " + Common.GetDic("lbl_apv_pending"));
                                }
                            }
                            
                        }
                    }
                    else {
                        switch (getInfo("documentViewStateCode")) {
                            case "COMPLETE"://완료
                                $('#ApvLineTemp').text(Common.GetDic("lbl_ApprovalComplete"));
                                break;
                            case "REJECT"://기각
                                $('#ApvLineTemp').text(Common.GetDic("btn_apv_Deny"));
                                break;
                            case "CANCEL"://취소
                                $('#ApvLineTemp').text(Common.GetDic("btn_apv_cancel"));
                                break;
                            case "RESERVATION"://보류
                                $('#ApvLineTemp').text(Common.GetDic("lbl_apv_hold"));
                                break;
                        }
                    }

                }
            }
            else if (getInfo("currentDocumentStateCode") == "COOPERATION_WAIT" || getInfo("currentDocumentStateCode") == "COOPERATION" || getInfo("currentDocumentStateCode") == "EXAMINATION") {
                var strConsultApvLine; // 협조처 결재선

                if (strConsultApv != null && strConsultApv != undefined && strConsultApv != "") {
                    strConsultApvLine = $.parseXML(strConsultApv); // 협조처 결재선
                	//strApvStatus = $(strConsultApvLine).find("steps > division[divisiontype='COOPERATION_PLACE'][oucode='" + getInfo("dpid_apv") + "']"); // 협조처 결재선
                    strApvStatus = $(strConsultApvLine).find("steps > division:has(step:eq(0)[processinstanceid='" + getInfo("piid") + "'])"); // 협조처 결재선
                }

                if (strConsultApv != null && strConsultApv != undefined && strConsultApv != "") {
                    if (strApvStatus.length > 0 && getInfo("currentDocumentStateCode") != "") {
                        if (($(strApvStatus).length == $(strApvStatus).find("step[routetype='assist']").length) && ($(strApvStatus).find("step[routetype='assist']").length > 0 && $(strApvStatus).find("step[routetype='assist'] > ou > person > taskinfo[status='pending']").length > 0)) {
                            $('#ApvLineTemp').text(Common.GetDic("lbl_apv_Cooperation_Wait"));
                        }
                            //else if ($(strApvStatus).find("step").length > 1 && $(strApvStatus).find("step > ou > person > taskinfo[status='pending']").length > 0) {
                            //}
                        else if ($(strApvStatus).find("step[routetype='examine']").length > 0 && $(strApvStatus).find("step[routetype='assist'] > ou > person > taskinfo[status='pending']").length > 0) { //  검토완료
                            $('#ApvLineTemp').text(Common.GetDic("lbl_apv_Cooperation_Process"));
                        } else if ($(strApvStatus).find("step[routetype='assist']").length > 0 && $(strApvStatus).find("step[routetype='examine'] > ou > person > taskinfo[status='pending']").length > 0) { // 검토중
                            $('#ApvLineTemp').text(Common.GetDic("lbl_apv_Cooperation_Process"));
                        } else if ($(strApvStatus).find("step").find("person").find("taskinfo[status='completed']").length == $(strApvStatus).find("step").find("person").length) { //협조완료
                            $('#ApvLineTemp').text(Common.GetDic("btn_apv_CompleteConsult"));
                        } else if ($(strApvStatus).find("step").find("person").find("taskinfo[status='reject']").length > 0) { // 협조거부
                        	$('#ApvLineTemp').text(Common.GetDic("btn_apv_RejectConsult"));
                        }
                    }
                }
            }
            else if (getInfo("pdef") == "STEP3_PATTERN" || getInfo("pdef") == "STEP4_PATTERN") { //3단계, 4단계 수신처 그리기
                strApvStatus = $(elmRoot).find("division[divisiontype='receive'] > step > ou > person:has(taskinfo[status='pending'])");
                if (strApvStatus.length > 0) {
                    var sDutyName = ""
                    if ($(strApvStatus).attr("dutycode") != null && $(strApvStatus).attr("dutycode") != "") {
                        sDutyName = CFN_GetDicDatas($(strApvStatus).attr("dutyname")) + " ";
                    } else {
                        sDutyName = Common.GetDic("lbl_apv_charge_person") + " ";
                    }

                    $('#ApvLineTemp').text(Common.GetDic("lbl_apv_receive") + sDutyName + Common.GetDic("lbl_apv_pending"));
                }
            }
        }
    }
    //3. 협조전류 프로세스이면서 
    if (getInfo("pdef") == "COOPERATION_PATTERN") {

        //발신처 완료되면 발신일 표기
        if (getInfo("COMPLETED_DATE") != null && getInfo("COMPLETED_DATE") != "") {
            if (getInfo("mode") != "DRAFT" && getInfo("mode") != "TEMPSAVE") {
                //협조전 LocalTiem 변환시 시분초 까지 넘겨 준다
                var Completed_DATE = CFN_TransLocalTime(getInfo("COMPLETED_DATE"), _UR_DateFormat);
                $("#Completed_DATE").val(Completed_DATE);
            }
        }
        //수신처이면 수신일 표기
        //TO-DO : AS-IS 오토웨이에 수신일은 첫번째 결재자 Action 날짜로 표시하고 있어서 변경
        if (getInfo("currentDocumentStateCode") != "SEND" && $("#ReceiveDate").length > 0) {
            var receiveDivision = $(elmRoot).find("division[divisiontype='receive']:first"); // 수신처정보
            //if ($(receiveDivision).length == 1 && $(receiveDivision).find("taskinfo").attr("datereceived") != undefined && $(receiveDivision).find("taskinfo").attr("datereceived") != "") {
            //    var ReceiveDate = CFN_TransLocalTime($(receiveDivision).find("taskinfo").attr("datereceived"), _UR_DateFormat);
            //    $("#ReceiveDate").val(ReceiveDate);
            //}
            //if ($(receiveDivision).length == 1 && $(receiveDivision).find("taskinfo").attr("datecompleted") != undefined && $(receiveDivision).find("taskinfo").attr("datecompleted") != "") {
            //    var ReceiveDate = CFN_TransLocalTime($(receiveDivision).find("taskinfo").attr("datecompleted"), _UR_DateFormat);
            //    $("#ReceiveDate").val(ReceiveDate);
            //}
            if ($(receiveDivision).length == 1 && $(receiveDivision).find("step > ou > person:first").find("taskinfo").attr("datecompleted") != undefined && $(receiveDivision).find("step > ou > person:first").find("taskinfo").attr("datecompleted") != "") {
                var ReceiveDate = CFN_TransLocalTime($(receiveDivision).find("step > ou > person:first").find("taskinfo").attr("datecompleted"), _UR_DateFormat);
                $("#ReceiveDate").val(ReceiveDate);
            }
        }
    }

}

// TO-DO : 결재의견 표시
// 최우석
//function setCommentDisplay(oApvList) {
//    var elmList;
//    var elmRoot = $(oApvList).find("steps");

//    if (elmRoot != null) {
//        $(elmRoot).find("division").each(function (i, element) {
//            /* 결재 의견이 하나라도 있으면 '<의견있음>' 표시  _최우석
//               1. 글자 클릭 시 팝업창으로 의견 목록 조회 
//               2. 하단에 의견 표시 
//            */
//            /*  
//                 의견종류코드 
//                 typecode
//                 결재의견  COMMENT 
//                 취소사유  CANCEL_REASON 
//                 검토의견  EXAMINATION 
//                 기각사유  REJECT_REASON 
//             */
//            //발신부서의견일때
//            var attachComment = [];
//            var table = "";
//            var tstart = "";
//            var tend = ""
//            var tcontent = "";
//            tstart = "<div>" + Common.GetDic("lbl_apv_comment_view_send") + "</div>"; //발신의견
//            tcontent = "<th style='text-align:center'>";
//            tcontent += "<dt><strong>";
//            tcontent += "" + Common.GetDic("TodoMsgType_ApprovalComment") + "";//결재의견
//            tcontent += "</strong></dt>";
//            tcontent += "</th>";

//            //지시의견
//            var table_opinion = "";
//            var tstart_opinion = "";
//            var tend_opinion = "";
//            var tcontent_opinion = "";
//            var recPersonChekc = '';//협조처 수신의견 체크
//            tstart_opinion = "<div>" + Common.GetDic("btn_apv_Order_comment") + "</div>"; //발신의견
//            tcontent_opinion = "<th style='text-align:center'>";
//            tcontent_opinion += "<dt><strong>";
//            tcontent_opinion += "" + Common.GetDic("btn_apv_Order_comment") + "";//결재의견
//            tcontent_opinion += "</strong></dt>";
//            tcontent_opinion += "</th>";

//            /*의견있을때 표시*/
//            if ($(m_oApvList).find("step > ou > person > taskinfo[visible!='n'] > comment[typecode='COMMENT'],step > ou > role > taskinfo[visible!='n'] > comment[typecode='COMMENT']").length > 0) {
//                //결재의견  $(elm).text().replace(/\n/g, "<br />")
//                //버튼에서 라벨로 변경
//                //$('#ApvLineTemp_comment').html("<span id='btCommentView' onclick='doButtonAction(this);'  style='cursor:pointer'><a class='c-button c-button--little' href='javascript:void(0);'>" + Common.GetDic("btn_apv_have_comment") + "</a></span>"); //의견 text, 다국어 :의견있음  btn_apv_have_comment                
//                $('#ApvLineTemp_comment').html("<span id='btCommentView' onclick='doButtonAction(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_Apporval_opnion_Exist") + "&gt;" + "</span>");
//            }
//            if ($(m_oApvList).find("step > ou > person > taskinfo[visible!='n'] > comment[typecode='SPECIAL_REPORT'],step > ou > role > taskinfo[visible!='n'] > comment[typecode='SPECIAL_REPORT']").length > 0 && getInfo('piid_parent') == "") {
//                //별도보고 수신부서에서는 보이지 않아야함 
//                //버튼에서 라벨로 변경
//                //$('#ApvLineTemp_special').html("<span id='btCommentView_special' onclick='btCommentSpecial(this);'  style='cursor:pointer' ><a class='c-button c-button--little' href='javascript:void(0);'>" + Common.GetDic("lbl_apv_Special_Report") + "</a></span>"); //의견 text, 다국어 :별도보고  btn_apv_have_comment 최우석                
//                //TO-DO : 예결함에서는 별도보고가 보이지 말아야 한다
//                //2017-09-27 BY YJYOO
//                if (getInfo("documentViewStateCode") == "SPECIAL_REPORT") {
//                    $('#ApvLineTemp_special').html("<span id='btCommentView_special' onclick='btCommentSpecial(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("lbl_apv_Special_Report") + "&gt;" + "</span>");
//                }

//            }

//            //총괄부서 검토의견 
//            if (getInfo("fmpf").indexOf("GWOK_INVEST") > -1 || getInfo("fmpf").indexOf("GWOK_PINVEST") > -1) {
//                if ($(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > role > person > taskinfo > comment[typecode='COMMENT']").length > 0) {
//                    var role_name = $(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > role").attr("name");
//                    var tcontents = "";
//                    tcontents = "<th style='text-align:center'>";
//                    tcontents += "<dt><strong>";
//                    //tcontents += "" + Common.GetDic("lbl_ctrlDept_comment") + "";//총괄부서 검토의견
//                    tcontents += CFN_GetDicDatas(role_name) + " " + Common.GetDic("COMMENT_TYPE_EXAMINATION") + "";//총괄부서 검토의견
//                    tcontents += "</strong></dt>";
//                    tcontents += "</th>";

//                    var testOrder = [];
//                    var testOrderList = [];
//                    $(m_oApvList).find("steps > division[divisiontype='send']> step > ou > role > person > taskinfo > comment[typecode='COMMENT']").each(function (comdiv, comdivlist) {
//                        var user_duty = XFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname")) == '' ? Common.GetDic("lbl_apv_charge") : CFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname"));
//                        testOrder.push($(comdivlist).attr('datecommented') + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent().attr('name')) + "^^^" + user_duty + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent("person").attr('ouname')) + "^^^" + XFN_ChangeOutputValue($(this).text().replace(/\n/g, "<br/>")) + "^^^" + $(comdivlist).attr('fileurl'));

//                    });
//                    var temp = '';
//                    for (var i = 0; i < testOrder.length; i++) {
//                        for (var a = i; a < testOrder.length; a++)
//                            if (testOrder[i] > testOrder[a]) {

//                                temp = testOrder[i];
//                                testOrder[i] = testOrder[a];
//                                testOrder[a] = temp;
//                            }
//                    }
//                    //[2017-06-13 11:34;TE황대원ST;차장;TE그룹웨어기술팀ST;asdf,
//                    for (var i = 0; i < testOrder.length; i++) {

//                        tstart = "<table class='table_10' id='table' style='margin-top:20px;'><tbody>";
//                        tend = "</tbody></table>"
//                        tcontents += "<tr>";
//                        tcontents += "</tr>";
//                        tcontents += "<tr>";
//                        tcontents += "<td style='padding:0px'>";
//                        //의견변경 testOrder[i].split(';')[0]
//                        tcontents += "<div class='form__textbox' style='width:100%'><div style='padding-top:5px;font-weight:700'>[" + CFN_TransLocalTime(testOrder[i].split('^^^')[0]) + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[1]) + " " + testOrder[i].split('^^^')[2] + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[3]) + "]</div>" + "<div style='padding-top:5px;padding-bottom:5px;word-wrap: break-word;'>" + fn_replaceXLCharacter(CFN_GetDicDatas(testOrder[i].split('^^^')[4])); // 20171101 hpark XSS 관련 수정 // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
//                        //파일
//                        if (testOrder[i].split('^^^')[5] != '') {

//                            var CountAttach = testOrder[i].split('^^^')[5];
//                            //var szURL = Common.GetBaseConfig('WebServicePath') + "/ClientWebService.asmx/AttachCmtList";
//                            var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList";
//                            var Param = String.format("{ messageID:'{0}'}", CountAttach);
//                            var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
//                            oResult = $.parseJSON(oResult);
//                            var xmlReturn = $.parseXML(oResult.d);

//                            var errorNode = $(xmlReturn).find("response > error");
//                            if (errorNode.length > 0) {
//                                Common.Error("Desc: " + errorNode.text());
//                                return false;
//                            }
//                            else {
//                                tcontents += "<div style='padding-top:5px;padding-bottom:5px;' id='" + CountAttach + "'>";
//                                var elmlist = $(xmlReturn).find("NewDataSet > Table");
//                                //$(elmlist).length
//                                $(elmlist).each(function (i, elm) {
//                                    //alert($(this).find("FileID").text());
//                                    var FileID = $(elm).find("FileID").text();
//                                    var MessageID = $(elm).find("MessageID").text();
//                                    var FileName = $(elm).find("FileName").text();
//                                    tcontents += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);


//                                    //tcontents += "&nbsp<a onclick='CommonFileDownLoadProcess(" + $(elm).find("FileID").text() + ',' + i + ',' + $(elm).find("MessageID").text() + ");'><img src='/images/images/Controls/file/data_any.gif' style='cursor:pointer' ></a>&nbsp;" + $(elm).find("FileName").text() + "&nbsp<i class='i-download'></i>&nbsp&nbsp";
//                                    //tcontents += "&nbsp<a onclick='DEXT5DownLoadProcess("+i+ ");'><img src='/images/images/Controls/file/data_any.gif'></a>&nbsp;" + $(elm).find("FileName").text() + "&nbsp<i class='i-download'></i>&nbsp&nbsp";
//                                });
//                                tcontents += "</div></div>";
//                            }
//                        }
//                        tcontents += "</td>";
//                        tcontents += "</tr>";

//                        table = tstart + tcontents + tend;
//                        $("#Comment_table_ctrldept").html(table);
//                    }
//                }
//            }

//            $(m_oApvList).find("steps > division[divisiontype='send'] > step, steps > division[divisiontype='receive'] > step").each(function (div, elmdiv) {
//                //if ($(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo > comment[typecode='COMMENT']").length > 0) {
//                if ($(m_oApvList).find("steps > division > step > ou > person > taskinfo > comment[typecode='COMMENT']").length > 0) {

//                    if ($(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo > comment[typecode='COMMENT']").length > 0 && div == 0) { //무조건 발신부서에 커맨트가 있으면 됨

//                        //발신부서 send 이면서 receive일때 
//                        var testOrder = [];
//                        var testOrderList = [];
//                        $(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > person > taskinfo > comment[typecode='COMMENT']").each(function (comdiv, comdivlist) {
//                            var user_duty = XFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname")) == '' ? Common.GetDic("lbl_apv_charge") : CFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname"));
//                            testOrder.push($(comdivlist).attr('datecommented') + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent().attr('name')) + "^^^" + user_duty + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent("person").attr('ouname')) + "^^^" + XFN_ChangeOutputValue($(this).text().replace(/\n/g, "<br/>")) + "^^^" + $(comdivlist).attr('fileurl'));
//                            //testOrder.push($(comdivlist).attr('datecommented') + ";" + CFN_GetDicDatas($(comdivlist).parent().parent().attr('name')) + ";" + user_duty + ";" + CFN_GetDicDatas($(comdivlist).parent().parent("person").attr('ouname')) + ";" + decodeURI($(this).text()).replace(/\n/g, "<br/>") + ";" + $(comdivlist).attr('fileurl'));

//                        });
//                        var temp = '';
//                        for (var i = 0; i < testOrder.length; i++) {
//                            for (var a = i; a < testOrder.length; a++)
//                                if (testOrder[i] > testOrder[a]) {

//                                    temp = testOrder[i];
//                                    testOrder[i] = testOrder[a];
//                                    testOrder[a] = temp;
//                                }
//                        }
//                        //[2017-06-13 11:34;TE황대원ST;차장;TE그룹웨어기술팀ST;asdf,
//                        for (var i = 0; i < testOrder.length; i++) {

//                            tstart = "<table class='table_10' id='table' style='margin-top:20px;'><tbody>";
//                            tend = "</tbody></table>"
//                            tcontent += "<tr>";
//                            tcontent += "</tr>";
//                            tcontent += "<tr>";
//                            tcontent += "<td style='padding:0px'>";
//                            //의견변경 testOrder[i].split(';')[0]
//                            tcontent += "<div class='form__textbox' style='width:100%'><div style='padding-top:5px;font-weight:700'>[" + CFN_TransLocalTime(testOrder[i].split('^^^')[0]) + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[1]) + " " + testOrder[i].split('^^^')[2] + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[3]) + "]</div>" + "<div style='padding-top:5px;padding-bottom:5px;word-wrap: break-word;'>" + fn_replaceXLCharacter(CFN_GetDicDatas(testOrder[i].split('^^^')[4])); // 20171101 hpark XSS 관련 수정 // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
//                            //파일
//                            if (testOrder[i].split('^^^')[5] != '') {

//                                var CountAttach = testOrder[i].split('^^^')[5];
//                                //var szURL = Common.GetBaseConfig('WebServicePath') + "/ClientWebService.asmx/AttachCmtList";
//                                var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList";
//                                var Param = String.format("{ messageID:'{0}'}", CountAttach);
//                                var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
//                                oResult = $.parseJSON(oResult);
//                                var xmlReturn = $.parseXML(oResult.d);

//                                var errorNode = $(xmlReturn).find("response > error");
//                                if (errorNode.length > 0) {
//                                    Common.Error("Desc: " + errorNode.text());
//                                    return false;
//                                }
//                                else {
//                                    tcontent += "<div style='padding-top:5px;padding-bottom:5px;' id='" + CountAttach + "'>";
//                                    var elmlist = $(xmlReturn).find("NewDataSet > Table");
//                                    //$(elmlist).length
//                                    $(elmlist).each(function (i, elm) {
//                                        //alert($(this).find("FileID").text());
//                                        var FileID = $(elm).find("FileID").text();
//                                        var MessageID = $(elm).find("MessageID").text();
//                                        var FileName = $(elm).find("FileName").text();
//                                        tcontent += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);


//                                        //tcontent += "&nbsp<a onclick='CommonFileDownLoadProcess(" + $(elm).find("FileID").text() + ',' + i + ',' + $(elm).find("MessageID").text() + ");'><img src='/images/images/Controls/file/data_any.gif' style='cursor:pointer' ></a>&nbsp;" + $(elm).find("FileName").text() + "&nbsp<i class='i-download'></i>&nbsp&nbsp";
//                                        //tcontent += "&nbsp<a onclick='DEXT5DownLoadProcess("+i+ ");'><img src='/images/images/Controls/file/data_any.gif'></a>&nbsp;" + $(elm).find("FileName").text() + "&nbsp<i class='i-download'></i>&nbsp&nbsp";
//                                    });
//                                    tcontent += "</div></div>";
//                                }
//                            }
//                            tcontent += "</td>";
//                            tcontent += "</tr>";

//                            table = tstart + tcontent + tend;
//                            $("#Comment_table").html(table);
//                        }


//                        //} else if ($(m_oApvList).find("steps > division[divisiontype='receive'] > step > ou > person > taskinfo > comment[typecode='COMMENT']").length > 0) { //무조건 발신부서에 커맨트가 있으면 됨
//                    } else if ($(elmdiv).parent().attr("divisiontype") == "receive") { //무조건 발신부서에 커맨트가 있으면 됨
//                        var testOrder = [];
//                        var testOrderList = [];
//                        $(elmdiv).find("ou > person > taskinfo > comment[typecode='COMMENT']").each(function (comdiv, comdivlist) {
//                            var user_duty = XFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname")) == '' ? Common.GetDic("lbl_apv_charge") : CFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname"));
//                            testOrder.push($(comdivlist).attr('datecommented') + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent().attr('name')) + "^^^" + user_duty + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent("person").attr('ouname')) + "^^^" + XFN_ChangeOutputValue($(this).text().replace(/\n/g, "<br/>")) + "^^^" + $(comdivlist).attr('fileurl'));
//                        });
//                        var temp = '';
//                        for (var i = 0; i < testOrder.length; i++) {
//                            for (var a = i; a < testOrder.length; a++)
//                                if (testOrder[i] > testOrder[a]) {

//                                    temp = testOrder[i];
//                                    testOrder[i] = testOrder[a];
//                                    testOrder[a] = temp;
//                                }
//                        }
//                        //[2017-06-13 11:34;TE황대원ST;차장;TE그룹웨어기술팀ST;asdf,
//                        for (var i = 0; i < testOrder.length; i++) {

//                            tstart = "<table class='table_10' id='table' style='margin-top:20px;'><tbody>";
//                            tend = "</tbody></table>"
//                            tcontent += "<tr>";
//                            tcontent += "</tr>";
//                            tcontent += "<tr>";
//                            tcontent += "<td style='padding:0px'>";
//                            //의견변경 testOrder[i].split(';')[0]
//                            tcontent += "<div class='form__textbox' style='width:100%'><div style='padding-top:5px;font-weight:700'>[" + CFN_TransLocalTime(testOrder[i].split('^^^')[0]) + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[1]) + " " + testOrder[i].split('^^^')[2] + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[3]) + "]</div>" + "<div style='padding-top:5px;padding-bottom:5px;word-wrap: break-word;'>" + fn_replaceXLCharacter(CFN_GetDicDatas(testOrder[i].split('^^^')[4])); // 20171101 hpark XSS 관련 수정 // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
//                            //파일
//                            if (testOrder[i].split('^^^')[5] != '') {

//                                var CountAttach = testOrder[i].split('^^^')[5];
//                                //var szURL = Common.GetBaseConfig('WebServicePath') + "/ClientWebService.asmx/AttachCmtList";
//                                var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList";
//                                var Param = String.format("{ messageID:'{0}'}", CountAttach);
//                                var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
//                                oResult = $.parseJSON(oResult);
//                                var xmlReturn = $.parseXML(oResult.d);

//                                var errorNode = $(xmlReturn).find("response > error");
//                                if (errorNode.length > 0) {
//                                    Common.Error("Desc: " + errorNode.text());
//                                    return false;
//                                }
//                                else {
//                                    tcontent += "<div style='padding-top:5px;padding-bottom:5px;' id='" + CountAttach + "'>";
//                                    var elmlist = $(xmlReturn).find("NewDataSet > Table");
//                                    //$(elmlist).length
//                                    $(elmlist).each(function (i, elm) {
//                                        //alert($(this).find("FileID").text());
//                                        var FileID = $(elm).find("FileID").text();
//                                        var MessageID = $(elm).find("MessageID").text();
//                                        var FileName = $(elm).find("FileName").text();
//                                        tcontent += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
//                                    });
//                                    tcontent += "</div></div>";
//                                }
//                            }
//                            tcontent += "</td>";
//                            tcontent += "</tr>";

//                            table = tstart + tcontent + tend;
//                            $("#Comment_table").html(table);
//                        }

//                        //STEP3_PATTERN 지시의견 
//                        if ($(elmdiv).find("ou > person > taskinfo > comment").length > 1
//                            //&& getInfo("pdef") == "STEP3_PATTERN"
//                            && $(elmdiv).attr("processinstanceid") == getInfo("piid")) {
//                            testOrder = [];
//                            testOrderList = [];
//                            tcontent = "";
//                            $(elmdiv).find("ou > person > taskinfo > comment[typecode='OPINION']").each(function (comdiv, comdivlist) {
//                                var user_duty = XFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname")) == '' ? Common.GetDic("lbl_apv_charge") : CFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname"));
//                                testOrder.push($(comdivlist).attr('datecommented') + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent().attr('name')) + "^^^" + user_duty + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent("person").attr('ouname')) + "^^^" + XFN_ChangeOutputValue($(this).text().replace(/\n/g, "<br/>")) + "^^^" + $(comdivlist).attr('fileurl'));
//                            });
//                            var temp = '';
//                            for (var i = 0; i < testOrder.length; i++) {
//                                for (var a = i; a < testOrder.length; a++)
//                                    if (testOrder[i] > testOrder[a]) {

//                                        temp = testOrder[i];
//                                        testOrder[i] = testOrder[a];
//                                        testOrder[a] = temp;
//                                    }
//                            }
//                            //[2017-06-13 11:34;TE황대원ST;차장;TE그룹웨어기술팀ST;asdf,
//                            for (var i = 0; i < testOrder.length; i++) {

//                                tstart = "<table class='table_10' id='table' style='margin-top:20px;'><tbody>";
//                                tend = "</tbody></table>"
//                                tcontent += "<tr>";
//                                tcontent += "</tr>";
//                                tcontent += "<tr>";
//                                tcontent += "<td style='padding:0px'>";
//                                //의견변경 testOrder[i].split(';')[0]
//                                tcontent += "<div class='form__textbox' style='width:100%'><div style='padding-top:5px;font-weight:700'>[" + CFN_TransLocalTime(testOrder[i].split('^^^')[0]) + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[1]) + " " + testOrder[i].split('^^^')[2] + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[3]) + "]</div>" + "<div style='padding-top:5px;padding-bottom:5px;word-wrap: break-word;'>" + fn_replaceXLCharacter(CFN_GetDicDatas(testOrder[i].split('^^^')[4])); // 20171101 hpark XSS 관련 수정 // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
//                                //파일
//                                if (testOrder[i].split('^^^')[5] != '') {

//                                    var CountAttach = testOrder[i].split('^^^')[5];
//                                    //var szURL = Common.GetBaseConfig('WebServicePath') + "/ClientWebService.asmx/AttachCmtList";
//                                    var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList";
//                                    var Param = String.format("{ messageID:'{0}'}", CountAttach);
//                                    var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
//                                    oResult = $.parseJSON(oResult);
//                                    var xmlReturn = $.parseXML(oResult.d);

//                                    var errorNode = $(xmlReturn).find("response > error");
//                                    if (errorNode.length > 0) {
//                                        Common.Error("Desc: " + errorNode.text());
//                                        return false;
//                                    }
//                                    else {
//                                        tcontent += "<div style='padding-top:5px;padding-bottom:5px;' id='" + CountAttach + "'>";
//                                        var elmlist = $(xmlReturn).find("NewDataSet > Table");
//                                        //$(elmlist).length
//                                        $(elmlist).each(function (i, elm) {
//                                            //alert($(this).find("FileID").text());
//                                            var FileID = $(elm).find("FileID").text();
//                                            var MessageID = $(elm).find("MessageID").text();
//                                            var FileName = $(elm).find("FileName").text();
//                                            tcontent += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
//                                        });
//                                        tcontent += "</div></div>";
//                                    }
//                                }
//                                tcontent += "</td>";
//                                tcontent += "</tr>";

//                                table = tstart + tcontent + tend;
//                                $("#Comment_table_spec").html(fnCommentHeadHtml(Common.GetDic("btn_apv_Order_comment"), tcontent));

//                            }
//                        }

//                    } else if ($(elmdiv).find("ou > person > taskinfo > comment[typecode='SPECIAL_REPORTX']").length > 0) { //별도보고 X
//                        //별도보고
//                        var user_duty = XFN_GetDicDatas($(elmdiv).find("person").attr("positionname")) == '' ? Common.GetDic("lbl_apv_charge") : CFN_GetDicDatas($(elmdiv).find("person").attr("positionname"));
//                        tstart_spec = "<table class='table_10' id='table' style='margin-top:20px;'><tbody>";
//                        tend_spec = "</tbody></table>"
//                        tcontent_spec += "<tr>";
//                        tcontent_spec += "</tr>";
//                        tcontent_spec += "<tr>";
//                        tcontent_spec += "<td style='border:0px'>";
//                        tcontent_spec += "<div style='padding-top:5px'>[" + CFN_TransLocalTime($(elmdiv).find("person").find('taskinfo').attr('datereceived')) + " " + CFN_GetDicDatas($(elmdiv).find("person").attr('name')) + " " + user_duty + " " + CFN_GetDicDatas($(elmdiv).find("person").attr('ouname')) + "]</div>" + "<div style='padding-top:5px;padding-bottom:5px'>" + XFN_ChangeOutputValue($(this).text().replace(/\n/g, "</div>")); // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)

//                        //파일
//                        if ($(this).find("ou > person > taskinfo >comment").attr('fileurl') != '') {
//                            var CountAttach = $(this).find("ou > person > taskinfo >comment").attr('fileurl');
//                            //var szURL = Common.GetBaseConfig('WebServicePath') + "/ClientWebService.asmx/AttachCmtList";
//                            var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList";
//                            var Param = String.format("{ messageID:'{0}'}", CountAttach);
//                            var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
//                            oResult = $.parseJSON(oResult);
//                            var xmlReturn = $.parseXML(oResult.d);

//                            var errorNode = $(xmlReturn).find("response > error");
//                            if (errorNode.length > 0) {
//                                Common.Error("Desc: " + errorNode.text());
//                                return false;
//                            }
//                            else {
//                                tcontent_spec += "<div style='padding-top:5px;padding-bottom:5px' id='" + CountAttach + "'>";
//                                var elmlist = $(xmlReturn).find("NewDataSet > Table");
//                                //$(elmlist).length
//                                $(elmlist).each(function () {
//                                    //alert($(this).find("FileID").text());
//                                    //tcontent_spec += "<a onclick='DEXT5DownLoadProcess('''" + $(this).find("FileID").text() + "'');'><img src='/images/images/Controls/file/data_any.gif'></a>&nbsp;&nbsp;";
//                                    var FileID = $(elm).find("FileID").text();
//                                    var MessageID = $(elm).find("MessageID").text();
//                                    var FileName = $(elm).find("FileName").text();
//                                    tcontent_spec += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
//                                });
//                                tcontent_spec += "</div>";
//                            }
//                        }
//                        tcontent_spec += "</td>";
//                        tcontent_spec += "</tr>";
//                        table_spec = tstart_spec + tcontent_spec + tend_spec;
//                        $("#Comment_table_spec").html(table_spec);


//                    }
//                    //else
//                        if ($(elmdiv).find("ou > person > taskinfo > comment[typecode='OPINION']").length > 0 && $(elmdiv).attr("processinstanceid") == getInfo("piid")) {
//                        $(m_oApvList).find("steps > division[divisiontype='receive'] > step:has(ou > person > taskinfo > comment[typecode='OPINION'])").each(function (divRec, elmdivRec) {

//                            $(m_oApvList).find("steps > division[divisiontype='receive'] > step").each(function (index, elmCo) {
//                                if ($(elmCo).find('ou > person').attr('code') == Common.GetSession("UR_Code") && getInfo('pdef') == 'COOPERATION_PATTERN') { //협조전이면서 협조처에서 결재선을 지정할때 부서가 다를 수 있음 같은 division으로 검사 
//                                    $('#ApvLineTemp_exa_comment').html("<span onclick='btCommentOpinion(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_apv_Order_comment") + "&gt;" + "</span>");
//                                }
//                            });

//                            //지시의견
//                            var user_duty = XFN_GetDicDatas($(elmdivRec).find("person").attr("positionname")) == '' ? Common.GetDic("lbl_apv_charge") : CFN_GetDicDatas($(elmdivRec).find("person").attr("positionname"));
//                            tstart_opinion = "<table class='table_10' id='table' style='margin-top:20px;'><tbody>";
//                            tend_opinion = "</tbody></table>"
//                            tcontent_opinion += "<tr>";
//                            tcontent_opinion += "</tr>";
//                            tcontent_opinion += "<tr>";
//                            tcontent_opinion += "<td style='padding:0px'>";
//                            tcontent_opinion += "<div class='form__textbox' style='width:100%'><div style='padding-top:5px'>[" + CFN_TransLocalTime($(elmdivRec).find("person").find('taskinfo').attr('datereceived')) + " " + CFN_GetDicDatas($(elmdivRec).find("person").attr('name')) + " " + user_duty + " " + CFN_GetDicDatas($(elmdivRec).find("person").attr('ouname')) + "]</div>" + "<div style='padding-top:5px;padding-bottom:5px;word-wrap: break-word;'>" + $(elmdivRec).find("ou > person > taskinfo > comment[typecode='OPINION']").text().replace(/\n/g, "</div>"); // 20171101 hpark XSS 관련 수정 XFN_ChangeOutputValue 삭제 // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
//                            //파일
//                            if ($(this).find("ou > person > taskinfo >comment").attr('fileurl') != '') {
//                                var CountAttach = $(this).find("ou > person > taskinfo >comment").attr('fileurl');
//                                var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList";
//                                var Param = String.format("{ messageID:'{0}'}", CountAttach);
//                                var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
//                                oResult = $.parseJSON(oResult);
//                                var xmlReturn = $.parseXML(oResult.d);

//                                var errorNode = $(xmlReturn).find("response > error");
//                                if (errorNode.length > 0) {
//                                    Common.Error("Desc: " + errorNode.text());
//                                    return false;
//                                }
//                                else {
//                                    tcontent_opinion += "<div style='padding-top:5px;padding-bottom:5px' id='" + CountAttach + "'>";
//                                    var elmlist = $(xmlReturn).find("NewDataSet > Table");
//                                    $(elmlist).each(function () {
//                                        var FileID = $(elm).find("FileID").text();
//                                        var MessageID = $(elm).find("MessageID").text();
//                                        var FileName = $(elm).find("FileName").text();
//                                        tcontent_opinion += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
//                                    });
//                                    tcontent_opinion += "</div></div>";
//                                }
//                            }
//                            tcontent_opinion += "</td>";
//                            tcontent_opinion += "</tr>";
//                            table_opinion = tstart_opinion + tcontent_opinion + tend_opinion;
//                            $("#Comment_table_opinion").html(table_opinion);
//                        });



//                    } else if ($(elmdiv).find("ou > person > taskinfo > comment[typecode='RECEIVE_REASON']").length > 0) {
//                        //
//                        //$(elmdiv).find("ou > person > taskinfo > comment[comment_type='reject_reason']").text();

//                    } else if ($(elmdiv).find("ou > person > taskinfo > comment[typecode='CANCEL_REASON']").length > 0) {
//                        //취소사유

//                    } else if ($(elmdiv).find("ou > person > taskinfo > comment[typecode='order']").length > 0) {
//                        //지시사항

//                    } else {
//                        //아무의견도 속하지 않을때 
//                        //var user_duty = XFN_GetDicDatas($(elmdiv).find("person").attr("positionname")) == '' ? Common.GetDic("lbl_apv_charge") : CFN_GetDicDatas($(elmdiv).find("person").attr("positionname"));
//                        //tstart = "<table class='table_10' id='table'><tbody>";
//                        //tend = "</tbody></table>"
//                        //tcontent += "<tr>";
//                        //tcontent += "</tr>";
//                        //tcontent += "<tr>";
//                        //tcontent += "<td style='border:0px'>";
//                        //tcontent += "<div style='padding-top:5px'>[" + CFN_TransLocalTime($(elmdiv).find("person").find('taskinfo').attr('datereceived'), "yyyy-MM-dd HH:mm") + " " + CFN_GetDicDatas($(elmdiv).find("person").attr('name')) + " " + user_duty + " " + CFN_GetDicDatas($(elmdiv).find("person").attr('ouname')) + "]</div>" + "<div style='padding-top:5px;padding-bottom:5px'>" + $(this).text().replace(/\n/g, "</div>");
//                        //tcontent += "</td>";
//                        //tcontent += "</tr>";
//                        //// ex) AS-IS 의견 위에 표시 여부 [2017-04-12 14:25 TEST2656104 차장 고객센터] 
//                        ////if (_Json_clas_nm[i].USER_ID != getInfo("usid")) $("#" + _Json_clas_nm[i].COMMENT_ID).prop("disabled", true);
//                        ////CFN_TransLocalTime($(elm).parent().attr("datereceived"), m_oInfoSrc._UR_DateFormat)

//                        //table = tstart + tcontent + tend;
//                        //$("#Comment_table").html(table);
//                    }
//                }
//            });

//        });
//    }

//    //수신부서의견 ->협조요청
//    //품의서 프로세스일 경우
//    if (getInfo("pdef") == "GENERAL_PATTERN"
//        || getInfo("pdef") == "UNITY_REQST_PATTERN"
//        || getInfo("pdef") == "ABROAD_PATTERN" || getInfo("pdef") == "INVEST_PATTERN") {
//        var consultApv_exa = getInfo('strConsultJson');
//        if (consultApv_exa != "") {
//            var tstart_rec = '';
//            var tend_rec = '';
//            var tcontent_rec = '';
//            tstart_rec = "<div>" + Common.GetDic("lbl_apv_comment_view_rec") + "</div>";//수신의견
//            tcontent_rec = "<th style='text-align:center'>";
//            tcontent_rec += "<dt><strong>";
//            tcontent_rec += Common.GetDic("lbl_apv_comment_view_rec"); //수신의견
//            tcontent_rec += "</strong></dt>";
//            tcontent_rec += "</th>";

//            //var consultApv_exa = "<steps initiatorcode='E550101' initiatoroucode='YKAC' status='active'><division name='COOPERATION_PLACE' divisiontype='COOPERATION_PLACE' oucode='AB4E5' ouname=''><taskinfo kind='COOPERATION_PLACE' result='' status='' datereceived='' /><step unittype='ou' routetype='assist' name=''><ou code='AB4E5' name=''><person code='9930254' name='' oucode='AB4E5' ouname='' position=';' title='' level=''><taskinfo status='completed' result='completed' kind='normal' customattribute1='' wiid='' ><comment typecode='EXAMINATION'><![CDATA[검토의견]]></comment></taskinfo></person></ou></step><step unittype='person' routetype='examine' name=''><ou code='AB4E5' name='TE구매시스템팀ST'><person code='2505734' name='TE유재욱ST' oucode='AB4E5' ouname='TE구매시스템팀ST' position='ko-KR;' title='' level=''><taskinfo status='pending' result='pending' kind='normal' customattribute1='' wiid='' /></person></ou></step></division></steps>";
//            consultApv_exa = $.parseXML(consultApv_exa);
//            var consultApvRoot_exa = $(consultApv_exa).find("steps > division[divisiontype='COOPERATION_PLACE']");


//            var oApvList = $.parseXML(document.getElementById("APVLIST").value);;//원본
//            var elmRoot = $(oApvList).find("steps");
//            var companycode_exa = '';
//            companycode_exa = $(elmRoot).find('division > step > ou').eq(0).attr('companycode'); //기안부서찾기


//            //기안부서와 협조부서들 코드 비교
//            var m_RecDept_exa = $('#CONSULT_LIST').val();
//            var UserDept_exa = true;
//            var aRecDept_exa = m_RecDept_exa.split("|");

//            /*수신부서의견 실시간으로 올리고 시간으로 나열하기때문에 따로 처리*/
//            //발신부서 send 이면서 receive일때 
//            var testOrder = [];
//            var testOrderList = [];

//            var table = '';
//            /*수신의견*/

//            $(consultApvRoot_exa).each(function (i) {

//                if ($(consultApvRoot_exa).eq(i).attr('oucode') == getInfo('dpid') && getInfo('piid_parent') != '' && $(consultApvRoot_exa).eq(i).find("step > ou > person > taskinfo > comment[typecode='RECEIVE_REASON']").length > 0) {

//                    $(consultApvRoot_exa).eq(i).find("step > ou > person > taskinfo > comment[typecode='RECEIVE_REASON']").each(function (comdiv, comdivlist) {
//                        var user_duty = XFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname")) == '' ? Common.GetDic("lbl_apv_charge") : CFN_GetDicDatas($(comdivlist).parent().parent().attr("positionname"));
//                        testOrder.push($(comdivlist).attr('datecommented') + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent().attr('name')) + "^^^" + user_duty + "^^^" + CFN_GetDicDatas($(comdivlist).parent().parent("person").attr('ouname')) + "^^^" + XFN_ChangeOutputValue($(this).text().replace(/\n/g, "<br/>")) + "^^^" + $(comdivlist).attr('fileurl'));

//                    });
//                    var temp = '';
//                    for (var i = 0; i < testOrder.length; i++) {
//                        for (var a = i; a < testOrder.length; a++)
//                            if (testOrder[i] > testOrder[a]) {

//                                temp = testOrder[i];
//                                testOrder[i] = testOrder[a];
//                                testOrder[a] = temp;
//                            }
//                    }
//                    //[2017-06-13 11:34;TE황대원ST;차장;TE그룹웨어기술팀ST;asdf,
//                    for (var i = 0; i < testOrder.length; i++) {


//                        tstart_rec = "<table class='table_10' id='table' style='margin-top:20px;'><tbody>";
//                        tend_rec = "</tbody></table>"
//                        tcontent_rec += "<tr>";
//                        tcontent_rec += "</tr>";
//                        tcontent_rec += "<tr>";
//                        tcontent_rec += "<td style='padding:0px'>";
//                        //의견변경 testOrder[i].split(';')[0]
//                        tcontent_rec += "<div class='form__textbox' style='width:100%'><div style='padding-top:5px;font-weight:700;'>[" + CFN_TransLocalTime(testOrder[i].split('^^^')[0]) + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[1]) + " " + testOrder[i].split('^^^')[2] + " " + CFN_GetDicDatas(testOrder[i].split('^^^')[3]) + "]</div>" + "<div style='padding-top:5px;padding-bottom:5px;word-wrap: break-word;'>" + fn_replaceXLCharacter(CFN_GetDicDatas(testOrder[i].split('^^^')[4]));  // 20171101 hpark XSS 관련 수정 // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)

//                        //파일
//                        if (testOrder[i].split('^^^')[5] != '') {

//                            var CountAttach = testOrder[i].split('^^^')[5];
//                            //var szURL = Common.GetBaseConfig('WebServicePath') + "/ClientWebService.asmx/AttachCmtList";
//                            var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList";
//                            var Param = String.format("{ messageID:'{0}'}", CountAttach);
//                            var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
//                            oResult = $.parseJSON(oResult);
//                            var xmlReturn = $.parseXML(oResult.d);

//                            var errorNode = $(xmlReturn).find("response > error");
//                            if (errorNode.length > 0) {
//                                Common.Error("Desc: " + errorNode.text());
//                                return false;
//                            }
//                            else {
//                                tcontent_rec += "<div style='padding-top:5px;padding-bottom:5px' id='" + CountAttach + "'>";
//                                var elmlist = $(xmlReturn).find("NewDataSet > Table");
//                                //$(elmlist).length
//                                $(elmlist).each(function (i, elm) {
//                                    var FileID = $(elm).find("FileID").text();
//                                    var MessageID = $(elm).find("MessageID").text();
//                                    var FileName = $(elm).find("FileName").text();
//                                    tcontent_rec += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
//                                });
//                                tcontent_rec += "</div></div>";
//                            }
//                        }
//                        tcontent_rec += "</td>";
//                        tcontent_rec += "</tr>";

//                        table = tstart_rec + tcontent_rec + tend_rec;
//                        $("#Comment_table_REC").html(table);
//                    }

//                }


//            });

//            /********************************************************/

//            //wsc_검토의견
//            if ($(consultApvRoot_exa).find("step > ou > person > taskinfo[visible!='n'] >  comment").length >= 1) { //comment가 하나라도 있으면 검토의견을 그릴 수있음 
//                $(consultApvRoot_exa).find("step").each(function (div, elmdiv) {

//                    if (getInfo('etid') != $(elmdiv).find('ou').attr('companycode')) {
//                        UserDept_exa = false;
//                    }

//                    /*검토의견 표시 
//                    결재선에서 division안에 자기가 있어야 표시 
//                    자기부서만 보여야함 
//                    수신의견이 아니여야함

//                    (consultApvRoot_exa).attr('oucode') 부서code
//                    */
//                    if ($(elmdiv).find('ou > person').attr('code') == Common.GetSession("UR_Code") && $(consultApvRoot_exa).find("step > ou > person > taskinfo[visible!='n'] >  comment[typecode!='RECEIVE_REASON']").length > 0) {
//                        //버튼에서 라벨로 변경
//                        //$('#ApvLineTemp_exa_comment').html("<span onclick='btComment_exa(this);' style='cursor:pointer'><a class='c-button c-button--little' href='javascript:void(0);'>" + Common.GetDic("btn_apv_have_comment_exa_2") + "</a></span>"); //의견 text, 다국어 :검토의견  btn_apv_have_comment
//                        if ($(elmdiv).attr("approvalorder") != "100" && $($(elmdiv).prev()).length > 0) {
//                            var exam_Comment_typecode = $($(elmdiv).prev()).find("ou > person > taskinfo > comment").attr("typecode");
//                            if (exam_Comment_typecode == "EXAMINATION") {
//                                $('#ApvLineTemp_exa_comment').html("<span onclick='btComment_exa(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_apv_have_comment_exa_2") + "&gt;" + "</span>");
//                            }
//                            else if (exam_Comment_typecode == "OPINION") {
//                                $('#ApvLineTemp_exa_comment').html("<span onclick='btCommentOpinion(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_apv_Order_comment") + "&gt;" + "</span>");
//                            }
//                        }

//                    }

//                    if ($(elmdiv).find("ou > person > taskinfo[visible!='n'] > comment").length > 0) {  //setp마다 comment가 있을때 그리기
//                        var dept_status_exa = '';

//                        //결재 상태 표기
//                        //division안에 상태를 표시하기위해 each문을 사용
//                        $(elmdiv).parent("division").each(function (i, element) {
//                            //각각 dvision마다 상태를 넣어야함 
//                            if ($(this).find("step > ou").find("person").find("taskinfo[status='reject']").length >= 1) {
//                                dept_status_exa = Common.GetDic("btn_apv_RejectConsult");// '협조거부';
//                            } else if ($(this).find("step > ou").find("person").find("taskinfo[status='completed']").length == $(this).find("ou").find("person").length) {
//                                dept_status_exa = Common.GetDic("btn_apv_CompleteConsult"); //'협조완료'
//                            } else if ($(this).find("step[routetype='examine']").length >= 1 && $(this).find("step[routetype='examine'] > ou > person > taskinfo[result='completed']").length >= 1 && $(this).find("step[routetype='examine'] > ou > person > taskinfo[result='pending']").length == 0) {
//                                dept_status_exa = Common.GetDic("btn_apv_CompleteReview"); //검토완료
//                            } else if ($(this).find("step > ou").find("person").find("taskinfo[status='pending']").length >= 1) {
//                                dept_status_exa = Common.GetDic("lbl_apv_Examination_Before"); //검토중
//                            }

//                        });

//                    }
//                });
//            }

//            /*새로생성*******************************************************/
//            tstart_exa = "<div>" + Common.GetDic("lbl_apv_comment_view_rec") + "</div>";//수신의견
//            tcontent_exa = "<th style='text-align:center'>";
//            tcontent_exa += "<dt><strong>";
//            tcontent_exa += Common.GetDic("btn_apv_have_comment_exa"); //검토의견
//            tcontent_exa += "</strong></dt>";
//            tcontent_exa += "</th>";
//            tstart_exa = "<table class='table_10' id='table' style='margin-top:20px;'><tbody>";
//            tend_exa = "</tbody></table>"

//            $(consultApvRoot_exa).find("step > ou > person:has(taskinfo[status='completed'],[status='reject']):last").each(function (idx, curPerson) {
//                var dept_status_exa = '';
//                if ($(curPerson).find('taskinfo > comment').length > 0) {
//                    //결재 상태 표기
//                    //division안에 상태를 표시하기위해 each문을 사용
//                    $(curPerson).parent().parent().parent("division").each(function (i, element) {

//                        //각각 dvision마다 상태를 넣어야함 
//                        if ($(this).find("step > ou").find("person").find("taskinfo[status='reject']").length >= 1) {
//                            dept_status_exa = Common.GetDic("btn_apv_RejectConsult");// '협조거부';
//                        } else if ($(this).find("step > ou").find("person").find("taskinfo[status='completed']").length == $(this).find("ou").find("person").length) {
//                            dept_status_exa = Common.GetDic("btn_apv_CompleteConsult"); //'협조완료'
//                        } else if ($(this).find("step[routetype='examine']").length >= 1 && $(this).find("step[routetype='examine'] > ou > person > taskinfo[result='completed']").length >= 1 && $(this).find("step[routetype='examine'] > ou > person > taskinfo[result='pending']").length == 0) {
//                            dept_status_exa = Common.GetDic("btn_apv_CompleteReview"); //검토완료
//                        } else if ($(this).find("step > ou").find("person").find("taskinfo[status='pending']").length >= 1) {
//                            dept_status_exa = Common.GetDic("lbl_apv_Examination_Before"); //검토중
//                        }
//                    });
//                    if (getInfo('etid') != $(curPerson).parent('ou').attr('companycode')) {
//                        UserDept_exa = false;
//                    }
//                    //tcontent_exa += "<tr>";
//                    //tcontent_exa += "</tr>";
//                    tcontent_exa += "<tr>";
//                    tcontent_exa += "<td style='padding: 0px;border:0px'>";
//                    tcontent_exa += "<div class='form__textbox' style='width:100%'>";
//                    if (UserDept_exa == true) {
//                        //tcontent_exa += "[" + CFN_TransLocalTime($(curPerson).find('taskinfo > comment').attr('datecommented'), "yyyy-MM-dd HH:mm") + " " + " " + CFN_GetDicDatas($(curPerson).attr('ouname')) + " " + dept_status_exa + "]" + "<br> " + $(curPerson).find("taskinfo > comment[typecode!='RECEIVE_REASON']").text().replace(/\n/g, "<br />");
//                        tcontent_exa += "<div style='padding-top:5px;font-weight: 700;'>";
//                        tcontent_exa += "[" + CFN_TransLocalTime($(curPerson).find('taskinfo > comment').attr('datecommented')) + " " + " " + CFN_GetDicDatas($(curPerson).attr('ouname')) + " " + dept_status_exa + "]"; // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
//                        tcontent_exa += "</div>";
//                        tcontent_exa += "<div style='padding-top:5px;padding-bottom: 5px;word-wrap: break-word;'>";
//                        tcontent_exa += fn_replaceXLCharacter($(curPerson).find("taskinfo > comment[typecode!='RECEIVE_REASON']").text()).replace(/\n/g, "<br />"); // 20171101 hpark XSS 관련 수정
//                        tcontent_exa += "</div>";
//                    } else {
//                        // ou에 회사명이 없는 경우가 상당수임 (회사명이 없는 경우의 고려가 필요함)
//                        if ($(curPerson).parent('ou').attr('companyname') != null && $(curPerson).parent('ou').attr('companyname') != undefined) {
//                            //tcontent_exa += "[" + CFN_TransLocalTime($(curPerson).find('taskinfo > comment').attr('datecommented'), "yyyy-MM-dd HH:mm") + " " + CFN_GetDicDatas($(curPerson).attr('ouname')) + " (" + CFN_GetDicDatas($(curPerson).find('ou').attr('companyname')) + ") " + dept_status_exa + "]" + "<br> " + $(curPerson).find("taskinfo > comment[typecode!='RECEIVE_REASON']").text().replace(/\n/g, "<br />");
//                            tcontent_exa += "<div style='padding-top:5px;'>";
//                            tcontent_exa += "[" + CFN_TransLocalTime($(curPerson).find('taskinfo > comment').attr('datecommented')) + " " + CFN_GetDicDatas($(curPerson).attr('ouname')) + " (" + CFN_GetDicDatas($(curPerson).parent('ou').attr('companyname')) + ") " + dept_status_exa + "]"; // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
//                            tcontent_exa += "</div>";
//                            tcontent_exa += "<div style='padding-top:5px;padding-bottom: 5px;'>";
//                            tcontent_exa += $(curPerson).find("taskinfo > comment[typecode!='RECEIVE_REASON']").text().replace(/\n/g, "<br />");
//                            tcontent_exa += "</div>";
//                        }
//                    }

//                    //파일
//                    if ($(this).find("ou > person > taskinfo >comment").attr('fileurl') != '') {

//                        var CountAttach = $(this).find("ou > person > taskinfo >comment").attr('fileurl');
//                        //var szURL = Common.GetBaseConfig('WebServicePath') + "/ClientWebService.asmx/AttachCmtList";
//                        var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList";
//                        var Param = String.format("{ messageID:'{0}'}", CountAttach);
//                        var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
//                        oResult = $.parseJSON(oResult);
//                        var xmlReturn = $.parseXML(oResult.d);

//                        var errorNode = $(xmlReturn).find("response > error");
//                        if (errorNode.length > 0) {
//                            Common.Error("Desc: " + errorNode.text());
//                            return false;
//                        }
//                        else {
//                            tcontent_exa += "<div style='padding-top:5px;padding-bottom:5px' id='" + CountAttach + "'>";
//                            var elmlist = $(xmlReturn).find("NewDataSet > Table");
//                            //$(elmlist).length
//                            $(elmlist).each(function (i, elm) {
//                                //alert($(this).find("FileID").text());
//                                var FileID = $(elm).find("FileID").text();
//                                var MessageID = $(elm).find("MessageID").text();
//                                var FileName = $(elm).find("FileName").text();
//                                tcontent_exa += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
//                                //tcontent += "&nbsp<a onclick='CommonFileDownLoadProcess(" + $(elm).find("FileID").text() + ',' + i + ',' + $(elm).find("MessageID").text() + ");'><img src='/images/images/Controls/file/data_any.gif' style='cursor:pointer' ></a>&nbsp;" + $(elm).find("FileName").text() + "&nbsp<i class='i-download'></i>&nbsp&nbsp";
//                                //tcontent += "&nbsp<a onclick='DEXT5DownLoadProcess("+i+ ");'><img src='/images/images/Controls/file/data_any.gif'></a>&nbsp;" + $(elm).find("FileName").text() + "&nbsp<i class='i-download'></i>&nbsp&nbsp";
//                            });
//                            tcontent_exa += "</div>";
//                        }
//                    }

//                    tcontent_exa += "</div>";
//                    tcontent_exa += "</td>";
//                    tcontent_exa += "</tr>";


//                    //if (_Json_clas_nm[i].USER_ID != getInfo("usid")) $("#" + _Json_clas_nm[i].COMMENT_ID).prop("disabled", true);
//                    table_exa = tstart_exa + tcontent_exa + tend_exa;
//                    $("#Comment_table_exa").html(table_exa);
//                }
//            });
//            /********************************************************/

//        }
//    }
//}

function setCommentDisplay_(oApvList) {
    /*
    일반의견:COMMENT,
    지시의견:OPINION,
    반송사유:RETURN_REASON, RECEIVE_REASON
    취소사유:CANCEL_REASON,
    기각사유:REJECT_REASON,
    별도보고:SPECIAL_REPORT,
    검토의견:EXAMINATION,
    지시사항:ORDER
    */
    var sCOMMENT_HTML = ""; //
    var sOPINION_HTML = "";
    var sRETURN_REASON_HTML = "";
    var sCANCEL_REASON_HTML = "";
    var sREJECT_REASON_HTML = "";
    var sSPECIAL_REPORT_HTML = "";
    var sEXAMINATION_HTML = "";
    var sORDER_HTML = "";
    var sCOMMENT_ROLE_HTML = "";

    $(oApvList).find("steps > division > step > ou > person > taskinfo > comment,steps > division > step > ou > role > person > taskinfo > comment").each(function (div, elmComment) {
        var elmDivision;
        var elmStep;
        var elmOu;
        var elmPerson;
        var elmObject = elmComment;
        while (elmObject.nodeName != "division" && elmObject.nodeName != null && elmObject.nodeName != null) {
            elmObject = $(elmObject).parent()[0];
            if (elmObject.nodeName == "person") elmPerson = elmObject;
            else if (elmObject.nodeName == "ou") elmOu = elmObject;
            else if (elmObject.nodeName == "step") elmStep = elmObject;
            else if (elmObject.nodeName == "division") elmDivision = elmObject;
        }

        var sTypecode = $(elmComment).attr("typecode");


        if (sTypecode == "COMMENT") {//일반의견
            if (getInfo("fmpf").indexOf("GWOK_INVEST") > -1 || getInfo("fmpf").indexOf("GWOK_PINVEST") > -1) {
                if ($(elmPerson).parent()[0].nodeName == "role") {//총괄부서 검토의견
                    sCOMMENT_ROLE_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);
                } else {
                    sCOMMENT_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);
                }
            } else {
                if ($(elmPerson).parent()[0].nodeName == "role") {//총괄부서 검토의견
                    sCOMMENT_ROLE_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);
                    //} else if (sCOMMENT_ROLE_HTML != "" && $(elmDivision).attr("divisiontype") == "send") {//총괄부서 검토의견
                    //    sCOMMENT_ROLE_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);
                } else if ($(elmStep).attr("name") == "rolestep") {//총괄부서 검토의견
                    sCOMMENT_ROLE_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);
                } else {
                    sCOMMENT_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);
                }
            }
        } else if (sTypecode == "OPINION" && getInfo("pdef") == "STEP3_PATTERN") {//STEP3_PATTERN 지시의견 
            if ($(elmStep).attr("processinstanceid") == getInfo("piid"))
                sOPINION_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);

            //} else if (sTypecode == "SPECIAL_REPORT" && getInfo("documentViewStateCode") == "SPECIAL_REPORT") {//별도보고
        } else if (sTypecode == "OPINION" && getInfo("piid_parent") != "" && $(elmDivision).attr("divisiontype") != "cooperation") {
                sOPINION_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);
        } else if (sTypecode == "SPECIAL_REPORT") {//별도보고
            if ($(elmStep).attr("processinstanceid") == getInfo("piid") && $(elmPerson).find("taskinfo").attr("status") == "pending") {
                sSPECIAL_REPORT_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);
            }

        } else if ($(elmDivision).attr("divisiontype") == "receive") {
            if (sTypecode != "RETURN_REQ_REASON" && sTypecode != "RETURN_REASON" && sTypecode != "REJECT_REASON" && sTypecode != "CANCEL_REASON" && $(elmStep).attr("processinstanceid") == getInfo("piid")) {
                if (!(getInfo("pdef") == "REQUEST_PATTERN")) { //기각 시 지시의견 없음. 품의서에서만 사용.
                    sOPINION_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment);
                }
            }
        }
    });
    var hasConsultComment = false;
    var ConsultCommentYN = false;
    var ConsultCommentHasYN = false;
    if (getInfo("pdef") == "GENERAL_PATTERN"
        || getInfo("pdef") == "INVEST_PATTERN" //투자품의
        || getInfo("pdef") == "ABROAD_PATTERN" //해외출장품의서류
        || getInfo("pdef") == "UNITY_REQST_PATTERN" //통합신청서류 
        ) {
        var consultApv_exa = getInfo('strConsultJson');
        consultApv_exa = $.parseXML(consultApv_exa);
        $(consultApv_exa).find("steps > division[divisiontype='COOPERATION_PLACE']").each(function (div, elmDivision) {
            //협조처 초기화
            ConsultCommentYN = false;
            if ($(elmDivision).find("step > ou > person > taskinfo > comment:last").length > 0) {
                if (getInfo("piid_parent") != "" && $(elmDivision).find("step[processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo > comment:last").length > 0) {
                    hasConsultComment = true;
                }
                
                var elmComment = $(elmDivision).find("step > ou > person > taskinfo > comment:last")[0];
                var elmFirstStep = $(elmDivision).find("step[approvalorder='100']");
                var elmStep;
                var elmOu;
                var elmPerson;
                var elmObject = elmComment;
                var elmFullComment = $(elmDivision).find("step > ou > person > taskinfo > comment");

                if ($(elmComment).attr("typecode") == "COMPLETE_CONSULT" && elmComment.textContent == "") {
                    ConsultCommentYN = true; ConsultCommentHasYN = true;
                    if($(elmDivision).find("step[processinstanceid='" + getInfo("piid") + "'] > ou > person > taskinfo > comment").length == 1 )
                    {
                        hasConsultComment = false;
                    }
                }

                while (elmObject.nodeName != "step" && elmObject.nodeName != null && elmObject.nodeName != null) {
                    elmObject = $(elmObject).parent()[0];
                    if (elmObject.nodeName == "person") elmPerson = elmObject;
                    else if (elmObject.nodeName == "ou") elmOu = elmObject;
                    else if (elmObject.nodeName == "step") elmStep = elmObject;
                }

                //글로비스 협조완료시 검토자가 등록한 첨부파일이 사라지는 현상 개선
                if (Common.GetBaseConfig("UseActCmtAttach") == "Y") {
                    var sFileurl = "";
                    $(elmFullComment).each(function (i, elm) {
                        if ($(elm).attr('fileurl') != null && $(elm).attr('fileurl') != undefined && $(elm).attr('fileurl') != "") {
                            sFileurl = $(elm).attr('fileurl');
                        }
                    });
                    if (!ConsultCommentYN || sFileurl != "") {
                        sEXAMINATION_HTML += fnCommentBodyHtml_GLOVIS(elmStep, elmOu, elmPerson, elmComment, elmFirstStep, elmFullComment);
                    }
                }
                else {
                    if (!ConsultCommentYN) {
                        sEXAMINATION_HTML += fnCommentBodyHtml(elmStep, elmOu, elmPerson, elmComment, elmFirstStep);
                    }
                }
            }
        });
    }

    if (sCOMMENT_HTML.length > 0 && (getInfo("DefaultComment") != "Y" && getInfo("DefaultCommentAll") != "Y")) {
        $("#Comment_table").html(fnCommentHeadHtml(Common.GetDic("TodoMsgType_ApprovalComment"), sCOMMENT_HTML));
        $('#ApvLineTemp_comment').html("<span id='btCommentView' onclick='doButtonAction(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_Apporval_opnion_Exist") + "&gt;" + "</span>");
    }
    if (sOPINION_HTML.length > 0 && (getInfo("DefaultOpinion") != "Y" && getInfo("DefaultCommentAll") != "Y")) {
        if (getInfo("pdef") == "REQST_CRRF_PATTERN") {
            $("#Comment_table_opinion").html(fnCommentHeadHtml(Common.GetDic("lbl_apv_comment_view_rec"), sOPINION_HTML));
            $('#ApvLineTemp_exa_comment').html("<span onclick='btCommentOpinion(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("lbl_apv_comment_view_rec") + "&gt;" + "</span>");
        }
        else {
            $("#Comment_table_opinion").html(fnCommentHeadHtml(Common.GetDic("btn_apv_Order_comment"), sOPINION_HTML));
            $('#ApvLineTemp_exa_comment').html("<span onclick='btCommentOpinion(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_apv_Order_comment") + "&gt;" + "</span>");
        }
    }
    if (sSPECIAL_REPORT_HTML.length > 0) {
        //if(getInfo("documentViewStateCode") == "SPECIAL_REPORT") {
        $('#ApvLineTemp_special').html("<span id='btCommentView_special' onclick='btCommentSpecial(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("lbl_apv_Special_Report") + "&gt;" + "</span>");
        //}
    }
    if (sCOMMENT_ROLE_HTML.length > 0 && (getInfo("DefaultCtrlComment") != "Y" && getInfo("DefaultCommentAll") != "Y")) {
        var role_name = $(m_oApvList).find("steps > division[divisiontype='send'] > step > ou > role").attr("name");
        $("#Comment_table_ctrldept").html(fnCommentHeadHtml(CFN_GetDicDatas(role_name) + " " + Common.GetDic("COMMENT_TYPE_EXAMINATION"), sCOMMENT_ROLE_HTML));
        $('#ApvLineTemp_comment').html("<span id='btCommentView' onclick='doButtonAction(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_Apporval_opnion_Exist") + "&gt;" + "</span>");
    }

    if ((sEXAMINATION_HTML.length > 0 || ConsultCommentHasYN) && (getInfo("DefaultExamination") != "Y" && getInfo("DefaultCommentAll") != "Y")) {
        if (From_ID != "PORTAL") {
            $("#Comment_table_exa").html(fnCommentHeadHtml(Common.GetDic("btn_apv_have_comment_exa"), sEXAMINATION_HTML));
            if (getInfo("piid_parent") != "" && hasConsultComment) $('#ApvLineTemp_exa_comment').html("<span onclick='btComment_exa(this);' style='color:red;font-weight:bold;cursor:pointer;'>" + "&lt;" + Common.GetDic("btn_apv_have_comment_exa_2") + "&gt;" + "</span>");
        }
    }
}

function fnCommentBodyHtml(_elmStep, _elmOu, _elmPerson, _elmComment, _parentStep) {
    var returnHtml = "";
    var sFileHtml = "";
   // 글로비스 통합품의서 검토의견 첨부파일 전부 보이도록 처리 STS HK.CHO
    if (getInfo("ENT_CODE") == "H138" && getInfo("fmpf") == "GWOK_FAIRTRADE") {
        if ($(_elmComment).attr('fileurl') != '') {//의견 첨부파일.
            var CountAttach = $(_elmComment).attr('fileurl');
            var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList_Add";
            var Param = String.format("{ messageID:'{0}'}", CountAttach);
            var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
            oResult = $.parseJSON(oResult);
            var xmlReturn = $.parseXML(oResult.d);

            var errorNode = $(xmlReturn).find("response > error");
            if (errorNode.length > 0) {
                Common.Error("Desc: " + errorNode.text());
                return false;
            }
            else {
                sFileHtml += "<div style='padding-top:5px;padding-bottom:5px' id='" + CountAttach + "'>";
                var elmlist = $(xmlReturn).find("NewDataSet > Table");
                $(elmlist).each(function (i, elm) {
                    var FileID = $(elm).find("FileID").text();
                    var MessageID = $(elm).find("MessageID").text();
                    var FileName = $(elm).find("FileName").text();
                    sFileHtml += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
                });
                sFileHtml += "</div>";
            }
        }
    }
    else {
        if ($(_elmComment).attr('fileurl') != '') {//의견 첨부파일.
            var CountAttach = $(_elmComment).attr('fileurl');
            var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList";
            var Param = String.format("{ messageID:'{0}'}", CountAttach);
            var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
            oResult = $.parseJSON(oResult);
            var xmlReturn = $.parseXML(oResult.d);

            var errorNode = $(xmlReturn).find("response > error");
            if (errorNode.length > 0) {
                Common.Error("Desc: " + errorNode.text());
                return false;
            }
            else {
                sFileHtml += "<div style='padding-top:5px;padding-bottom:5px' id='" + CountAttach + "'>";
                var elmlist = $(xmlReturn).find("NewDataSet > Table");
                $(elmlist).each(function (i, elm) {
                    var FileID = $(elm).find("FileID").text();
                    var MessageID = $(elm).find("MessageID").text();
                    var FileName = $(elm).find("FileName").text();
                    sFileHtml += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
                });
                sFileHtml += "</div>";
            }
        }
    }

    returnHtml += "<tr>";
    returnHtml += "<td style='padding: 0px;'>";
    returnHtml += "<div class='form__textbox' style='width: 100%;'>";
    if (_parentStep != null && _parentStep != undefined && $(_parentStep).find("ou").length > 0) {
        returnHtml += String.format("<div style='padding-top: 5px; font-weight: 700;'>[{0}({1})]</div>", CFN_GetDicDatas($(_parentStep).find("ou").attr("name")), CFN_GetDicDatas($(_parentStep).find("ou").attr("companyname")));
    }
    var sCompanyname = "";
    //if ($(_elmOu).attr('companycode') != getInfo('etid'))
    {
        sCompanyname = String.format("({0})", CFN_GetDicDatas($(_elmOu).attr('companyname')));
    }
    returnHtml += String.format("<div style='padding-top: 5px; font-weight: 700;'>[{0} {1} {2} {3}{4}]</div>"
                                , CFN_TransLocalTime($(_elmComment).attr('datecommented'))
                                , CFN_GetDicDatas($(_elmPerson).attr('name'))
                                , CFN_GetDicDatas($(_elmPerson).attr('positionname'))
                                , CFN_GetDicDatas($(_elmPerson).attr('ouname'))
                                , sCompanyname); // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
    returnHtml += String.format("<div style='padding-top: 5px; padding-bottom: 5px; -ms-word-wrap: break-word;'>{0}</div>"
                                , $(_elmComment).text().replace(/\n/g, "<br/>")); // 20171101 hpark XSS 관련 수정 XFN_ChangeOutputValue 삭제
    returnHtml += sFileHtml;
    returnHtml += "</div>";
    returnHtml += "</td>";
    returnHtml += "</tr>";
    return returnHtml;
}

function fnCommentBodyHtml_GLOVIS(_elmStep, _elmOu, _elmPerson, _elmComment, _parentStep, _elmFullComment) {
    var returnHtml = "";
    var sFileHtml = "";
    var sFileurl = "";


    $(_elmFullComment).each(function (i, elm) {
        if ($(elm).attr('fileurl') != null && $(elm).attr('fileurl') != undefined && $(elm).attr('fileurl') != "") {
            sFileurl = $(elm).attr('fileurl');
        }
        
    });

    if ($(_elmComment).attr('fileurl') != '' || sFileurl != "") {//의견 첨부파일.
        var CountAttach = ($(_elmComment).attr('fileurl')) == "" ? sFileurl : $(_elmComment).attr('fileurl') ;
        var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList_Add";
        var Param = String.format("{ messageID:'{0}'}", CountAttach);
        var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
        oResult = $.parseJSON(oResult);
        var xmlReturn = $.parseXML(oResult.d);

        var errorNode = $(xmlReturn).find("response > error");
        if (errorNode.length > 0) {
            Common.Error("Desc: " + errorNode.text());
            return false;
        }
        else {
            sFileHtml += "<div style='padding-top:5px;padding-bottom:5px' id='" + CountAttach + "'>";
            var elmlist = $(xmlReturn).find("NewDataSet > Table");
            $(elmlist).each(function (i, elm) {
                var FileID = $(elm).find("FileID").text();
                var MessageID = $(elm).find("MessageID").text();
                var FileName = $(elm).find("FileName").text();
                sFileHtml += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
            });
            sFileHtml += "</div>";
        }
    }

    returnHtml += "<tr>";
    returnHtml += "<td style='padding: 0px;'>";
    returnHtml += "<div class='form__textbox' style='width: 100%;'>";
    if (_parentStep != null && _parentStep != undefined && $(_parentStep).find("ou").length > 0) {
        returnHtml += String.format("<div style='padding-top: 5px; font-weight: 700;'>[{0}({1})]</div>", CFN_GetDicDatas($(_parentStep).find("ou").attr("name")), CFN_GetDicDatas($(_parentStep).find("ou").attr("companyname")));
    }
    var sCompanyname = "";
    //if ($(_elmOu).attr('companycode') != getInfo('etid'))
    {
        sCompanyname = String.format("({0})", CFN_GetDicDatas($(_elmOu).attr('companyname')));
    }
    returnHtml += String.format("<div style='padding-top: 5px; font-weight: 700;'>[{0} {1} {2} {3}{4}]</div>"
                                , CFN_TransLocalTime($(_elmComment).attr('datecommented'))
                                , CFN_GetDicDatas($(_elmPerson).attr('name'))
                                , CFN_GetDicDatas($(_elmPerson).attr('positionname'))
                                , CFN_GetDicDatas($(_elmPerson).attr('ouname'))
                                , sCompanyname); // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
    returnHtml += String.format("<div style='padding-top: 5px; padding-bottom: 5px; -ms-word-wrap: break-word;'>{0}</div>"
                                , $(_elmComment).text().replace(/\n/g, "<br/>")); // 20171101 hpark XSS 관련 수정 XFN_ChangeOutputValue 삭제
    returnHtml += sFileHtml;
    returnHtml += "</div>";
    returnHtml += "</td>";
    returnHtml += "</tr>";
    return returnHtml;
}

function fnCommentBodyHtml_GLOVIS(_elmStep, _elmOu, _elmPerson, _elmComment, _parentStep, _elmFullComment) {
    var returnHtml = "";
    var sFileHtml = "";
    var sFileurl = "";


    $(_elmFullComment).each(function (i, elm) {
        if ($(elm).attr('fileurl') != null && $(elm).attr('fileurl') != undefined && $(elm).attr('fileurl') != "") {
            sFileurl = $(elm).attr('fileurl');
        }
        
    });

    if ($(_elmComment).attr('fileurl') != '' || sFileurl != "") {//의견 첨부파일.
        var CountAttach = ($(_elmComment).attr('fileurl')) == "" ? sFileurl : $(_elmComment).attr('fileurl') ;
        var szURL = "/Approval/Controls/ApprovalExecuteWebService.asmx/AttachCmtList_Add";
        var Param = String.format("{ messageID:'{0}'}", CountAttach);
        var oResult = CFN_CallAjaxJson(szURL, Param, false, null);
        oResult = $.parseJSON(oResult);
        var xmlReturn = $.parseXML(oResult.d);

        var errorNode = $(xmlReturn).find("response > error");
        if (errorNode.length > 0) {
            Common.Error("Desc: " + errorNode.text());
            return false;
        }
        else {
            sFileHtml += "<div style='padding-top:5px;padding-bottom:5px' id='" + CountAttach + "'>";
            var elmlist = $(xmlReturn).find("NewDataSet > Table");
            $(elmlist).each(function (i, elm) {
                var FileID = $(elm).find("FileID").text();
                var MessageID = $(elm).find("MessageID").text();
                var FileName = $(elm).find("FileName").text();
                sFileHtml += String.format("&nbsp<a onclick='CommonFileDownLoadProcess(\"{0}\",\"{1}\",\"{2}\",\"{4}\");' style='cursor:pointer'><img src='/images/images/Controls/file/data_any.gif'  >&nbsp;{3}&nbsp;<i class='i-download' ></i></a>&nbsp&nbsp", FileID, i.toString(), MessageID, FileName, formJson.oFormData.DOC_LEVEL);
            });
            sFileHtml += "</div>";
        }
    }

    returnHtml += "<tr>";
    returnHtml += "<td style='padding: 0px;'>";
    returnHtml += "<div class='form__textbox' style='width: 100%;'>";
    if (_parentStep != null && _parentStep != undefined && $(_parentStep).find("ou").length > 0) {
        returnHtml += String.format("<div style='padding-top: 5px; font-weight: 700;'>[{0}({1})]</div>", CFN_GetDicDatas($(_parentStep).find("ou").attr("name")), CFN_GetDicDatas($(_parentStep).find("ou").attr("companyname")));
    }
    var sCompanyname = "";
    //if ($(_elmOu).attr('companycode') != getInfo('etid'))
    {
        sCompanyname = String.format("({0})", CFN_GetDicDatas($(_elmOu).attr('companyname')));
    }
    returnHtml += String.format("<div style='padding-top: 5px; font-weight: 700;'>[{0} {1} {2} {3}{4}]</div>"
                                , CFN_TransLocalTime($(_elmComment).attr('datecommented'))
                                , CFN_GetDicDatas($(_elmPerson).attr('name'))
                                , CFN_GetDicDatas($(_elmPerson).attr('positionname'))
                                , CFN_GetDicDatas($(_elmPerson).attr('ouname'))
                                , sCompanyname); // 20171204 hpark m/r/dField 날짜포멧 변경(댓글,의견)
    returnHtml += String.format("<div style='padding-top: 5px; padding-bottom: 5px; -ms-word-wrap: break-word;'>{0}</div>"
                                , $(_elmComment).text().replace(/\n/g, "<br/>")); // 20171101 hpark XSS 관련 수정 XFN_ChangeOutputValue 삭제
    returnHtml += sFileHtml;
    returnHtml += "</div>";
    returnHtml += "</td>";
    returnHtml += "</tr>";
    return returnHtml;
}

function fnCommentHeadHtml(_sTypecode, _BodyHtml) {
    var sTitle = _sTypecode;

    var returnHtml = "";

    returnHtml += "<table class='table_10' id='table' style='margin-top: 20px;'>";
    returnHtml += "<tbody>";
    returnHtml += "<tr>";
    returnHtml += "<th style='text-align: center;'>";
    returnHtml += "<dt>";
    returnHtml += "<strong>" + sTitle + "</strong>";
    returnHtml += "</dt>";
    returnHtml += "</th>";
    returnHtml += _BodyHtml;
    returnHtml += "</tbody>";
    returnHtml += "</table>";

    return returnHtml;
}

function fnCommentHeadHtml(_sTypecode, _BodyHtml) {
    var sTitle = _sTypecode;

    var returnHtml = "";

    returnHtml += "<table class='table_10' id='table' style='margin-top: 20px;'>";
    returnHtml += "<tbody>";
    returnHtml += "<tr>";
    returnHtml += "<th style='text-align: center;'>";
    returnHtml += "<dt>";
    returnHtml += "<strong>" + sTitle + "</strong>";
    returnHtml += "</dt>";
    returnHtml += "</th>";
    returnHtml += _BodyHtml;
    returnHtml += "</tbody>";
    returnHtml += "</table>";

    return returnHtml;
}

function formatDate(sDate, sMode) {
    /// <summary>
    ///  날짜 형식
    /// &#10; "R" : 2012년 03월 09일
    /// &#10; "D" : 2012-03-09
    /// &#10; "Y" : 2012년 03월 09일 (원래값이 2012.03.09 일때)
    /// &#10; "A" : 201203
    /// &#10; "APV" : 2012-03-09 09:45
    /// &#10; "M" : 2012.03
    /// &#10; else : 2012-03-09
    ///</summary>
    /// <param name="sDate" type="String">날짜</param>
    /// <param name="sMode" type="String">모드(null 가능)</param>
    /// <returns type="String" />
    //타임존 적용 2015-10-13 YHM
    var dtDate = XFN_TransDateServerFormat(CFN_TransLocalTime(formatDateCVT(sDate)));
    //var dtDate = formatDateCVT(sDate);
    var aRecDate = dtDate.split("-");
    var aRecDate2 = dtDate.split(".");
    if (sMode == "R") { // 2012년 03월 09일
        if (aRecDate.length > 2) { return aRecDate[0] + "년 " + aRecDate[1] + "월 " + aRecDate[2].substring(0, 2) + "일"; } else { return ""; }
    } else if (sMode == "D") {  // 2012-03-09
        if (aRecDate.length > 2) { return aRecDate[0] + "-" + aRecDate[1] + "-" + aRecDate[2].substring(0, 2); } else { return ""; }
    } else if (sMode == "Y") { // 2012년 03월 09일(원래값이 2012.03.09 일때)
        if (aRecDate2.length > 2) { return aRecDate2[0] + "년 " + aRecDate2[1] + "월 " + aRecDate2[2] + "일"; } else { return ""; }
    } else if (sMode == "A") { // 201203
        if (aRecDate.length > 2) { return aRecDate[0] + aRecDate[1]; } else { return ""; }
    } else if (sMode == "APV") {    // 2012-03-09 09:45
        if (aRecDate.length > 2) {
            var dtDate = new Date(dtDate.replace(/-/g, "/").replace(/오후/, "pm").replace(/오전/, "am"));
            //alert(dtDate);
            return dtDate.getFullYear() + "-" + dblDigit(dtDate.getMonth() + 1) + "-" + dblDigit(dtDate.getDate()) + " " + dblDigit(dtDate.getHours()) + ":" + dblDigit(dtDate.getMinutes());
        } else { return ""; }
    } else if (sMode == "CMT") {
        return XFN_TransDateLocalFormat(dblDigit(dtDate));
    } else if (sMode == "H") {    // 03/09 09:45
        if (aRecDate.length > 2) {
            var dtDate = new Date(dtDate.replace(/-/g, "/").replace(/오후/, "pm").replace(/오전/, "am"));
            //alert(dtDate);
            return dblDigit(dtDate.getMonth() + 1) + "/" + dblDigit(dtDate.getDate()) + " " + dblDigit(dtDate.getHours()) + ":" + dblDigit(dtDate.getMinutes());
        } else { return ""; }
    } else if (sMode == "S") {  // 2012
        if (aRecDate.length > 2) { return aRecDate[0]; } else { return ""; }
    } else if (sMode == "M") {  // 2012.03
        if (aRecDate.length > 2) { return aRecDate[0] + "." + aRecDate[1]; } else { return ""; }
    } else {    // 2012-03-09
        if (aRecDate.length > 2) {
            var dtDate = new Date(dtDate.replace(/-/g, "/").replace(/오후/, "pm").replace(/오전/, "am"));
            return aRecDate[0].substring(2, 4) + "/" + aRecDate[1] + "/" + aRecDate[2].substring(0, 2) + " " + dblDigit(dtDate.getHours()) + ":" + dblDigit(dtDate.getMinutes());
        } else { return ""; }
    }
}

function formatDate(sDate, sMode) {
    //return CFN_TransDateLocalFormat(CFN_TransLocalTime(formatDateCVT(sDate)));
    return CFN_TransLocalTime(sDate).substring(0,10);
}

function formatDateCVT(sDate) {
    if (sDate == "" || sDate == null)
        return "";
    var szDate = sDate.replace(/-/g, "/").replace(/오후/, "pm").replace(/오전/, "am");
    if (szDate.indexOf("pm") > -1) {
        szDate = szDate.replace("pm ", "");
        var atempPM = szDate.split(" ");
        var tmp = parseInt(atempPM[1].split(":")[0]) + 12;
        if (tmp > 23 && parseInt(atempPM[1].split(":")[1]) > 0) tmp = tmp - 12;
        tmp = dblDigit(tmp);
        var atempPM2 = atempPM[0].split("/");
        szDate = atempPM2[1] + "/" + atempPM2[2] + "/" + atempPM2[0] + " " + tmp + atempPM[1].substring(atempPM[1].indexOf(":"), 10);
    } else {
        szDate = szDate.replace("am ", "");
        var atempAM = szDate.split(" ");
        var atempAM2 = atempAM[0].split("/");
        szDate = atempAM2[1] + "/" + atempAM2[2] + "/" + atempAM2[0] + " " + atempAM[1];
    }
    var dtDate = new Date(szDate);
    return dtDate.getFullYear() + "-" + dblDigit(dtDate.getMonth() + 1) + "-" + dblDigit(dtDate.getDate()) + " " + dblDigit(dtDate.getHours()) + ":" + dblDigit(dtDate.getMinutes()) + ":" + dblDigit(dtDate.getSeconds());
}

function dblDigit(iVal) { return (iVal < 10 ? "0" + iVal : iVal); }


/*
20171221 hpark 부서정보 가져오기(협조처 셋팅위해)
	pDN_Code : 회사코드(H101)
	pDeptCode : 부서코드(YECA)
	bSetting : 협조처 셋팅 여부(true,false)
	bExlist : 필수협조처 여부(true,false)
	bAdd : 추가/초기화 여부(true,false)
*/
function fn_SetConsultList(pDN_Code, pDeptCode, bSetting, bExlist, bAdd) {
    try {
        var szURL = "/Approval/Controls/ApprovalWebservice.asmx";
        var Param = String.format("{ DN_Code:'{0}',DeptCode:'{1}' }", pDN_Code, pDeptCode);
        var rtnString = "";
        var origin_CONSULT_LIST = ($("#CONSULT_LIST").val() ? $("#CONSULT_LIST").val() : "");
        var origin_CONSULT_EXLIST = ($("#CONSULT_EXLIST").val() ? $("#CONSULT_EXLIST").val() : "");
        CFN_CallAjaxJson(szURL + "/GetDeptInfoForConsultList", Param, false, function (data) {
            var oResult = $.parseJSON(data);
            var xmlReturn = $.parseXML(oResult.d);
            var errorNode = $(xmlReturn).find("error");
            if (errorNode.length > 0) {
                Common.Error("Desc: " + $(errorNode).text());
            } else {

                var elmlist = $(xmlReturn).find("Table");
                $(elmlist).each(function () {
                    var result = String.format("{0}:{1}:T:{2}::{3}:N:{4}:{5}:{6}|"
								, $(this).find("FARMCODE").text()
								, $(this).find("DN_CODE").text()
								, $(this).find("DEPTCODE").text()
								, $(this).find("ORGGRADECODE").text()
								, $(this).find("EXDISPLAYNAME_GR").text()
								, $(this).find("EXDISPLAYNAME_DN").text()
								, $(this).find("EXDISPLAYNAME_ORGGRADE").text());
                    rtnString = rtnString + result;

                    if (origin_CONSULT_LIST.indexOf(result) > -1) origin_CONSULT_LIST = origin_CONSULT_LIST.replace(result, '');
                    if (origin_CONSULT_EXLIST.indexOf(result) > -1) origin_CONSULT_EXLIST = origin_CONSULT_EXLIST.replace(result, '');
                });
            }
        });

        // 협조처 셋팅
        if (bSetting) {
            if (bAdd) {	// 협조처 추가
                $("#CONSULT_LIST").val(origin_CONSULT_LIST + rtnString);
                if (bExlist) {	// 필수협조처에 추가
                    $("#CONSULT_EXLIST").val(origin_CONSULT_EXLIST + rtnString);
                } else {		// 필수협조처에서 제거
                    $("#CONSULT_EXLIST").val(origin_CONSULT_EXLIST);
                }
            } else {	// 협조처 초기화
                $("#CONSULT_LIST").val(rtnString);
                if (bExlist) {	// 필수협조처에 추가
                    $("#CONSULT_EXLIST").val(rtnString);
                } else {		// 필수협조처에서 제거
                    $("#CONSULT_EXLIST").val("");
                }
            }
            if ($("#RecLine").length > 0) document.getElementById("RecLine").innerHTML = initConsultList();
        }
        return rtnString;
    }
    catch (e) {
        return "";
    }
}

/*
20171221 hpark 부서정보 가져오기(협조처 셋팅위해)
	pDN_Code : 회사코드(H101)
	pDeptCode : 부서코드(YECA)
	bExlist : 필수협조처만 삭제 여부(true,false)
*/
function fn_DelConsultList(pDN_Code, pDeptCode, bExlist) {
    var cList = $("#CONSULT_LIST").val();
    var ceList = $("#CONSULT_EXLIST").val();
    var delDept = "";

    delDept = fn_SetConsultList(pDN_Code, pDeptCode);
    if (delDept != "") {
        $("#CONSULT_EXLIST").val(ceList.replace(delDept, ''));
        if (!bExlist) $("#CONSULT_LIST").val(cList.replace(delDept, ''));
        if ($("#RecLine").length > 0) document.getElementById("RecLine").innerHTML = initConsultList();
    }
}



function displayAssistEx(elmList) {//신청서html
    var elmTaskInfo;
    var strDate;
    var Apvlines = "";
    var ApvPOSLines = ""; //부서명 or 발신부서,신청부서,담당부서,수신부서 등등 으로 표기<tr>
    var ApvSignLines = ""; //결재자 사인이미지 들어가는 부분<tr>
    var ApvApproveNameLines = ""; //결재자 성명 및 contextmenu 및 </br>붙임 후 결재일자 표기<tr>
    var ApvDateLines = ""; //사용안함
    var dept_name_td_Arr = [];
    elmList.each(function (i, elm) {
        elmTaskInfo = $(elm).find("taskinfo");

        if (elmTaskInfo.attr("visible") != "n") //결재선 숨기기한 사람 숨기기
        {
            var sTitle = "";

            var splittitle = ($(elm).attr("dutyname") != null && $(elm).attr("dutyname") != undefined && $(elm).attr("dutyname") != "") ? $(elm).attr("dutyname") : "";
            if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                sTitle = CFN_GetDicDatas(splittitle);


            strDate = ($(elmTaskInfo).attr("datecompleted") != "" && $(elmTaskInfo).attr("datecompleted") != undefined) ? $(elmTaskInfo).attr("datecompleted") : "";

            var split_elmTitle = ($(elm).attr("dutyname") != null && $(elm).attr("positionname") != undefined && $(elm).attr("positionname") != "") ? $(elm).attr("positionname") : "";
            elmTitle = (split_elmTitle != "") ? CFN_GetDicDatas(split_elmTitle) : Common.GetDic("lbl_apv_charge");

            //ApvApproveNameLines = (strDate == "") ? "&nbsp;" : "[" + Common.GetDic("lbl_apv_Cooperation_Complete") + "]";
            ApvApproveNameLines = (strDate == "") ? "&nbsp;" : ($(elmTaskInfo).attr("status").toUpperCase() == "REJECT" ? "[" + Common.GetDic("lbl_apv_Cooperation_Reject") + "]" : "[" + Common.GetDic("lbl_apv_Cooperation_Complete") + "]");
            

            if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "")
                ApvApproveNameLines += "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("ouname")), true) + " (" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
            else
                ApvApproveNameLines += "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("ouname")), true) + " " + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"

            ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");

            if (getInfo("fmpf") == 'WF_HPT_AW_INVESTMENT_GOODS' || getInfo("fmpf") == 'WF_HPT_AW_OVER_TECH_REQUEST' || getInfo("fmpf") == 'WF_HPT_AW_OVERSEAS_BUSINESS' || getInfo("fmpf") == 'WF_HPT_AW_PROJECT_INVESTMENT' || getInfo("fmpf") == 'WF_HPT_AW_SAP_PREFIX_WF500' || getInfo("fmpf") == 'WF_HPT_AW_SAP_PREFIX_WF503' || getInfo("fmpf") == 'WF_HPT_AW_SAP_PREFIX_WF504' || getInfo("fmpf") == 'WF_HPT_AW_SAP_PREFIX_WF505' || getInfo("fmpf") == 'WF_HPT_AW_SAP_PREFIX_WF506' || getInfo("fmpf") == 'WF_HPT_AW_SAP_PREFIX_WF508' || getInfo("fmpf") == 'WF_HPT_SAP_PREFIX_001' || getInfo("fmpf") == 'WF_TRANSYS_EXP001-D' || getInfo("fmpf") == 'WF_TRANSYS_INV001-D' || getInfo("fmpf") == 'WF_TRANSYS_INV002-D' || getInfo("fmpf") == 'WF_TRANSYS_INV005-D' || getInfo("fmpf") == 'WF_TRANSYS_INV006-D')
                dept_name_td_Arr.unshift(ApvApproveNameLines + " " + sTitle + " " + ApvDateLines);
            else
                dept_name_td_Arr.push(ApvApproveNameLines + " " + sTitle + " " + ApvDateLines);
        }
    });

    var szReturn = "";
    //개인 협조 기본 4줄로 셋팅 KBW20180523
    for (i = 0; i < 8; i++) {

        if (i == 0 || i == 2 || i == 4 || i == 6 || i == 8 || i == 10) {
            szReturn += "<tr>";
        }

        if ((dept_name_td_Arr[i] != '') && (dept_name_td_Arr[i] != undefined)) {
            szReturn += "<td>" + dept_name_td_Arr[i] + "</td>";

        } else {
            szReturn += "<td></td>";
        }

        if (i == 1 || i == 3 || i == 5 || i == 7 || i == 9 || i == 11) {
            szReturn += "</tr>";
        }
    }

    return "<table class='table_10' style='margin:0px; padding:0px; border:hidden;'><colgroup><col style='width:44.45%'/><col style='width:55.55%'/></colgroup>" + szReturn + "</table>";
}


function displayControlLineExt(elmList) {//신청서html
    var elmTaskInfo;
    var strDate;
    var ApvApproveNameLines = ""; //결재자 성명 및 contextmenu 및 </br>붙임 후 결재일자 표기<tr>
    var ApvDateLines = ""; //사용안함
    var dept_name_td_Arr = [];

    elmList.each(function (i, elm) {
        elmTaskInfo = $(elm).find("taskinfo");

        var roleperson = $(elm).find("person");
        if (roleperson.length > 0)
        {
            elm = roleperson[0];
            var sTitle = "";

            var splittitle = ($(elm).attr("dutyname") != null && $(elm).attr("dutyname") != undefined && $(elm).attr("dutyname") != "") ? $(elm).attr("dutyname") : "";
            if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                sTitle = CFN_GetDicDatas(splittitle);


            strDate = ($(elmTaskInfo).attr("datecompleted") != "" && $(elmTaskInfo).attr("datecompleted") != undefined) ? $(elmTaskInfo).attr("datecompleted") : "";

            var split_elmTitle = ($(elm).attr("dutyname") != null && $(elm).attr("positionname") != undefined && $(elm).attr("positionname") != "") ? $(elm).attr("positionname") : "";
            elmTitle = (split_elmTitle != "") ? CFN_GetDicDatas(split_elmTitle) : Common.GetDic("lbl_apv_charge");

            ApvApproveNameLines = (strDate == "") ? "&nbsp;" : "[" + Common.GetDic("OBT_STATUS_COMPLETE") + "] ";

            if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "")
                ApvApproveNameLines += "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("ouname")), true) + " (" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
            else
                ApvApproveNameLines += "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("ouname")), true) + " " + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"

            ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");

            dept_name_td_Arr.push(ApvApproveNameLines + " " + sTitle + " " + ApvDateLines);
        } else {
            ApvApproveNameLines = "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
            dept_name_td_Arr.push(ApvApproveNameLines);
        }
    });

    var szReturn = "";
    for (i = 0; i < dept_name_td_Arr.length ; i++) {

        if (i == 0 || i == 2 || i == 4 || i == 6 || i == 8 || i == 10) {
            szReturn += "<tr>";
        }

        if ((dept_name_td_Arr[i] != '') && (dept_name_td_Arr[i] != undefined)) {
            szReturn += "<td>" + dept_name_td_Arr[i] + "</td>";

        } else {
            szReturn += "<td></td>";
        }

        if (i == 1 || i == 3 || i == 5 || i == 7 || i == 9 || i == 11) {
            szReturn += "</tr>";
        }
    }

    return "<table class='table_10' style='margin:0px; padding:0px; border:hidden;'><colgroup><col style='width:44.45%'/><col style='width:55.55%'/></colgroup>" + szReturn + "</table>";
}

//팀장 결재선 설정 함수
function setManagerApprovalLine() {
    var tmp_apvlist = $.parseXML($("#APVLIST").val());
    $(tmp_apvlist).find("division[divisiontype='send'] > step:has(ou  taskinfo[kind != 'charge'])").remove();
    var initiator = $(tmp_apvlist).find("division[divisiontype='send'] > step > ou:has( person > taskinfo[kind='charge'])");
    var dn_code = $(initiator).attr("companycode");
    var deptcode = $(initiator).attr("code");
    if (getInfo("usismanager") == "Y") {
    }
    else {
        var sManagerCode = Common.GetObjectInfo("GR", _GR_Code, "ManagerCode").Table[0].ManagerCode;
        var sStep = makeStep(tmp_apvlist, sManagerCode, "approve", null, null, null, null);

        if ($(sStep).find("ou > person").attr("code") == sManagerCode) {
            $($(tmp_apvlist).find("division[divisiontype='send']")).append(sStep);
            $("#APVLIST").val(CFN_XmlToString(tmp_apvlist));
        }
        else {
            var GroupPath = Common.GetSession("GR_FullCode");
            var aGroupPath = GroupPath.split(";");
            var nStep = nStep - 1;
            var aDepth = aGroupPath.length - 2;
            for (var i = 0; i < aDepth; i++) {
                var tManagerCode = Common.GetObjectInfo("GR", aGroupPath[aDepth - i], "ManagerCode").Table[0].ManagerCode;
                if (tManagerCode != "") {
                    var tStep = makeStep(tmp_apvlist, tManagerCode, "approve", null, null, null, null);
                    if ($(tStep).find("ou > person").attr("code") == tManagerCode) {
                        $($(tmp_apvlist).find("division[divisiontype='send']")).append(tStep);
                        $("#APVLIST").val(CFN_XmlToString(tmp_apvlist));
                        break;
                    }
                }
            }
        }
    }
}

function displaycontrolEx(elmList)
{
    //트랜시스 투자품의서류 통제처표시 200211 홍성빈
    var elmTaskInfo;
    var strDate;
    var Apvlines = "";
    var ApvPOSLines = ""; //부서명 or 발신부서,신청부서,담당부서,수신부서 등등 으로 표기<tr>
    var ApvApproveNameLines = ""; //결재자 성명 및 contextmenu 및 </br>붙임 후 결재일자 표기<tr>
    var ApvDateLines = ""; //사용안함
    var dept_name_td_Arr = [];
    var prev_deptcd = "";
    elmList.each(function (i, elm) {
        elmTaskInfo = $(elm).find("taskinfo");
        var sTitle = "";
        var splittitle = ($(elm).attr("dutyname") != null && $(elm).attr("dutyname") != undefined && $(elm).attr("dutyname") != "") ? $(elm).attr("dutyname") : "";
            if (splittitle != "" && CFN_GetDicDatas(splittitle) != "")
                sTitle = CFN_GetDicDatas(splittitle);

            strDate = ($(elmTaskInfo).attr("datecompleted") != "" && $(elmTaskInfo).attr("datecompleted") != undefined) ? $(elmTaskInfo).attr("datecompleted") : "";

            var split_elmTitle = ($(elm).attr("dutyname") != null && $(elm).attr("positionname") != undefined && $(elm).attr("positionname") != "") ? $(elm).attr("positionname") : "";
            elmTitle = (split_elmTitle != "") ? CFN_GetDicDatas(split_elmTitle) : Common.GetDic("lbl_apv_charge");

            //ApvApproveNameLines = (strDate == "") ? "&nbsp;" : "[" + Common.GetDic("lbl_apv_Cooperation_Complete") + "]";
            ApvApproveNameLines = (strDate == "") ? "&nbsp;" : ($(elmTaskInfo).attr("status").toUpperCase() == "REJECT" ? "[" + Common.GetDic("lbl_apv_Cooperation_Reject") + "]" : "[" + Common.GetDic("lbl_apv_Cooperation_Complete") + "]");


            if ($(elm).attr("delegationAt") != null && $(elm).attr("delegationAt") != "")
                ApvApproveNameLines += "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("ouname")), true) + " (" + Common.GetDic("lbl_apv_Deputy") + ")" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"
            else
                ApvApproveNameLines += "<span>" + getLngLabel(XFN_GetDicInfo(elm.getAttribute("ouname")), true) + " " + getLngLabel(XFN_GetDicInfo(elm.getAttribute("name")), true) + "</span>"

            ApvDateLines = (strDate == "") ? "&nbsp;" : formatDate(strDate, "D");

        
            if ($(elm).attr("documentstepcode") == "EXAMINATION_RECEIVE" && $(elm).attr("documentstepcode") != undefined) {
                if ($(elm).attr("oucode").toString() == prev_deptcd) {
                    var oudeptnm = $(elm).attr("ouname").split(";");
                    dept_name_td_Arr.pop();
                    dept_name_td_Arr.push(oudeptnm[1].toString() + " " + Common.GetDic("lbl_apv_Examination_Process"));
                }
            }
            else{

                if (dept_name_td_Arr.length == 0)
                {
                    dept_name_td_Arr.push(ApvApproveNameLines + " " + sTitle + " " + ApvDateLines);
                }
                else if (dept_name_td_Arr.length > 0 && $(elm).attr("oucode").toString() == prev_deptcd) {
                    dept_name_td_Arr.pop();
                    dept_name_td_Arr.push(ApvApproveNameLines + " " + sTitle + " " + ApvDateLines);
                }
                else if (dept_name_td_Arr.length > 0 && $(elm).attr("oucode").toString() != prev_deptcd)
                {
                    dept_name_td_Arr.push(ApvApproveNameLines + " " + sTitle + " " + ApvDateLines);
                }
            }
                prev_deptcd = $(elm).attr("oucode").toString();
            
    });

    var szReturn = "";
    //트랜시스 투자품의서류 통제처사용 200131 홍성빈
    //if (getInfo("ENT_CODE") == "H104" && getInfo("fmpf").indexOf("WF_HPT_AW_SAP_PREFIX_WF50") > -1 && $(assistApvList).find("division[divisiontype='send'] > step[routetype='assist']").length < 1) { j = 4 };
    var j = dept_name_td_Arr.length > 2 ? 4 : 2;
    for (i = 0; i < dept_name_td_Arr.length; i++)
    {

        if (i == 0 || i == 2 || i == 4 || i == 6 || i == 8 || i == 10) {
            szReturn += "<tr>";
        }

        if ((dept_name_td_Arr[i] != '') && (dept_name_td_Arr[i] != undefined)) {
            szReturn += "<td>" + dept_name_td_Arr[i] + "</td>";

        } else {
            szReturn += "<td></td>";
        }

        if (i == 1 || i == 3 || i == 5 || i == 7 || i == 9 || i == 11) {
            szReturn += "</tr>";
        }
    }

    return "<table class='table_10' style='margin:0px; padding:0px; border:hidden;'><colgroup><col style='width:44.45%'/><col style='width:55.55%'/></colgroup>" + szReturn + "</table>";
}

// 결재방 헤더 셋팅
function setApprovalLineTitle() {
    if (getInfo('mode') == "DRAFT" || getInfo('mode') == "TEMPSAVE") {
        if (getInfo("chkApvLineNameYN") == "Y") {
            $("#SEND_TITLE").val(Common.GetDicAllLang("ApvLineName", getInfo("selSendDept")));
            $("#RECEIVE_TITLE").val(Common.GetDicAllLang("ApvLineName", getInfo("selReceiveDept1")));
            $("#RECEIVE_TITLE2").val(Common.GetDicAllLang("ApvLineName", getInfo("selReceiveDept2")));
            $("#APPROVAL_TITLE_YN").val("Y");
        } else {
            $("#APPROVAL_TITLE_YN").val("N");
        }
    }
}

// 결재방 수 체크
function cnkApprovalLine(oApvList) {
    var ReturnMsg = "";

    if (getInfo('typeImg') == "T12" || getInfo('typeImg') == "T13" || getInfo('typeImg') == "T14" || getInfo('typeImg') == "T15" || getInfo('typeImg') == "T16" ||
        getInfo('typeImg') == "T17" || getInfo('typeImg') == "T18" || getInfo('typeImg') == "T19" || getInfo('typeImg') == "T20" || getInfo('typeImg') == "T21") {
        var elmList, elmAssistList, ApvListMaxLength, ApvAssistListMaxLength;
        var CurrentDivisionIdx = getInfo("CurrentDivisionIdx");
        var elmDivison = $(oApvList).find("division:eq(" + CurrentDivisionIdx + ")");

        if (CurrentDivisionIdx == 0) {
            elmList = $(elmDivison).find("step[routetype='approve'][name!='MANAGE_DIVISION'][name!='MANAGE_PM'][name!='reference'][name!='CTRL_CFO'][name!='CTRL_CFO_HMB'] > ou > person[is_hidden!='Y'][documentstepcode!='EXAMINATION_RECEIVE'],step[routetype='approve'][name!='reference']  > ou > role[documentstepcode!='MANAGEMENT_RECEIVE'][documentstepcode!='CONTROL_DEPT_RECEIVE']");
        } else {
            var oStep = document.createElement("step");
            var oOU = document.createElement("ou");
            var oPerson = document.createElement("person");
            var oTaskinfo = document.createElement("taskinfo");
            var ApprovalCnt = $(oApvList).find("division:eq(" + (CurrentDivisionIdx - 1) + ")").find("step > ou > person[is_hidden!='Y'] > taskinfo[status='pending'], step > ou > person[is_hidden!='Y'] > taskinfo[status='inactive'], step >  ou > role > person[is_hidden!='Y'] > taskinfo[status='pending'], step > ou > person[is_hidden!='Y'] > taskinfo[status='inactive']").length;

            $(oStep).append(oOU);
            $(oOU).append(oPerson);
            $(oPerson).append(oTaskinfo);

            $(oStep).attr("approvalorder", "100");
            $(oStep).attr("approverat", "N");
            $(oStep).attr("routetype", "approve");
            $(oTaskinfo).attr("status", "inactive");
            $(oTaskinfo).attr("kind", "normal");

            elmList = $(elmDivison).find("step[name!='reference'] > ou > role,step[name!='reference'] > ou > person[is_hidden!='Y'] "); //(person|role)
            if ($(elmDivison).find("step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y']").length > 0) {
                if ($(elmDivison).find("step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[datecompleted!=''][datecompleted])").length > 0) {
                    elmList = $(elmDivison).find("step[name!='reference'] > ou > role,step[routetype!='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y'],step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y']:has(taskinfo[datecompleted!=''][datecompleted]) ");
                } else if ($(elmDivison).find("step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y'][code='" + getInfo('usid') + "'] ").length > 0 && ApprovalCnt == 0) {
                    elmList = $(elmDivison).find("step[name!='reference'] > ou > role,step[routetype!='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y'],step[routetype='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y'][code='" + getInfo('usid') + "'] ");
                } else {
                    elmList = $(elmDivison).prepend(oStep).find("step[name!='reference'] > ou > role,step[routetype!='multi_charge'][name!='reference'] > ou > person[is_hidden!='Y']");
                }
            } else if ($(elmDivison).find("step[routetype='receive_dept'][name!='reference'] > ou").length > 0 && $(elmDivison).find("step[routetype='receive_dept'][name!='reference'] > ou > person[is_hidden!='Y']").length == 0) {
                elmList = $(elmDivison).prepend(oStep).find("step[routetype!='receive_dept'][name!='reference'] > ou > role,step[routetype!='receive_dept'][name!='reference'] > ou > person[is_hidden!='Y'] ");
            } else if (elmList.length == 0) {
                elmList = $(elmDivison).find("step[routetype='receive'] > ou"); //(person|role)
            }
        }

        if (getInfo('typeImg') == "T13" || getInfo('typeImg') == "T14" || getInfo('typeImg') == "T15" || getInfo('typeImg') == "T16") {
            elmAssistList = $(elmDivison).closest('steps').find("step[routetype='assist'] > ou > person[is_hidden!='Y'][documentstepcode!='COOPERATION_REQUEST']").sort(function (a, b) {
                if ($(a).closest("step").attr("allottype") == "parallel" && $(a).find("taskinfo[datecompleted!=''][datecompleted]").length > 0 &&
                    $(b).closest("step").attr("allottype") == "parallel" && $(b).find("taskinfo[datecompleted!=''][datecompleted]").length == 0) {
                    return -1;
                } else {
                    return 1;
                }
            });
            elmList = elmList.filter(function (x) { return elmAssistList.toArray().indexOf(elmList[x]) < 0; });
        } else if (getInfo('typeImg') == "T12" || getInfo('typeImg') == "T17" || getInfo('typeImg') == "T18" || getInfo('typeImg') == "T19" || getInfo('typeImg') == "T20") {
            elmAssistList = $(elmDivison).find("step[routetype='assist'] > ou > person[is_hidden!='Y'][documentstepcode!='COOPERATION_REQUEST']").sort(function (a, b) {
                if ($(a).closest("step").attr("allottype") == "parallel" && $(a).find("taskinfo[datecompleted!=''][datecompleted]").length > 0 &&
                    $(b).closest("step").attr("allottype") == "parallel" && $(b).find("taskinfo[datecompleted!=''][datecompleted]").length == 0) {
                    return -1;
                } else {
                    return 1;
                }
            });
            elmList = elmList.filter(function (x) { return elmAssistList.toArray().indexOf(elmList[x]) < 0; });
        }

        if ((getInfo('typeImg') == "T13" || getInfo('typeImg') == "T15") && CurrentDivisionIdx > 0) {
            ApvListMaxLength = Number(Common.GetBaseConfig('HDEC_DIV_TYPE_MAX_APVLINE'));
        } else {
            ApvListMaxLength = Number(getInfo("scApvlineCntV"));
        }

        if (getInfo('typeImg') == "T13") {
            ApvAssistListMaxLength = Number(Common.GetBaseConfig('HDEC_DIV_TYPE_MAX_APVLINE'));
        } else {
            ApvAssistListMaxLength = Number(getInfo("scApvlineCntV"));
        }

        var ExceptConsultApprovalLine = Common.GetBaseConfig('ExceptConsultApprovalLine');
        if (elmList.length > ApvListMaxLength) {
            ReturnMsg = String.format(Common.GetDic("MSG_CHK_APVLINE_01"), ApvListMaxLength)
        } else if (ExceptConsultApprovalLine.split(";").indexOf(getInfo("fmpf")) < 0 && elmAssistList.length > ApvAssistListMaxLength) {
            ReturnMsg = String.format(Common.GetDic("MSG_CHK_APVLINE_02"), ApvAssistListMaxLength)
        }
    }

    return ReturnMsg;
}